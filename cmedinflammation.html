<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Community Medicine - Prevention Module</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a0b2e; /* Deep Purple Background */
            color: #ffffff;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #2d1b4e; 
        }
        ::-webkit-scrollbar-thumb {
            background: #fbbf24; 
            border-radius: 4px;
        }

        /* Animations */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .btn-glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 215, 0, 0.2);
            transition: all 0.3s ease;
        }
        
        .btn-glass:hover {
            background: rgba(255, 215, 0, 0.2);
            border-color: #fbbf24;
            transform: translateY(-2px);
        }

        .option-btn {
            transition: all 0.2s;
        }
        
        .option-btn.selected {
            border-color: #fbbf24;
            background: rgba(251, 191, 36, 0.1);
        }

        .correct-anim {
            background-color: #22c55e !important;
            border-color: #22c55e !important;
            color: white !important;
        }

        .wrong-anim {
            background-color: #ef4444 !important;
            border-color: #ef4444 !important;
            color: white !important;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Navbar -->
    <nav class="p-4 bg-opacity-90 backdrop-blur-md bg-[#2d1b4e] border-b border-yellow-500/30 sticky top-0 z-50 shadow-lg">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center gap-3">
                <i class="fa-solid fa-graduation-cap text-yellow-400 text-2xl"></i>
                <h1 class="text-xl md:text-2xl font-bold tracking-wider text-white">
                    COMMUNITY<span class="text-yellow-400">MED</span> QUIZ
                </h1>
            </div>
            <button onclick="goHome()" class="text-sm text-gray-300 hover:text-yellow-400 transition">
                <i class="fa-solid fa-house"></i> Home
            </button>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-grow container mx-auto p-4 md:p-6 flex flex-col items-center justify-center">
        
        <!-- Section Selection Screen -->
        <div id="section-menu" class="w-full max-w-4xl grid gap-6 fade-in">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold text-yellow-400 mb-2">Communicable Diseases & Prevention (K Park)</h2>
                <p class="text-gray-400">Select a Learning Objective to begin</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- Buttons generated by JS -->
            </div>
        </div>

        <!-- Quiz Screen -->
        <div id="quiz-container" class="w-full max-w-2xl hidden fade-in">
            <!-- Progress Header -->
            <div class="flex justify-between items-center mb-4 text-sm text-gray-400">
                <span id="progress-text">Question 1/20</span>
                <span id="score-badge" class="bg-yellow-500/20 text-yellow-400 px-3 py-1 rounded-full border border-yellow-500/30">
                    Score: 0
                </span>
            </div>
            
            <!-- Progress Bar -->
            <div class="w-full bg-gray-700 h-2 rounded-full mb-6 overflow-hidden">
                <div id="progress-bar" class="bg-gradient-to-r from-yellow-400 to-orange-500 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
            </div>

            <!-- Question Card -->
            <div class="bg-[#2d1b4e] border border-purple-500/30 rounded-2xl p-6 md:p-8 shadow-2xl relative overflow-hidden">
                <div class="absolute top-0 right-0 w-32 h-32 bg-yellow-500/10 rounded-full blur-3xl -mr-16 -mt-16"></div>
                
                <h3 id="question-text" class="text-xl md:text-2xl font-semibold mb-8 leading-relaxed text-gray-100">
                    Loading Question...
                </h3>

                <!-- Options -->
                <div id="options-container" class="grid gap-3">
                    <!-- Options injected here -->
                </div>

                <!-- Explanation Box -->
                <div id="explanation-box" class="mt-6 p-4 bg-blue-900/30 border border-blue-500/30 rounded-xl hidden">
                    <p class="text-blue-200 text-sm"><i class="fa-solid fa-circle-info mr-2"></i><span id="explanation-text"></span></p>
                </div>

                <!-- Next Button -->
                <button id="next-btn" onclick="nextQuestion()" class="mt-8 w-full bg-yellow-400 hover:bg-yellow-500 text-black font-bold py-3 px-6 rounded-xl shadow-lg transform transition hover:-translate-y-1 hidden">
                    Next Question <i class="fa-solid fa-arrow-right ml-2"></i>
                </button>
            </div>
        </div>

        <!-- Result Screen -->
        <div id="result-screen" class="w-full max-w-3xl hidden fade-in text-center">
            <div class="bg-[#2d1b4e] border border-yellow-500/30 rounded-3xl p-8 shadow-2xl">
                <div class="w-24 h-24 bg-yellow-400 rounded-full flex items-center justify-center mx-auto mb-6 shadow-[0_0_20px_rgba(251,191,36,0.5)]">
                    <i class="fa-solid fa-trophy text-4xl text-black"></i>
                </div>
                
                <h2 class="text-3xl font-bold text-white mb-2">Module Completed!</h2>
                <p class="text-gray-400 mb-6">Here is how you performed</p>

                <div class="text-6xl font-bold text-yellow-400 mb-8" id="final-score">0%</div>

                <div class="flex flex-col md:flex-row gap-4 justify-center mb-8">
                    <button onclick="restartModule()" class="btn-glass text-white px-8 py-3 rounded-xl font-semibold hover:bg-white/10">
                        <i class="fa-solid fa-rotate-right mr-2"></i> Retry Module
                    </button>
                    <button onclick="goHome()" class="bg-yellow-400 text-black px-8 py-3 rounded-xl font-semibold hover:bg-yellow-500 transition">
                        <i class="fa-solid fa-list mr-2"></i> Main Menu
                    </button>
                </div>

                <!-- Wrong Answers Section -->
                <div id="review-section" class="text-left mt-8 border-t border-gray-700 pt-8 hidden">
                    <h3 class="text-xl font-bold text-red-400 mb-4"><i class="fa-solid fa-circle-exclamation mr-2"></i>Review Incorrect Answers</h3>
                    <div id="wrong-answers-list" class="space-y-4">
                        <!-- Wrong answers injected here -->
                    </div>
                </div>
            </div>
        </div>

    </main>

    <footer class="text-center p-6 text-gray-600 text-sm">
        <p>Community Medicine Prevention Module • Designed for Mobile</p>
    </footer>

    <script>
        // --- DATA: 50 Community Medicine MCQs (K Park) ---
        const questionBank = [
            // CM-LO-1: Mode of Transmission & General Prevention (Q1-17)
            {
                id: 1, section: "CM-LO-1", question: "The period between the entry of the infectious agent and the appearance of the first sign or symptom is correctly defined as the:",
                options: ["Generation time", "Incubation period", "Serial interval", "Communicable period"], answer: 1,
                explanation: "The Incubation Period is the time from infection to the onset of clinical symptoms."
            },
            {
                id: 2, section: "CM-LO-1", question: "All are considered direct modes of transmission EXCEPT:",
                options: ["Droplet infection (short range)", "Direct contact (e.g., handshake)", "Fomite-borne transmission", "Contact with soil (e.g., hookworm)"], answer: 2,
                explanation: "Fomite-borne transmission (via inanimate objects like clothes or toys) is an indirect mode of transmission."
            },
            {
                id: 3, section: "CM-LO-1", question: "In the 'Chain of Infection', the infectious agent is followed immediately by the:",
                options: ["Portal of entry", "Reservoir", "Portal of exit", "Susceptible host"], answer: 1,
                explanation: "The sequence is Agent → Reservoir (source) → Portal of Exit. The reservoir harbors the agent."
            },
            {
                id: 4, section: "CM-LO-1", question: "An inanimate object (e.g., towel, doorknob) that conveys infection is known as a:",
                options: ["Vector", "Carrier", "Reservoir", "Fomite"], answer: 3,
                explanation: "Fomites are inanimate objects that can harbor and transmit pathogens."
            },
            {
                id: 5, section: "CM-LO-1", question: "The phenomenon where a human harbors a specific infectious agent without visible clinical illness and sheds the agent is known as:",
                options: ["Subclinical case", "Carrier state", "Inapparent infection", "Zoonosis"], answer: 1,
                explanation: "A carrier is an infected person who excretes the agent without suffering from the visible disease."
            },
            {
                id: 6, section: "CM-LO-1", question: "Which disease transmission is typically classified as 'vehicle-borne'?",
                options: ["Malaria transmitted by mosquitoes", "Typhoid fever via contaminated drinking water", "Tetanus via contaminated soil", "Influenza via short-range droplets"], answer: 1,
                explanation: "Vehicle-borne transmission involves inanimate material (like food, water, or blood) acting as the vehicle. Water is the classic vehicle for typhoid."
            },
            {
                id: 7, section: "CM-LO-1", question: "The best environmental measure to prevent the spread of droplet nuclei (airborne) diseases like Measles in a hospital setting is:",
                options: ["Routine handwashing", "Disinfection of fomites", "Negative pressure isolation rooms", "Contact tracing and quarantine"], answer: 2,
                explanation: "Airborne transmission requires specialized engineering controls like negative pressure isolation to contain droplet nuclei."
            },
            {
                id: 8, section: "CM-LO-1", question: "A disease that is constantly present at a predictable and stable level within a given geographical area or population is termed:",
                options: ["Pandemic", "Epidemic", "Endemic", "Sporadic"], answer: 2,
                explanation: "Endemic refers to the habitual presence and usual prevalence of a disease."
            },
            {
                id: 9, section: "CM-LO-1", question: "The concept of 'Herd Immunity' is a community protection measure primarily aimed at protecting the:",
                options: ["Reservoir population", "Non-immunized susceptible hosts", "Carrier state individuals", "Portal of entry sites"], answer: 1,
                explanation: "Herd immunity protects those who cannot be immunized (e.g., infants, immunocompromised) by having a high proportion of the population immune."
            },
            {
                id: 10, section: "CM-LO-1", question: "The period during which an infected person is able to transmit or shed the infectious agent to a susceptible host is called the:",
                options: ["Latent period", "Serial interval", "Communicable period", "Generation time"], answer: 2,
                explanation: "The communicable period is the time the agent can be transferred."
            },
            {
                id: 11, section: "CM-LO-1", question: "Biological transmission by an arthropod vector involves:",
                options: ["Simple mechanical transfer of the agent on the vector's legs", "Multiplication and/or development of the agent in the vector", "Contamination of food by the vector's body", "Passive transfer on the vector's body"], answer: 1,
                explanation: "In biological transmission, the infectious agent undergoes multiplication (e.g., Plasmodium in Anopheles) or developmental change in the vector before transmission."
            },
            {
                id: 12, section: "CM-LO-1", question: "The term used for an infection acquired by a patient during their stay in a hospital or other healthcare facility is:",
                options: ["Zoonosis", "Iatrogenic infection", "Nosocomial infection", "Latent infection"], answer: 2,
                explanation: "Nosocomial infections are healthcare-associated infections (HAI)."
            },
            {
                id: 13, section: "CM-LO-1", question: "What is the key purpose of 'quarantine' in public health communicable disease control?",
                options: ["Treatment of the infected cases", "Restriction of movement for apparently healthy contacts", "Isolation of the known sick individuals", "Terminal disinfection of infected premises"], answer: 1,
                explanation: "Quarantine limits the freedom of healthy contacts who may be incubating the disease."
            },
            {
                id: 14, section: "CM-LO-1", question: "General preventive measures against communicable diseases include all EXCEPT:",
                options: ["Provision of a safe and adequate water supply", "Health education of the public", "Specific immunization programs", "Adequate disposal of human and animal excreta"], answer: 2,
                explanation: "Specific immunization is categorized as a specific prevention measure, not a general one."
            },
            {
                id: 15, section: "CM-LO-1", question: "The infectious period in a subclinical case of disease is most difficult to control primarily because:",
                options: ["The agent is non-pathogenic", "The host is not contagious", "The case is not recognized clinically", "The infectious agent dies quickly"], answer: 2,
                explanation: "Lack of clinical recognition means the case cannot be isolated, allowing the person to continue spreading the agent unwittingly."
            },
            {
                id: 16, section: "CM-LO-1", question: "A common reservoir for human plague (Yersinia pestis) in an endemic rural area is:",
                options: ["Domesticated dogs", "Cattle and sheep", "Wild rodents", "Birds"], answer: 2,
                explanation: "Wild rodents (and their fleas) are the primary reservoir for endemic or sylvan plague."
            },
            {
                id: 17, section: "CM-LO-1", question: "The time interval between the receipt of infection and the maximal infectivity of the host is termed:",
                options: ["Communicable period", "Generation time", "Incubation period", "Serial interval"], answer: 1,
                explanation: "Generation time is the interval from infection to maximum infectivity, which may be shorter than the incubation period."
            },
            
            // CM-LO-2: Levels of Prevention (Primary, Secondary, Tertiary) (Q18-34)
            {
                id: 18, section: "CM-LO-2", question: "Which of the following interventions is a clear example of Primary Prevention?",
                options: ["Mass screening for breast cancer", "Case finding and prompt treatment of tuberculosis", "Immunization against Polio at 6 weeks", "Rehabilitation after a lower limb amputation"], answer: 2,
                explanation: "Primary prevention occurs before the onset of disease; immunization (specific protection) falls into this category."
            },
            {
                id: 19, section: "CM-LO-2", question: "The concept of 'Health Promotion' (e.g., advocating for healthy diets and lifestyles) is primarily related to which level of prevention?",
                options: ["Primordial prevention", "Primary prevention", "Secondary prevention", "Tertiary prevention"], answer: 0,
                explanation: "Primordial prevention acts *before* risk factors are established in the population, focusing on healthy patterns and environmental changes."
            },
            {
                id: 20, section: "CM-LO-2", question: "Secondary Prevention is characterized by measures that aim for:",
                options: ["Preventing the initial occurrence of disease", "Early diagnosis and prompt treatment", "Limiting disability and rehabilitation", "Avoiding the development of risk factors in childhood"], answer: 1,
                explanation: "Secondary prevention aims to detect disease in its early stages and treat it to arrest the progression."
            },
            {
                id: 21, section: "CM-LO-2", question: "Early detection of disease through mass screening programs (e.g., routine blood pressure checks) is a classic example of:",
                options: ["Primordial prevention", "Primary prevention", "Secondary prevention", "Tertiary prevention"], answer: 2,
                explanation: "Screening identifies disease in asymptomatic individuals, which is a key component of secondary prevention."
            },
            {
                id: 22, section: "CM-LO-2", question: "Measures taken to reduce the impairment and minimize functional disability after a disease has caused structural damage are categorized as:",
                options: ["Primary prevention", "Secondary prevention", "Tertiary prevention", "Specific protection"], answer: 2,
                explanation: "Tertiary prevention includes disability limitation and rehabilitation."
            },
            {
                id: 23, section: "CM-LO-2", question: "Giving Iron and Folic Acid tablets to pregnant women to prevent anemia is an example of which level of prevention?",
                options: ["Primordial", "Primary (Specific Protection)", "Secondary", "Tertiary"], answer: 1,
                explanation: "This is specific protection (part of primary prevention) as it intervenes before the disease (anemia) occurs."
            },
            {
                id: 24, section: "CM-LO-2", question: "Which intervention falls under Primordial Prevention?",
                options: ["Treating established hypertension with medication", "Mass drug administration for Lymphatic Filariasis", "Legislative banning of tobacco advertising aimed at youth", "Chemoprophylaxis for close contacts of meningitis"], answer: 2,
                explanation: "Banning advertising prevents the development of the risk factor (smoking habit) in the first place."
            },
            {
                id: 25, section: "CM-LO-2", question: "The 'Iceberg Phenomenon' of disease suggests that:",
                options: ["Most cases are severe and easily diagnosed", "The majority of disease burden is subclinical or undiagnosed", "All cases require advanced tertiary care", "Non-communicable diseases are always more prevalent"], answer: 1,
                explanation: "The submerged part of the iceberg represents the majority of disease burden: asymptomatic, undiagnosed, and latent cases."
            },
            {
                id: 26, section: "CM-LO-2", question: "Which is the most important component of the disability limitation stage in the natural history of disease?",
                options: ["Health education", "Chemoprophylaxis", "Adequate treatment and control of the disease", "Immunization"], answer: 2,
                explanation: "Adequate treatment during the pathogenesis period prevents the disease from progressing to irreversible damage/disability."
            },
            {
                id: 27, section: "CM-LO-2", question: "The 'Period of Prepathogenesis' in the natural history of disease corresponds to which level(s) of prevention?",
                options: ["Primary and Secondary", "Primordial and Primary", "Secondary and Tertiary", "Only Tertiary"], answer: 1,
                explanation: "Prepathogenesis is before the disease process starts in the host, covering Primordial (before risk factors) and Primary (before disease onset) prevention."
            },
            {
                id: 28, section: "CM-LO-2", question: "Providing occupational training and physical therapy to a patient who has suffered permanent functional loss from a stroke is an example of:",
                options: ["Primary prevention", "Disability limitation", "Rehabilitation", "Specific protection"], answer: 2,
                explanation: "Rehabilitation is the final stage of tertiary prevention, aiming at functional restoration."
            },
            {
                id: 29, section: "CM-LO-2", question: "Which measure primarily targets the 'Portal of Entry' in the chain of infection for the Primary Prevention of communicable diseases?",
                options: ["Water chlorination", "Isolation of sick cases", "Use of a face mask by a susceptible health worker", "Safe disposal of sewage"], answer: 2,
                explanation: "A face mask blocks the infectious agent's entry into the respiratory tract of the susceptible host."
            },
            {
                id: 30, section: "CM-LO-2", question: "The crucial difference between Primary and Secondary prevention is whether the disease process has:",
                options: ["Started in the host", "Been completely cured", "Spread to other members of the community", "Caused irreversible death"], answer: 0,
                explanation: "Primary prevention acts before the disease starts; Secondary acts after biological onset (pre-symptomatic or mild stage)."
            },
            {
                id: 31, section: "CM-LO-2", question: "A patient with established Type 2 Diabetes receiving regular retinal examinations to prevent blindness is performing:",
                options: ["Primary prevention", "Secondary prevention", "Tertiary prevention", "Specific protection"], answer: 1,
                explanation: "Screening (early detection/diagnosis of diabetic retinopathy) in an established patient is Secondary Prevention to prevent a major complication (blindness)."
            },
            {
                id: 32, section: "CM-LO-2", question: "Which preventive measure is classified as 'Specific Protection'?",
                options: ["Health education for all", "Immunization against a specific pathogen", "Mass screening for disease", "Rehabilitation services"], answer: 1,
                explanation: "Specific protection (part of Primary Prevention) involves measures directed at a specific disease or hazard, such as immunization."
            },
            {
                id: 33, section: "CM-LO-2", question: "The combination of 'Early Diagnosis' and 'Prompt Treatment' forms the core of which level of prevention?",
                options: ["Primordial", "Primary", "Secondary", "Tertiary"], answer: 2,
                explanation: "These two actions define Secondary Prevention, aiming to cure or halt the disease."
            },
            {
                id: 34, section: "CM-LO-2", question: "In the context of the levels of prevention, the immediate focus of 'Disability Limitation' is:",
                options: ["To prevent the initial exposure to the agent", "To prevent the progression of the disease to irreversible impairment", "To restore function after maximum damage", "To eliminate all risk factors from the environment"], answer: 1,
                explanation: "Disability limitation (Tertiary Prevention) intervenes in the late pathogenesis phase to prevent the impairment from turning into an irreversible disability."
            },
            
            // CM-LO-3: Immunoprophylaxis & Chemoprophylaxis (Q35-50)
            {
                id: 35, section: "CM-LO-3", question: "Passive immunity is medically administered for communicable diseases when there is a need for:",
                options: ["Long-lasting protection", "Immediate onset of protection", "Stimulation of the host's immune system", "Protection against endemic diseases"], answer: 1,
                explanation: "Passive immunity provides immediate, temporary protection through pre-formed antibodies (Immunoglobulin)."
            },
            {
                id: 36, section: "CM-LO-3", question: "Which combination is typically given to provide immediate and long-term protection after a severe exposure to an infection like Tetanus or Rabies?",
                options: ["Only the Toxoid/Vaccine (Active)", "Only the Immunoglobulin (Passive)", "Both Active Immunization and Passive Immunization", "Chemoprophylaxis only"], answer: 2,
                explanation: "Wound care is followed by both passive (immediate antibodies) and active (long-term memory) immunization."
            },
            {
                id: 37, section: "CM-LO-3", question: "Chemoprophylaxis, in the context of public health, is the administration of a drug to:",
                options: ["Treat an established, clinical infection", "Prevent infection or progression to overt disease", "Provide immediate passive immunity", "Boost the active immune response"], answer: 1,
                explanation: "Chemoprophylaxis uses chemical agents (drugs) to prevent an infectious disease from developing."
            },
            {
                id: 38, section: "CM-LO-3", question: "Which of the following is an example of a 'Live Attenuated' vaccine?",
                options: ["Tetanus Toxoid", "Inactivated Polio Vaccine (IPV)", "Measles, Mumps, Rubella (MMR)", "Hepatitis B Recombinant Vaccine"], answer: 2,
                explanation: "MMR is a classic live attenuated vaccine, providing strong, long-lasting cellular and humoral immunity."
            },
            {
                id: 39, section: "CM-LO-3", question: "The process of adding a substance (e.g., aluminum salts) to a non-live vaccine to enhance and prolong its immune response is called:",
                options: ["Attenuation", "Seroconversion", "Adjuvantation", "Neutralization"], answer: 2,
                explanation: "Adjuvants enhance the body's immune response to the vaccine antigen."
            },
            {
                id: 40, section: "CM-LO-3", question: "A primary challenge associated with the use of Live Attenuated vaccines is:",
                options: ["Lack of efficacy in young children", "The possibility of rare reversion to virulence in immunocompromised hosts", "Short duration of immunity requiring frequent boosters", "Requirement for high doses and complex routes of administration"], answer: 1,
                explanation: "Reversion to virulence and causing disease (vaccine-associated paralytic polio from OPV) is the most significant risk."
            },
            {
                id: 41, section: "CM-LO-3", question: "Chemoprophylaxis with Isoniazid (INH) is typically administered to contacts for the prevention of:",
                options: ["Typhoid Fever", "Leprosy", "Meningococcal Meningitis", "Tuberculosis (Latent Infection)"], answer: 3,
                explanation: "INH is the standard drug for treating latent TB infection (LTBI), which is a form of chemoprophylaxis."
            },
            {
                id: 42, section: "CM-LO-3", question: "Which vaccine requires storage at deep-freeze temperatures (-15°C to -25°C) within the cold chain system?",
                options: ["BCG Vaccine", "MMR Vaccine", "Oral Polio Vaccine (OPV)", "Hepatitis B Vaccine"], answer: 2,
                explanation: "OPV is the most heat-sensitive vaccine and requires storage at deep-freeze temperatures."
            },
            {
                id: 43, section: "CM-LO-3", question: "The main purpose of a 'booster dose' in active immunization is to:",
                options: ["Establish primary immunity", "Provide passive immunity", "Induce a secondary immune response with high antibody titers and prolonged memory", "Treat an existing subclinical infection"], answer: 2,
                explanation: "Boosters cause a rapid, stronger, and sustained immune response (anamnestic response)."
            },
            {
                id: 44, section: "CM-LO-3", question: "Which category of vaccine provides protection using only a specific antigen component, such as a protein or polysaccharide?",
                options: ["Toxoid vaccines", "Live Attenuated vaccines", "Subunit/Recombinant vaccines", "Whole-cell inactivated vaccines"], answer: 2,
                explanation: "Subunit and Recombinant vaccines (e.g., Hepatitis B) use purified components, minimizing side effects."
            },
            {
                id: 45, section: "CM-LO-3", question: "The duration of protection afforded by natural active immunity (e.g., having Measles) is generally:",
                options: ["A few weeks", "A few months", "Shorter than passive immunity", "Longer and often life-long"], answer: 3,
                explanation: "Natural active immunity is typically the most robust and long-lasting form of immunity."
            },
            {
                id: 46, section: "CM-LO-3", question: "Which vaccine is typically administered at birth or soon after as part of the Expanded Programme on Immunization (EPI)?",
                options: ["DPT (Diphtheria, Pertussis, Tetanus)", "Measles", "Hepatitis B and BCG", "Typhoid Vaccine"], answer: 2,
                explanation: "Hepatitis B (birth dose) and BCG (against severe childhood TB) are standard initial vaccines."
            },
            {
                id: 47, section: "CM-LO-3", question: "The use of pooled Human Normal Immunoglobulin after exposure to Measles or Hepatitis A is an example of:",
                options: ["Active immunization", "Chemoprophylaxis", "Passive immunization", "Non-specific protection"], answer: 2,
                explanation: "Immunoglobulin contains ready-made antibodies, which provides passive immunity."
            },
            {
                id: 48, section: "CM-LO-3", question: "Chemoprophylaxis with Rifampicin or Ciprofloxacin is the preferred intervention for close contacts of:",
                options: ["Cholera", "Meningococcal Meningitis", "Tuberculosis", "Viral Encephalitis"], answer: 1,
                explanation: "Rifampicin rapidly eliminates the carriage of Neisseria meningitidis from the nasopharynx."
            },
            {
                id: 49, section: "CM-LO-3", question: "Which vaccine is composed of a bacterial toxin that has been modified to lose its toxicity but retain its immunogenicity?",
                options: ["Inactivated Polio Vaccine", "MMR Vaccine", "Tetanus Toxoid", "Haemophilus influenzae type b (Hib) Vaccine"], answer: 2,
                explanation: "Toxoids (like Tetanus and Diphtheria) are detoxified bacterial exotoxins."
            },
            {
                id: 50, section: "CM-LO-3", question: "In the cold chain, what specific temperature range is required for storing most heat-stable vaccines (like BCG, TT, HepB)?",
                options: ["0°C to 4°C", "2°C to 8°C", "8°C to 15°C", "-20°C to -10°C"], answer: 1,
                explanation: "The standard cold chain temperature for most vaccines is +2°C to +8°C."
            }
        ];

        // --- STATE MANAGEMENT ---
        let currentSectionQuestions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let wrongAnswers = [];

        // --- DOM ELEMENTS ---
        const sectionMenu = document.getElementById('section-menu');
        const quizContainer = document.getElementById('quiz-container');
        const resultScreen = document.getElementById('result-screen');
        
        const questionText = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        const scoreBadge = document.getElementById('score-badge');
        const explanationBox = document.getElementById('explanation-box');
        const explanationText = document.getElementById('explanation-text');
        const nextBtn = document.getElementById('next-btn');
        const finalScoreDisplay = document.getElementById('final-score');
        const reviewSection = document.getElementById('review-section');
        const wrongAnswersList = document.getElementById('wrong-answers-list');

        // --- INITIALIZATION ---
        function init() {
            // Updated sections for Community Medicine LOs
            const sections = [
                { id: "CM-LO-1", title: "Transmission & Epidemiology", desc: "Q1-17: Chain of Infection, Reservoir, and Modes of Spread" },
                { id: "CM-LO-2", title: "Levels of Prevention", desc: "Q18-34: Primordial, Primary, Secondary, and Tertiary Prevention" },
                { id: "CM-LO-3", title: "Prophylaxis & Immunity", desc: "Q35-50: Immunization, Chemoprophylaxis, and Cold Chain" }
            ];

            const container = sectionMenu.querySelector('.grid');
            container.innerHTML = '';

            sections.forEach(sec => {
                const questionsInSec = questionBank.filter(q => q.section === sec.id).length;
                const btn = document.createElement('button');
                btn.className = "bg-[#2d1b4e] border border-purple-500/30 hover:border-yellow-400 p-6 rounded-2xl text-left transition-all hover:bg-purple-900/50 group shadow-lg";
                btn.onclick = () => startQuiz(sec.id);
                btn.innerHTML = `
                    <div class="flex items-center justify-between mb-2">
                        <span class="bg-yellow-400/10 text-yellow-400 text-xs px-2 py-1 rounded uppercase tracking-wide">${sec.id} (${questionsInSec} Qs)</span>
                        <i class="fa-solid fa-chevron-right text-gray-500 group-hover:text-yellow-400 transition"></i>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-1 group-hover:text-yellow-300 transition">${sec.title}</h3>
                    <p class="text-sm text-gray-400">${sec.desc}</p>
                `;
                container.appendChild(btn);
            });
        }

        // --- QUIZ LOGIC ---
        function startQuiz(sectionId) {
            currentSectionQuestions = questionBank.filter(q => q.section === sectionId);
            currentQuestionIndex = 0;
            score = 0;
            wrongAnswers = [];
            
            sectionMenu.classList.add('hidden');
            resultScreen.classList.add('hidden');
            quizContainer.classList.remove('hidden');
            
            renderQuestion();
        }

        function renderQuestion() {
            const q = currentSectionQuestions[currentQuestionIndex];
            
            // Update UI
            questionText.innerText = `${currentQuestionIndex + 1}. ${q.question}`;
            progressText.innerText = `Question ${currentQuestionIndex + 1}/${currentSectionQuestions.length}`;
            scoreBadge.innerText = `Score: ${score}`;
            progressBar.style.width = `${((currentQuestionIndex) / currentSectionQuestions.length) * 100}%`;
            
            // Reset State
            optionsContainer.innerHTML = '';
            explanationBox.classList.add('hidden');
            nextBtn.classList.add('hidden');

            // Create Options
            q.options.forEach((opt, index) => {
                const btn = document.createElement('button');
                btn.className = "option-btn w-full text-left p-4 rounded-xl border border-gray-600 bg-gray-800/50 hover:bg-gray-700 text-gray-200 font-medium relative";
                btn.innerHTML = `<span class="inline-block w-6 h-6 rounded-full bg-gray-700 text-center text-xs leading-6 mr-3 border border-gray-600">${String.fromCharCode(65 + index)}</span> ${opt}`;
                btn.onclick = () => checkAnswer(index, btn);
                optionsContainer.appendChild(btn);
            });
        }

        function checkAnswer(selectedIndex, btnElement) {
            // Disable all buttons
            const buttons = optionsContainer.querySelectorAll('button');
            buttons.forEach(b => b.disabled = true);

            const q = currentSectionQuestions[currentQuestionIndex];
            const isCorrect = selectedIndex === q.answer;

            if (isCorrect) {
                score++;
                btnElement.classList.add('correct-anim');
                btnElement.querySelector('span').classList.replace('bg-gray-700', 'bg-green-600');
                scoreBadge.innerText = `Score: ${score}`;
            } else {
                btnElement.classList.add('wrong-anim');
                btnElement.querySelector('span').classList.replace('bg-gray-700', 'bg-red-600');
                
                // Highlight correct answer
                buttons[q.answer].classList.add('correct-anim');
                buttons[q.answer].querySelector('span').classList.replace('bg-gray-700', 'bg-green-600');
                
                wrongAnswers.push({
                    question: q.question,
                    yourAnswer: q.options[selectedIndex],
                    correctAnswer: q.options[q.answer],
                    explanation: q.explanation
                });
            }

            // Show Explanation
            explanationText.innerHTML = `<strong>${isCorrect ? "Correct!" : "Incorrect."}</strong> ${q.explanation}`;
            explanationBox.classList.remove('hidden');
            
            // Show Next Button
            nextBtn.classList.remove('hidden');
            
            // Update Progress Bar
            progressBar.style.width = `${((currentQuestionIndex + 1) / currentSectionQuestions.length) * 100}%`;
        }

        function nextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < currentSectionQuestions.length) {
                renderQuestion();
            } else {
                showResults();
            }
        }

        function showResults() {
            quizContainer.classList.add('hidden');
            resultScreen.classList.remove('hidden');
            
            const percentage = Math.round((score / currentSectionQuestions.length) * 100);
            finalScoreDisplay.innerText = `${percentage}%`;
            finalScoreDisplay.className = `text-6xl font-bold mb-8 ${percentage >= 70 ? 'text-green-400' : 'text-red-400'}`;

            // Render Wrong Answers
            if (wrongAnswers.length > 0) {
                reviewSection.classList.remove('hidden');
                wrongAnswersList.innerHTML = '';
                wrongAnswers.forEach(item => {
                    const div = document.createElement('div');
                    div.className = "bg-gray-800/50 p-4 rounded-xl border border-red-500/20";
                    div.innerHTML = `
                        <p class="text-white font-semibold mb-2 text-sm md:text-base">${item.question}</p>
                        <div class="text-xs md:text-sm grid gap-1">
                            <p class="text-red-400"><i class="fa-solid fa-xmark mr-2"></i>Your Answer: ${item.yourAnswer}</p>
                            <p class="text-green-400"><i class="fa-solid fa-check mr-2"></i>Correct Answer: ${item.correctAnswer}</p>
                            <p class="text-blue-300 mt-2 italic border-t border-gray-700 pt-2"><i class="fa-solid fa-lightbulb mr-1"></i> ${item.explanation}</p>
                        </div>
                    `;
                    wrongAnswersList.appendChild(div);
                });
            } else {
                reviewSection.classList.add('hidden');
            }
        }

        function restartModule() {
            // Identify current section ID by checking the first question of the last set
            const currentSecID = currentSectionQuestions[0].section;
            startQuiz(currentSecID);
        }

        function goHome() {
            quizContainer.classList.add('hidden');
            resultScreen.classList.add('hidden');
            sectionMenu.classList.remove('hidden');
        }

        // Run
        init();
</script>
</body>
</html>
