<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Community Medicine - Neurosciences Module (Mental Health)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a0b2e; /* Deep Purple Background */
            color: #ffffff;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #2d1b4e; 
        }
        ::-webkit-scrollbar-thumb {
            background: #4ade80; /* Updated to a vibrant green for mental health theme */
            border-radius: 4px;
        }

        /* Animations */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .btn-glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(74, 222, 128, 0.2); /* Green border */
            transition: all 0.3s ease;
        }
        
        .btn-glass:hover {
            background: rgba(74, 222, 128, 0.2);
            border-color: #4ade80;
            transform: translateY(-2px);
        }

        .option-btn {
            transition: all 0.2s;
        }
        
        .option-btn.selected {
            border-color: #4ade80;
            background: rgba(74, 222, 128, 0.1);
        }

        .correct-anim {
            background-color: #10b981 !important; /* Tailwind green-600 */
            border-color: #10b981 !important;
            color: white !important;
        }

        .wrong-anim {
            background-color: #ef4444 !important;
            border-color: #ef4444 !important;
            color: white !important;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Navbar -->
    <nav class="p-4 bg-opacity-90 backdrop-blur-md bg-[#2d1b4e] border-b border-green-400/30 sticky top-0 z-50 shadow-lg">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center gap-3">
                <i class="fa-solid fa-brain text-green-400 text-2xl"></i>
                <h1 class="text-xl md:text-2xl font-bold tracking-wider text-white">
                    COMMUNITY <span class="text-green-400">NEURO</span>
                </h1>
            </div>
            <button onclick="goHome()" class="text-sm text-gray-300 hover:text-green-400 transition">
                <i class="fa-solid fa-house"></i> Home
            </button>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-grow container mx-auto p-4 md:p-6 flex flex-col items-center justify-center">
        
        <!-- Section Selection Screen -->
        <div id="section-menu" class="w-full max-w-4xl grid gap-6 fade-in">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold text-green-400 mb-2">Community Medicine - Neurosciences Module</h2>
                <p class="text-gray-400">Select a Learning Objective (K Park Cmed)</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Buttons generated by JS -->
            </div>
        </div>

        <!-- Quiz Screen -->
        <div id="quiz-container" class="w-full max-w-2xl hidden fade-in">
            <!-- Progress Header -->
            <div class="flex justify-between items-center mb-4 text-sm text-gray-400">
                <span id="progress-text">Question 1/25</span>
                <span id="score-badge" class="bg-green-500/20 text-green-400 px-3 py-1 rounded-full border border-green-500/30">
                    Score: 0
                </span>
            </div>
            
            <!-- Progress Bar -->
            <div class="w-full bg-gray-700 h-2 rounded-full mb-6 overflow-hidden">
                <div id="progress-bar" class="bg-gradient-to-r from-green-400 to-teal-500 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
            </div>

            <!-- Question Card -->
            <div class="bg-[#2d1b4e] border border-purple-500/30 rounded-2xl p-6 md:p-8 shadow-2xl relative overflow-hidden">
                <div class="absolute top-0 right-0 w-32 h-32 bg-green-500/10 rounded-full blur-3xl -mr-16 -mt-16"></div>
                
                <h3 id="question-text" class="text-xl md:text-2xl font-semibold mb-8 leading-relaxed text-gray-100">
                    Loading Question...
                </h3>

                <!-- Options -->
                <div id="options-container" class="grid gap-3">
                    <!-- Options injected here -->
                </div>

                <!-- Explanation Box -->
                <div id="explanation-box" class="mt-6 p-4 bg-blue-900/30 border border-blue-500/30 rounded-xl hidden">
                    <p class="text-blue-200 text-sm"><i class="fa-solid fa-circle-info mr-2"></i><span id="explanation-text"></span></p>
                </div>

                <!-- Next Button -->
                <button id="next-btn" onclick="nextQuestion()" class="mt-8 w-full bg-green-400 hover:bg-green-500 text-black font-bold py-3 px-6 rounded-xl shadow-lg transform transition hover:-translate-y-1 hidden">
                    Next Question <i class="fa-solid fa-arrow-right ml-2"></i>
                </button>
            </div>
        </div>

        <!-- Result Screen -->
        <div id="result-screen" class="w-full max-w-3xl hidden fade-in text-center">
            <div class="bg-[#2d1b4e] border border-green-500/30 rounded-3xl p-8 shadow-2xl">
                <div class="w-24 h-24 bg-green-400 rounded-full flex items-center justify-center mx-auto mb-6 shadow-[0_0_20px_rgba(74,222,128,0.5)]">
                    <i class="fa-solid fa-trophy text-4xl text-black"></i>
                </div>
                
                <h2 class="text-3xl font-bold text-white mb-2">Module Completed!</h2>
                <p class="text-gray-400 mb-6">Here is how you performed</p>

                <div class="text-6xl font-bold text-green-400 mb-8" id="final-score">0%</div>

                <div class="flex flex-col md:flex-row gap-4 justify-center mb-8">
                    <button onclick="restartModule()" class="btn-glass text-white px-8 py-3 rounded-xl font-semibold hover:bg-white/10">
                        <i class="fa-solid fa-rotate-right mr-2"></i> Retry Module
                    </button>
                    <button onclick="goHome()" class="bg-green-400 text-black px-8 py-3 rounded-xl font-semibold hover:bg-green-500 transition">
                        <i class="fa-solid fa-list mr-2"></i> Main Menu
                    </button>
                </div>

                <!-- Wrong Answers Section -->
                <div id="review-section" class="text-left mt-8 border-t border-gray-700 pt-8 hidden">
                    <h3 class="text-xl font-bold text-red-400 mb-4"><i class="fa-solid fa-circle-exclamation mr-2"></i>Review Incorrect Answers</h3>
                    <div id="wrong-answers-list" class="space-y-4">
                        <!-- Wrong answers injected here -->
                    </div>
                </div>
            </div>
        </div>

    </main>

    <footer class="text-center p-6 text-gray-600 text-sm">
        <p>Community Medicine Neurosciences Module • Based on K Park</p>
    </footer>

    <script>
        // --- DATA: 25 MCQs for Community Medicine - Neurosciences Module ---
        const questionBank = [
            // LO 1: Epidemiology of Mental Disorders (Q1-13)
            {
                id: 1, section: "CM-Neuro-LO1", 
                question: "Which term correctly describes the proportion of individuals in a population who have a specified mental disorder at a given point in time?",
                options: ["Incidence", "Attack Rate", "Prevalence", "Case Fatality Rate"], 
                answer: 2,
                explanation: "Prevalence is the total number of cases of a disorder existing in a population at a specific time, indicating the 'depth of the problem'."
            },
            {
                id: 2, section: "CM-Neuro-LO1", 
                question: "According to the Global Burden of Disease (GBD) studies, mental and substance use disorders collectively contribute most significantly to which measure?",
                options: ["Years of Life Lost (YLL)", "Years Lived with Disability (YLD)", "Crude Death Rate", "Infant Mortality Rate"], 
                answer: 1,
                explanation: "Mental disorders typically have early onset and are non-fatal but cause chronic impairment, leading to high Years Lived with Disability (YLD)."
            },
            {
                id: 3, section: "CM-Neuro-LO1", 
                question: "A cross-sectional survey finds that 15% of the adult population currently meets the criteria for Major Depressive Disorder. This finding represents the:",
                options: ["Lifetime prevalence", "Point incidence", "Period prevalence", "Point prevalence"], 
                answer: 3,
                explanation: "Point prevalence refers to the proportion of cases present at a single specified moment in time (e.g., 'currently meets the criteria')."
            },
            {
                id: 4, section: "CM-Neuro-LO1", 
                question: "Which of the following social determinants is considered a major and consistent risk factor for the development of most common mental disorders globally?",
                options: ["Rural residency", "Advanced age (over 65)", "Socioeconomic disadvantage (poverty)", "High levels of physical activity"], 
                answer: 2,
                explanation: "Poverty and low socioeconomic status are consistently associated with higher rates of mental illness worldwide due to chronic stress and poor resources."
            },
            {
                id: 5, section: "CM-Neuro-LO1", 
                question: "The primary challenge in establishing accurate, comparable epidemiological data for mental health disorders across different cultures is often related to:",
                options: ["High cost of medications", "Variations in defining 'normal' behavior and illness expression", "Lack of hospital infrastructure", "Difficulty in finding mental health professionals"], 
                answer: 1,
                explanation: "Cultural factors influence how symptoms are reported, interpreted, and understood, making standardized diagnosis difficult (e.g., somatization)."
            },
            {
                id: 6, section: "CM-Neuro-LO1", 
                question: "Which classification system is primarily used in public health, epidemiology, and health management systems globally for reporting and coding mental and behavioral disorders?",
                options: ["DSM (Diagnostic and Statistical Manual)", "ICD (International Classification of Diseases)", "Bradford Hill Criteria", "The Global Burden Index"], 
                answer: 1,
                explanation: "The World Health Organization’s ICD (currently ICD-11) is the international standard for health information, including mental health."
            },
            {
                id: 7, section: "CM-Neuro-LO1", 
                question: "In mental health epidemiology, 'comorbidity' most accurately refers to the simultaneous existence of:",
                options: ["A mental disorder and a poor diet", "A mental disorder and physical disability", "Two or more distinct mental disorders (or a mental and physical disorder)", "A mental disorder and a strong support system"], 
                answer: 2,
                explanation: "Comorbidity is the presence of two or more disorders in the same person, such as depression co-occurring with anxiety or substance use."
            },
            {
                id: 8, section: "CM-Neuro-LO1", 
                question: "The concept of 'untreated need' or the 'treatment gap' in mental health most directly reflects which aspect of the problem's depth?",
                options: ["High incidence rates", "Lack of specialized psychiatrist training", "The difference between prevalence and treated cases", "Environmental pollution effects"], 
                answer: 2,
                explanation: "The treatment gap highlights the severity of the problem by showing how many people need help but are not receiving it, often due to lack of resources or stigma."
            },
            {
                id: 9, section: "CM-Neuro-LO1", 
                question: "Which age group typically demonstrates the highest lifetime prevalence of mental disorders, often due to the onset of many conditions during this period?",
                options: ["Elderly (65+)", "Adolescents and Young Adults (15-24 years)", "Middle-aged adults (40-60 years)", "Preschool children (0-5 years)"], 
                answer: 1,
                explanation: "The majority of mental disorders, including anxiety and depression, begin before age 24, making this group highly burdened."
            },
            {
                id: 10, section: "CM-Neuro-LO1", 
                question: "Which finding would be the STRONGEST evidence indicating a rising incidence of a mental disorder in a community?",
                options: ["A decline in hospital beds", "An increase in new cases over a year relative to the population at risk", "A decrease in the median age of onset", "An increase in general practitioner consultations for minor stress"], 
                answer: 1,
                explanation: "Incidence is the rate of new cases. An increase in new cases over a specific period is the direct epidemiological measure of rising risk."
            },
            {
                id: 11, section: "CM-Neuro-LO1", 
                question: "In the context of the natural history of a mental illness, which factor is a protective factor against developing the disorder?",
                options: ["Family history of psychosis", "Chronic unemployment", "High levels of community social support", "Exposure to violence"], 
                answer: 2,
                explanation: "Social support acts as a buffer against stress and adversity, reducing the risk of mental illness onset."
            },
            {
                id: 12, section: "CM-Neuro-LO1", 
                question: "The primary role of routine screening tools (like PHQ-9 for depression) in community settings, from an epidemiological perspective, is to:",
                options: ["Diagnose the condition definitively", "Improve case identification and estimate prevalence in primary care", "Determine the cause of the illness", "Prescribe treatment immediately"], 
                answer: 1,
                explanation: "Screening tools are used for high-risk populations in primary care to identify probable cases for further assessment, thereby improving prevalence estimates and detection."
            },
            {
                id: 13, section: "CM-Neuro-LO1", 
                question: "A major reason why the true prevalence of mental disorders is often underestimated in community surveys is the presence of:",
                options: ["High recovery rates", "Low genetic predisposition", "High levels of social stigma leading to non-reporting", "Accurate public knowledge of symptoms"], 
                answer: 2,
                explanation: "Stigma discourages individuals from acknowledging or reporting symptoms during surveys, leading to under-reporting and thus underestimation of the true burden."
            },

            // LO 2: Community-based interventions for Mental Illnesses (Q14-25)
            {
                id: 14, section: "CM-Neuro-LO2", 
                question: "A community program focused on teaching stress management and coping skills to all students in a high school aims to prevent the ONSET of mental illnesses. This is an example of:",
                options: ["Secondary prevention", "Tertiary prevention", "Primary prevention", "Quaternary prevention"], 
                answer: 2,
                explanation: "Primary prevention targets the entire healthy population or high-risk groups to prevent the disease/disorder from ever occurring."
            },
            {
                id: 15, section: "CM-Neuro-LO2", 
                question: "For a mental health disorder, a community-based intervention that aims at early diagnosis and prompt effective treatment is classified as:",
                options: ["Health promotion", "Secondary prevention", "Specific protection", "Tertiary prevention"], 
                answer: 1,
                explanation: "Secondary prevention focuses on reducing the duration of illness and limiting disability through early detection (screening) and treatment."
            },
            {
                id: 16, section: "CM-Neuro-LO2", 
                question: "A program focused on vocational training and supported employment for individuals with severe schizophrenia aims to reduce residual disability and improve social functioning. This is a form of:",
                options: ["Primary prevention", "Secondary prevention", "Quaternary prevention", "Tertiary prevention"], 
                answer: 3,
                explanation: "Tertiary prevention focuses on rehabilitation and preventing complications/relapses in those already diagnosed with the illness."
            },
            {
                id: 17, section: "CM-Neuro-LO2", 
                question: "The concept of 'Task Shifting' in community mental health is primarily a strategy to:",
                options: ["Increase psychiatrist salaries", "Relocate services to central hospitals", "Expand reach by training non-specialist health workers (e.g., nurses, GPs) to deliver care", "Develop new psychoactive drugs"], 
                answer: 2,
                explanation: "Task shifting addresses the severe shortage of specialists by training non-specialist personnel to take on specific mental health tasks."
            },
            {
                id: 18, section: "CM-Neuro-LO2", 
                question: "Which community-based approach is most effective for reducing 'internalized stigma' (self-stigma) among individuals with mental illness?",
                options: ["Mass media campaigns", "Contact-based education (interactions with recovered individuals)", "Policy changes in employment law", "Large-scale financial aid programs"], 
                answer: 1,
                explanation: "Direct, personal interaction (contact-based) is highly effective at challenging stereotypes and reducing both public and self-stigma."
            },
            {
                id: 19, section: "CM-Neuro-LO2", 
                question: "Psychoeducation in a community setting is defined as providing patients and families with knowledge about their illness. Its main objective is to:",
                options: ["Offer psychotherapy", "Reduce medication side effects", "Promote adherence, identify relapses, and empower care partners", "Initiate institutionalization"], 
                answer: 2,
                explanation: "Psychoeducation is vital for chronic conditions to improve understanding, treatment adherence, and coping skills, reducing relapse risk."
            },
            {
                id: 20, section: "CM-Neuro-LO2", 
                question: "The global push for integrating mental health services into existing Primary Health Care (PHC) structures is primarily intended to:",
                options: ["Lower the overall cost of all healthcare", "Reduce the mental health treatment gap and improve accessibility", "Replace all specialist mental hospitals", "Train all general practitioners as psychiatrists"], 
                answer: 1,
                explanation: "Integration makes services physically and socially more accessible and reduces the stigma associated with seeking care at a specialized facility."
            },
            {
                id: 21, section: "CM-Neuro-LO2", 
                question: "In the context of community mental health, the policy of 'deinstitutionalization' primarily involves:",
                options: ["Increasing the size of mental hospitals", "Shifting long-term care from large psychiatric hospitals to community-based residential and support services", "Banning all psychological treatment", "Closing all emergency departments"], 
                answer: 1,
                explanation: "Deinstitutionalization is the movement of care out of large institutions into smaller, integrated community settings."
            },
            {
                id: 22, section: "CM-Neuro-LO2", 
                question: "A community program aims to improve parental bonding and attachment in high-risk families to prevent early childhood behavioral problems. This represents which level of prevention?",
                options: ["Targeted Tertiary", "Selective Primary", "Universal Secondary", "Indicated Prevention"], 
                answer: 1,
                explanation: "This is 'Selective' primary prevention because it targets a subgroup (high-risk families) of the healthy population to prevent the onset of illness."
            },
            {
                id: 23, section: "CM-Neuro-LO2", 
                question: "Lay health workers or community volunteers are often used in mental health programs primarily because they:",
                options: ["Possess advanced pharmacological knowledge", "Are cheaper than specialists and understand local culture/language", "Are exempt from legal liability", "Can perform major surgery"], 
                answer: 1,
                explanation: "Their cultural competence and affordability are key assets in providing culturally sensitive and accessible services in low-resource settings."
            },
            {
                id: 24, section: "CM-Neuro-LO2", 
                question: "Following a natural disaster, a community health team sets up psycho-social support centers to identify and support victims showing acute stress reactions. This is a crucial component of:",
                options: ["Universal primary care", "Mental Health Psychosocial Support (MHPSS) in emergencies", "Long-term institutional rehabilitation", "Chronic disease management"], 
                answer: 1,
                explanation: "MHPSS interventions are standardized community-level responses in acute emergencies to address psychological trauma and stress."
            },
            {
                id: 25, section: "CM-Neuro-LO2", 
                question: "Which is the most appropriate long-term goal for a community mental health rehabilitation center?",
                options: ["Permanent housing in the center", "Achieving maximum recovery, independence, and integration into the community", "Total cessation of all psychiatric medication", "Focusing exclusively on physical health indicators"], 
                answer: 1,
                explanation: "Rehabilitation is fundamentally about restoring function and social roles to maximize independence and quality of life within the community."
            }
        ];

        // --- STATE MANAGEMENT ---
        let currentSectionQuestions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let wrongAnswers = [];

        // --- DOM ELEMENTS ---
        const sectionMenu = document.getElementById('section-menu');
        const quizContainer = document.getElementById('quiz-container');
        const resultScreen = document.getElementById('result-screen');
        
        const questionText = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        const scoreBadge = document.getElementById('score-badge');
        const explanationBox = document.getElementById('explanation-box');
        const explanationText = document.getElementById('explanation-text');
        const nextBtn = document.getElementById('next-btn');
        const finalScoreDisplay = document.getElementById('final-score');
        const reviewSection = document.getElementById('review-section');
        const wrongAnswersList = document.getElementById('wrong-answers-list');

        // --- INITIALIZATION ---
        function init() {
            // Updated Sections for Community Medicine - Neurosciences Module
            const sections = [
                { id: "CM-Neuro-LO1", title: "LO 1: Epidemiology & Burden", desc: "Q1-13: Depth of Problem in Mental Illnesses" },
                { id: "CM-Neuro-LO2", title: "LO 2: Community Interventions", desc: "Q14-25: Prevention and Rehabilitation" }
            ];

            const container = sectionMenu.querySelector('.grid');
            container.innerHTML = '';

            sections.forEach(sec => {
                const totalQuestions = questionBank.filter(q => q.section === sec.id).length;
                const btn = document.createElement('button');
                btn.className = "bg-[#2d1b4e] border border-purple-500/30 hover:border-green-400 p-6 rounded-2xl text-left transition-all hover:bg-purple-900/50 group shadow-lg";
                btn.onclick = () => startQuiz(sec.id);
                btn.innerHTML = `
                    <div class="flex items-center justify-between mb-2">
                        <span class="bg-green-400/10 text-green-400 text-xs px-2 py-1 rounded uppercase tracking-wide">${sec.id} (${totalQuestions} Qs)</span>
                        <i class="fa-solid fa-chevron-right text-gray-500 group-hover:text-green-400 transition"></i>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-1 group-hover:text-green-300 transition">${sec.title}</h3>
                    <p class="text-sm text-gray-400">${sec.desc}</p>
                `;
                container.appendChild(btn);
            });
        }

        // --- QUIZ LOGIC ---
        function startQuiz(sectionId) {
            currentSectionQuestions = questionBank.filter(q => q.section === sectionId);
            currentQuestionIndex = 0;
            score = 0;
            wrongAnswers = [];
            
            sectionMenu.classList.add('hidden');
            resultScreen.classList.add('hidden');
            quizContainer.classList.remove('hidden');
            
            renderQuestion();
        }

        function renderQuestion() {
            const q = currentSectionQuestions[currentQuestionIndex];
            
            // Update UI
            questionText.innerText = `${currentQuestionIndex + 1}/${currentSectionQuestions.length}. ${q.question}`;
            progressText.innerText = `Question ${currentQuestionIndex + 1}/${currentSectionQuestions.length}`;
            scoreBadge.innerText = `Score: ${score}`;
            progressBar.style.width = `${((currentQuestionIndex) / currentSectionQuestions.length) * 100}%`;
            
            // Reset State
            optionsContainer.innerHTML = '';
            explanationBox.classList.add('hidden');
            nextBtn.classList.add('hidden');

            // Create Options
            q.options.forEach((opt, index) => {
                const btn = document.createElement('button');
                btn.className = "option-btn w-full text-left p-4 rounded-xl border border-gray-600 bg-gray-800/50 hover:bg-gray-700 text-gray-200 font-medium relative";
                btn.innerHTML = `<span class="inline-block w-6 h-6 rounded-full bg-gray-700 text-center text-xs leading-6 mr-3 border border-gray-600">${String.fromCharCode(65 + index)}</span> ${opt}`;
                btn.onclick = () => checkAnswer(index, btn);
                optionsContainer.appendChild(btn);
            });
        }

        function checkAnswer(selectedIndex, btnElement) {
            // Disable all buttons
            const buttons = optionsContainer.querySelectorAll('button');
            buttons.forEach(b => b.disabled = true);

            const q = currentSectionQuestions[currentQuestionIndex];
            const isCorrect = selectedIndex === q.answer;

            if (isCorrect) {
                score++;
                btnElement.classList.add('correct-anim');
                btnElement.querySelector('span').classList.replace('bg-gray-700', 'bg-green-600');
                scoreBadge.innerText = `Score: ${score}`;
            } else {
                btnElement.classList.add('wrong-anim');
                btnElement.querySelector('span').classList.replace('bg-gray-700', 'bg-red-600');
                
                // Highlight correct answer
                buttons[q.answer].classList.add('correct-anim');
                buttons[q.answer].querySelector('span').classList.replace('bg-gray-700', 'bg-green-600');
                
                wrongAnswers.push({
                    question: q.question,
                    yourAnswer: q.options[selectedIndex],
                    correctAnswer: q.options[q.answer],
                    explanation: q.explanation
                });
            }

            // Show Explanation
            explanationText.innerHTML = `<strong>${isCorrect ? "Correct!" : "Incorrect."}</strong> ${q.explanation}`;
            explanationBox.classList.remove('hidden');
            
            // Show Next Button
            nextBtn.classList.remove('hidden');
            
            // Update Progress Bar
            progressBar.style.width = `${((currentQuestionIndex + 1) / currentSectionQuestions.length) * 100}%`;
        }

        function nextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < currentSectionQuestions.length) {
                renderQuestion();
            } else {
                showResults();
            }
        }

        function showResults() {
            quizContainer.classList.add('hidden');
            resultScreen.classList.remove('hidden');
            
            const percentage = Math.round((score / currentSectionQuestions.length) * 100);
            finalScoreDisplay.innerText = `${percentage}%`;
            finalScoreDisplay.className = `text-6xl font-bold mb-8 ${percentage >= 70 ? 'text-green-400' : 'text-red-400'}`;

            // Render Wrong Answers
            if (wrongAnswers.length > 0) {
                reviewSection.classList.remove('hidden');
                wrongAnswersList.innerHTML = '';
                wrongAnswers.forEach(item => {
                    const div = document.createElement('div');
                    div.className = "bg-gray-800/50 p-4 rounded-xl border border-red-500/20";
                    div.innerHTML = `
                        <p class="text-white font-semibold mb-2 text-sm md:text-base">${item.question}</p>
                        <div class="text-xs md:text-sm grid gap-1">
                            <p class="text-red-400"><i class="fa-solid fa-xmark mr-2"></i>Your Answer: ${item.yourAnswer}</p>
                            <p class="text-green-400"><i class="fa-solid fa-check mr-2"></i>Correct Answer: ${item.correctAnswer}</p>
                            <p class="text-blue-300 mt-2 italic border-t border-gray-700 pt-2"><i class="fa-solid fa-lightbulb mr-1"></i> ${item.explanation}</p>
                        </div>
                    `;
                    wrongAnswersList.appendChild(div);
                });
            } else {
                reviewSection.classList.add('hidden');
            }
        }

        function restartModule() {
            // Identify current section ID by checking the first question of the last set
            const currentSecID = currentSectionQuestions[0].section;
            startQuiz(currentSecID);
        }

        function goHome() {
            quizContainer.classList.add('hidden');
            resultScreen.classList.add('hidden');
            sectionMenu.classList.remove('hidden');
        }

        // Run
        init();

    </script>
</body>
</html>

