<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ModMedicalis | Let the visuals speak</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLMDJd/r7oQ9tTdsLqB81lE1K8j/bNq0lR7a/m4N1zJ3I7Z5n7W2vP0yQ5G7gNl1g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        /* Import Fonts */
        @import url('https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;500;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Saira+Condensed:wght@700;800;900&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Lilita+One&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap');

        /* Custom font definitions */
        .algerya-sans-sc-font { font-family: 'Saira Condensed', sans-serif; font-weight: 800; letter-spacing: -0.02em; text-transform: uppercase; }
        .roboto-font { font-family: 'Roboto', sans-serif; }
        
        body { font-family: 'Roboto', sans-serif; background-color: #f8fafc; color: #1e293b; transition: background-color 0.3s, color 0.3s; overflow-x: hidden; width: 100%; }

        /* Existing Styles */
        .avail-btn { background-color: #1e293b; color: white; padding: 0.75rem 2rem; font-weight: 700; border-radius: 1.5rem; transition: background-color 0.3s, transform 0.2s; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); font-size: 0.875rem; }
        @media (min-width: 640px) { .avail-btn { padding: 1rem 2.5rem; font-size: 1rem; } }
        .avail-btn:hover { background-color: #334155; transform: translateY(-2px); }
        
        .filter-text-button { 
            position: relative; 
            cursor: pointer; 
            padding: 0.5rem 0.75rem; 
            transition: color 0.3s ease; 
            padding-bottom: 0.5rem; 
            font-size: 1.1rem;
            font-family: 'Saira Condensed', sans-serif;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        @media (min-width: 640px) { .filter-text-button { padding: 0.5rem 1rem; padding-bottom: 0.75rem; font-size: 1.25rem; } }
        .filter-text-button::after { content: ''; position: absolute; left: 50%; bottom: 0; height: 3px; width: 0; background-color: #3b82f6; transition: width 0.3s ease, transform 0.3s ease; transform: translateX(-50%); }
        .filter-text-button.active { color: #3b82f6; }
        #filter-buttons-container .filter-text-button.active::after { background-color: #3b82f6 !important; }
        .filter-text-button.active::after { width: 100%; }
        
        .product-popup-image-container { width: 100%; padding-top: 140%; position: relative; overflow: hidden; background-color: #f3f4f6; }
        .product-popup-image-container img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: contain; }
        
        .glass-card { 
            background-color: #F8F8F8; 
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.05); 
            transition: all 0.3s ease; 
            position: relative; 
            border: 1px solid #f3f4f6;
            padding-bottom: 2rem !important; 
            min-height: 320px; 
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        .horizontal-scroll-container { display: flex; overflow-x: scroll; scroll-snap-type: x mandatory; -webkit-overflow-scrolling: touch; padding-bottom: 1rem; }
        .horizontal-scroll-container::-webkit-scrollbar { display: none; }
        .horizontal-scroll-container { -ms-overflow-style: none; scrollbar-width: none; }
        .product-image-box { background-color: #e5e7eb; position: relative; width: 100%; aspect-ratio: 4/5; margin-bottom: 0.5rem; cursor: pointer; }
        .product-image-box img { object-fit: contain; width: 100%; height: 100%; }
        
        .product-card-title { font-size: 1.25rem; line-height: 1.0; font-weight: 900; text-transform: uppercase; cursor: pointer; font-family: 'Saira Condensed', sans-serif; letter-spacing: -0.03em; }
        @media (min-width: 640px) { .product-card-title { font-size: 1.5rem; } }
        
        .product-price-main { 
            color: #F94A4A; 
            font-family: 'Saira Condensed', sans-serif;
            font-size: 1.5rem; 
            font-weight: 900; 
            background-color: transparent; 
            padding: 0;
            display: inline-block;
            margin-top: 4px;
        }
        @media (min-width: 640px) { .product-price-main { font-size: 1.75rem; } }
        
        .product-price-cut { color: #9ca3af; text-decoration: line-through; font-size: 0.75rem; }
        .add-to-cart-btn { width: 1.75rem; height: 1.75rem; font-size: 1rem; background-color: #1e293b; color: white; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2); position: absolute; bottom: 0.5rem; right: 0.5rem; }
        @media (min-width: 640px) { .add-to-cart-btn { width: 2rem; height: 2rem; font-size: 1.25rem; bottom: 0.75rem; right: 0.75rem; } }
        .tilted-overlap-image { position: absolute; top: -1.5rem; right: 0.25rem; width: 80px; height: 80px; z-index: 20; transform: rotate(10deg); object-fit: contain; pointer-events: none; }
        @media (min-width: 640px) { .tilted-overlap-image { top: -2.5rem; right: 0.5rem; width: 120px; height: 120px; } }
        
        .hero-tab-card { background: white; border: 2px solid transparent; border-radius: 12px; padding: 0.5rem; display: flex; flex-direction: row; align-items: center; justify-content: center; gap: 0.5rem; cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03); position: relative; overflow: hidden; width: 100%; }
        @media (min-width: 640px) { .hero-tab-card { padding: 1rem; gap: 1rem; justify-content: flex-start; } }
        .hero-tab-card:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        .hero-tab-card.active-custom-red { border-color: #F94A4A; background-color: #fff1f2; }
        .hero-tab-card.active-custom-red .tab-icon-box { background-color: #F94A4A; color: white; }
        .hero-tab-card.active-custom-red span { color: #F94A4A; }
        .hero-tab-card.active-blue { border-color: #3b82f6; background-color: #eff6ff; }
        .hero-tab-card.active-blue .tab-icon-box { background-color: #3b82f6; color: white; }
        .hero-tab-card.active-pink { border-color: #ec4899; background-color: #fdf2f8; }
        /* Custom Orange Style for Block 4 */
        .hero-tab-card.active-custom-orange { border-color: #E78846; background-color: #fff7ed; }
        .hero-tab-card.active-custom-orange .tab-icon-box { background-color: #E78846; color: white; }
        .hero-tab-card.active-custom-orange span { color: #E78846; }

        .tab-icon-box { width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 0.9rem; transition: all 0.3s ease; flex-shrink: 0; }
        @media (min-width: 640px) { .tab-icon-box { width: 48px; height: 48px; font-size: 1.25rem; border-radius: 10px; } }
        .tab-text { font-size: 0.75rem; }
        @media (min-width: 640px) { .tab-text { font-size: 1rem; } }
        .tab-panel { display: none; }
        .tab-panel.active { display: flex; }
        
        @keyframes fadeInRight { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }
        .animate-fade-right { animation: fadeInRight 0.5s ease-out forwards; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .product-slide-up { animation: slideUp 0.4s ease-out forwards; }
        .reveal-on-scroll { opacity: 0; transform: translateY(30px); transition: all 0.8s ease-out; }
        .reveal-on-scroll.is-visible { opacity: 1; transform: translateY(0); }

        /* Checkout Styles */
        #checkout-page {
            font-family: 'Roboto', -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
            background-color: #ffffff;
            min-height: 100vh;
            color: #333;
            width: 100%;
            overflow-x: hidden;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 100;
        }
        .shopify-layout { display: flex; flex-direction: row; height: 100%; max-width: 1200px; margin: 0 auto; width: 100%; overflow-x: hidden; }
        .shopify-main { width: 58%; padding: 3rem 4% 2rem 0; border-right: 1px solid #e1e1e1; }
        .shopify-sidebar { width: 42%; background-color: #fafafa; padding: 3rem 0 2rem 4%; min-height: 100vh; border-left: 1px solid #e1e1e1; margin-left: -1px; display: flex; flex-direction: column; }
        
        .mobile-header { padding: 1rem; display: flex; justify-content: center; background: white; border-bottom: 1px solid #e1e1e1; width: 100%; }
        .mobile-summary-accordion { display: block; background: #fafafa; border-bottom: 1px solid #e1e1e1; border-top: 1px solid #e1e1e1; width: 100%; }
        .mobile-summary-accordion summary { list-style: none; padding: 1rem; display: flex; justify-content: space-between; align-items: center; cursor: pointer; color: #1A5693; font-size: 0.9rem; font-weight: 500; }
        .mobile-summary-accordion summary::-webkit-details-marker { display: none; }
        .mobile-summary-accordion summary::after { content: 'â–¼'; font-size: 0.7rem; margin-left: 0.5rem; transition: transform 0.2s; }
        .mobile-summary-accordion[open] summary::after { transform: rotate(180deg); }
        .mobile-summary-content { padding: 0 1rem 1.5rem 1rem; border-top: 1px solid #e6e6e6; }

        .modern-input { width: 100%; padding: 0.9rem; border: 1px solid #d9d9d9; border-radius: 8px; font-size: 16px; color: #333; transition: all 0.2s ease-in-out; background: white; box-shadow: 0 1px 0 rgba(0,0,0,0.05); font-family: inherit; }
        .modern-input:focus { border-color: #1A5693; box-shadow: 0 0 0 1px #1A5693; outline: none; }
        
        .shopify-input-group { margin-bottom: 0.85rem; }
        .shopify-input-label { display: block; font-size: 0.85rem; font-weight: 500; color: #333; margin-bottom: 0.35rem; }
        select.modern-input { background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e"); background-position: right 0.8rem center; background-repeat: no-repeat; background-size: 1.2em 1.2em; -webkit-appearance: none; padding-right: 2.5rem; }
        
        .shopify-btn-primary { background-color: #1A5693; color: white; padding: 1.25rem 1.5rem; border-radius: 8px; font-weight: 600; font-size: 1rem; width: 100%; text-align: center; transition: background-color 0.2s; margin-top: 1.5rem; cursor: pointer; font-family: inherit; }
        .shopify-btn-primary:hover { background-color: #144374; }
        
        .sidebar-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem; }
        .sidebar-label { color: #555; font-size: 0.9rem; }
        .sidebar-value { font-weight: 600; color: #333; font-size: 0.9rem; }
        .sidebar-total { border-top: 1px solid #e1e1e1; padding-top: 1.25rem; margin-top: 1.25rem; display: flex; justify-content: space-between; align-items: center; }
        .sidebar-total-label { font-size: 1.1rem; color: #333; }
        .sidebar-total-value { font-size: 1.4rem; font-weight: 700; color: #333; }
        
        .payment-icons-container { display: flex; gap: 8px; margin-top: auto; padding-top: 2rem; opacity: 0.7; justify-content: center; }
        .payment-icon { height: 24px; width: auto; object-fit: contain; }

        .custom-scrollbar::-webkit-scrollbar { width: 5px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #c1c1c1; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #a8a8a8; }

        @media (max-width: 1023px) {
            .shopify-layout { flex-direction: column; }
            .shopify-main { width: 100%; padding: 1.5rem 1rem; border-right: none; order: 2; box-sizing: border-box; }
            .shopify-sidebar { display: none; }
            .checkout-header-logo { display: none; }
            .shopify-btn-primary { width: 100%; padding: 1.1rem; }
        }
        @media (min-width: 1024px) {
            .mobile-header { display: none; }
            .mobile-summary-accordion { display: none; }
        }

        .product-accordian-item { border-bottom: 1px solid #eee; padding: 1rem 0; cursor: pointer; }
        .product-accordian-title { font-weight: 800; font-size: 1.1rem; text-transform: uppercase; font-family: 'Saira Condensed', sans-serif; display: flex; justify-content: space-between; align-items: center; }
        .product-accordian-title:hover { color: #F94A4A; }
        .review-bar-container { display: flex; align-items: center; gap: 10px; margin-bottom: 4px; font-size: 0.85rem; }
        .review-bar-bg { flex: 1; height: 8px; background-color: #eee; border-radius: 4px; overflow: hidden; }
        .review-bar-fill { height: 100%; background-color: #F94A4A; border-radius: 4px; }
        .custom-dropdown-box { border: 1px solid #e5e7eb; border-radius: 8px; padding: 12px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; margin-bottom: 1rem; font-weight: 600; font-size: 0.95rem; }
        .custom-dropdown-box:hover { border-color: #F94A4A; }
        .free-preview-btn-ref { border: 2px solid #F94A4A; color: #F94A4A; font-weight: 900; text-transform: uppercase; border-radius: 8px; width: 100%; padding: 10px; display: flex; align-items: center; justify-content: center; gap: 8px; transition: all 0.2s; font-family: 'Saira Condensed', sans-serif; font-size: 1.1rem; }
        .free-preview-btn-ref:hover { background-color: #FFF1F2; }
        
        .notification-arrow {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 0 10px;
            font-size: 1rem;
            opacity: 0.7;
            transition: opacity 0.3s;
        }
        .notification-arrow:hover { opacity: 1; }
        .pre-order-warning {
            background-color: #FEF3C7;
            border: 1px solid #F59E0B;
            color: #92400E;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        /* Bundle Popup Styles */
        .bundle-popup-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 60;
            background: white;
            padding: 1rem;
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            border: 1px solid #f3f4f6;
            max-width: 320px;
            transform: translateY(150%);
            transition: transform 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .bundle-popup-container.show { transform: translateY(0); }
        
        /* Ambassador Carousel Animation */
        .active-slide { opacity: 1 !important; }
    </style>
</head>
<body class="min-h-screen antialiased">
    <!-- Top Notification Strip with Carousel -->
    <div class="bg-[#F94A4A] py-2 text-center sticky top-0 z-50 shadow-sm flex items-center justify-center">
        <button class="notification-arrow" onclick="prevNotification()"><i class="fas fa-chevron-left"></i></button>
        <span id="notification-text" class="text-white algerya-sans-sc-font font-bold text-sm sm:text-lg tracking-wider mx-2">MIND YOUR MINORS 4 IS NOW AVAILABLE</span>
        <button class="notification-arrow" onclick="nextNotification()"><i class="fas fa-chevron-right"></i></button>
    </div>

    <!-- Header -->
    <header class="bg-white border-b border-gray-100 sticky top-10 z-40">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative">
            <div class="flex justify-between items-center h-14 sm:h-16">
                <!-- Left Side -->
                <div class="flex items-center">
                    <button id="mobile-menu-button" class="md:hidden text-gray-600 hover:text-[#1A5693] mr-4">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-menu"><line x1="4" x2="20" y1="12"y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>
                    </button>
                    <div class="hidden md:block relative">
                        <input type="text" id="search-input" placeholder="Search products..." class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-[#1A5693] focus:border-[#1A5693] w-64 text-sm">
                        <button id="search-button" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-600 hover:text-[#1A5693]">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
                        </button>
                        <div id="search-dropdown" class="search-dropdown hidden"></div>
                    </div>
                </div>
                <!-- Center: Logo -->
                <div class="absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2">
                    <a href="#" id="home-logo-link" class="flex-shrink-0 flex items-center">
                        <img src="https://i.imgur.com/R8x4icz.png" alt="ModMedicalis Logo" class="h-10 sm:h-12 w-auto rounded-lg">
                    </a>
                </div>
                <!-- Right Side: Cart Buttons -->
                <div class="flex items-center space-x-3">
                    <button id="desktop-cart-button" class="hidden md:block relative text-gray-600 hover:text-[#1A5693] transition duration-150">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-shopping-bag"><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"/><path d="M3 6h18"/><path d="M16 10a4 4 0 0 1-8 0"/></svg>
                        <span id="desktop-cart-count" class="absolute -top-1 -right-1 inline-flex items-center justify-center px-1.5 py-0.5 text-[10px] font-bold leading-none text-white transform translate-x-1/2 -translate-y-1/2 bg-[#1A5693] rounded-full">0</span>
                    </button>
                    <button id="mobile-cart-button" class="md:hidden relative text-gray-600 hover:text-[#1A5693] transition duration-150">
                        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-shopping-bag"><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"/><path d="M3 6h18"/><path d="M16 10a4 4 0 0 1-8 0"/></svg>
                        <span id="mobile-cart-count" class="absolute -top-1 -right-1 inline-flex items-center justify-center px-1.5 py-0.5 text-[9px] font-bold leading-none text-white transform translate-x-1/2 -translate-y-1/2 bg-[#1A5693] rounded-full">0</span>
                    </button>
                </div>
            </div>
        </div>
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden bg-white border-t border-gray-100">
            <div class="px-4 py-3 space-y-2">
                <div class="relative w-full">
                    <input type="text" id="mobile-search-input" placeholder="Search products..." class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-[#1A5693] focus:border-[#1A5693] text-sm">
                    <button id="mobile-search-button" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-600 hover:text-[#1A5693]">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
                    </button>
                    <div id="mobile-search-dropdown" class="search-dropdown hidden"></div>
                </div>
                <div class="mt-4 border-t border-gray-100 pt-2 space-y-2">
                    <a href="#" onclick="openInfoPage('about'); return false;" class="block text-gray-700 font-medium py-1 algerya-sans-sc-font text-lg tracking-wide">About Us</a>
                    <a href="#" onclick="openInfoPage('contact'); return false;" class="block text-gray-700 font-medium py-1 algerya-sans-sc-font text-lg tracking-wide">Contact Us</a>
                    <a href="#" onclick="openInfoPage('shipping'); return false;" class="block text-gray-700 font-medium py-1 algerya-sans-sc-font text-lg tracking-wide">Shipping & Return</a>
                    <a href="#" onclick="openInfoPage('faqs'); return false;" class="block text-gray-700 font-medium py-1 algerya-sans-sc-font text-lg tracking-wide">FAQs</a>
                    <a href="#" onclick="openInfoPage('resources'); return false;" class="block text-[#1A5693] font-bold py-1 algerya-sans-sc-font text-lg tracking-wide">Free Resources</a>
                </div>
            </div>
        </div>
    </header>

    <main>
        <!-- Hero Section -->
        <section id="hero-section" class="relative bg-red-50 pt-8 pb-8 sm:pb-16 overflow-hidden reveal-on-scroll transition-colors duration-500">
             <div class="max-w-7xl mx-auto px-4 h-full relative z-10 flex flex-col justify-center">
                <div id="hero-content-wrapper" class="mb-8 sm:mb-12 min-h-[350px] flex items-center">
                    
                    <!-- NEW: BLOCK 4 HERO PANEL (DEFAULT) -->
                    <div id="panel-block4" class="tab-panel active w-full flex flex-col-reverse md:flex-row items-center justify-between gap-6 sm:gap-12 animate-fade-right">
                        <div class="text-center md:text-left md:w-1/2 space-y-3 sm:space-y-4">
                            <span class="bg-white text-[#E78846] font-bold px-4 py-1.5 rounded-full text-xs sm:text-sm shadow-sm inline-block tracking-wide">SPECIAL PRE-ORDER</span>
                            <h1 class="text-5xl sm:text-6xl md:text-7xl font-black text-gray-900 leading-tight algerya-sans-sc-font"> PRE-ORDER <br> <span class="text-[#E78846]">BLOCK 4</span> </h1>
                            <p class="text-gray-600 font-medium text-sm sm:text-base max-w-md mx-auto md:mx-0">Secure your copy of the upcoming Block 4 notes. Enhanced visuals and concise content. Shipping starts Dec 22nd.</p>
                            <div class="flex flex-col sm:flex-row gap-3 sm:gap-4 justify-center md:justify-start mt-4 sm:mt-6">
                                <button class="add-to-cart-btn-hero bg-[#E78846] text-white font-bold py-3 px-8 rounded-xl shadow-lg hover:opacity-90 transition transform hover:-translate-y-1 text-sm sm:text-base" onclick="document.querySelector('.add-to-cart-btn[data-product-id=\'5\']').click()"> PRE-ORDER </button>
                                <button class="bg-white text-gray-900 border-2 border-gray-200 font-bold py-3 px-8 rounded-xl shadow-sm hover:border-[#E78846] transition text-sm sm:text-base" onclick="document.getElementById('notes').scrollIntoView({behavior: 'smooth'})"> VIEW ALL NOTES </button>
                            </div>
                        </div>
                        <div class="md:w-1/2 flex justify-center relative"> <img src="https://i.imgur.com/GwkaaF6.jpeg" class="w-48 sm:w-64 md:w-80 rounded-xl shadow-2xl rotate-[-2deg] border-4 border-white transform transition hover:rotate-0 duration-500"> </div>
                    </div>

                    <!-- BLOCK 3 HERO PANEL -->
                    <div id="panel-block3" class="tab-panel hidden w-full flex flex-col-reverse md:flex-row items-center justify-between gap-6 sm:gap-12 animate-fade-right">
                        <div class="text-center md:text-left md:w-1/2 space-y-3 sm:space-y-4">
                            <span class="bg-white text-[#F94A4A] font-bold px-4 py-1.5 rounded-full text-xs sm:text-sm shadow-sm inline-block tracking-wide">1ST YEAR MBBS ESSENTIAL</span>
                            <h1 class="text-5xl sm:text-6xl md:text-7xl font-black text-gray-900 leading-tight algerya-sans-sc-font"> ACE YOUR <br> <span class="text-[#F94A4A]">BLOCK 3 EXAMS</span> </h1>
                            <p class="text-gray-600 font-medium text-sm sm:text-base max-w-md mx-auto md:mx-0">Detailed illustrations and high-yield mnemonics. Perfect for quick revision and concept consolidation.</p>
                            <div class="flex flex-col sm:flex-row gap-3 sm:gap-4 justify-center md:justify-start mt-4 sm:mt-6">
                                <button class="add-to-cart-btn-hero bg-[#F94A4A] text-white font-bold py-3 px-8 rounded-xl shadow-lg hover:opacity-90 transition transform hover:-translate-y-1 text-sm sm:text-base" onclick="document.querySelector('.add-to-cart-btn[data-product-id=\'4\']').click()"> SHOP BLOCK 3 </button>
                                <button class="bg-white text-gray-900 border-2 border-gray-200 font-bold py-3 px-8 rounded-xl shadow-sm hover:border-[#F94A4A] transition text-sm sm:text-base" onclick="document.getElementById('notes').scrollIntoView({behavior: 'smooth'})"> VIEW ALL NOTES </button>
                            </div>
                        </div>
                        <div class="md:w-1/2 flex justify-center relative"> <img src="https://i.imgur.com/C5uiLKv.jpeg" class="w-48 sm:w-64 md:w-80 rounded-xl shadow-2xl rotate-[2deg] border-4 border-white transform transition hover:rotate-0 duration-500"> </div>
                    </div>

                    <!-- BLOCK 6 HERO PANEL -->
                    <div id="panel-block6" class="tab-panel hidden w-full flex flex-col-reverse md:flex-row items-center justify-between gap-6 sm:gap-12 animate-fade-right">
                        <div class="text-center md:text-left md:w-1/2 space-y-3 sm:space-y-4">
                            <span class="bg-white text-[#3b82f6] font-bold px-4 py-1.5 rounded-full text-xs sm:text-sm shadow-sm inline-block tracking-wide">TRUSTED BY MED STUDENTS</span>
                            <h1 class="text-5xl sm:text-6xl md:text-7xl font-black text-gray-900 leading-tight algerya-sans-sc-font"> STUDY SMARTER <br> <span class="text-[#3b82f6]">FOR BLOCK 6</span> </h1>
                            <p class="text-gray-600 font-medium text-sm sm:text-base max-w-md mx-auto md:mx-0">The newly launched minor subjects block notes. Completely aligned with UHS LOs with enhanced illustrations.</p>
                            <div class="flex flex-col sm:flex-row gap-3 sm:gap-4 justify-center md:justify-start mt-4 sm:mt-6">
                                <button class="add-to-cart-btn-hero bg-[#3b82f6] text-white font-bold py-3 px-8 rounded-xl shadow-lg hover:bg-blue-700 transition transform hover:-translate-y-1 text-sm sm:text-base" onclick="document.querySelector('.add-to-cart-btn[data-product-id=\'3\']').click()"> SHOP BLOCK 6 </button>
                                <button class="bg-white text-gray-900 border-2 border-gray-200 font-bold py-3 px-8 rounded-xl shadow-sm hover:border-blue-600 transition text-sm sm:text-base" onclick="document.getElementById('notes').scrollIntoView({behavior: 'smooth'})"> VIEW ALL NOTES </button>
                            </div>
                        </div>
                        <div class="md:w-1/2 flex justify-center relative"> <img src="https://i.imgur.com/wLiYfOr.jpeg" class="w-48 sm:w-64 md:w-80 rounded-xl shadow-2xl rotate-[-3deg] border-4 border-white transform transition hover:rotate-0 duration-500"> </div>
                    </div>

                    <!-- BLOCK 5 HERO PANEL -->
                    <div id="panel-block5" class="tab-panel hidden w-full flex flex-col-reverse md:flex-row items-center justify-between gap-6 sm:gap-12 animate-fade-right">
                        <div class="text-center md:text-left md:w-1/2 space-y-3 sm:space-y-4">
                            <span class="bg-white text-[#ec4899] font-bold px-4 py-1.5 rounded-full text-xs sm:text-sm shadow-sm inline-block tracking-wide">BEST VALUE FOR 2ND YEAR</span>
                            <h1 class="text-5xl sm:text-6xl md:text-7xl font-black text-gray-900 leading-tight algerya-sans-sc-font"> MASTER <br> <span class="text-[#ec4899]">BLOCK 5 MINORS</span> </h1>
                            <p class="text-gray-600 font-medium text-sm sm:text-base max-w-md mx-auto md:mx-0">Say goodbye to boring books. Completely aligned with UHS LOs and recommended books.</p>
                            <div class="flex flex-col sm:flex-row gap-3 sm:gap-4 justify-center md:justify-start mt-4 sm:mt-6">
                                <button class="add-to-cart-btn-hero bg-[#ec4899] text-white font-bold py-3 px-8 rounded-xl shadow-lg hover:bg-pink-600 transition transform hover:-translate-y-1 text-sm sm:text-base" onclick="document.querySelector('.add-to-cart-btn[data-product-id=\'2\']').click()"> SHOP BLOCK 5 </button>
                                <button class="bg-white text-gray-900 border-2 border-gray-200 font-bold py-3 px-8 rounded-xl shadow-sm hover:border-pink-500 transition text-sm sm:text-base" onclick="document.getElementById('notes').scrollIntoView({behavior: 'smooth'})"> VIEW ALL NOTES </button>
                            </div>
                        </div>
                        <div class="md:w-1/2 flex justify-center relative"> <img src="https://i.imgur.com/mTnWoeB.png" class="w-48 sm:w-64 md:w-80 rounded-xl shadow-2xl rotate-[-2deg] border-4 border-white transform transition hover:rotate-0 duration-500"> </div>
                    </div>
                </div>
                
                <!-- Hero Tabs Grid -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-2 sm:gap-4 max-w-5xl mx-auto w-full">
                    <!-- New Block 4 Tab First -->
                    <div class="hero-tab-card active-custom-orange group" data-target="block4" data-color="custom-orange">
                        <div class="tab-icon-box bg-orange-100 text-[#E78846] group-hover:bg-[#E78846] group-hover:text-white"> <i class="fa-solid fa-clock"></i> </div> 
                        <span class="tab-text font-bold text-gray-800 group-hover:text-[#E78846] transition-colors algerya-sans-sc-font tracking-wide">BLOCK 4</span>
                    </div>
                    <div class="hero-tab-card group" data-target="block3" data-color="custom-red">
                        <div class="tab-icon-box bg-red-100 text-red-600 group-hover:bg-[#F94A4A] group-hover:text-white"> <i class="fa-solid fa-brain"></i> </div> 
                        <span class="tab-text font-bold text-gray-800 group-hover:text-[#F94A4A] transition-colors algerya-sans-sc-font tracking-wide">BLOCK 3</span>
                    </div>
                    <div class="hero-tab-card group" data-target="block6" data-color="blue">
                        <div class="tab-icon-box bg-blue-100 text-blue-600 group-hover:bg-blue-600 group-hover:text-white"> <i class="fa-solid fa-book-medical"></i> </div> 
                        <span class="tab-text font-bold text-gray-800 group-hover:text-blue-600 transition-colors algerya-sans-sc-font tracking-wide">BLOCK 6</span>
                    </div>
                    <div class="hero-tab-card group" data-target="block5" data-color="pink">
                        <div class="tab-icon-box bg-pink-100 text-pink-600 group-hover:bg-pink-600 group-hover:text-white"> <i class="fa-solid fa-pills"></i> </div> 
                        <span class="tab-text font-bold text-gray-800 group-hover:text-pink-600 transition-colors algerya-sans-sc-font tracking-wide">BLOCK 5</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Shop Section -->
        <section id="notes" class="py-6 sm:py-8 mx-0 mt-4 sm:mt-6 mb-4 bg-white relative overflow-hidden reveal-on-scroll">
            <img src="https://i.imgur.com/QRYh6HS.png" alt="Medical Diagram" class="tilted-overlap-image">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center relative z-30">
                <h2 class="text-4xl sm:text-6xl font-black mb-4 text-black algerya-sans-sc-font uppercase tracking-tight">TOP RESOURCES</h2>
                
                <div id="filter-buttons-container" class="flex justify-center space-x-4 sm:space-x-6 mb-6">
                    <span id="filter-all" data-year="all" class="filter-text-button active text-black">ALL</span>
                    <span id="filter-1st" data-year="1" class="filter-text-button text-gray-500">1st Year</span>
                    <span id="filter-2nd" data-year="2" class="filter-text-button text-gray-500">2nd Year</span>
                </div>
                
                <div id="product-container" class="horizontal-scroll-container">
                    <div class="glass-card snap-center flex-shrink-0 w-40 sm:w-48 p-2 sm:p-3 rounded-xl text-center product-card mr-3" data-year="1" data-product-id="4">
                        <div class="product-image-box rounded-lg flex items-center justify-center product-trigger" data-product-id="4">
                            <img src="https://i.imgur.com/6tFeXf5.jpeg" alt="Mind Your Minors Block 3" class="rounded-lg">
                            <span class="absolute top-1 left-1 text-[10px] font-bold text-white bg-green-500 px-1.5 py-0.5 rounded-full shadow-md">NEW!!</span>
                        </div>
                        <h3 class="product-card-title text-gray-900 mb-0.5 product-trigger" data-product-id="4">MIND YOUR MINORS BLOCK 3</h3>
                        <div class="flex flex-col items-center justify-center space-y-0.5 mt-auto pb-6"> 
                            <span class="product-price-main">Rs. 700</span> 
                        </div>
                        <button class="add-to-cart-btn rounded-full flex items-center justify-center" data-product-id="4"> <span class="font-light leading-none">+</span> </button>
                    </div>
                    <div class="glass-card snap-center flex-shrink-0 w-40 sm:w-48 p-2 sm:p-3 rounded-xl text-center product-card mr-3" data-year="2" data-product-id="2">
                        <div class="product-image-box rounded-lg flex items-center justify-center product-trigger" data-product-id="2">
                            <img src="https://i.imgur.com/zTYjCgL.jpeg" alt="Mind Your Minors Block 5" class="rounded-lg">
                            <span class="absolute top-1 left-1 text-[10px] font-bold text-white bg-blue-500 px-1.5 py-0.5 rounded-full shadow-md">BEST VALUE</span>
                        </div>
                        <h3 class="product-card-title text-gray-900 mb-0.5 product-trigger" data-product-id="2">MIND YOUR MINORS - BLOCK 5</h3>
                        <div class="flex flex-col items-center justify-center space-y-0.5 mt-auto pb-6"> 
                            <span class="product-price-main">Rs. 500</span> 
                        </div>
                        <button class="add-to-cart-btn rounded-full flex items-center justify-center" data-product-id="2"> <span class="font-light leading-none">+</span> </button>
                    </div>
                    <div class="glass-card snap-center flex-shrink-0 w-40 sm:w-48 p-2 sm:p-3 rounded-xl text-center product-card mr-3" data-year="2" data-product-id="3">
                        <div class="product-image-box rounded-lg flex items-center justify-center product-trigger" data-product-id="3">
                            <img src="https://i.imgur.com/IhQVD4x.jpeg" alt="Mind Your Minors Block 6" class="rounded-lg">
                            <span class="absolute top-1 left-1 text-[10px] font-bold text-white bg-red-600 px-1.5 py-0.5 rounded-full shadow-md">NEW!</span>
                        </div>
                        <h3 class="product-card-title text-gray-900 mb-0.5 product-trigger" data-product-id="3">MIND YOUR MINORS - BLOCK 6</h3>
                        <div class="flex flex-col items-center justify-center space-y-0.5 mt-auto pb-6"> 
                            <span class="product-price-main">Rs. 700</span> 
                        </div>
                        <button class="add-to-cart-btn rounded-full flex items-center justify-center" data-product-id="3"> <span class="font-light leading-none">+</span> </button>
                    </div>
                    <!-- NEW PRODUCT: BLOCK 4 - TAG REMOVED -->
                    <div class="glass-card snap-center flex-shrink-0 w-40 sm:w-48 p-2 sm:p-3 rounded-xl text-center product-card mr-3" data-year="2" data-product-id="5">
                        <div class="product-image-box rounded-lg flex items-center justify-center product-trigger" data-product-id="5">
                            <img src="https://i.imgur.com/KsHrKt0.jpeg" alt="Mind Your Minors Block 4" class="rounded-lg">
                        </div>
                        <h3 class="product-card-title text-gray-900 mb-0.5 product-trigger" data-product-id="5">MIND YOUR MINORS - BLOCK 4</h3>
                        <div class="flex flex-col items-center justify-center space-y-0.5 mt-auto pb-6"> 
                            <span class="product-price-main">Rs. 600</span>
                            <span class="product-price-cut">Rs. 700</span>
                        </div>
                        <button class="add-to-cart-btn rounded-full flex items-center justify-center" data-product-id="5"> <span class="font-light leading-none">+</span> </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- NEW BUNDLE SECTION -->
        <section id="bundle-section" class="py-10 bg-gradient-to-br from-indigo-50 to-purple-50 reveal-on-scroll">
            <div class="max-w-4xl mx-auto px-4 sm:px-6 text-center">
                <span class="inline-block bg-purple-600 text-white text-xs font-bold px-3 py-1 rounded-full mb-3 tracking-widest uppercase">Limited Offer</span>
                <h2 class="text-3xl sm:text-5xl font-black mb-4 text-gray-900 algerya-sans-sc-font uppercase leading-tight">BUNDLE AND SAVE <span class="text-purple-600">Rs 150</span></h2>
                <p class="text-gray-600 mb-8 max-w-xl mx-auto">Get all 2nd Year resources (Block 4, 5, and 6) in one go. Complete your minor subjects preparation and save big.</p>
                
                <div class="bg-white rounded-3xl p-6 shadow-xl border border-purple-100 flex flex-col md:flex-row items-center justify-center gap-6 relative overflow-hidden">
                    <!-- Images -->
                    <div class="flex -space-x-8 md:-space-x-12 mb-4 md:mb-0 justify-center">
                        <img src="https://i.imgur.com/zTYjCgL.jpeg" class="w-32 md:w-40 rounded-xl shadow-lg transform rotate-[-10deg] border-2 border-white z-10" alt="Block 5">
                        <img src="https://i.imgur.com/KsHrKt0.jpeg" class="w-36 md:w-44 rounded-xl shadow-xl border-2 border-white z-20 relative -top-2" alt="Block 4">
                        <img src="https://i.imgur.com/IhQVD4x.jpeg" class="w-32 md:w-40 rounded-xl shadow-lg transform rotate-[10deg] border-2 border-white z-10" alt="Block 6">
                    </div>
                    
                    <!-- Info & Action -->
                    <div class="text-center md:text-left space-y-4 z-20">
                        <div>
                            <p class="text-sm font-bold text-gray-400 uppercase tracking-wider">2nd Year Complete Pack</p>
                            <div class="flex items-center justify-center md:justify-start gap-3">
                                <span class="text-4xl font-black text-gray-900 algerya-sans-sc-font">Rs. 1649</span>
                                <span class="text-xl text-gray-400 line-through font-bold">Rs. 1800</span>
                            </div>
                        </div>
                        <button onclick="addBundleToCart()" class="w-full md:w-auto bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-8 rounded-xl shadow-lg hover:shadow-xl transition transform hover:-translate-y-1 algerya-sans-sc-font tracking-wide text-lg flex items-center justify-center gap-2">
                            <i class="fas fa-layer-group"></i> MAKE MY BUNDLE
                        </button>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Vertical Images Section -->
        <section class="py-4 sm:py-6 bg-white reveal-on-scroll">
             <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex flex-col space-y-6 sm:space-y-8">
                    <img src="https://i.imgur.com/Xj9l2Cr.jpeg" alt="Preview 1" class="w-full rounded-3xl shadow-lg border border-gray-100">
                    <img src="https://i.imgur.com/XF7dRZ9.jpeg" alt="Preview 2" class="w-full rounded-3xl shadow-lg border border-gray-100">
                    <img src="https://i.imgur.com/rvOMwxF.jpeg" alt="Preview 3" class="w-full rounded-3xl shadow-lg border border-gray-100">
                </div>
            </div>
        </section>

        <!-- New Feature Section -->
        <section class="bg-[#E0F4FF] rounded-t-[50px] pb-0 pt-10 mt-6 w-full overflow-hidden border-none shadow-none reveal-on-scroll">
            <div class="w-full flex justify-center">
                 <img src="https://i.imgur.com/FZwBd2i.png" alt="Product Features" class="w-full max-w-7xl h-auto object-contain">
            </div>
        </section>

        <!-- Free Resources Section -->
        <section class="py-10 sm:py-16 bg-[#ef4444] rounded-[30px] mb-4 reveal-on-scroll relative overflow-hidden">
            <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center relative z-10">
                <div class="inline-block bg-[#991b1b] text-white font-bold px-6 py-2 rounded-lg mb-4 tracking-wider shadow-sm text-sm sm:text-base algerya-sans-sc-font uppercase">
                    FREE RESOURCES
                </div>
                <h2 class="text-3xl sm:text-5xl font-black text-white algerya-sans-sc-font mb-8 leading-tight">
                    EXPLORE HANDMADE NOTES <br> MADE BY OUR TEAM
                </h2>
                <a href="https://modmedicalis.online/FREE-RESOURCES" class="bg-white text-gray-900 font-black px-8 py-4 rounded-xl shadow-lg hover:bg-gray-100 transition transform hover:-translate-y-1 inline-flex items-center gap-2 text-sm sm:text-base uppercase tracking-wide">
                    <i class="fa-solid fa-arrow-down text-red-600"></i>
                    CLICK TO GET THE FREE RESOURCES
                </a>
            </div>
        </section>

        <!-- Founder Section (UPDATED: REMOVED IMAGE/NAME) -->
        <section class="py-6 sm:py-10 bg-white border-t border-gray-200 reveal-on-scroll">
            <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="p-5 sm:p-8 bg-white rounded-xl border-t-0">
                    <p class="text-gray-700 mb-4 sm:mb-6 text-sm sm:text-base leading-relaxed text-center">Mind Your Minors was born from the real struggles of every medical student; endless notes, massive books, and not enough time. We wanted to change the way students learn, making it smarter, simpler, and more visual. Each page blends clarity with creativity, turning complex topics into quick, memorable insights. Designed by students who've been in your shoes, this book makes learning the minor subjects not a burden, but a breakthrough in your MBBS journey.</p>
                </div>
            </div>
        </section>

        <!-- NEW: CAMPUS AMBASSADORS SECTION -->
        <section class="w-full bg-white pb-0 mb-0 reveal-on-scroll border-t border-gray-200">
            <div class="text-center py-6">
                <h2 class="text-3xl sm:text-5xl font-black text-[#1A5693] algerya-sans-sc-font tracking-wide">CAMPUS AMBASSADORS</h2>
            </div>
            <div class="relative w-full">
                <img src="https://i.imgur.com/2krt0Lk.jpeg" class="w-full h-auto object-cover block" alt="Ambassadors">
                <div class="absolute bottom-10 left-1/2 transform -translate-x-1/2">
                     <button onclick="openInfoPage('ambassadors')" class="bg-[#1A5693] text-white font-bold py-3 px-8 rounded-full shadow-lg hover:scale-105 transition algerya-sans-sc-font text-lg">SEE DETAIL</button>
                </div>
            </div>
        </section>
    </main>

    <!-- NEW: Info Pages Container (Hidden by default) -->
    <div id="info-page-container" class="hidden min-h-screen bg-white pt-6 pb-12">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
            <button onclick="switchView('main')" class="mb-6 flex items-center text-gray-600 hover:text-[#1A5693] transition font-medium">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                </svg>
                Back to Home
            </button>
            
            <!-- Contact Us -->
            <div id="info-contact" class="info-content hidden">
                <h1 class="text-4xl font-extrabold text-[#1A5693] algerya-sans-sc-font mb-6">Contact Us</h1>
                <p class="text-gray-700 mb-4">We are here to help you. Reach out to us via any of the following channels:</p>
                <div class="bg-gray-50 p-6 rounded-xl border border-gray-100 shadow-sm">
                    <p class="font-bold text-lg mb-2">WhatsApp Support</p>
                    <p class="text-[#1A5693] font-mono text-xl mb-4">0309 6554421</p>
                    <p class="font-bold text-lg mb-2">Email</p>
                    <p class="text-gray-600 mb-4">support@modmedicalis.online</p>
                    <p class="font-bold text-lg mb-2">Social Media</p>
                    <div class="flex space-x-4 mt-2">
                        <a href="#" class="text-gray-500 hover:text-pink-600"><i class="fab fa-instagram fa-2x"></i></a>
                        <a href="#" class="text-gray-500 hover:text-blue-600"><i class="fab fa-facebook fa-2x"></i></a>
                    </div>
                </div>
            </div>
            
            <div id="info-about" class="info-content hidden">
                <h1 class="text-4xl font-extrabold text-[#1A5693] algerya-sans-sc-font mb-6">About Us</h1>
                <div class="prose max-w-none text-gray-700 font-roboto">
                     <p class="mb-4">ModMedicalis is a student-led initiative designed to revolutionize medical education in Pakistan.</p>
                </div>
            </div>
            
            <div id="info-shipping" class="info-content hidden">
                <h1 class="text-4xl font-extrabold text-[#1A5693] algerya-sans-sc-font mb-6">Shipping & Return</h1>
                <div class="space-y-8 font-roboto text-gray-700">
                    <div class="bg-gray-50 p-6 rounded-xl border border-gray-100">
                        <div class="flex items-start mb-4">
                            <i class="fas fa-truck text-[#1A5693] text-2xl mt-1 mr-4"></i>
                            <div>
                                <h3 class="text-xl font-bold mb-2 algerya-sans-sc-font text-gray-900">Shipping Charges</h3>
                                <p class="mb-1">Shipping charges in Lahore are <span class="font-bold">100 Rs</span>.</p>
                                <p>Shipping charges in other cities are <span class="font-bold">200 Rs</span>.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 p-6 rounded-xl border border-gray-100">
                        <div class="flex items-start mb-4">
                            <i class="fas fa-money-bill-wave text-green-600 text-2xl mt-1 mr-4"></i>
                            <div>
                                <h3 class="text-xl font-bold mb-2 algerya-sans-sc-font text-gray-900">Payment</h3>
                                <p>Shipping charges have to be paid in <span class="font-bold">CASH TO RIDER</span> at the time of delivery.</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-red-50 p-6 rounded-xl border border-red-100">
                        <div class="flex items-start mb-4">
                            <i class="fas fa-exclamation-circle text-red-600 text-2xl mt-1 mr-4"></i>
                            <div>
                                <h3 class="text-xl font-bold mb-2 algerya-sans-sc-font text-gray-900">Return Policy</h3>
                                <p>No return once ordered but return can only be made if any printing issue (major) is found in the book.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-blue-50 p-6 rounded-xl border border-blue-100">
                        <div class="flex items-start mb-4">
                            <i class="fas fa-headset text-[#1A5693] text-2xl mt-1 mr-4"></i>
                            <div>
                                <h3 class="text-xl font-bold mb-2 algerya-sans-sc-font text-gray-900">Contact Us</h3>
                                <p class="mb-2">For information regarding shipping or order details contact:</p>
                                <div class="font-bold text-lg text-[#1A5693]">
                                    <p>0318 6967013</p>
                                    <p>0309 6554421</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="info-faqs" class="info-content hidden">
                <h1 class="text-4xl font-extrabold text-[#1A5693] algerya-sans-sc-font mb-6">FAQs</h1>
                <div class="space-y-4">
                    <div class="product-accordian-item border border-gray-200 rounded-lg px-4" onclick="toggleAccordion(this)">
                        <div class="product-accordian-title py-2">
                            WHICH RESOURCE BOOKS ARE USED FOR THESE NOTES <span class="text-[#F94A4A] text-xl transform transition-transform">+</span>
                        </div>
                        <div class="hidden pb-4 text-sm text-gray-600 font-roboto">
                            <ul class="list-disc list-inside space-y-1">
                                <li><strong>Pathology:</strong> Big & medium Robbins</li>
                                <li><strong>Pharmacology:</strong> Katzung & Lippincott Pharmacology</li>
                                <li><strong>Community Medicine:</strong> K Park</li>
                                <li><strong>Behavioural Sciences:</strong> Muwaddat H Rana</li>
                                <li><strong>Aging:</strong> Lippincott Biochemistry, Harper, Big & Medium Robbins</li>
                            </ul>
                        </div>
                    </div>

                    <div class="product-accordian-item border border-gray-200 rounded-lg px-4" onclick="toggleAccordion(this)">
                        <div class="product-accordian-title py-2">
                            DO YOU DELIVER IN OTHER CITIES? <span class="text-[#F94A4A] text-xl transform transition-transform">+</span>
                        </div>
                        <div class="hidden pb-4 text-sm text-gray-600 font-roboto">
                            Yes we deliver all over Pakistan.
                        </div>
                    </div>

                    <div class="product-accordian-item border border-gray-200 rounded-lg px-4" onclick="toggleAccordion(this)">
                        <div class="product-accordian-title py-2">
                            WHAT IS THE QUALITY OF PAGES? <span class="text-[#F94A4A] text-xl transform transition-transform">+</span>
                        </div>
                        <div class="hidden pb-4 text-sm text-gray-600 font-roboto">
                            Pages are matte quality & book is in spiral binding.
                        </div>
                    </div>

                    <div class="product-accordian-item border border-gray-200 rounded-lg px-4" onclick="toggleAccordion(this)">
                        <div class="product-accordian-title py-2">
                            HOW MANY DAYS IT TAKES TO DELIVER? <span class="text-[#F94A4A] text-xl transform transition-transform">+</span>
                        </div>
                        <div class="hidden pb-4 text-sm text-gray-600 font-roboto">
                            <ul class="list-disc list-inside">
                                <li><strong>1-2 days:</strong> In Lahore</li>
                                <li><strong>3-4 days:</strong> Other cities</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="info-resources" class="info-content hidden"><h1 class="text-4xl font-extrabold text-[#1A5693] algerya-sans-sc-font mb-6">Free Resources</h1><p>Drive Link...</p></div>

            <!-- NEW: Ambassador Subpage -->
            <div id="info-ambassadors" class="info-content hidden bg-[#0B1120] min-h-screen text-white p-4 -mt-6 -mx-4 sm:-mx-8 lg:-mx-8 pb-12">
                <div class="max-w-4xl mx-auto pt-6">
                    <button onclick="switchView('main')" class="mb-6 flex items-center text-gray-300 hover:text-white transition font-medium">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                        </svg>
                        Back to Home
                    </button>
                    <h1 class="text-4xl sm:text-5xl font-extrabold text-white algerya-sans-sc-font mb-10 text-center tracking-wide">CAMPUS AMBASSADORS</h1>
                    
                    <!-- Section 1 Carousel -->
                    <div class="max-w-4xl mx-auto mb-16 relative overflow-hidden rounded-xl h-[400px] sm:h-[600px] shadow-2xl carousel-container" id="ambassador-carousel-1">
                        <img src="https://i.imgur.com/GepgEiA.jpeg" class="absolute inset-0 w-full h-full object-contain bg-black transition-opacity duration-1000 opacity-100 active-slide">
                        <img src="https://i.imgur.com/tWtZxZl.jpeg" class="absolute inset-0 w-full h-full object-contain bg-black transition-opacity duration-1000 opacity-0">
                    </div>

                    <!-- Section 2 Carousel -->
                    <div class="max-w-4xl mx-auto relative overflow-hidden rounded-xl h-[400px] sm:h-[600px] shadow-2xl carousel-container" id="ambassador-carousel-2">
                        <img src="https://i.imgur.com/61ruBIC.jpeg" class="absolute inset-0 w-full h-full object-contain bg-black transition-opacity duration-1000 opacity-100 active-slide">
                        <img src="https://i.imgur.com/f3Ok9pd.jpeg" class="absolute inset-0 w-full h-full object-contain bg-black transition-opacity duration-1000 opacity-0">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer id="contact" class="bg-[#FFEFF2] text-gray-900 py-8 sm:py-10 reveal-on-scroll">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <div class="flex flex-col items-center mb-6 sm:mb-8">
                <a href="#" class="home-logo-link flex-shrink-0 flex items-center mb-4"> <img src="https://i.imgur.com/R8x4icz.png" alt="ModMedicalis Logo" class="h-10 sm:h-12 w-auto rounded-lg"> </a>
                <h3 class="text-lg sm:text-xl font-bold text-red-600 mb-2 algerya-sans-sc-font">MODMEDICALIS</h3>
                <p class="text-xs sm:text-sm text-gray-600 max-w-sm">Your trusted partner for medical education excellence.</p>
            </div>
            <div class="max-w-xs mx-auto mb-6 sm:mb-8 border-t border-b border-gray-300 py-4 sm:py-6">
                <h4 class="text-sm sm:text-base font-bold mb-4 text-red-600 algerya-sans-sc-font">MENU</h4>
                <ul class="space-y-2 text-sm sm:text-base font-medium">
                    <li><a href="#" class="home-logo-link text-gray-700 hover:text-red-600 transition algerya-sans-sc-font text-lg tracking-wide">Home</a></li>
                    <li><a href="#notes" onclick="switchView('main'); document.getElementById('notes').scrollIntoView(); return false;" class="text-gray-700 hover:text-red-600 transition algerya-sans-sc-font text-lg tracking-wide">Shop</a></li>
                    <li><a href="#" onclick="openInfoPage('about'); return false;" class="text-gray-700 hover:text-red-600 transition algerya-sans-sc-font text-lg tracking-wide">About Us</a></li>
                    <li><a href="#" onclick="openInfoPage('contact'); return false;" class="text-gray-700 hover:text-red-600 transition algerya-sans-sc-font text-lg tracking-wide">Contact Us</a></li>
                </ul>
            </div>
             <div class="text-[10px] sm:text-xs text-gray-500 space-x-4 pt-4 mt-4 border-t border-gray-300"> 
                 <p class="mb-2">&copy; 2025 ModMedicalis</p> 
             </div>
             <div class="flex justify-center gap-4 mt-6 pb-4 opacity-70">
                <img src="https://i.imgur.com/khyCRda.png" alt="JazzCash" class="h-8 w-auto grayscale hover:grayscale-0 transition duration-300">
                <img src="https://i.imgur.com/YPjxkVW.png" alt="Easypaisa" class="h-8 w-auto grayscale hover:grayscale-0 transition duration-300">
                <img src="https://i.imgur.com/klcJtkq.png" alt="Bank Transfer" class="h-8 w-auto grayscale hover:grayscale-0 transition duration-300">
            </div>
        </div>
    </footer>

    <!-- CART MODAL (Hidden) -->
    <div id="cart-modal-overlay" class="hidden fixed inset-0 bg-black bg-opacity-60 z-[200] flex items-center justify-center p-4 backdrop-blur-sm transition-opacity duration-300">
        <div id="cart-modal" class="bg-white w-full max-w-md rounded-[2rem] shadow-2xl transform transition-all duration-300 scale-95 opacity-0 overflow-hidden flex flex-col max-h-[90vh]">
            <div class="pt-6 px-6 pb-2 flex justify-between items-center bg-white">
                <h3 id="cart-heading-title" class="text-3xl font-black text-gray-900 algerya-sans-sc-font uppercase tracking-tight">YOUR CART <span class="text-gray-400 font-medium">(0 ITEMS)</span></h3>
                <button id="close-cart-button" class="text-gray-400 hover:text-gray-900 transition p-2"> 
                    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg> 
                </button>
            </div>
            <!-- Progress Bar Removed -->
            <div class="h-[1px] bg-gray-100 w-full mt-2"></div>
            <div id="cart-items-container" class="p-6 overflow-y-auto custom-scrollbar flex-1 space-y-6 bg-white"> 
                <p id="empty-cart-message" class="text-gray-400 text-center italic py-10">Your cart is empty.</p> 
            </div>
            <div class="h-[1px] bg-gray-100 w-full"></div>
            <div id="cart-footer" class="p-6 bg-white space-y-4">
                <div class="flex justify-between items-center"> 
                    <span class="text-lg font-bold text-gray-900 algerya-sans-sc-font tracking-wide">SUBTOTAL</span> 
                    <span id="cart-subtotal" class="text-lg font-bold text-gray-900">Rs. 0</span> 
                </div>
                <div class="flex justify-between items-center"> 
                    <span class="text-2xl font-black text-gray-900 algerya-sans-sc-font tracking-wide">TOTAL</span> 
                    <span id="cart-total" class="text-2xl font-black text-gray-900">Rs. 0</span> 
                </div>
                <button id="proceed-to-checkout-btn" class="w-full bg-[#3ba4f5] text-white py-4 rounded-xl font-black text-lg hover:bg-sky-500 transition duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 algerya-sans-sc-font tracking-widest uppercase"> CHECK OUT </button>
            </div>
        </div>
    </div>
    
    <!-- NEW BUNDLE POPUP -->
    <div id="bundle-popup" class="bundle-popup-container">
        <div class="flex items-start justify-between mb-3">
             <h4 class="text-xl font-black text-purple-700 algerya-sans-sc-font leading-none">SAVE BIG ON <br> 2ND YEAR BUNDLE</h4>
             <button onclick="document.getElementById('bundle-popup').classList.remove('show')" class="text-gray-400 hover:text-gray-600"><i class="fas fa-times"></i></button>
        </div>
        <p class="text-sm text-gray-600 mb-4">Get Block 4, 5 & 6 together for just <strong>Rs. 1649</strong> instead of 1800.</p>
        <div class="flex justify-center -space-x-4 mb-4">
             <img src="https://i.imgur.com/zTYjCgL.jpeg" class="w-16 h-20 object-cover rounded shadow border border-white" alt="B5">
             <img src="https://i.imgur.com/KsHrKt0.jpeg" class="w-16 h-20 object-cover rounded shadow border border-white z-10" alt="B4">
             <img src="https://i.imgur.com/IhQVD4x.jpeg" class="w-16 h-20 object-cover rounded shadow border border-white" alt="B6">
        </div>
        <button onclick="addBundleToCart(); document.getElementById('bundle-popup').classList.remove('show')" class="w-full bg-purple-600 text-white font-bold py-2 rounded-lg hover:bg-purple-700 transition shadow-md">MAKE BUNDLE (Rs. 1649)</button>
    </div>

    <!-- Checkout Page -->
    <div id="checkout-page" class="hidden">
        <!-- (Same Checkout Code) -->
        <div class="mobile-header">
            <img src="https://i.imgur.com/R8x4icz.png" alt="ModMedicalis" class="h-10 w-auto rounded-lg">
        </div>
        <details class="mobile-summary-accordion" open>
            <summary>
                <span class="flex items-center text-[#1A5693]">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                    Show order summary
                </span>
                <span id="mobile-summary-total" class="text-gray-900 font-bold">Rs. 0</span>
            </summary>
            <div class="mobile-summary-content">
                <ul class="text-sm space-y-3 pt-3 text-gray-600 mobile-cart-mirror"></ul>
            </div>
        </details>
        <div class="shopify-layout">
            <div class="shopify-main">
                <div class="checkout-header-logo hidden lg:block">
                    <img src="https://i.imgur.com/R8x4icz.png" alt="ModMedicalis" class="h-12 w-auto rounded-lg">
                </div>
                
                <!-- NEW: PRE ORDER WARNING TOP -->
                <div id="pre-order-warning-top" class="pre-order-warning hidden">
                    <i class="fas fa-clock text-xl text-yellow-600"></i>
                    <div>
                        <p class="font-bold text-sm uppercase">Pre-Order Item in Cart</p>
                        <p class="text-xs">Your order includes "Mind Your Minors Block 4". This is a pre-order. We will inform you via your mobile number when the book arrives. Expected release date: <strong>22nd Dec 2025</strong>.</p>
                    </div>
                </div>

                <form id="checkout-form" method="POST" enctype="multipart/form-data">
                    <input type="hidden" name="Cart Details" id="form-cart-details">
                    <input type="hidden" name="Final Bill" id="form-final-bill">
                    <input type="hidden" name="Order ID" id="form-order-id">
                    <input type="hidden" name="Roll Number" id="form-roll-number" value="">
                    
                    <!-- HIDDEN FIELDS FOR FORMSUBMIT -->
                    <input type="hidden" name="_subject" value="New Order Received - ModMedicalis">
                    <input type="hidden" name="_captcha" value="false">
                    <input type="hidden" name="_template" value="table">
                    
                    <div class="mb-8 border-b border-gray-100 pb-8">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-lg font-medium">Contact & Shipping</h2>
                            <p class="text-sm text-[#1A5693] cursor-pointer" onclick="returnToCartFromCheckout()">Return to Cart</p>
                        </div>
                        <div class="shopify-input-group">
                            <label class="shopify-input-label">Full Name</label>
                            <input type="text" id="full_name" name="Full Name" required class="modern-input" placeholder="Enter your name">
                        </div>
                        <div class="shopify-input-group">
                            <label class="shopify-input-label">Contact Number</label>
                            <input type="tel" id="contact_number" name="Contact Number" required class="modern-input" placeholder="03XXXXXXXXX">
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="shopify-input-group">
                                <label class="shopify-input-label">College</label>
                                <select id="college" name="College" required class="modern-input">
                                    <option value="" disabled selected>Select Medical College</option>
                                </select>
                            </div>
                            <div class="shopify-input-group">
                                <label class="shopify-input-label">City</label>
                                <select id="city_selector" name="City" required class="modern-input">
                                    <option value="" disabled selected>Select City</option>
                                </select>
                            </div>
                        </div>
                        <div class="shopify-input-group">
                            <label class="shopify-input-label">Shipping Address</label>
                            <textarea id="shipping_address" name="Shipping Address" rows="3" required class="modern-input" placeholder="House no, Street, Area..."></textarea>
                        </div>
                        
                        <!-- UPDATED PROMO SECTION (Formerly AIMC only) -->
                        <div id="college-promo-section" class="hidden mt-4">
                            <div class="p-3 bg-blue-50 border border-blue-200 rounded-lg">
                                <p class="text-xs font-bold text-blue-800 mb-2 uppercase tracking-wide">College Student Offer</p>
                                <div class="flex gap-2">
                                    <input type="text" id="promo_code" name="Promo Code Entered" class="modern-input uppercase text-sm" placeholder="Enter Promo Code">
                                </div>
                                <div id="roll-number-entry" class="hidden mt-2">
                                    <input type="number" id="roll_number" name="AIMC Roll Number" class="modern-input text-sm" placeholder="Roll Number (AIMC Only)">
                                    <p id="roll-number-feedback" class="text-[11px] mt-1 font-semibold"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mb-8 border-b border-gray-100 pb-8">
                         <div class="flex justify-between items-center mb-4">
                            <h2 class="text-lg font-medium">Payment</h2>
                        </div>
                        <div class="bg-gray-50 border border-gray-200 rounded-lg p-5 mb-6">
                            <p class="text-sm font-medium text-gray-500 mb-1">Send payment to:</p>
                            <p class="text-lg font-bold text-gray-900">MUHAMMAD HASNAIN</p>
                            <div class="flex items-center space-x-2 mt-2">
                                <span class="text-xl font-mono text-black font-roboto font-bold tracking-wider">03096554421</span>
                                <button type="button" onclick="copyPaymentNumber(this)" class="text-xs bg-gray-200 hover:bg-gray-300 px-2 py-1 rounded transition duration-200">Copy</button>
                            </div>
                            <p class="text-xs text-gray-500 mt-1">Jazzcash & Easypaisa</p>
                            <div class="mt-4 pt-4 border-t border-gray-200">
                                <p class="text-sm font-medium text-gray-900">Amount to Pay: <span id="payment-amount" class="text-red-600 font-bold">Rs. 0</span></p>
                                <p class="text-[11px] text-gray-500 mt-1">*Delivery charges are paid in Cash on Delivery. Pay only for products now.</p>
                            </div>
                        </div>
                        <div class="shopify-input-group">
                            <label class="shopify-input-label">Upload Payment Proof</label>
                            <div class="flex items-center justify-center w-full">
                                <label for="payment_slip" class="flex flex-col items-center justify-center w-full h-32 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 transition">
                                    <div class="flex flex-col items-center justify-center pt-5 pb-6">
                                        <svg class="w-8 h-8 mb-4 text-gray-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 16">
                                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"/>
                                        </svg>
                                        <p class="text-sm text-gray-500"><span id="upload-text">Click to upload slip</span></p>
                                    </div>
                                    <input type="file" id="payment_slip" name="Payment Slip" accept="image/*,.pdf" required class="hidden">
                                </label>
                            </div>
                        </div>
                        <div class="mt-8">
                            <p class="text-sm font-medium mb-3 text-gray-700">How did you hear about us?</p>
                            <div class="space-y-2">
                                <div class="flex items-center"> <input id="source-ambassador" name="Referral Source" type="radio" value="Ambassador" required class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500"> <label for="source-ambassador" class="ml-2 text-sm text-gray-700">Ambassador</label> </div>
                                <div class="flex items-center"> <input id="source-social" name="Referral Source" type="radio" value="Social Media" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500"> <label for="source-social" class="ml-2 text-sm text-gray-700">Social Media</label> </div>
                                <div class="flex items-center"> <input id="source-colleagues" name="Referral Source" type="radio" value="Colleagues" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500"> <label for="source-colleagues" class="ml-2 text-sm text-gray-700">Colleagues</label> </div>
                            </div>
                        </div>
                    </div>
                    <div class="mb-4">
                        <div id="checkout-delivery-note" class="p-4 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-800 mb-6"></div>
                        
                        <!-- Order Summary Inline for Checkout -->
                        <div id="checkout-inline-summary" class="mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200">
                            <h3 class="text-lg font-bold text-gray-900 mb-4 algerya-sans-sc-font uppercase">Order Summary</h3>
                            <ul id="inline-summary-list" class="text-sm space-y-3 mb-4 text-gray-600"></ul>
                            <div class="flex justify-between items-center pt-3 border-t border-gray-200 font-bold text-gray-900">
                                <span>Total</span>
                                <span id="inline-summary-total">Rs. 0</span>
                            </div>
                        </div>

                        <!-- NEW: PRE ORDER WARNING BOTTOM -->
                        <div id="pre-order-warning-bottom" class="pre-order-warning hidden">
                            <i class="fas fa-info-circle text-xl text-yellow-600"></i>
                            <div>
                                <p class="text-xs">Reminder: Block 4 is a pre-order item. Shipping will commence from <strong>22nd Dec 2025</strong>. We will contact you for status confirmation.</p>
                            </div>
                        </div>

                        <p class="text-sm text-gray-600 mb-4">Please verify all details above before confirming.</p>
                        <div class="checkout-navigation">
                            <button type="submit" id="confirm-order-btn" class="shopify-btn-primary bg-red-600 hover:bg-red-700">Place Order</button>
                        </div>
                    </div>
                </form>
                <div class="payment-icons-container md:hidden pb-8">
                    <img src="https://i.imgur.com/khyCRda.png" alt="JazzCash" class="payment-icon">
                    <img src="https://i.imgur.com/YPjxkVW.png" alt="Easypaisa" class="payment-icon">
                    <img src="https://i.imgur.com/klcJtkq.png" alt="Bank Transfer" class="payment-icon">
                </div>
                <div id="checkout-success-page" class="hidden py-12 text-center">
                    <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-900 mb-2">Order Confirmed!</h3>
                    <div id="checkout-success-message" class="text-gray-600 mb-6"></div>
                    <p class="text-sm text-gray-500 bg-gray-50 p-4 rounded-lg inline-block">Support: <strong>03096554421</strong></p>
                    <button id="close-success-btn" class="block w-full max-w-xs mx-auto mt-8 shopify-btn-primary">Return to Shop</button>
                </div>
            </div>
            <div class="shopify-sidebar">
                <div class="sidebar-product-list"></div>
                <h3 class="text-lg font-bold text-gray-700 mb-4">Order Summary</h3>
                <ul id="checkout-summary-list" class="text-sm space-y-3 mb-4 text-gray-600"></ul>
                <div class="sidebar-total">
                    <span class="sidebar-total-label">Total</span>
                    <div class="flex items-center">
                        <span class="sidebar-total-currency">PKR</span>
                        <span id="checkout-final-total" class="sidebar-total-value">Rs. 0</span>
                    </div>
                </div>
                <div class="mt-8 pt-8 border-t border-gray-200">
                    <button id="close-checkout-button" class="text-sm text-red-500 hover:text-red-700 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                        Cancel Checkout
                    </button>
                </div>
                <div class="payment-icons-container">
                    <img src="https://i.imgur.com/khyCRda.png" alt="JazzCash" class="payment-icon">
                    <img src="https://i.imgur.com/YPjxkVW.png" alt="Easypaisa" class="payment-icon">
                    <img src="https://i.imgur.com/klcJtkq.png" alt="Bank Transfer" class="payment-icon">
                </div>
            </div>
        </div>
    </div>
    
    <!-- Product Modal Page -->
    <div id="product-page" class="hidden min-h-screen bg-white">
        <div id="product-page-content" class="max-w-7xl mx-auto py-8 sm:py-12 px-4 sm:px-6 lg:px-8">
            <div class="flex justify-end mb-4">
                <button id="close-product-page-button" class="text-gray-500 hover:text-gray-900 transition p-2 bg-gray-100 rounded-full">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                </button>
            </div>
            
            <div class="grid md:grid-cols-2 gap-8 lg:gap-16">
                <!-- Mobile Only: Title & Price First -->
                <div class="md:hidden space-y-2">
                     <h2 id="popup-product-name-mobile" class="text-4xl sm:text-5xl font-black text-gray-900 algerya-sans-sc-font uppercase leading-none tracking-tight"></h2>
                     <div class="flex items-end space-x-3 pb-2">
                        <span id="popup-product-price-mobile" class="text-3xl font-black algerya-sans-sc-font tracking-wide text-[#F94A4A]"></span>
                        <span id="popup-product-old-price-mobile" class="text-lg text-gray-400 line-through mb-1"></span>
                    </div>
                </div>

                <!-- Left Column: Images -->
                <div class="space-y-4">
                    <div id="popup-image-carousel" class="w-full relative">
                        <div class="product-popup-image-container rounded-lg shadow-sm border border-gray-100 bg-gray-50"> 
                            <img id="popup-main-image" src="" alt="Product Main Image" class="p-2"> 
                        </div>
                        <div id="popup-thumbnails" class="flex space-x-3 mt-4 overflow-x-auto pb-2"></div>
                    </div>
                </div>

                <!-- Right Column: Details -->
                <div class="space-y-5">
                    <!-- Desktop Only: Title & Price -->
                    <div class="hidden md:block">
                        <h2 id="popup-product-name" class="text-4xl sm:text-5xl font-black text-gray-900 algerya-sans-sc-font uppercase leading-none tracking-tight"></h2>
                        <div class="flex items-center mt-2 space-x-1">
                            <div class="flex text-yellow-400 text-sm">
                                <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i>
                            </div>
                            <!-- Dynamic review count ID added -->
                            <span id="popup-header-review-count-desktop" class="text-gray-500 text-sm font-medium ml-2"></span>
                        </div>
                        <div class="border-b border-gray-100 pb-4 mt-2">
                            <div class="flex items-end space-x-3">
                               <span id="popup-product-price" class="text-3xl font-black algerya-sans-sc-font tracking-wide text-[#F94A4A]"></span>
                               <span id="popup-product-old-price" class="text-lg text-gray-400 line-through mb-1"></span>
                           </div>
                       </div>
                    </div>
                    
                    <!-- Mobile Ratings (Moved here for mobile flow) -->
                    <div class="md:hidden flex items-center mt-2 space-x-1">
                        <div class="flex text-yellow-400 text-sm">
                            <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i>
                        </div>
                        <!-- Dynamic review count ID added -->
                        <span id="popup-header-review-count-mobile" class="text-gray-500 text-sm font-medium ml-2"></span>
                    </div>

                    <button id="popup-free-preview-btn" class="free-preview-btn-ref">
                        <i class="fas fa-file-pdf"></i> CLICK FOR FREE PREVIEW
                    </button>

                    <div class="space-y-3">
                        <div>
                            <p class="font-extrabold text-sm uppercase text-gray-800 mb-1 algerya-sans-sc-font">FORMAT</p>
                            <div class="custom-dropdown-box">
                                <span>Spiral Bound</span>
                                <i class="fas fa-chevron-down text-gray-400"></i>
                            </div>
                        </div>
                    </div>

                    <div class="flex gap-4">
                        <div class="border border-gray-300 rounded-lg flex items-center px-4 w-32 justify-between bg-white h-14">
                            <!-- ADDED IDS HERE -->
                            <span id="popup-quantity-minus" class="text-gray-400 text-xl font-light cursor-pointer select-none hover:text-black">-</span>
                            <span id="popup-quantity-count" class="font-bold text-xl">1</span>
                            <span id="popup-quantity-plus" class="text-gray-400 text-xl font-light cursor-pointer select-none hover:text-black">+</span>
                        </div>
                        <button id="popup-add-to-cart-btn" class="flex-1 bg-[#F94A4A] text-white rounded-lg font-black text-lg uppercase tracking-wide shadow-lg hover:opacity-90 transition transform hover:-translate-y-0.5 algerya-sans-sc-font h-14 flex items-center justify-center gap-2" data-product-id="">
                             ADD TO CART <span id="popup-btn-price-display"></span>
                        </button>
                    </div>

                    <div class="space-y-2 pt-2">
                        <div class="flex items-center text-sm text-gray-600">
                            <i class="fas fa-truck text-[#F94A4A] w-6 text-center"></i>
                            <span>Shipping all over Pakistan</span>
                        </div>
                        <div class="flex items-center text-sm text-gray-600">
                            <i class="fas fa-lightbulb text-[#F94A4A] w-6 text-center"></i>
                            <span>High-Yield & Visual</span>
                        </div>
                    </div>

                    <div id="popup-delivery-notice" class="hidden"></div>
                    <div id="popup-product-features" class="hidden"></div>
                    <p id="popup-product-description" class="hidden"></p>

                    <div class="border-t border-gray-200 mt-6">
                        <div class="product-accordian-item" onclick="toggleAccordion(this)">
                            <div class="product-accordian-title">
                                WHAT'S INCLUDED? <span class="text-[#F94A4A] text-xl transform transition-transform">+</span>
                            </div>
                            <div class="hidden mt-3 text-sm text-gray-600">
                                <ul class="list-disc list-inside space-y-1 ml-2">
                                    <li>Mnemonics</li>
                                    <li>Illustrations</li>
                                    <li>Online Quiz Portal - Mediquiz</li>
                                    <li>All Minor Subjects</li>
                                </ul>
                            </div>
                        </div>
                        <div class="product-accordian-item" onclick="toggleAccordion(this)">
                            <div class="product-accordian-title">
                                ABOUT THE GUIDE <span class="text-[#F94A4A] text-xl transform transition-transform">+</span>
                            </div>
                            <div class="hidden mt-3 text-sm text-gray-600 leading-relaxed">
                                A highly successful & game changer book for minor subjects. With our top resources minor subjects donâ€™t feel boring anymore. Recommended by top scorers, our resources are here to make minor subjects a piece of cake.
                            </div>
                        </div>
                        <div class="product-accordian-item" onclick="toggleAccordion(this)">
                            <div class="product-accordian-title">
                                WHO'S IT FOR? <span class="text-[#F94A4A] text-xl transform transition-transform">+</span>
                            </div>
                            <div class="hidden mt-3 text-sm text-gray-600">
                                For MBBS students studying in colleges affiliated with UHS.
                            </div>
                        </div>
                    </div>

                    <div class="pt-6">
                        <h3 class="text-xl font-black uppercase mb-4 algerya-sans-sc-font">CUSTOMER REVIEWS</h3>
                        <div class="flex items-center gap-8 mb-6">
                            <div class="text-center">
                                <!-- Dynamic Rating ID Added -->
                                <div id="popup-rating-value" class="text-5xl font-light text-gray-600"></div>
                                <div class="flex text-yellow-400 text-sm justify-center my-1">
                                    <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i>
                                </div>
                                <!-- Dynamic Review Count ID Added -->
                                <div id="popup-review-count-text" class="text-xs text-gray-500"></div>
                            </div>
                            <div class="flex-1 max-w-xs">
                                <div class="review-bar-container"> <span>5</span> <div class="review-bar-bg"><div class="review-bar-fill" style="width: 90%"></div></div> </div>
                                <div class="review-bar-container"> <span>4</span> <div class="review-bar-bg"><div class="review-bar-fill" style="width: 10%"></div></div> </div>
                                <div class="review-bar-container"> <span>3</span> <div class="review-bar-bg"><div class="review-bar-fill" style="width: 0%"></div></div> </div>
                                <div class="review-bar-container"> <span>2</span> <div class="review-bar-bg"><div class="review-bar-fill" style="width: 0%"></div></div> </div>
                                <div class="review-bar-container"> <span>1</span> <div class="review-bar-bg"><div class="review-bar-fill" style="width: 0%"></div></div> </div>
                            </div>
                        </div>
                        <button class="w-full border border-[#F94A4A] text-[#F94A4A] font-bold py-2 rounded uppercase text-sm hover:bg-red-50 transition">Write a review</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

<script>
    // --- Notification Carousel Logic ---
    const notifications = [
        "MIND YOUR MINORS 4 IS NOW AVAILABLE",
        "DELIVERING ALL OVER PAKISTAN",
        "BUNDLE & SAVE Rs 150 ON 2ND YEAR RESOURCES"
    ];
    let currentNotificationIndex = 0;
    const notificationTextElement = document.getElementById('notification-text');

    function updateNotification() {
        notificationTextElement.textContent = notifications[currentNotificationIndex];
    }

    function nextNotification() {
        currentNotificationIndex = (currentNotificationIndex + 1) % notifications.length;
        updateNotification();
    }

    function prevNotification() {
        currentNotificationIndex = (currentNotificationIndex - 1 + notifications.length) % notifications.length;
        updateNotification();
    }

    // Auto-rotate notifications every 5 seconds
    setInterval(nextNotification, 5000);

    // Show Bundle Popup after 5 seconds
    setTimeout(() => {
        document.getElementById('bundle-popup').classList.add('show');
    }, 5000);
    
    // --- AMBASSADOR CAROUSEL LOGIC ---
    function startAmbassadorCarousel(containerId) {
        const container = document.getElementById(containerId);
        if(!container) return;
        const images = container.querySelectorAll('img');
        let index = 0;
        setInterval(() => {
            images[index].classList.remove('active-slide');
            images[index].classList.add('opacity-0');
            index = (index + 1) % images.length;
            images[index].classList.remove('opacity-0');
            images[index].classList.add('active-slide');
        }, 3000);
    }
    
    document.addEventListener('DOMContentLoaded', () => {
        startAmbassadorCarousel('ambassador-carousel-1');
        startAmbassadorCarousel('ambassador-carousel-2');
    });

    // ... existing helper functions ...
    function toggleAccordion(element) {
        const content = element.querySelector('div:not(.product-accordian-title)');
        const icon = element.querySelector('.product-accordian-title span');
        if (content.classList.contains('hidden')) {
            content.classList.remove('hidden');
            icon.style.transform = 'rotate(45deg)';
        } else {
            content.classList.add('hidden');
            icon.style.transform = 'rotate(0deg)';
        }
    }

    function displayCustomAlert(message) {
        const popup = document.createElement('div');
        popup.className = 'fixed inset-0 bg-black bg-opacity-70 z-[1000] flex items-center justify-center p-4';
        popup.innerHTML = ` <div class="bg-white rounded-xl shadow-2xl p-6 max-w-sm w-full text-center"> <h5 class="text-xl font-bold text-red-600 mb-4 algerya-sans-sc-font">Notification</h5> <p class="text-gray-700 mb-6">${message}</p> <button onclick="this.closest('.fixed').remove()" class="px-6 py-2 bg-[#1A5693] text-white rounded-lg font-bold hover:bg-blue-700 algerya-sans-sc-font">OK</button> </div> `;
        document.body.appendChild(popup);
    }
    
    // ... copyPaymentNumber, DELIVERY_CHARGE_LAHORE, etc ...
    function copyPaymentNumber(btn) {
        const number = '03096554421';
        const tempInput = document.createElement('input');
        tempInput.value = number;
        document.body.appendChild(tempInput);
        tempInput.select();
        try { 
            document.execCommand('copy'); 
            const originalText = btn.innerText;
            btn.innerText = "Copied!";
            btn.classList.remove('bg-gray-200', 'hover:bg-gray-300', 'text-gray-900');
            btn.classList.add('bg-green-500', 'text-white');
            setTimeout(() => {
                btn.innerText = originalText;
                btn.classList.remove('bg-green-500', 'text-white');
                btn.classList.add('bg-gray-200', 'hover:bg-gray-300', 'text-gray-900');
            }, 2000);
        } catch (err) { 
            displayCustomAlert('Failed to copy number. Please manually copy: 03096554421'); 
        }
        document.body.removeChild(tempInput);
    }
    const DELIVERY_CHARGE_LAHORE = 100;
    const DELIVERY_CHARGE_OLL = 200;
    const CITIES_LIST = [ 'Lahore', 'Faisalabad', 'Rawalpindi', 'Gujranwala', 'Multan', 'Bahawalpur', 'Sargodha', 'Sialkot', 'Sheikhupura', 'Rahim Yar Khan', 'Jhang', 'Dera Ghazi Khan', 'Gujrat', 'Sahiwal', 'Wah Cantonment', 'Kasur', 'Okara', 'Karachi', 'Hyderabad', 'Sukkur', 'Larkana', 'Peshawar', 'Mardan', 'Abbottabad', 'Swat', 'Quetta', 'Islamabad', 'Muzaffarabad', 'Other' ].sort((a, b) => { if (a === 'Lahore') return -1; if (b === 'Lahore') return 1; if (a === 'Other') return 1; if (b === 'Other') return -1; return a.localeCompare(b); });
    const calculateDeliveryCharge = (cityName) => { return cityName === 'Lahore' ? DELIVERY_CHARGE_LAHORE : DELIVERY_CHARGE_OLL; };
    const PAKISTAN_MEDICAL_COLLEGES = [ 'Rashid Latif Medical College (RLMC), Lahore', 'King Edward Medical University (KEMU), Lahore', 'Allama Iqbal Medical College (AIMC), Lahore', 'Fatima Jinnah Medical University (FJMU), Lahore', 'Services Institute of Medical Sciences (SIMS), Lahore', 'Nishtar Medical University (NMU), Multan', 'Rawalpindi Medical University (RMU), Rawalpindi', 'Quaid-e-Azam Medical College (QAMC), Bahawalpur', 'Faisalabad Medical University (FMU), Faisalabad', 'Sargodha Medical College (SMC), Sargodha', 'Gujranwala Medical College (GMC), Gujranwala', 'Sialkot Medical College (SMC), Sialkot', 'Dera Ghazi Khan Medical College (DGKMC), D.G Khan', 'Dow Medical College (DMC), Karachi', 'Sindh Medical College (SMC), Karachi', 'Jinnah Sindh Medical University (JSMU), Karachi', 'Liaquat University of Medical and Health Sciences (LUMHS), Jamshoro', 'Khyber Medical College (KMC), Peshawar', 'Ayub Medical College (AMC), Abbottabad', 'Bolan Medical College (BMC), Quetta', 'Shaikh Zayed Medical College (SZMC), Rahim Yar Khan', 'Azad Jammu and Kashmir Medical College (AJKMC), Muzaffarabad', 'PIMS Medical College, Islamabad', 'Saidu Medical College, Swat', 'Gajju Khan Medical College (GKMC), Swabi', 'Bannu Medical College (BMC), Bannu', 'Aga Khan University Hospital (AKUH), Karachi', 'Shalamar Medical and Dental College (SMDC), Lahore', 'CMH Lahore Medical College (CMH LMC)', 'FMH College of Medicine and Dentistry (FMHCM&D), Lahore', 'University College of Medicine and Dentistry (UCMD), Lahore', 'Azra Naheed Medical College (ANMC), Lahore', 'Central Park Medical College (CPMC), Lahore', 'Lahore Medical and Dental College (LMDC), Lahore', 'Continental Medical College (CMC), Lahore', 'Amna Inayat Medical College (AIMC), Sheikhupura', 'Islamabad Medical and Dental College (IMDC), Islamabad', 'Foundation University Medical College (FUMC), Rawalpindi', 'Riphah International University (RIU), Islamabad', 'Rawal Institute of Health Sciences, Islamabad', 'Karachi Medical and Dental College (KMDC), Karachi', 'Liaquat College of Medicine and Dentistry (LCMD), Karachi', 'Ziauddin Medical University, Karachi', 'Indus Medical College, Tando Muhammad Khan', 'Wah Medical College, Wah Cantt', 'Hashmat Medical College, Gujrat', 'Akhtar Saeed Medical and Dental College (ASMDC), Lahore', 'Pak Red Crescent Medical and Dental College, Lahore', 'HBS Medical and Dental College, Islamabad', 'Sarhad University of Science and IT, Peshawar', 'Bacha Khan Medical College, Mardan', 'Women Medical and Dental College, Abbottabad', 'Bakhtawar Amin Medical and Dental College, Multan', 'Bilal Medical College, Rawalpindi', 'Fazaia Medical College, Islamabad', 'Green International University (GIU), Lahore', ].sort();
    
    // BACKEND CONFIGURATION
    const BIN_ID = '6916abbf43b1c97be9ac64e8';
    const READ_URL = `https://api.jsonbin.io/v3/b/${BIN_ID}/latest`;
    const WRITE_URL = `https://api.jsonbin.io/v3/b/${BIN_ID}`;
    const API_KEY = '$2a$10$c2jwTEMgLn/n1ZXEL5qWiOTw4f6Mqr1r1Qd0ah0khbqTrChXEog8u';
    
    // NEW ORDER CONFIGURATION
    const ORDER_BIN_ID = '693dfa40d0ea881f40277ddf';
    const ORDER_BIN_URL = `https://api.jsonbin.io/v3/b/${ORDER_BIN_ID}`;
    const ORDER_API_KEY = '$2a$10$hKOenfTHIlmCwiQp8Ta1ue1CQt1GPgEjPMlXgyLgFhbwRyU1R.pIm';

    let rollNumberDataFromBackend = {};
    let isBackendReady = false;
    async function fetchRollNumberData() {
        try { const response = await fetch(READ_URL); if (!response.ok) throw new Error(`Backend responded with status: ${response.status}`); const data = await response.json(); if (data.record && data.record.available_rolls && data.record.blocked_rolls && data.record.used_rolls) { rollNumberDataFromBackend = data.record; isBackendReady = true; console.log('Successfully fetched roll number data from backend.'); } } catch (error) { console.error('CRITICAL ERROR fetching roll number data:', error); isBackendReady = false; }
    }
    function getRollNumberStatus(rollNumber) {
        const num = parseInt(rollNumber); if (isNaN(num)) return { isValid: false, message: "Please enter a valid number." }; if (!isBackendReady || !rollNumberDataFromBackend.blocked_rolls) { return { isValid: false, message: "Verification server is not ready. Please try again." }; } if (rollNumberDataFromBackend.blocked_rolls.includes(num)) { return { isValid: false, message: "This roll number is not eligible for the promo." }; } if (rollNumberDataFromBackend.used_rolls.includes(num)) { return { isValid: false, message: "sorry you have either pre ordered the book or already used the promo code" }; } if (!rollNumberDataFromBackend.available_rolls.includes(num)) { return { isValid: false, message: "sorry you have either pre ordered the book or already used the promo code" }; } return { isValid: true, message: "Roll Number is valid and available for promo discount." };
    }
    async function updateBackendWithUsedRollNumber(usedRollNumber) {
        const numToRemove = parseInt(usedRollNumber); if (isNaN(numToRemove) || !isBackendReady) return; const newAvailableRolls = rollNumberDataFromBackend.available_rolls.filter(roll => roll !== numToRemove); const newUsedRolls = [...rollNumberDataFromBackend.used_rolls, numToRemove]; const payload = { ...rollNumberDataFromBackend, available_rolls: newAvailableRolls, used_rolls: newUsedRolls }; try { const response = await fetch(WRITE_URL, { method: 'PUT', headers: { 'Content-Type': 'application/json', 'X-Master-Key': API_KEY, 'X-Bin-Versioning': 'false' }, body: JSON.stringify(payload) }); if (!response.ok) throw new Error(`Backend update failed with status: ${response.status}`); console.log(`Successfully removed roll number ${usedRollNumber} from backend.`); rollNumberDataFromBackend = payload; } catch (error) { console.error('CRITICAL ERROR updating backend with used roll number:', error); }
    }
    
    // ... openInfoPage, returnToCartFromCheckout, etc ...
    function openInfoPage(pageName) {
        const mainContent = document.querySelector('main');
        const header = document.querySelector('header');
        const footer = document.querySelector('footer');
        const productPage = document.getElementById('product-page');
        const checkoutPage = document.getElementById('checkout-page');
        const infoContainer = document.getElementById('info-page-container');
        const stickyStrip = document.querySelector('.sticky.top-0.z-50');
        mainContent.classList.add('hidden');
        productPage.classList.add('hidden');
        checkoutPage.classList.add('hidden');
        header.classList.remove('hidden');
        footer.classList.remove('hidden');
        if(stickyStrip) stickyStrip.classList.remove('hidden');
        infoContainer.classList.remove('hidden');
        document.querySelectorAll('.info-content').forEach(el => el.classList.add('hidden'));
        const target = document.getElementById(`info-${pageName}`);
        if(target) target.classList.remove('hidden');
        window.scrollTo(0, 0);
        document.getElementById('mobile-menu').classList.add('hidden');
    }

    function returnToCartFromCheckout() {
        const mainContent = document.querySelector('main');
        const header = document.querySelector('header');
        const footer = document.querySelector('footer');
        const productPage = document.getElementById('product-page');
        const checkoutPage = document.getElementById('checkout-page');
        const infoContainer = document.getElementById('info-page-container');
        const stickyStrip = document.querySelector('.sticky.top-0.z-50');
        checkoutPage.classList.add('hidden');
        productPage.classList.add('hidden');
        infoContainer.classList.add('hidden');
        mainContent.classList.remove('hidden');
        header.classList.remove('hidden');
        footer.classList.remove('hidden');
        if(stickyStrip) stickyStrip.classList.remove('hidden');
        const cartModalOverlay = document.getElementById('cart-modal-overlay');
        const cartModal = document.getElementById('cart-modal');
        document.getElementById('desktop-cart-button').click();
    }

    const saveCartToStorage = (cartData) => { localStorage.setItem('modMedicalisCart', JSON.stringify(cartData)); };
    const loadCartFromStorage = () => { const storedCart = localStorage.getItem('modMedicalisCart'); return storedCart ? JSON.parse(storedCart) : []; };

    document.addEventListener('DOMContentLoaded', () => {
        fetchRollNumberData();
        const mainContent = document.querySelector('main');
        const header = document.querySelector('header');
        const footer = document.querySelector('footer');
        const productPage = document.getElementById('product-page');
        const checkoutPage = document.getElementById('checkout-page');
        const infoPageContainer = document.getElementById('info-page-container');
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        const filterButtons = document.querySelectorAll('.filter-text-button');
        const productCards = document.querySelectorAll('.product-card');
        const productTriggers = document.querySelectorAll('.product-trigger');
        const searchInput = document.getElementById('search-input');
        const searchDropdown = document.getElementById('search-dropdown');
        const mobileSearchInput = document.getElementById('mobile-search-input');
        const mobileSearchDropdown = document.getElementById('mobile-search-dropdown');
        const cartModalOverlay = document.getElementById('cart-modal-overlay');
        const cartModal = document.getElementById('cart-modal');
        const cartItemsContainer = document.getElementById('cart-items-container');
        const emptyCartMessage = document.getElementById('empty-cart-message');
        const cartSubtotalElement = document.getElementById('cart-subtotal');
        const cartTotalElement = document.getElementById('cart-total');
        const cartCountElements = document.querySelectorAll('[id$="-cart-count"]');
        const proceedToCheckoutBtn = document.getElementById('proceed-to-checkout-btn');
        const closeCheckoutButton = document.getElementById('close-checkout-button');
        const paymentAmount = document.getElementById('payment-amount');
        const checkoutSummaryList = document.getElementById('checkout-summary-list');
        const inlineSummaryList = document.getElementById('inline-summary-list');
        const inlineSummaryTotal = document.getElementById('inline-summary-total');
        const checkoutFinalTotal = document.getElementById('checkout-final-total');
        const checkoutCollegeSelect = document.getElementById('college');
        const citySelector = document.getElementById('city_selector');
        const checkoutDeliveryNote = document.getElementById('checkout-delivery-note');
        const checkoutForm = document.getElementById('checkout-form');
        const checkoutSuccessPage = document.getElementById('checkout-success-page');
        const cancelCheckoutBtn = document.getElementById('cancel-checkout-btn');
        const closeSuccessBtn = document.getElementById('close-success-btn');
        const closeProductPageButton = document.getElementById('close-product-page-button');
        const popupMainImage = document.getElementById('popup-main-image');
        const popupThumbnails = document.getElementById('popup-thumbnails');
        const popupProductName = document.getElementById('popup-product-name');
        const popupProductPrice = document.getElementById('popup-product-price');
        const popupProductOldPrice = document.getElementById('popup-product-old-price');
        const popupProductDescription = document.getElementById('popup-product-description');
        const popupAddToCartBtn = document.getElementById('popup-add-to-cart-btn');
        const popupFreePreviewBtn = document.getElementById('popup-free-preview-btn');
        const aimcPromoSection = document.getElementById('college-promo-section');
        const promoCodeInput = document.getElementById('promo_code');
        const rollNumberEntry = document.getElementById('roll-number-entry');
        const rollNumberInput = document.getElementById('roll_number');
        const rollNumberFeedback = document.getElementById('roll-number-feedback');
        const formRollNumber = document.getElementById('form-roll-number');
        const paymentSlipInput = document.getElementById('payment_slip');
        
        // --- AUTO-SWIPE HERO ---
        const heroTabs = document.querySelectorAll('.hero-tab-card');
        const heroPanels = document.querySelectorAll('.tab-panel');
        const heroSection = document.getElementById('hero-section');
        let currentTabIndex = 0;
        let swipeInterval;

        const updateHeroTab = (index) => {
             // Deactivate all
             heroTabs.forEach(t => t.classList.remove('active-custom-red', 'active-blue', 'active-pink', 'active-custom-orange'));
             heroSection.classList.remove('bg-red-50', 'bg-blue-50', 'bg-pink-50', 'bg-orange-50');
             heroSection.style.backgroundColor = ''; // Reset inline style
             heroPanels.forEach(panel => { panel.classList.remove('active'); panel.classList.add('hidden'); });

             // Activate new
             const tab = heroTabs[index];
             const color = tab.getAttribute('data-color');
             const targetId = tab.getAttribute('data-target');
             const targetPanel = document.getElementById(`panel-${targetId}`);

             if (color === 'custom-red') { tab.classList.add('active-custom-red'); heroSection.classList.add('bg-red-50'); }
             else if (color === 'blue') { tab.classList.add('active-blue'); heroSection.classList.add('bg-blue-50'); }
             else if (color === 'pink') { tab.classList.add('active-pink'); heroSection.classList.add('bg-pink-50'); }
             else if (color === 'custom-orange') { 
                 tab.classList.add('active-custom-orange'); 
                 // Applying a light tint for background, while text uses strong #E78846
                 heroSection.style.backgroundColor = '#fff7ed'; 
             }

             if (targetPanel) {
                targetPanel.classList.remove('hidden');
                targetPanel.classList.add('active');
                targetPanel.classList.remove('animate-fade-right');
                void targetPanel.offsetWidth; // trigger reflow
                targetPanel.classList.add('animate-fade-right');
             }
        };

        const startAutoSwipe = () => {
            swipeInterval = setInterval(() => {
                currentTabIndex = (currentTabIndex + 1) % heroTabs.length;
                updateHeroTab(currentTabIndex);
            }, 4000);
        };

        // Manual Click Handler stops auto swipe temporarily or resets it
        heroTabs.forEach((tab, index) => {
            tab.addEventListener('click', () => {
                clearInterval(swipeInterval);
                currentTabIndex = index;
                updateHeroTab(currentTabIndex);
                startAutoSwipe();
            });
        });

        // Initialize (Start with Block 4 which is index 0 now)
        updateHeroTab(0);
        startAutoSwipe();


        if(paymentSlipInput) {
            paymentSlipInput.addEventListener('change', function(e) {
                const fileName = e.target.files[0]?.name;
                const textSpan = document.getElementById('upload-text');
                const label = this.closest('label');
                if (fileName) {
                    textSpan.innerHTML = `Selected: <span class="font-bold text-[#1A5693]">${fileName}</span>`;
                    label.classList.add('border-[#1A5693]', 'bg-blue-50');
                    label.classList.remove('border-gray-300', 'bg-gray-50');
                } else {
                    textSpan.textContent = "Click to upload slip";
                    label.classList.remove('border-[#1A5693]', 'bg-blue-50');
                    label.classList.add('border-gray-300', 'bg-gray-50');
                }
            });
        }

        const products = [ 
            { id: 1, name: "BLOCK 2 FLASHCARDS", price: 900, oldPrice: 1100, year: 1, isPrebook: false, images: ["https://i.imgur.com/c4XSHmA.jpeg"], description: "High-yield flashcards for Block 2, aligned with UHS LOs. Perfect for quick revision and concept consolidation.", previewLink: "https://drive.google.com/file/d/1QFJiBzPELwVWcaVi7VWnDrIr-bwm5qBy/view?usp=drivesdk", rating: 4.80, reviews: 10 }, 
            { id: 2, name: "MIND YOUR MINORS - BLOCK 5", price: 500, oldPrice: null, year: 2, isPrebook: false, images: ["https://i.imgur.com/zTYjCgL.jpeg"], description: "Get ready to ace your minor subjects with our illustrative notes and say good bye to boring books. Completely alligned with UHS LOs and recommended books.", previewLink: "https://drive.google.com/file/d/1LDBgWhSP6xeWDqxyKyutZ7tOijrx_uuS/view?usp=drivesdk", rating: 4.89, reviews: 17 }, 
            { id: 3, name: "MIND YOUR MINORS - BLOCK 6", price: 700, oldPrice: 1500, year: 2, isPrebook: false, images: ["https://i.imgur.com/IhQVD4x.jpeg", "https://i.imgur.com/TyME5Qd.jpeg", "https://i.imgur.com/miUBzhw.jpeg", "https://i.imgur.com/o4FT33T.jpeg", "https://i.imgur.com/KluXvgE.jpeg", "https://i.imgur.com/VieVppz.jpeg"], description: "The newly launched minor subjects block notes. Completely aligned with UHS LOs and recommended books, featuring enhanced illustrations and high-yield mnemonics.", previewLink: "https://drive.google.com/file/d/1yhewdyE8Xc4ALB3Eo7CDzAFTsr_PHbK-/view?usp=drivesdk", rating: 4.76, reviews: 25 }, 
            { id: 4, name: "MIND YOUR MINORS BLOCK 3", price: 700, oldPrice: null, year: 1, isPrebook: false, images: ["https://i.imgur.com/6tFeXf5.jpeg", "https://i.imgur.com/rmStT8a.png", "https://i.imgur.com/rQ4hSiA.png", "https://i.imgur.com/kkNXowV.png"], description: "The newly launched minor subjects block 3 notes for 1st Year. Completely aligned with UHS LOs, featuring enhanced illustrations and high-yield mnemonics.", previewLink: "#", rating: 4.88, reviews: 20 },
            { id: 5, name: "MIND YOUR MINORS - BLOCK 4", price: 600, oldPrice: 700, year: 2, isPrebook: true, images: ["https://i.imgur.com/KsHrKt0.jpeg", "https://i.imgur.com/J9ZCfaW.jpeg", "https://i.imgur.com/pOHKnvt.jpeg", "https://i.imgur.com/2UkMNMo.png", "https://i.imgur.com/kMlh9Ha.jpeg"], description: "PRE-ORDER NOW! The upcoming Block 4 notes. Secure your copy for the 22nd Dec 2025 release. Enhanced visuals, concise content.", previewLink: "https://drive.google.com/file/d/1tUAKX4sqMDSV5JpgyBbcgOE56tnU8H9y/view?usp=drivesdk", rating: 5.0, reviews: 5 }
        ];
        
        let cart = loadCartFromStorage();
        const findProductById = (id) => products.find(p => p.id === id);
        
        window.switchView = function(view) {
            mainContent.classList.add('hidden');
            header.classList.add('hidden');
            footer.classList.add('hidden');
            productPage.classList.add('hidden');
            checkoutPage.classList.add('hidden');
            if(infoPageContainer) infoPageContainer.classList.add('hidden');
            document.querySelector('.sticky.top-0.z-50')?.classList.add('hidden');
            
            if (view === 'main') { 
                mainContent.classList.remove('hidden'); 
                header.classList.remove('hidden'); 
                footer.classList.remove('hidden'); 
                document.querySelector('.sticky.top-0.z-50')?.classList.remove('hidden'); 
            } else if (view === 'product') { 
                productPage.classList.remove('hidden'); 
            } else if (view === 'checkout') { 
                checkoutPage.classList.remove('hidden'); 
            }
            window.scrollTo(0, 0);
        };

        const performSearch = (searchTerm, dropdownElement) => {
            if (!searchTerm.trim()) { dropdownElement.classList.add('hidden'); return; }
            const searchLower = searchTerm.toLowerCase();
            const matchingProducts = products.filter(p => p.name.toLowerCase().includes(searchLower) || (p.description && p.description.toLowerCase().includes(searchLower)));
            dropdownElement.innerHTML = matchingProducts.length > 0 ? '' : '<div class="search-dropdown-item text-gray-500">No products found</div>';
            matchingProducts.forEach(product => { const item = document.createElement('div'); item.className = 'search-dropdown-item'; item.textContent = product.name; item.addEventListener('click', () => { openProductPage(product.id); dropdownElement.classList.add('hidden'); if (searchInput) searchInput.value = ''; if (mobileSearchInput) mobileSearchInput.value = ''; }); dropdownElement.appendChild(item); });
            dropdownElement.classList.remove('hidden');
        };
        if (searchInput) searchInput.addEventListener('input', () => performSearch(searchInput.value, searchDropdown));
        if (mobileSearchInput) mobileSearchInput.addEventListener('input', () => performSearch(mobileSearchInput.value, mobileSearchDropdown));

        const isBlock6InCart = () => cart.some(item => item.productId === 3);
        
        // NEW: College Selection Logic for AIMC, QAMC, RLMC
        const toggleCollegePromos = () => { 
            const college = checkoutCollegeSelect.value;
            const isAimc = college.includes('Allama Iqbal Medical College');
            const isQamc = college.includes('Quaid-e-Azam Medical College');
            const isRlmc = college.includes('Rashid Latif Medical College');
            
            // Show promo section if any of the eligible colleges are selected
            const showPromo = (isAimc && isBlock6InCart()) || isQamc || isRlmc;
            
            aimcPromoSection.classList.toggle('hidden', !showPromo); 
            
            if (!showPromo) { 
                promoCodeInput.value = ''; 
                rollNumberEntry.classList.add('hidden'); 
                rollNumberInput.value = ''; 
                rollNumberInput.removeAttribute('required'); 
                rollNumberFeedback.textContent = ''; 
                formRollNumber.value = ''; 
            } else {
                // If switching between colleges, clear irrelevant data
                if (isQamc || isRlmc) {
                    rollNumberEntry.classList.add('hidden');
                    rollNumberInput.removeAttribute('required');
                }
            }
        };

        checkoutCollegeSelect.addEventListener('change', () => { toggleCollegePromos(); updateCheckoutTotals(); });
        
        promoCodeInput.addEventListener('input', () => { 
            const code = promoCodeInput.value.toUpperCase().trim();
            const college = checkoutCollegeSelect.value;
            
            // AIMC Logic
            if (college.includes('Allama Iqbal Medical College')) {
                if (code === 'AIMC28') { 
                    rollNumberEntry.classList.remove('hidden'); 
                    rollNumberInput.setAttribute('required', 'required'); 
                    rollNumberFeedback.textContent = 'Promo code accepted. Please enter your Roll Number.'; 
                    rollNumberFeedback.className = 'text-[11px] mt-2 font-semibold text-green-600'; 
                } else { 
                    rollNumberEntry.classList.add('hidden'); 
                    rollNumberInput.removeAttribute('required'); 
                    rollNumberInput.value = ''; 
                    rollNumberFeedback.textContent = 'Enter the correct code to proceed with the discount.'; 
                    rollNumberFeedback.className = 'text-[11px] mt-2 font-semibold text-gray-500'; 
                } 
            }
            // QAMC & RLMC Logic happens directly in calculateDiscount
            
            formRollNumber.value = ''; 
            updateCheckoutTotals(); 
        });

        rollNumberInput.addEventListener('input', () => { const roll = rollNumberInput.value.trim(); if (!isBackendReady) { rollNumberFeedback.textContent = 'Could not connect to the promo verification server.'; rollNumberFeedback.className = 'text-[11px] mt-2 font-semibold text-red-600'; updateCheckoutTotals(); return; } if (roll.length > 0) { const status = getRollNumberStatus(roll); rollNumberFeedback.textContent = status.message; rollNumberFeedback.className = `text-[11px] mt-2 font-semibold ${status.isValid ? 'text-green-600' : 'text-red-600'}`; } else { rollNumberFeedback.textContent = 'Please enter your Roll Number for verification.'; rollNumberFeedback.className = 'text-[11px] mt-2 font-semibold text-gray-500'; } formRollNumber.value = ''; updateCheckoutTotals(); });
        
        // --- BUNDLE LOGIC ---
        const calculateBundleDiscount = () => {
            const p2 = cart.find(i => i.productId === 2)?.quantity || 0;
            const p3 = cart.find(i => i.productId === 3)?.quantity || 0;
            const p5 = cart.find(i => i.productId === 5)?.quantity || 0;
            const bundles = Math.min(p2, p3, p5);
            return bundles * 151;
        };

        const calculateDiscount = () => { 
            let totalDiscount = 0;
            const bundleDiscount = calculateBundleDiscount();
            totalDiscount += bundleDiscount;
            
            // Calculate how many items are "locked" in a bundle
            const numBundles = bundleDiscount / 151;
            const bundledItemsCount = numBundles * 3; 

            // College Promo Logic
            const college = checkoutCollegeSelect.value;
            const code = promoCodeInput.value.toUpperCase().trim();

            // AIMC Logic
            if (college.includes('Allama Iqbal Medical College') && code === 'AIMC28') { 
                const roll = rollNumberInput.value.trim(); 
                if (roll.length > 0 && getRollNumberStatus(roll).isValid) { 
                    const block6Item = cart.find(item => item.productId === 3); 
                    if(block6Item) totalDiscount += (100 * block6Item.quantity); 
                } 
            } 
            
            // QAMC & RLMC Logic (Rs 50 off per non-bundle item)
            let isValidPromo = false;
            if (college.includes('Quaid-e-Azam Medical College') && code === 'MOD-U-QAMC-28') isValidPromo = true;
            if (college.includes('Rashid Latif Medical College') && code === 'MOD-A-RLMC-28') isValidPromo = true;
            
            if (isValidPromo) {
                const totalItems = cart.reduce((acc, i) => acc + i.quantity, 0);
                const eligibleItems = Math.max(0, totalItems - bundledItemsCount);
                totalDiscount += (eligibleItems * 50);
            }

            return totalDiscount; 
        };
        
        const updateCheckoutTotals = () => {
            let itemsTotal = cart.reduce((acc, item) => acc + item.price * item.quantity, 0);
            const discount = calculateDiscount();
            const city = citySelector.value;
            const deliveryCharge = cart.length > 0 && city ? calculateDeliveryCharge(city) : 0;
            const cityStatus = city === 'Lahore' ? 'Lahore' : 'Other City';
            const productSubtotalAfterDiscount = itemsTotal - discount;
            const finalTotal = productSubtotalAfterDiscount + deliveryCharge;
            paymentAmount.textContent = `Rs. ${Math.max(0, productSubtotalAfterDiscount).toLocaleString('en-PK')}`;
            checkoutFinalTotal.textContent = `Rs. ${Math.max(0, finalTotal).toLocaleString('en-PK')}`;
            document.getElementById('mobile-summary-total').textContent = `Rs. ${Math.max(0, finalTotal).toLocaleString('en-PK')}`;
            
            // New Inline Total
            if(inlineSummaryTotal) inlineSummaryTotal.textContent = `Rs. ${Math.max(0, finalTotal).toLocaleString('en-PK')}`;
            
            // Pre-Order Warning Logic
            const isPreOrder = cart.some(item => item.productId === 5); // Check for Block 4
            const preOrderTop = document.getElementById('pre-order-warning-top');
            const preOrderBottom = document.getElementById('pre-order-warning-bottom');
            
            if (isPreOrder) {
                preOrderTop.classList.remove('hidden');
                preOrderBottom.classList.remove('hidden');
            } else {
                preOrderTop.classList.add('hidden');
                preOrderBottom.classList.add('hidden');
            }

            checkoutDeliveryNote.innerHTML = `<h5 class="text-base font-extrabold text-[#1A5693] algerya-sans-sc-font mb-2">Delivery Payment Note</h5><p class="text-xs">Delivery charges of <strong>Rs. ${deliveryCharge.toLocaleString('en-PK')}</strong> (${cityStatus}) <span class="font-extrabold underline">MUST BE PAID IN CASH TO THE RIDER</span> upon delivery. The total amount you pay online (Rs. ${Math.max(0, productSubtotalAfterDiscount).toLocaleString('en-PK')}) is for products only.</p>`;
            let cartSummary = [];
            checkoutSummaryList.innerHTML = '';
            if(inlineSummaryList) inlineSummaryList.innerHTML = ''; // Clear inline summary
            const mobileCartMirror = document.querySelector('.mobile-cart-mirror');
            if (mobileCartMirror) mobileCartMirror.innerHTML = '';
            
            cart.forEach(item => { 
                const itemTotal = item.price * item.quantity; 
                const liHtml = `
                    <li class="flex items-center space-x-4 mb-4">
                        <div class="relative flex-shrink-0">
                            <img src="${item.image}" alt="${item.name}" class="w-16 h-16 rounded-md border border-gray-200 object-cover bg-white">
                            <span class="absolute -top-2 -right-2 bg-gray-500 text-white text-xs font-bold w-5 h-5 flex items-center justify-center rounded-full">${item.quantity}</span>
                        </div>
                        <div class="flex-1">
                            <p class="text-sm font-medium text-gray-800">${item.name}</p>
                        </div>
                        <p class="text-sm font-bold text-gray-800">Rs. ${itemTotal.toLocaleString('en-PK')}</p>
                    </li>
                `;
                checkoutSummaryList.insertAdjacentHTML('beforeend', liHtml);
                if(inlineSummaryList) inlineSummaryList.insertAdjacentHTML('beforeend', liHtml); // Populate inline
                if (mobileCartMirror) mobileCartMirror.insertAdjacentHTML('beforeend', liHtml);
                cartSummary.push(`${item.name} x ${item.quantity} (Rs. ${itemTotal.toLocaleString('en-PK')})`); 
            });
            
            // Display Bundle Discount specifically
            const bundleDisc = calculateBundleDiscount();
            if (bundleDisc > 0) {
                 const bDiscHtml = `<li class="sidebar-row text-purple-600"><span class="sidebar-label text-purple-600">Bundle Discount</span><span class="sidebar-value">- Rs. ${bundleDisc.toLocaleString('en-PK')}</span></li>`;
                 checkoutSummaryList.insertAdjacentHTML('beforeend', bDiscHtml);
                 if(inlineSummaryList) inlineSummaryList.insertAdjacentHTML('beforeend', bDiscHtml);
                 if (mobileCartMirror) mobileCartMirror.insertAdjacentHTML('beforeend', bDiscHtml);
                 cartSummary.push(`Bundle Discount: -Rs. ${bundleDisc.toLocaleString('en-PK')}`);
            }

            // Display College Discount
            const totalDisc = calculateDiscount();
            const collegeDisc = totalDisc - bundleDisc;
            if (collegeDisc > 0) { 
                const discHtml = `<li class="sidebar-row text-green-600"><span class="sidebar-label text-green-600">College Promo Discount</span><span class="sidebar-value">- Rs. ${collegeDisc.toLocaleString('en-PK')}</span></li>`;
                checkoutSummaryList.insertAdjacentHTML('beforeend', discHtml);
                if(inlineSummaryList) inlineSummaryList.insertAdjacentHTML('beforeend', discHtml);
                if (mobileCartMirror) mobileCartMirror.insertAdjacentHTML('beforeend', discHtml);
                cartSummary.push(`Promo Discount: -Rs. ${collegeDisc.toLocaleString('en-PK')}`); 
            }
            if (deliveryCharge > 0) { 
                const delHtml = `<li class="sidebar-row pt-2 border-t border-gray-100"><span class="sidebar-label">Delivery (${cityStatus})</span><span class="sidebar-value">Rs. ${deliveryCharge.toLocaleString('en-PK')}</span></li><li class="text-[10px] text-gray-400 italic text-right -mt-1">Paid to rider in cash</li>`;
                checkoutSummaryList.insertAdjacentHTML('beforeend', delHtml);
                if(inlineSummaryList) inlineSummaryList.insertAdjacentHTML('beforeend', delHtml);
                if (mobileCartMirror) mobileCartMirror.insertAdjacentHTML('beforeend', delHtml);
                cartSummary.push(`Delivery Charge (${cityStatus}): +Rs. ${deliveryCharge.toLocaleString('en-PK')} (Cash to Rider)`); 
            }
            document.getElementById('form-cart-details').value = cartSummary.join('; ');
            document.getElementById('form-final-bill').value = `Rs. ${Math.max(0, finalTotal).toLocaleString('en-PK')}`;
        };
        citySelector.addEventListener('change', updateCheckoutTotals);
        
        const validateCheckout = () => { 
             const form = document.getElementById('checkout-form');
             const inputs = form.querySelectorAll('input[required], select[required], textarea[required]');
             let isValid = true;
             
             inputs.forEach(input => {
                 if (!input.checkValidity()) {
                     isValid = false;
                     input.reportValidity();
                     return;
                 }
                 if (input.type === 'radio' && input.name === 'Referral Source') {
                      if(!document.querySelector('input[name="Referral Source"]:checked')) isValid = false;
                 }
             });
             
             const paymentSlip = document.getElementById('payment_slip');
             if (paymentSlip && !paymentSlip.files.length) {
                 displayCustomAlert('Please upload the payment slip to proceed.');
                 isValid = false;
             }
             
             if (!aimcPromoSection.classList.contains('hidden') && checkoutCollegeSelect.value.includes('Allama Iqbal') && promoCodeInput.value.toUpperCase() === 'AIMC28') { 
                const roll = rollNumberInput.value.trim(); 
                const status = getRollNumberStatus(roll); 
                if (!status.isValid) { 
                    displayCustomAlert('Please enter a valid, unused AIMC roll number.'); 
                    isValid = false; 
                } 
             }
             
             return isValid;
        };
        
        const openCheckoutPage = () => {
            if (cart.length === 0) return displayCustomAlert('Your cart is empty.');
            if (checkoutCollegeSelect.options.length <= 1) { const collegeFragment = document.createDocumentFragment(); PAKISTAN_MEDICAL_COLLEGES.forEach(college => { const option = document.createElement('option'); option.value = college; option.textContent = college; collegeFragment.appendChild(option); }); const otherCollegeOption = document.createElement('option'); otherCollegeOption.value = 'Other'; otherCollegeOption.textContent = 'Other (Please specify in Address)'; collegeFragment.appendChild(otherCollegeOption); checkoutCollegeSelect.appendChild(collegeFragment); }
            if (citySelector.options.length <= 1) { const cityFragment = document.createDocumentFragment(); CITIES_LIST.forEach(city => { const option = document.createElement('option'); option.value = city; option.textContent = city; cityFragment.appendChild(option); }); citySelector.appendChild(cityFragment); }
            showCartModal(false); toggleCollegePromos(); updateCheckoutTotals(); checkoutSuccessPage.classList.add('hidden'); checkoutForm.reset(); window.switchView('checkout');
        };
        
        // Helper function to convert file to base64
        const convertToBase64 = (file) => {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        };

        // --- DUAL SUBMISSION LOGIC ---
        checkoutForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            if (!validateCheckout()) return;

            const submitButton = document.getElementById('confirm-order-btn');
            submitButton.disabled = true;
            submitButton.textContent = 'Placing Order...';

            const formData = new FormData(checkoutForm);
            
            // Generate IDs
            const orderId = `#${Math.floor(1000 + Math.random() * 9000)}`;
            const timestamp = new Date().toISOString(); 
            const fullName = formData.get('Full Name');
            
            // JSONBin Payload
            const newOrder = {
                "orderId": orderId,
                "orderDateTimePKT": timestamp, 
                "fullName": fullName,
                "collegeName": formData.get('College'),
                "shippingAddress": `${formData.get('Shipping Address')}, ${formData.get('City')}`,
                "contactInfo": `${formData.get('Contact Number')}`, 
                "product": formData.get('Cart Details'),
                "total": document.getElementById('form-final-bill').value, 
                "cost": 0, 
                "status": "pending",
                "paymentSlip": "Sent to Email via FormSubmit" 
            };
            
            const usedRollNumber = formRollNumber.value.trim();
            
            // 1. JSONBin Promise
            const saveOrderToBin = async () => {
                const readResponse = await fetch(ORDER_BIN_URL + '/latest', {
                    method: 'GET',
                    headers: { 'X-Master-Key': ORDER_API_KEY }
                });
                if (!readResponse.ok) throw new Error('Failed to read existing orders');
                const readData = await readResponse.json();
                
                // Robust Check for Existing Array (Handles { "orders": [] } vs [ ... ])
                let existingOrders = [];
                if (readData.record) {
                    if (Array.isArray(readData.record.orders)) {
                        existingOrders = readData.record.orders;
                    } else if (Array.isArray(readData.record)) {
                        existingOrders = readData.record;
                    }
                }
                
                // Append New Order
                existingOrders.push(newOrder);
                
                // Save Back wrapped in object to prevent root array ambiguity
                const writeResponse = await fetch(ORDER_BIN_URL, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': ORDER_API_KEY,
                        'X-Bin-Versioning': 'false' 
                    },
                    body: JSON.stringify({ "orders": existingOrders }) 
                });
                if (!writeResponse.ok) throw new Error('Failed to save order');
                return writeResponse.json();
            };

            // 2. FormSubmit Promise
            const sendToFormSubmit = async () => {
                // Ensure the email modmedicalis@gmail.com is ACTIVATED on FormSubmit
                return fetch("https://formsubmit.co/ajax/modmedicalis@gmail.com", {
                    method: 'POST',
                    body: formData // File is included here automatically
                });
            };

            try {
                // Execute both. If one fails, catch it so the other isn't blocked.
                await Promise.all([
                    saveOrderToBin().catch(err => console.error("JSONBin Error:", err)),
                    sendToFormSubmit().catch(err => console.error("FormSubmit Error:", err))
                ]);
                
                // Assuming at least one worked (usually JSONBin is reliable for data, FormSubmit for image)
                handleOrderSuccess(orderId, fullName, usedRollNumber);
            } catch (error) {
                console.error("Critical Submission Error:", error);
                handleOrderFailure(orderId);
            } finally {
                submitButton.disabled = false;
                submitButton.textContent = 'Place Order';
            }
        });

        function handleOrderSuccess(orderId, userName, usedRollNumber) {
            if (usedRollNumber) updateBackendWithUsedRollNumber(usedRollNumber);
            
            checkoutForm.classList.add('hidden');
            checkoutSuccessPage.classList.remove('hidden');
            document.getElementById('checkout-success-message').innerHTML = `Thank you, <strong>${userName}</strong>! <br> Your order number <strong>${orderId}</strong> has been received.`;
            
            cart = [];
            saveCartToStorage(cart);
            renderCart();
        }

        function handleOrderFailure(orderId) {
            checkoutForm.classList.add('hidden');
            checkoutSuccessPage.classList.remove('hidden');
            document.getElementById('checkout-success-message').innerHTML = `
                <span style="color: #ef4444; font-weight: bold;">Connection Issue.</span><br>
                Please update us about your order at WhatsApp no <br>
                <strong class="text-lg text-[#1A5693]">03096554421</strong><br>
                <span class="text-xs text-gray-500">Order ID: ${orderId}</span>
            `;
            cart = [];
            saveCartToStorage(cart);
            renderCart();
        }
        
        proceedToCheckoutBtn.addEventListener('click', openCheckoutPage);
        const renderProductImages = (product) => { 
            // Update Main and Thumbnail Images
            popupMainImage.src = product.images[0]; 
            popupThumbnails.innerHTML = ''; 
            product.images.forEach((url, index) => { 
                const thumbnail = document.createElement('img'); 
                thumbnail.src = url; 
                thumbnail.alt = `${product.name} thumbnail ${index + 1}`; 
                thumbnail.className = `w-14 h-14 rounded-lg object-cover cursor-pointer border-2 transition duration-150 hover:border-[#1A5693] bg-white ${index === 0 ? 'border-[#1A5693]' : 'border-transparent'}`; 
                thumbnail.addEventListener('click', () => { 
                    popupMainImage.src = url; 
                    document.querySelectorAll('#popup-thumbnails img').forEach(img => img.classList.replace('border-[#1A5693]', 'border-transparent')); 
                    thumbnail.classList.replace('border-transparent', 'border-[#1A5693]'); 
                }); 
                popupThumbnails.appendChild(thumbnail); 
            }); 
            
            // Update Titles and Prices for both Mobile and Desktop Views
            const priceHtml = `Rs. ${product.price.toLocaleString('en-PK').replace('Rs.', '').trim()}`;
            
            // Desktop Elements
            document.getElementById('popup-product-name').textContent = product.name;
            document.getElementById('popup-product-price').textContent = priceHtml;
            document.getElementById('popup-product-old-price').textContent = product.oldPrice ? `Rs. ${product.oldPrice.toLocaleString('en-PK')}` : '';
            
            // Mobile Elements
            document.getElementById('popup-product-name-mobile').textContent = product.name;
            document.getElementById('popup-product-price-mobile').textContent = priceHtml;
            document.getElementById('popup-product-old-price-mobile').textContent = product.oldPrice ? `Rs. ${product.oldPrice.toLocaleString('en-PK')}` : '';

            // Update Dynamic Reviews
            const reviewText = `(${product.reviews} reviews)`;
            document.getElementById('popup-header-review-count-desktop').textContent = reviewText;
            document.getElementById('popup-header-review-count-mobile').textContent = reviewText;
            document.getElementById('popup-rating-value').textContent = product.rating.toFixed(2);
            document.getElementById('popup-review-count-text').textContent = `${product.reviews} reviews`;

            // Rest of Logic
            popupProductDescription.textContent = product.description; 
            document.getElementById('popup-btn-price-display').textContent = `â€¢ Rs.${product.price.toLocaleString('en-PK').replace('Rs.','').trim()}`; 
            
            // UPDATED ADD TO CART LOGIC
            let popupQty = 1;
            const qtyDisplay = document.getElementById('popup-quantity-count');
            qtyDisplay.textContent = popupQty;

            document.getElementById('popup-quantity-minus').onclick = () => {
                if(popupQty > 1) {
                    popupQty--;
                    qtyDisplay.textContent = popupQty;
                }
            };

            document.getElementById('popup-quantity-plus').onclick = () => {
                popupQty++;
                qtyDisplay.textContent = popupQty;
            };

            popupAddToCartBtn.onclick = () => { 
                addToCart(product.id, popupQty); // FIX: Use product.id instead of undefined id
                window.switchView('main'); 
            }; 
            // END UPDATED LOGIC

            popupFreePreviewBtn.onclick = () => window.open(product.previewLink, '_blank'); 
            const deliveryNotice = document.getElementById('popup-delivery-notice'); 
            const featuresContainer = document.getElementById('popup-product-features'); 
            
            if (product.id === 4) { 
                deliveryNotice.className = "mt-4 mb-4 text-sm text-gray-700 font-medium"; 
                deliveryNotice.innerHTML = ""; 
                featuresContainer.innerHTML = `<div class="mt-4 mb-4"><h4 class="font-bold text-black mb-2 text-sm uppercase tracking-wide algerya-sans-sc-font">Key Features:</h4><ul class="list-none text-sm text-gray-600 space-y-1"><li><i class="fas fa-circle-check text-green-500 mr-2"></i>From UHS Recommended books</li><li><i class="fas fa-circle-check text-green-500 mr-2"></i>Access to portal for quiz & past papers</li><li><i class="fas fa-circle-check text-green-500 mr-2"></i>Following all UHS LOs</li><li><i class="fas fa-circle-check text-green-500 mr-2"></i>Spiral binding & matte pages</li><li><i class="fas fa-circle-check text-green-500 mr-2"></i>Mnemonics</li><li><i class="fas fa-circle-check text-green-500 mr-2"></i>Illustrations</li></ul></div>`; 
                featuresContainer.classList.remove('hidden'); 
            } else { 
                // Removed specific text as requested for other products
                deliveryNotice.className = "hidden";
                deliveryNotice.innerHTML = ''; 
                featuresContainer.innerHTML = ''; 
                featuresContainer.classList.add('hidden'); 
            } 
        };

        const openProductPage = (productId) => { 
            const id = parseInt(productId); 
            const product = findProductById(id); 
            if (!product) return; 
            renderProductImages(product); 
            window.switchView('product'); 
        };
        
        // --- NEW CART RENDER & CALCULATION LOGIC ---
        const calculateTotals = () => { 
            let subtotal = cart.reduce((acc, item) => acc + item.price * item.quantity, 0); 
            
            // Apply Bundle Discount in Cart View
            const bundleDiscount = calculateBundleDiscount();
            const finalCartTotal = subtotal - bundleDiscount;

            let totalItems = cart.reduce((acc, item) => acc + item.quantity, 0); 
            
            // Text Updates
            cartSubtotalElement.textContent = `Rs. ${subtotal.toLocaleString('en-PK')}`;
            
            if (bundleDiscount > 0) {
                 // Show discounted total
                 cartTotalElement.innerHTML = `<span class="text-sm text-gray-400 line-through mr-2">Rs. ${subtotal.toLocaleString('en-PK')}</span> Rs. ${finalCartTotal.toLocaleString('en-PK')}`;
            } else {
                 cartTotalElement.textContent = `Rs. ${subtotal.toLocaleString('en-PK')}`; 
            }
            
            cartCountElements.forEach(el => el.textContent = totalItems); 
            document.getElementById('cart-heading-title').innerHTML = `YOUR CART <span class="text-gray-400 font-medium text-lg align-middle lowercase tracking-normal">(${totalItems} items)</span>`;
        };

        const renderCart = () => { 
            cartItemsContainer.innerHTML = ''; 
            emptyCartMessage.classList.toggle('hidden', cart.length > 0); 
            proceedToCheckoutBtn.disabled = cart.length === 0; 
            
            cart.forEach(item => { 
                // Updated HTML structure to match the reference image style
                const itemHtml = `
                    <div class="flex gap-4 py-6 border-b border-gray-100 last:border-0">
                        <div class="w-24 h-32 flex-shrink-0 bg-gray-100 rounded-lg overflow-hidden relative">
                            <img src="${item.image}" alt="${item.name}" class="w-full h-full object-contain p-1">
                        </div>
                        <div class="flex-1 flex flex-col justify-between">
                            <div>
                                <h3 class="text-lg font-black text-gray-900 leading-tight uppercase algerya-sans-sc-font tracking-tight">${item.name}</h3>
                                <p class="text-xs text-gray-500 mt-1">Format: Spiral Bound + eBook</p>
                            </div>
                            <div class="flex justify-between items-end mt-2">
                                <div class="flex items-center bg-gray-100 rounded-md">
                                    <button data-id="${item.productId}" data-delta="-1" class="quantity-btn px-3 py-1 text-gray-600 hover:text-black font-medium text-lg">-</button>
                                    <span class="px-2 font-semibold text-gray-900 text-sm">${item.quantity}</span>
                                    <button data-id="${item.productId}" data-delta="1" class="quantity-btn px-3 py-1 text-gray-600 hover:text-black font-medium text-lg">+</button>
                                </div>
                                <span class="font-black text-xl text-gray-900">Rs. ${(item.price * item.quantity).toLocaleString('en-PK')}</span>
                            </div>
                        </div>
                    </div>`; 
                cartItemsContainer.insertAdjacentHTML('beforeend', itemHtml); 
            }); 
            
            document.querySelectorAll('.quantity-btn').forEach(button => button.addEventListener('click', handleQuantityChange)); 
            calculateTotals(); 
        };
        // ---------------------------------------------

        const showCartModal = (show = true) => { if (show) { renderCart(); cartModalOverlay.classList.remove('hidden'); void cartModal.offsetWidth; cartModal.classList.remove('scale-95', 'opacity-0'); cartModal.classList.add('scale-100', 'opacity-100'); } else { cartModal.classList.remove('scale-100', 'opacity-100'); cartModal.classList.add('scale-95', 'opacity-0'); setTimeout(() => cartModalOverlay.classList.add('hidden'), 300); } };
        // Updated addToCart to accept quantity
        const addToCart = (productId, qty = 1) => { 
            const id = parseInt(productId); 
            const product = findProductById(id); 
            if (!product) return; 
            const cartItem = cart.find(item => item.productId === id); 
            if (cartItem) {
                cartItem.quantity += qty;
            } else {
                cart.push({ productId: id, name: product.name, price: product.price, quantity: qty, image: product.images[0] }); 
            }
            saveCartToStorage(cart); showCartModal(true); 
        };

        // NEW: Function for Bundle Button
        window.addBundleToCart = () => {
             // Add Block 5 (ID 2), Block 6 (ID 3), Block 4 (ID 5)
             addToCart(2, 1);
             addToCart(3, 1);
             addToCart(5, 1);
             // The modal will open automatically due to addToCart calls, 
             // but we want to ensure it calculates the total immediately.
             renderCart();
        };

        const handleQuantityChange = (e) => { e.preventDefault(); const productId = parseInt(e.currentTarget.dataset.id); const delta = parseInt(e.currentTarget.dataset.delta); const itemIndex = cart.findIndex(item => item.productId === productId); if (itemIndex > -1) { cart[itemIndex].quantity += delta; if (cart[itemIndex].quantity <= 0) cart.splice(itemIndex, 1); } saveCartToStorage(cart); renderCart(); };
        mobileMenuButton.addEventListener('click', () => mobileMenu.classList.toggle('hidden'));
        productTriggers.forEach(trigger => trigger.addEventListener('click', (e) => openProductPage(e.currentTarget.dataset.productId)));
        closeProductPageButton.addEventListener('click', () => window.switchView('main'));
        closeCheckoutButton.addEventListener('click', () => window.switchView('main'));
        if(cancelCheckoutBtn) cancelCheckoutBtn.addEventListener('click', () => window.switchView('main'));
        closeSuccessBtn.addEventListener('click', () => window.switchView('main'));
        document.querySelectorAll('.home-logo-link').forEach(link => { link.addEventListener('click', (e) => { e.preventDefault(); window.switchView('main'); }); });
        
        const revealElements = document.querySelectorAll('.reveal-on-scroll'); const revealObserver = new IntersectionObserver((entries, observer) => { entries.forEach(entry => { if (entry.isIntersecting) { entry.target.classList.add('is-visible'); observer.unobserve(entry.target); } }); }, { root: null, threshold: 0.1, rootMargin: "0px 0px -50px 0px" }); revealElements.forEach(el =>  revealObserver.observe(el));
        const setFilter = (targetYear) => { filterButtons.forEach(btn => { const isActive = btn.dataset.year === targetYear; btn.classList.toggle('active', isActive); btn.classList.toggle('text-white', isActive); btn.classList.toggle('text-black', isActive); btn.classList.toggle('text-gray-500', !isActive); }); productCards.forEach(card => { const isVisible = targetYear === 'all' || card.dataset.year === targetYear; card.classList.toggle('hidden', !isVisible); if (isVisible) { card.classList.remove('product-slide-up'); void card.offsetWidth; card.classList.add('product-slide-up'); } }); };
        filterButtons.forEach(button => button.addEventListener('click', (e) => setFilter(e.currentTarget.dataset.year)));
        
        // This targets the homepage cart buttons which still use default qty 1
        document.querySelectorAll('.add-to-cart-btn').forEach(button => button.addEventListener('click', (e) => addToCart(e.currentTarget.dataset.productId)));
        
        document.getElementById('desktop-cart-button').addEventListener('click', () => showCartModal(true));
        document.getElementById('mobile-cart-button').addEventListener('click', () => showCartModal(true));
        document.getElementById('close-cart-button').addEventListener('click', () => showCartModal(false));
        cartModalOverlay.addEventListener('click', (e) => { if (e.target === cartModalOverlay) showCartModal(false); });

        setFilter('all'); calculateTotals();
    });
</script>
</body>
</html>
```
