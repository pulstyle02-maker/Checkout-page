<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>ModMedicalis | Let the visuals speak</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Import Fonts */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Parisienne&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Lilita+One&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Londrina+Solid:wght@100;300;400;900&display=swap');

        @font-face {
            font-family: 'BBH SANS BOGLE';
            src: local('Arial'), local('Helvetica'), local('sans-serif');
            font-weight: 300;
        }

        @keyframes gradient-shift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .londrina-solid-font {
            font-family: 'Londrina Solid', sans-serif;
            font-weight: 400;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            color: #1e293b;
            transition: background-color 0.3s, color 0.3s;
        }

        .grid-pattern-bg {
             position: absolute;
             top: 0;
             left: 0;
             width: 100%;
             height: 100%;
             z-index: 1;
             background-image: linear-gradient(to right, rgba(255, 255, 255, 0.2) 2px, transparent 2px),
                               linear-gradient(to bottom, rgba(255, 255, 255, 0.2) 2px, transparent 2px);
             background-size: 40px 40px;
        }

        .red-curved-section {
            background-color: #ef4444;
            border-bottom-left-radius: 50px;
            border-bottom-right-radius: 50px;
            position: relative;
            overflow: hidden;
            z-index: 1;
        }

        .red-curved-section .content-z {
            position: relative;
            z-index: 10;
        }

        .medical-pattern-svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            opacity: 0.05;
        }

        .avail-btn {
            background-color: #1e293b;
            color: white;
            padding: 1rem 2.5rem;
            font-weight: 700;
            border-radius: 1.5rem;
            transition: background-color 0.3s, transform 0.2s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .avail-btn:hover {
            background-color: #334155;
            transform: translateY(-2px);
        }

        .top-resources-gradient {
            background: linear-gradient(90deg, #1A5693, #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            color: transparent;
            font-weight: 800;
        }

        .filter-text-button {
            position: relative;
            cursor: pointer;
            padding: 0.5rem 1rem;
            font-weight: 700;
            transition: color 0.3s ease;
            padding-bottom: 0.75rem;
        }

        .filter-text-button::after {
            content: '';
            position: absolute;
            left: 50%;
            bottom: 0;
            height: 3px;
            width: 0;
            background-color: #3b82f6;
            transition: width 0.3s ease, transform 0.3s ease;
            transform: translateX(-50%);
        }

        .filter-text-button.active {
            color: #3b82f6;
        }

        #filter-buttons-container .filter-text-button.active::after {
             background-color: white !important;
        }

        .filter-text-button.active::after {
            width: 100%;
        }

        .review-box-design {
            background-color: white;
            border: 1px solid #e5e7eb;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            border-radius: 1rem;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            height: 100%;
        }

        .review-box-design:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        .review-box-design::before {
             content: '';
             position: absolute;
             top: 0;
             left: 0;
             width: 100%;
             height: 4px;
             background-color: #1A5693;
             transform: scaleX(0);
             transform-origin: left;
             transition: transform 0.3s ease;
        }

        .review-box-design:hover::before {
            transform: scaleX(1);
        }

        .product-popup-overlay {
            z-index: 60;
            background-color: rgba(0, 0, 0, 0.7);
        }

        #product-details-popup {
             background-color: white;
             max-width: 32rem;
        }

        .product-popup-image-container {
            width: 100%;
            padding-top: 125%;
            position: relative;
            overflow: hidden;
            background-color: #f3f4f6;
        }

        .product-popup-image-container img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .glass-card {
            background-color: #ffffff;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            position: relative;
        }

        .horizontal-scroll-container {
            display: flex;
            overflow-x: scroll;
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch;
            padding-bottom: 1rem;
        }

        .horizontal-scroll-container::-webkit-scrollbar {
            display: none;
        }
        .horizontal-scroll-container {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .product-image-box {
            background-color: #e5e7eb;
            position: relative;
            height: 9rem;
            margin-bottom: 0.5rem;
            cursor: pointer;
        }
        .product-image-box img {
            object-fit: contain;
            width: 100%;
            height: 100%;
        }
        .product-card-title {
            font-size: 1rem;
            line-height: 1.2;
            font-weight: 900;
            text-transform: uppercase;
            cursor: pointer;
        }
        .product-price-main {
            color: #ef4444;
            font-size: 1.25rem;
            font-weight: 900;
        }
        .product-price-cut {
            color: #9ca3af;
            text-decoration: line-through;
            font-size: 0.875rem;
        }
        .add-to-cart-btn {
            width: 2rem;
            height: 2rem;
            font-size: 1.25rem;
            background-color: #1e293b;
            color: white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            position: absolute;
            bottom: 0.75rem;
            right: 0.75rem;
        }

        .cart-item-card {
            background-color: #fff;
            border: 1px solid #e5e7eb;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            background-image: linear-gradient(to right, #ffffff 1px, transparent 1px),
                              linear-gradient(to bottom, #ffffff 1px, transparent 1px);
            background-size: 15px 15px;
        }

        @keyframes slideUp {
          from {
            opacity: 0;
            transform: translateY(20px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
        .product-slide-up {
          animation: slideUp 0.4s ease-out forwards;
        }

        @keyframes slide { from { transform: translateX(0); } to { transform: translateX(-50%); } }
        .sliding-row { display: flex; width: fit-content; animation: slide 30s linear infinite; }
        .sliding-item-container { display: inline-block; white-space: nowrap; padding-right: 50vw; }
        .sliding-feature-box { display: inline-flex; align-items: center; padding: 0.5rem 1rem; background-color: #ffffff; border-radius: 9999px; margin: 0 1rem; box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.05); }
        .sliding-feature-text { background: linear-gradient(90deg, #3b82f6, #f25f61, #facc15); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; color: transparent; font-weight: 700; font-size: 0.875rem; }
        .sliding-row:nth-child(2) { animation-direction: reverse; animation-duration: 35s; }
        .parisienne-font { font-family: 'Parisienne', cursive; font-weight: 400; }
        .playfair-font { font-family: 'Playfair Display', serif; font-weight: 800; }
        .insight-banner-bg { background-image: linear-gradient(to right, #1A5693, #3b82f6); color: #ffffff; }
        .insight-text-yellow { color: #facc15; font-weight: 700; }
        @keyframes floatAndRotate { 0% { transform: translate(0, 0) rotate(0deg); } 33% { transform: translate(10px, -10px) rotate(3deg); } 66% { transform: translate(-8px, 8px) rotate(-2deg); } 100% { transform: translate(0, 0) rotate(0deg); } }
        .dynamic-bg-img { position: absolute; opacity: 0.12; background-size: contain; background-repeat: no-repeat; pointer-events: none; animation: floatAndRotate 20s ease-in-out infinite alternate; }

        .comparison-container {
            position: relative;
            overflow: hidden;
            padding-top: 75%;
            max-width: 42rem;
            margin: 0 auto;
            user-select: none;
            cursor: ew-resize;
            border-radius: 1rem;
        }

        .comparison-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
            transition: clip-path 0.3s ease-out;
            -webkit-transition: clip-path 0.3s ease-out;
            pointer-events: none;
        }

        .comparison-image.after {
            clip-path: inset(0 0 0 50%);
            -webkit-clip-path: inset(0 0 0 50%);
        }

        .comparison-line {
            position: absolute;
            top: 0;
            left: 50%;
            width: 6px;
            height: 100%;
            background-color: #1A5693;
            transform: translateX(-50%);
            z-index: 20;
            transition: left 0.3s ease-out;
            pointer-events: none;
            border-radius: 9999px;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
        }

        .slider-handle {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 40px;
            height: 40px;
            background-color: white;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            z-index: 30;
            transition: left 0.3s ease-out;
            pointer-events: none;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .tilted-overlap-image {
            position: absolute;
            top: -2.5rem;
            right: 0.5rem;
            width: 120px;
            height: 120px;
            z-index: 20;
            transform: rotate(10deg);
            object-fit: contain;
            pointer-events: none;
        }

        .logo-font {
            font-family: 'Lilita One', cursive;
            background: linear-gradient(90deg, #1A5693, #ef4444);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            color: transparent;
        }

        .prebook-notification-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.4);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
            pointer-events: none;
        }

        .prebook-notification-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }

        .prebook-notification-popup {
            background-color: #eff6ff;
            border: 2px solid #93c5fd;
            box-shadow: 0 10px 25px 0 rgba(0, 0, 0, 0.3);
            border-radius: 16px;
            color: #1e293b;
            padding: 1.5rem;
            max-width: 90%;
            width: 380px;
            transform: scale(0.9);
            transition: transform 0.3s ease-in-out;
            position: relative;
            text-align: center;
        }

        .prebook-notification-overlay.active .prebook-notification-popup {
             transform: scale(1);
        }

        .close-popup-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #dbeafe;
            border-radius: 50%;
            padding: 4px;
            line-height: 1;
            cursor: pointer;
            transition: background 0.2s;
        }
        .close-popup-btn:hover {
            background: #93c5fd;
        }

        @keyframes confetti-fall {
            0% { opacity: 1; transform: translateY(-100%) rotate(0deg); }
            100% { opacity: 0; transform: translateY(100vh) rotate(720deg); }
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: var(--color);
            border-radius: 50%;
            animation: confetti-fall var(--duration) linear infinite;
        }

        .overflow-hidden-body {
            overflow: hidden;
        }

        #bottom-notification-bar.hidden-down {
            transform: translateY(150%);
        }

        .progress-bar-container {
            width: 100%;
            height: 8px;
            background-color: #e5e7eb;
            border-radius: 4px;
            margin-bottom: 1.5rem;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(to right, #1A5693, #3b82f6);
            border-radius: 4px;
            transition: width 0.5s ease-in-out;
        }

        .checkout-step {
            display: none;
        }

        .checkout-step.active {
            display: block;
        }

        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1.5rem;
            position: relative;
        }

        .step-indicator::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            background-color: #e5e7eb;
            transform: translateY(-50%);
            z-index: 1;
        }

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 2;
            position: relative;
            flex: 1;
        }

        .step-circle {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #6b7280;
            margin-bottom: 0.5rem;
            transition: all 0.3s ease;
        }

        .step.active .step-circle {
            background-color: #1A5693;
            color: white;
        }

        .step.completed .step-circle {
            background-color: #10b981;
            color: white;
        }

        .step-label {
            font-size: 0.75rem;
            color: #6b7280;
            text-align: center;
        }

        .step.active .step-label {
            color: #1A5693;
            font-weight: 600;
        }

        .step.completed .step-label {
            color: #10b981;
        }

        .checkout-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 1.5rem;
        }

        .search-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            max-height: 200px;
            overflow-y: auto;
            z-index: 50;
        }

        .search-dropdown-item {
            padding: 0.75rem 1rem;
            cursor: pointer;
            border-bottom: 1px solid #f3f4f6;
            transition: background-color 0.2s;
        }

        .search-dropdown-item:hover {
            background-color: #f9fafb;
        }

        .search-dropdown-item:last-child {
            border-bottom: none;
        }

        /* popper (notification) */
        .popper {
            position: fixed;
            left: 50%;
            top: 12%;
            transform: translateX(-50%) scale(0.9);
            background: linear-gradient(90deg,#10b981,#3b82f6);
            color: white;
            padding: 1rem 1.25rem;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            z-index: 1200;
            opacity: 0;
            transition: transform .35s cubic-bezier(.2,.9,.3,1), opacity .35s;
            pointer-events: none;
            font-weight: 800;
            text-align: center;
        }
        .popper.show {
            opacity: 1;
            transform: translateX(-50%) scale(1);
            pointer-events: auto;
        }

        @media (prefers-color-scheme: dark) {
            body {
                background-color: #f8fafc !important;
                color: #1e293b !important;
            }
        }
    </style>
</head>
<body class="min-h-screen antialiased">

    <div class="bg-red-600 text-white text-center py-2 text-xs font-semibold sticky top-0 z-50">
        Mind your minors BLOCK 6 on its way!
        <button class="ml-2 px-2 py-0.5 bg-white text-red-600 rounded-full text-xs font-bold hover:bg-gray-100 transition duration-200" onclick="showPopup()">
            Prebook now
        </button>
    </div>

    <header class="bg-white shadow-lg sticky top-8 md:top-0 z-40">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-14 sm:h-16">
                <a href="javascript:location.reload()" class="flex-shrink-0 flex items-center">
                    <img src="https://i.imgur.com/osPp3Sa.jpeg" alt="ModMedicalis Logo" class="h-10 sm:h-12 w-auto rounded-lg">
                </a>

                <nav class="hidden md:flex items-center space-x-6">
                    <div class="relative">
                        <input type="text" id="search-input" placeholder="Search products..." class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-[#1A5693] focus:border-[#1A5693] w-64">
                        <button id="search-button" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-600 hover:text-[#1A5693]">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
                        </button>
                        <div id="search-dropdown" class="search-dropdown hidden"></div>
                    </div>
                    <button id="desktop-cart-button" class="relative text-gray-600 hover:text-[#1A5693] transition duration-150">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.38a2 2 0 0 0 1.84-1.11L22 7H4"/></svg>
                        <span id="desktop-cart-count" class="absolute -top-1 -right-1 inline-flex items-center justify-center px-2 py-0.5 text-xs font-bold leading-none text-white transform translate-x-1/2 -translate-y-1/2 bg-[#1A5693] rounded-full">0</span>
                    </button>
                </nav>

                <div class="flex items-center md:hidden space-x-4">
                    <button id="mobile-cart-button" class="relative text-gray-600 hover:text-[#1A5693] transition duration-150">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.38a2 2 0 0 0 1.84-1.11L22 7H4"/></svg>
                        <span id="mobile-cart-count" class="absolute -top-1 -right-1 inline-flex items-center justify-center px-2 py-0.5 text-xs font-bold leading-none text-white transform translate-x-1/2 -translate-y-1/2 bg-[#1A5693] rounded-full">0</span>
                    </button>
                    <button id="mobile-menu-button" class="text-gray-600 hover:text-[#1A5693]">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>
                    </button>
                </div>
            </div>
        </div>
        <div id="mobile-menu" class="hidden md:hidden bg-white border-t border-gray-100">
            <div class="px-4 py-3 space-y-2">
                <div class="relative w-full">
                    <input type="text" id="mobile-search-input" placeholder="Search products..." class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-[#1A5693] focus:border-[#1A5693]">
                    <button id="mobile-search-button" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-600 hover:text-[#1A5693]">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
                    </button>
                    <div id="mobile-search-dropdown" class="search-dropdown hidden"></div>
                </div>
            </div>
        </div>
    </header>

    <main>
        <!-- Hero and sections (kept same) -->
        <section class="pt-6 pb-12 sm:pt-6 sm:pb-16 bg-white relative overflow-hidden">
            <div class="absolute inset-0 z-0"></div>

            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center relative z-10">
                <div class="inline-block px-3 py-1.5 insight-banner-bg rounded-full text-xs font-medium mb-6 shadow-md">
                    Pakistan's first <span class="insight-text-yellow">insightful</span> platform for MBBS
                </div>

                <h1 class="text-3xl sm:text-6xl font-extrabold tracking-tight mb-4">
                    <span class="text-3xl sm:text-6xl text-gray-700" style="font-family: 'BBH SANS BOGLE', sans-serif; font-weight: 300;">When the words get dull</span>
                    <div class="text-[#1A5693] text-5xl sm:text-7xl mt-1 mb-3 londrina-solid-font">
                        Let the <span class="text-red-600" style="font-family: 'Londrina Solid', sans-serif; font-weight: 400;">VISUALS</span> speak!
                    </div>
                </h1>

                <div class="flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-4"></div>
            </div>
        </section>

        <section class="py-3 bg-gray-100 overflow-hidden border-y border-gray-200 space-y-2">
            <div class="flex">
                <div class="sliding-row">
                    <div class="sliding-item-container">
                        <span class="sliding-feature-box"><span class="sliding-feature-text">Aligned with UHS LOs</span></span>
                        <span class="sliding-feature-box"><span class="sliding-feature-text">From UHS recommended books</span></span>
                        <span class="sliding-feature-box"><span class="sliding-feature-text">Mnemonics</span></span>
                        <span class="sliding-feature-box"><span class="sliding-feature-text">Illustration</span></span>
                        <span class="sliding-feature-box"><span class="sliding-feature-text">Past papers</span></span>
                        <span class="sliding-feature-box"><span class="sliding-feature-text">OSPE</span></span>
                        <span class="sliding-feature-box"><span class="sliding-feature-text">Online quiz & flashcards</span></span>
                        <span class="sliding-feature-box"><span class="sliding-feature-text">Flowcharts</span></span>
                    </div>
                    <div class="sliding-item-container">
                        <span class="sliding-feature-box"><span class="sliding-feature-text">Aligned with UHS LOs</span></span>
                        <span class="sliding-feature-box"><span class="sliding-feature-text">From UHS recommended books</span></span>
                        <span class="sliding-feature-box"><span class="sliding-feature-text">Mnemonics</span></span>
                        <span class="sliding-feature-box"><span class="sliding-feature-text">Illustration</span></span>
                        <span class="sliding-feature-box"><span class="sliding-feature-text">Past papers</span></span>
                        <span class="sliding-feature-box"><span class="sliding-feature-text">OSPE</span></span>
                        <span class="sliding-feature-box"><span class="sliding-feature-text">Online quiz & flashcards</span></span>
                        <span class="sliding-feature-box"><span class="sliding-feature-text">Flowcharts</span></span>
                    </div>
                </div>
            </div>

            <div class="flex">
                <div class="sliding-row">
                    <div class="sliding-item-container">
                        <span class="sliding-feature-box"><span class="sliding-feature-text">Mnemonics</span></span>
                        <span class="sliding-feature-box"><span class="sliding-feature-text">Illustration</span></span>
                        <span class="sliding-feature-box"><span class="sliding-feature-text">Aligned with UHS LOs</span></span>
                        <span class="sliding-feature-box"><span class="sliding-feature-text">Past papers</span></span>
                        <span class="sliding-feature-box"><span class="sliding-feature-text">From UHS recommended books</span></span>
                        <span class="sliding-feature-box"><span class="sliding-feature-text">Flowcharts</span></span>
                        <span class="sliding-feature-box"><span class="sliding-feature-text">Online quiz & flashcards</span></span>
                        <span class="sliding-feature-box"><span class="sliding-feature-text">OSPE</span></span>
                    </div>
                    <div class="sliding-item-container">
                        <span class="sliding-feature-box"><span class="sliding-feature-text">Mnemonics</span></span>
                        <span class="sliding-feature-box"><span class="sliding-feature-text">Illustration</span></span>
                        <span class="sliding-feature-box"><span class="sliding-feature-text">Aligned with UHS LOs</span></span>
                        <span class="sliding-feature-box"><span class="sliding-feature-text">Past papers</span></span>
                        <span class="sliding-feature-box"><span class="sliding-feature-text">From UHS recommended books</span></span>
                        <span class="sliding-feature-box"><span class="sliding-feature-text">Flowcharts</span></span>
                        <span class="sliding-feature-box"><span class="sliding-feature-text">Online quiz & flashcards</span></span>
                        <span class="sliding-feature-box"><span class="sliding-feature-text">OSPE</span></span>
                    </div>
                </div>
            </div>
        </section>

        <section id="notes" class="py-12 sm:py-20 mx-0 mt-8 mb-4 shadow-2xl bg-red-600 relative overflow-hidden">
            <div class="grid-pattern-bg"></div>
            <img src="https://i.imgur.com/QRYh6HS.png" alt="Medical Diagram" class="tilted-overlap-image">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center relative z-30">
                <h2 class="text-2xl sm:text-4xl font-bold mb-4 text-white">TOP RESOURCES</h2>
                <div id="filter-buttons-container" class="flex justify-center space-x-6 mb-8">
                    <span id="filter-all" data-year="all" class="filter-text-button active text-base text-white" style="color: white;">ALL</span>
                    <span id="filter-1st" data-year="1" class="filter-text-button text-base text-gray-300">1st Year</span>
                    <span id="filter-2nd" data-year="2" class="filter-text-button text-base text-gray-300">2nd Year</span>
                </div>

                <div id="product-container" class="horizontal-scroll-container">
                    <div class="glass-card snap-center flex-shrink-0 w-48 p-3 rounded-xl text-center product-card mr-3" data-year="1" data-product-id="1">
                        <div class="product-image-box rounded-lg flex items-center justify-center product-trigger" data-product-id="1">
                            <img src="https://i.imgur.com/c4XSHmA.jpeg" alt="Block 2 Flashcards" class="rounded-lg">
                        </div>

                        <h3 class="product-card-title text-gray-900 mb-0.5 product-trigger" data-product-id="1">BLOCK 2 FLASHCARDS</h3>

                        <div class="flex flex-col items-center justify-center space-y-0.5">
                            <span class="product-price-cut text-xs">Rs. 1100 (pkr)</span>
                            <span class="product-price-main">Rs. 900</span>
                        </div>

                        <button class="add-to-cart-btn rounded-full flex items-center justify-center" data-product-id="1">
                            <span class="text-xl font-light leading-none">+</span>
                        </button>
                    </div>

                    <div class="glass-card snap-center flex-shrink-0 w-48 p-3 rounded-xl text-center product-card mr-3 hidden" data-year="2" data-product-id="2">
                        <div class="product-image-box rounded-lg flex items-center justify-center product-trigger" data-product-id="2">
                            <img src="https://i.imgur.com/mTnWoeB.png" alt="Mind Your Minors Block 5" class="rounded-lg">
                            <span class="absolute top-1 left-1 text-xs font-bold text-white bg-blue-500 px-2 py-0.5 rounded-full shadow-md">BEST VALUE</span>
                        </div>

                        <h3 class="product-card-title text-gray-900 mb-0.5 product-trigger" data-product-id="2">MIND YOUR MINORS - BLOCK 5</h3>

                        <div class="flex flex-col items-center justify-center space-y-0.5">
                            <span class="product-price-main">Rs. 500</span>
                        </div>

                        <button class="add-to-cart-btn rounded-full flex items-center justify-center" data-product-id="2">
                            <span class="text-xl font-light leading-none">+</span>
                        </button>
                    </div>

                    <div class="glass-card snap-center flex-shrink-0 w-48 p-3 rounded-xl text-center product-card mr-3 hidden" data-year="2" data-product-id="3">
                        <div class="product-image-box rounded-lg flex items-center justify-center product-trigger" data-product-id="3">
                             <img src="https://i.imgur.com/wLiYfOr.jpeg" alt="Mind Your Minors Block 6" class="rounded-lg">
                        </div>

                        <div class="text-center text-gray-300 text-xs font-medium my-2">Pre-book only</div>

                        <h3 class="product-card-title text-gray-900 mb-0.5 product-trigger" data-product-id="3">MIND YOUR MINORS - BLOCK 6</h3>

                        <div class="flex flex-col items-center justify-center space-y-0.5 mt-2">
                            <span class="text-base font-bold text-red-300">Launching Soon...</span>
                        </div>

                        <button class="absolute bottom-3 right-3 px-2 py-1 bg-gradient-to-r from-blue-500 to-[#1A5693] text-white text-xs font-semibold rounded-full shadow-lg hover:shadow-xl transition duration-200" onclick="showPrebookModal()">
                            Pre-book
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Reviews, Comparison, Free Resources, Founder, Team, etc. (kept exact) -->
        <!-- ... content omitted here for brevity in comments, but present in this file identical to your original ... -->

        <section class="py-12 sm:py-20 bg-gray-100 border-t border-gray-200">
            <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
                <h2 class="text-2xl sm:text-4xl font-extrabold text-center mb-10 text-gray-900">
                    <span class="text-red-600">MESSAGE FROM THE</span> <span class="text-[#1A5693]">FOUNDER</span>
                </h2>

                <div class="p-6 sm:p-8 bg-white rounded-xl shadow-2xl border-t-0">
                    <p class="italic text-gray-700 mb-6 text-base leading-relaxed">
                        Mind Your Minors was born from the real struggles of every medical student; endless notes, massive books, and not enough time. We wanted to change the way students learn, making it smarter, simpler, and more visual. Each page blends clarity with creativity, turning complex topics into quick, memorable insights. Designed by students who've been in your shoes, this book makes learning the minor subjects not a burden, but a breakthrough in your MB  BS journey.
                    </p>

                    <div class="flex items-center justify-end space-x-4 pt-4 border-t border-gray-100">
                        <div class="text-right">
                            <p class="font-bold text-lg text-gray-900">Muhammad Hasnain</p>
                            <p class="text-sm text-[#1A5693] font-semibold">Founder, ModMedicalis</p>
                        </div>
                        <img src="https://i.imgur.com/2y4pFZW.jpeg" alt="Founder's Photo" class="h-16 w-16 rounded-full object-cover ring-2 ring-[#1A5693] p-0.5">
                    </div>
                </div>
            </div>
        </section>

        <section class="py-12 sm:py-20 bg-gray-50 border-t border-gray-200">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <h2 class="text-2xl sm:text-4xl font-extrabold text-center mb-10 text-gray-900">
                    <span class="text-[#1A5693]">OUR</span> TEAM
                </h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-8">
                    <div class="flex flex-col items-center text-center p-4 bg-white rounded-xl shadow-lg hover:shadow-xl transition duration-300">
                        <img src="https://i.imgur.com/2y4pFZW.jpeg" alt="Muhammad Hasnain Photo" class="h-24 w-24 rounded-full object-cover ring-4 ring-red-600 mb-3">
                        <p class="font-bold text-lg text-gray-900">Muhammad Hasnain</p>
                        <p class="text-sm text-red-600 font-semibold">Founder | Developer | Graphic designer</p>
                        <p class="text-xs text-gray-500 mt-1">MS-II (AIMC)</p>
                    </div>

                    <div class="flex flex-col items-center text-center p-4 bg-white rounded-xl shadow-lg hover:shadow-xl transition duration-300">
                        <img src="https://i.imgur.com/RbGRiTF.jpeg" alt="Hamza Masood Gondal Photo" class="h-24 w-24 rounded-full object-cover ring-4 ring-red-600 mb-3">
                        <p class="font-bold text-lg text-gray-900">Hamza Masood Gondal</p>
                        <p class="text-sm text-red-600 font-semibold">Co-Founder | 1st Position holder AIMC (MS-I)</p>
                        <p class="text-xs text-gray-500 mt-1">MS-II (AIMC)</p>
                    </div>

                    <div class="flex flex-col items-center text-center p-4 bg-white rounded-xl shadow-lg hover:shadow-xl transition duration-300">
                        <img src="https://i.imgur.com/A3rIAiM.jpeg" alt="Mahrukh Nadeem Photo" class="h-24 w-24 rounded-full object-cover ring-4 ring-red-600 mb-3">
                        <p class="font-bold text-lg text-gray-900">Mahrukh Nadeem</p>
                        <p class="text-sm text-red-600 font-semibold">Admin | Designer</p>
                        <p class="text-xs text-gray-500 mt-1">MS-II (AIMC)</p>
                    </div>

                    <div class="flex flex-col items-center text-center p-4 bg-white rounded-xl shadow-lg hover:shadow-xl transition duration-300">
                        <img src="https://i.imgur.com/VQH3Rqp.png" alt="Hadia Gulshan Photo" class="h-24 w-24 rounded-full object-cover ring-4 ring-red-600 mb-3">
                        <p class="font-bold text-lg text-gray-900">Hadia Gulshan</p>
                        <p class="text-sm text-red-600 font-semibold">Graphic designer</p>
                        <p class="text-xs text-gray-500 mt-1">MS-II (AIMC)</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer id="contact" class="bg-gray-800 text-white py-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-8">
                <div>
                    <h3 class="text-lg font-bold text-[#1A5693] mb-3">MODMEDICALIS</h3>
                    <p class="text-xs text-gray-400">Your trusted partner for medical education excellence.</p>
                    <p class="text-xs text-gray-400 mt-3">&copy; 2025 ModMedicalis</p>
                    <p class="text-xs text-gray-400 mt-3">Developed by <span class="text-xl font-extrabold logo-font">HASNAIN & MAHRUKH</span></p>
                </div>

                <div>
                    <h4 class="text-base font-semibold mb-3">Quick Links</h4>
                    <ul class="space-y-1 text-sm">
                        <li><a href="#notes" class="text-gray-400 hover:text-[#1A5693]">TOP RESOURCES</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-[#1A5693]">Order Tracking</a></li>
                    </ul>
                </div>

                <div>
                    <h4 class="text-base font-semibold mb-3">Resources</h4>
                    <ul class="space-y-1 text-sm">
                        <li><a href="https://modmedicalis.online/FREE-RESOURCES" class="text-gray-400 hover:text-[#1A5693]">FREE RESOURCES</a></li>
                    </ul>
                </div>

                <div>
                    <h4 class="text-base font-semibold mb-3">Get In Touch</h4>
                    <p class="text-sm text-gray-400">Email: modmedicalis@gmail.com</p>
                    <p class="text-sm text-gray-400">Phone: 03096554421</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Cart Modal -->
    <div id="cart-modal-overlay" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div id="cart-modal" class="bg-white rounded-xl shadow-2xl w-full max-w-sm sm:max-w-md transform transition-all duration-300 scale-95 opacity-0">
            <div class="p-4 border-b flex justify-between items-center bg-red-600 rounded-t-xl">
                <h3 class="text-xl font-bold text-white">Your Cart</h3>
                <button id="close-cart-button" class="text-red-200 hover:text-white transition p-1">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                </button>
            </div>

            <div id="cart-items-container" class="p-4 max-h-72 overflow-y-auto space-y-3">
                <p id="empty-cart-message" class="text-gray-500 text-center italic text-sm">Your cart is empty.</p>
            </div>

            <div id="cart-footer" class="p-4 border-t space-y-2 rounded-b-xl bg-blue-50">
                <div class="flex justify-between font-semibold text-gray-700 text-sm">
                    <span>Subtotal:</span>
                    <span id="cart-subtotal">Rs. 0</span>
                </div>
                <div class="flex justify-between text-lg font-extrabold text-red-600">
                    <span>Total:</span>
                    <span id="cart-total">Rs. 0</span>
                </div>
                <button id="proceed-to-checkout-btn" class="w-full bg-[#1A5693] text-white py-2 rounded-lg font-bold text-sm hover:bg-blue-700 transition duration-200 shadow-lg">
                    Proceed to Checkout
                </button>
            </div>
        </div>
    </div>

    <!-- Product Details Popup -->
    <div id="product-details-popup-overlay" class="product-popup-overlay hidden fixed inset-0 flex items-center justify-center p-4">
        <div id="product-details-popup" class="bg-white rounded-xl shadow-2xl w-full max-w-lg max-h-[95vh] overflow-y-auto transform transition-all duration-300 scale-95 opacity-0">
            <div class="sticky top-0 p-3 border-b flex justify-end bg-white rounded-t-xl z-10">
                <button id="close-product-popup-button" class="text-gray-500 hover:text-gray-900 transition p-1">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                </button>
            </div>

            <div class="grid md:grid-cols-1 gap-4 p-4">
                <div class="space-y-3">
                    <div id="popup-image-carousel" class="w-full relative">
                        <div class="product-popup-image-container rounded-xl shadow-lg">
                            <img id="popup-main-image" src="" alt="Product Main Image">
                        </div>
                        <div id="popup-thumbnails" class="flex space-x-2 mt-3 overflow-x-auto justify-center"></div>
                    </div>
                </div>

                <div class="space-y-4">
                    <h2 id="popup-product-name" class="text-2xl font-extrabold text-[#1A5693]"></h2>

                    <div class="flex items-center space-x-2">
                         <span id="popup-product-price" class="text-3xl font-extrabold text-red-600"></span>
                         <span id="popup-product-old-price" class="text-base text-gray-400 line-through"></span>
                    </div>

                    <p id="popup-product-description" class="text-gray-700 leading-relaxed text-sm"></p>

                    <div class="flex flex-col space-y-3 pt-2">
                        <button id="popup-add-to-cart-btn" class="w-full bg-[#1A5693] text-white py-2.5 rounded-lg font-bold text-base hover:bg-blue-700 transition duration-200 shadow-lg flex items-center justify-center space-x-2 disabled:opacity-50" data-product-id="">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.38a2 2 0 0 0 1.84-1.11L22 7H4"/></svg>
                            <span>Add to cart</span>
                        </button>
                        <button id="popup-free-preview-btn" class="w-full bg-gray-200 text-gray-800 py-2.5 rounded-lg font-bold text-base hover:bg-gray-300 transition duration-200 shadow-md flex items-center justify-center space-x-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>
                            <span>Click for free preview</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="bottom-notification-bar" class="fixed bottom-0 left-0 w-full z-[100] text-center transition-transform duration-300 ease-in-out">
        <div class="bg-red-600 text-white py-2 px-4 shadow-2xl rounded-t-xl rounded-b-none mx-2 sm:mx-4 md:mx-8">
             <p class="londrina-solid-font text-xl sm:text-2xl tracking-wider">
                 AVAIL 15% OFF IN PREBOOKING!
             </p>
        </div>
    </div>

    <div id="prebook-notification-popup-overlay" class="prebook-notification-overlay">
        <div id="prebook-notification-popup" class="prebook-notification-popup">
            <button class="close-popup-btn" onclick="hidePopup()">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
            </button>
            <div class="flex flex-col space-y-4">
                <img src="https://i.imgur.com/wLiYfOr.jpeg" alt="Mind Your Minors Block 6" class="w-32 h-32 object-contain rounded-lg shadow-lg">
                <p class="text-2xl font-extrabold text-[#1A5693] londrina-solid-font tracking-wider">PREBOOK MIND YOUR MINORS BLOCK 6</p>
                <p class="text-4xl font-extrabold text-red-600">& CLAIM 15% OFF!!</p>
                <p class="text-xs font-semibold text-gray-700 italic border-t pt-2 w-full">Offer valid till launching of the book</p>
                <button onclick="hidePopup(); showPrebookModal();" class="w-full bg-red-600 text-white py-2 rounded-lg font-bold hover:bg-red-700 transition duration-200 shadow-md">Prebook Now</button>
            </div>
        </div>
    </div>

    <!-- Hidden iframe used to submit forms (supports file upload without page navigation) -->
    <iframe name="hidden_iframe" id="hidden_iframe" style="display:none;"></iframe>

    <!-- Popper element for the fun "wohooo" pop effect -->
    <div id="popper" class="popper" role="status" aria-live="polite" style="display:none;">WOHOO! YOU GOT 15% OFF! We'll contact you soon.</div>

    <script>
        /*************************************************************************
         * Full client-side script
         * - Keeps all original functionality: search, filters, product popup,
         *   cart, comparison slider, etc.
         * - Replaces previous fetch/AJAX submission for prebook & checkout
         *   with native form POST to FormSubmit via hidden iframe to avoid
         *   CORS/fetch issues and support file upload.
         *
         * Behavior:
         * - Prebook form: posts to https://formsubmit.co/modmedicalis@gmail.com (target hidden iframe).
         *   On iframe load we show the "WOHOO" popup + confetti and the success page.
         * - Checkout form: posts to https://formsubmit.co/modmedicalis@gmail.com (enctype multipart/form-data, target hidden iframe).
         *   Confirm button validates, sets submission flag and submits the native form so the uploaded slip is sent.
         *   On iframe load we show final slip/confirmation with generated order number.
         *************************************************************************/

        // Basic helpers
        function copyPaymentNumber() {
            const number = '03096554421';
            navigator.clipboard.writeText(number).then(() => {
                alert('Number copied to clipboard!');
            }, (err) => {
                alert('Failed to copy number.');
                console.error('Could not copy text: ', err);
            });
        }

        // Data & DOM refs
        const PAKISTAN_MEDICAL_COLLEGES = [
            'King Edward Medical University (KEMU), Lahore',
            'Allama Iqbal Medical College (AIMC), Lahore',
            'Fatima Jinnah Medical University (FJMU), Lahore',
            'Services Institute of Medical Sciences (SIMS), Lahore',
            'Postgraduate Medical Institute (PGMI), Lahore',
            'Dow Medical College (DMC), Karachi',
            'Jinnah Sindh Medical University (JSMU), Karachi',
            'Khyber Medical College (KMC), Peshawar',
            'Ayub Medical College (AMC), Abbottabad',
            'Rawalpindi Medical University (RMU), Rawalpindi',
            'Quaid-e-Azam Medical College (QAMC), Bahawalpur',
            'Liaquat University of Medical and Health Sciences (LUMHS), Jamshoro',
            'Bolan Medical College (BMC), Quetta',
            'Nishtar Medical University (NMU), Multan',
            'Shaikh Zayed Medical College (SZMC), Rahim Yar Khan',
            'Gujranwala Medical College (GMC), Gujranwala',
            'Sialkot Medical College (SMC), Sialkot',
            'Faisalabad Medical University (FMU), Faisalabad',
            'National University of Medical Sciences (NUMS) Colleges',
            'PIMS Medical College, Islamabad',
            'CMH Lahore Medical College',
            'FMH College of Medicine and Dentistry, Lahore',
            'Azra Naheed Medical College (ANMC), Lahore',
            'Continental Medical College (CMC), Lahore',
            'Lahore Medical & Dental College (LMDC), Lahore',
            'University College of Medicine and Dentistry (UCMD), Lahore',
            'Shalamar Medical and Dental College (SMDC), Lahore',
            'Aga Khan University Hospital (AKUH), Karachi',
            'Liaquat College of Medicine and Dentistry (LCMD), Karachi',
            'Indus Medical College, Tando Muhammad Khan',
            'Wah Medical College, Wah Cantt',
            'Riphah International University, Islamabad',
            'Foundation University Medical College (FUMC), Rawalpindi',
            'Islamabad Medical and Dental College (IMDC)',
            'Karachi Medical and Dental College (KMDC)',
            'Ziauddin Medical University, Karachi',
            'Other'
        ];

        // Minimal state
        let products = [
            {
                id: 1,
                name: "BLOCK 2 FLASHCARDS",
                price: 900,
                oldPrice: 1100,
                year: 1,
                isPrebook: false,
                images: ["https://i.imgur.com/c4XSHmA.jpeg"],
                description: "",
                previewLink: "https://drive.google.com/file/d/1QFJiBzPELwVWcaVi7VWnDrIr-bwm5qBy/view?usp=drivesdk"
            },
            {
                id: 2,
                name: "MIND YOUR MINORS - BLOCK 5",
                price: 500,
                oldPrice: null,
                year: 2,
                isPrebook: false,
                images: ["https://i.imgur.com/mTnWoeB.png"],
                description: "Get ready to ace your minor subjects with our illustrative notes & say good bye to boring books. Completely alligned with UHS LOs & recommended books",
                previewLink: "https://drive.google.com/file/d/1LDBgWhSP6xeWDqxyKyutZ7tOijrx_uuS/view?usp=drivesdk"
            },
            {
                id: 3,
                name: "MIND YOUR MINORS - BLOCK 6",
                price: 0,
                oldPrice: null,
                year: 2,
                isPrebook: true,
                images: ["https://i.imgur.com/wLiYfOr.jpeg", "https://i.imgur.com/iAdfNwC.png", "https://i.imgur.com/e9WIdYm.jpeg"],
                description: "Pre-book access for the upcoming minor subjects block notes. Secure your copy of the next high-demand resource for Second Year MBBS before the official launch. Special early-bird content included.",
                previewLink: "https://drive.google.com/file/d/1yhewdyE8Xc4ALB3Eo7CDzAFTsr_PHbK-/view?usp=drivesdk"
            }
        ];

        let cart = [];
        let currentCheckoutStep = 1;

        // DOM lookups (many elements)
        document.addEventListener('DOMContentLoaded', () => {
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            const filterButtons = document.querySelectorAll('.filter-text-button');
            const productCards = document.querySelectorAll('.product-card');
            const productTriggers = document.querySelectorAll('.product-trigger');

            const searchInput = document.getElementById('search-input');
            const searchDropdown = document.getElementById('search-dropdown');
            const mobileSearchInput = document.getElementById('mobile-search-input');
            const mobileSearchDropdown = document.getElementById('mobile-search-dropdown');

            const cartModalOverlay = document.getElementById('cart-modal-overlay');
            const cartModal = document.getElementById('cart-modal');
            const cartItemsContainer = document.getElementById('cart-items-container');
            const emptyCartMessage = document.getElementById('empty-cart-message');
            const cartSubtotalElement = document.getElementById('cart-subtotal');
            const cartTotalElement = document.getElementById('cart-total');
            const cartCountElements = document.querySelectorAll('[id$="-cart-count"]');
            const proceedToCheckoutBtn = document.getElementById('proceed-to-checkout-btn');

            const checkoutModalOverlay = document.getElementById('checkout-modal-overlay');
            const checkoutModal = document.getElementById('checkout-modal');
            const closeCheckoutButton = document.getElementById('close-checkout-button');
            const paymentAmountEl = document.getElementById('payment-amount');
            const checkoutSummaryList = document.getElementById('checkout-summary-list');
            const checkoutFinalTotal = document.getElementById('checkout-final-total');
            const checkoutCollegeSelect = document.getElementById('college');

            const checkoutForm = document.getElementById('checkout-form');
            const checkoutSteps = document.querySelectorAll('.checkout-step');
            const stepIndicators = document.querySelectorAll('.step');
            const progressBar = document.getElementById('checkout-progress-bar');
            const nextToPaymentBtn = document.getElementById('next-to-payment-btn');
            const backToShippingBtn = document.getElementById('back-to-shipping-btn');
            const nextToConfirmationBtn = document.getElementById('next-to-confirmation-btn');
            const backToPaymentBtn = document.getElementById('back-to-payment-btn');
            const cancelCheckoutBtn = document.getElementById('cancel-checkout-btn');
            const confirmOrderBtn = document.getElementById('confirm-order-btn');

            const prebookPageOverlay = document.getElementById('prebook-page-overlay');
            const prebookPageModal = document.getElementById('prebook-page-modal');
            const prebookPageContent = document.getElementById('prebook-page-content');
            const prebookSuccessPage = document.getElementById('prebook-success-page');
            const closePrebookPageButton = document.getElementById('close-prebook-page-button');
            const prebookForm = document.getElementById('prebook-form');
            const informViaRadios = document.querySelectorAll('input[name="Inform Via"]');
            const emailEntry = document.getElementById('email-entry');
            const whatsappEntry = document.getElementById('whatsapp-entry');
            const prebookEmailInput = document.getElementById('prebook_email');
            const prebookWhatsappInput = document.getElementById('prebook_whatsapp');

            const productPopupOverlay = document.getElementById('product-details-popup-overlay');
            const productPopup = document.getElementById('product-details-popup');
            const closeProductPopupButton = document.getElementById('close-product-popup-button');
            const popupMainImage = document.getElementById('popup-main-image');
            const popupThumbnails = document.getElementById('popup-thumbnails');
            const popupProductName = document.getElementById('popup-product-name');
            const popupProductPrice = document.getElementById('popup-product-price');
            const popupProductOldPrice = document.getElementById('popup-product-old-price');
            const popupProductDescription = document.getElementById('popup-product-description');
            const popupAddToCartBtn = document.getElementById('popup-add-to-cart-btn');
            const popupFreePreviewBtn = document.getElementById('popup-free-preview-btn');

            const bottomNotificationBar = document.getElementById('bottom-notification-bar');

            const hiddenIframe = document.getElementById('hidden_iframe');
            const popper = document.getElementById('popper');

            // utility to find product
            const findProductById = (id) => products.find(p => p.id === id);

            // SEARCH
            const performSearch = (searchTerm, dropdownElement) => {
                if (!searchTerm.trim()) {
                    dropdownElement.classList.add('hidden');
                    return;
                }
                const searchLower = searchTerm.toLowerCase();
                const matchingProducts = products.filter(product =>
                    product.name.toLowerCase().includes(searchLower) ||
                    (product.description && product.description.toLowerCase().includes(searchLower))
                );
                if (matchingProducts.length === 0) {
                    dropdownElement.innerHTML = '<div class="search-dropdown-item text-gray-500">No products found</div>';
                    dropdownElement.classList.remove('hidden');
                    return;
                }
                dropdownElement.innerHTML = '';
                matchingProducts.forEach(product => {
                    const item = document.createElement('div');
                    item.className = 'search-dropdown-item';
                    item.textContent = product.name;
                    item.addEventListener('click', () => {
                        showProductPopup(product.id);
                        dropdownElement.classList.add('hidden');
                        if (searchInput) searchInput.value = '';
                        if (mobileSearchInput) mobileSearchInput.value = '';
                    });
                    dropdownElement.appendChild(item);
                });
                dropdownElement.classList.remove('hidden');
            };

            if (searchInput && searchDropdown) {
                searchInput.addEventListener('input', () => performSearch(searchInput.value, searchDropdown));
                searchInput.addEventListener('focus', () => { if (searchInput.value.trim()) performSearch(searchInput.value, searchDropdown); });
                document.addEventListener('click', (e) => { if (!searchInput.contains(e.target) && !searchDropdown.contains(e.target)) searchDropdown.classList.add('hidden'); });
            }
            if (mobileSearchInput && mobileSearchDropdown) {
                mobileSearchInput.addEventListener('input', () => performSearch(mobileSearchInput.value, mobileSearchDropdown));
                mobileSearchInput.addEventListener('focus', () => { if (mobileSearchInput.value.trim()) performSearch(mobileSearchInput.value, mobileSearchDropdown); });
                document.addEventListener('click', (e) => { if (!mobileSearchInput.contains(e.target) && !mobileSearchDropdown.contains(e.target)) mobileSearchDropdown.classList.add('hidden'); });
            }

            // CART / RENDER / TOTALS
            const calculateTotals = () => {
                let subtotal = 0;
                let totalItems = 0;
                cart.forEach(item => {
                    subtotal += item.price * item.quantity;
                    totalItems += item.quantity;
                });
                const total = subtotal;
                cartSubtotalElement.textContent = `Rs. ${subtotal.toLocaleString('en-PK')}`;
                cartTotalElement.textContent = `Rs. ${total.toLocaleString('en-PK')}`;
                cartCountElements.forEach(el => el.textContent = totalItems);
            };

            const renderCart = () => {
                cartItemsContainer.innerHTML = '';
                if (cart.length === 0) {
                    emptyCartMessage.classList.remove('hidden');
                    proceedToCheckoutBtn.disabled = true;
                    calculateTotals();
                    return;
                }
                emptyCartMessage.classList.add('hidden');
                proceedToCheckoutBtn.disabled = false;

                cart.forEach(item => {
                    const itemHtml = `
                        <div class="flex items-center space-x-3 p-2 cart-item-card rounded-xl">
                            <div class="flex-shrink-0 w-10 h-10 bg-gray-200 rounded-lg overflow-hidden">
                                <img src="${item.image}" alt="${item.name} image" class="w-full h-full object-cover">
                            </div>
                            <div class="flex-grow">
                                <p class="text-xs font-semibold text-gray-800">${item.name}</p>
                                <p class="text-[0.65rem] text-red-500 font-bold">Rs. ${(item.price).toLocaleString('en-PK')}</p>
                            </div>
                            <div class="flex items-center space-x-1">
                                <button data-id="${item.productId}" data-delta="-1" class="w-5 h-5 bg-red-100 rounded-full text-xs font-bold text-red-700 hover:bg-red-200 transition quantity-btn">-</button>
                                <span class="w-3 text-center text-xs font-semibold">${item.quantity}</span>
                                <button data-id="${item.productId}" data-delta="1" class="w-5 h-5 bg-blue-100 rounded-full text-xs font-bold text-blue-700 hover:bg-blue-200 transition quantity-btn">+</button>
                            </div>
                            <div class="text-right w-12">
                                <p class="text-xs font-bold text-[#1A5693]">Rs. ${(item.price * item.quantity).toLocaleString('en-PK')}</p>
                            </div>
                        </div>
                    `;
                    cartItemsContainer.insertAdjacentHTML('beforeend', itemHtml);
                });

                document.querySelectorAll('.quantity-btn').forEach(button => button.addEventListener('click', handleQuantityChange));
                calculateTotals();
            };

            const addToCart = (productId) => {
                const id = parseInt(productId);
                const product = findProductById(id);
                if (!product || product.isPrebook) return;
                const cartItemIndex = cart.findIndex(item => item.productId === id);
                if (cartItemIndex > -1) cart[cartItemIndex].quantity += 1;
                else cart.push({ productId: id, name: product.name, price: product.price, quantity: 1, image: product.images[0] });
                showCartModal(true);
            };

            const handleQuantityChange = (e) => {
                const productId = parseInt(e.currentTarget.getAttribute('data-id'));
                const delta = parseInt(e.currentTarget.getAttribute('data-delta'));
                const cartItemIndex = cart.findIndex(item => item.productId === productId);
                if (cartItemIndex > -1) {
                    cart[cartItemIndex].quantity += delta;
                    if (cart[cartItemIndex].quantity <= 0) cart.splice(cartItemIndex, 1);
                }
                renderCart();
            };

            const showCartModal = (show = true) => {
                if (show) {
                    renderCart();
                    cartModalOverlay.classList.remove('hidden');
                    void cartModal.offsetWidth;
                    cartModal.classList.remove('scale-95', 'opacity-0');
                    cartModal.classList.add('scale-100', 'opacity-100');
                } else {
                    cartModal.classList.remove('scale-100', 'opacity-100');
                    cartModal.classList.add('scale-95', 'opacity-0');
                    setTimeout(() => cartModalOverlay.classList.add('hidden'), 300);
                }
            };

            document.querySelectorAll('.add-to-cart-btn').forEach(button => button.addEventListener('click', (e) => addToCart(e.currentTarget.getAttribute('data-product-id'))));
            document.getElementById('desktop-cart-button').addEventListener('click', () => showCartModal(true));
            document.getElementById('mobile-cart-button').addEventListener('click', () => showCartModal(true));
            document.getElementById('close-cart-button').addEventListener('click', () => showCartModal(false));
            cartModalOverlay.addEventListener('click', (e) => { if (e.target === cartModalOverlay) showCartModal(false); });

            // CHECKOUT: progress, steps, validation
            const updateCheckoutProgress = (step) => {
                stepIndicators.forEach((indicator, index) => {
                    const stepNumber = index + 1;
                    if (stepNumber < step) {
                        indicator.classList.remove('active');
                        indicator.classList.add('completed');
                    } else if (stepNumber === step) {
                        indicator.classList.add('active');
                        indicator.classList.remove('completed');
                    } else {
                        indicator.classList.remove('active', 'completed');
                    }
                });
                const progressPercentage = ((step - 1) / 2) * 100;
                progressBar.style.width = `${progressPercentage}%`;
                currentCheckoutStep = step;
            };

            const showCheckoutStep = (step) => {
                checkoutSteps.forEach(cs => cs.classList.remove('active'));
                document.getElementById(`checkout-step-${step}`).classList.add('active');
                updateCheckoutProgress(step);
            };

            const showCheckoutModal = () => {
                if (cart.length === 0) {
                    alert('Your cart is empty. Please add items before proceeding to checkout.');
                    return;
                }
                showCartModal(false);

                // populate colleges once
                if (checkoutCollegeSelect.options.length <= 1) {
                    const fragment = document.createDocumentFragment();
                    const publicGroup = document.createElement('optgroup');
                    publicGroup.label = "Public Medical Colleges";
                    const privateGroup = document.createElement('optgroup');
                    privateGroup.label = "Private Medical Colleges";

                    PAKISTAN_MEDICAL_COLLEGES.forEach(college => {
                        const option = document.createElement('option');
                        option.value = college;
                        option.textContent = college;
                        // naive grouping
                        if (college.includes('(KEMU)') || college.includes('(AIMC)') || college.includes('(FJMU)') || college.includes('(SIMS)') || college.includes('(DMC)') || college.includes('(KMC)') || college.includes('(RMU)') || college.includes('(QAMC)') || college.includes('(LUMHS)') || college.includes('(BMC)') || college.includes('(NMU)') || college.includes('(SZMC)') || college.includes('(GMC)') || college.includes('(SMC)') || college.includes('(FMU)') || college.includes('(NUMS)') || college.includes('PIMS')) {
                            publicGroup.appendChild(option);
                        } else if (college === 'Other') {
                            fragment.appendChild(option);
                        } else {
                            privateGroup.appendChild(option);
                        }
                    });
                    checkoutCollegeSelect.appendChild(publicGroup);
                    checkoutCollegeSelect.appendChild(privateGroup);
                    checkoutCollegeSelect.appendChild(fragment);
                }

                // build summary
                let total = 0;
                checkoutSummaryList.innerHTML = '';
                let cartSummary = [];
                cart.forEach(item => {
                    const itemTotal = item.price * item.quantity;
                    total += itemTotal;
                    const listItem = document.createElement('li');
                    listItem.textContent = `${item.name} x ${item.quantity} - Rs. ${itemTotal.toLocaleString('en-PK')}`;
                    checkoutSummaryList.appendChild(listItem);
                    cartSummary.push(`${item.name} x ${item.quantity} (Rs. ${itemTotal.toLocaleString('en-PK')})`);
                });

                paymentAmountEl.textContent = `Rs. ${total.toLocaleString('en-PK')}`;
                checkoutFinalTotal.textContent = `Rs. ${total.toLocaleString('en-PK')}`;
                document.getElementById('form-cart-details').value = cartSummary.join('; ');
                document.getElementById('form-final-bill').value = `Rs. ${total.toLocaleString('en-PK')}`;

                showCheckoutStep(1);
                checkoutModalOverlay.classList.remove('hidden');
                void checkoutModal.offsetWidth;
                checkoutModal.classList.remove('scale-95', 'opacity-0');
                checkoutModal.classList.add('scale-100', 'opacity-100');
                bottomNotificationBar.classList.add('hidden-down');
            };

            const closeCheckoutModal = () => {
                checkoutModal.classList.remove('scale-100', 'opacity-100');
                checkoutModal.classList.add('scale-95', 'opacity-0');
                bottomNotificationBar.classList.remove('hidden-down');
                setTimeout(() => checkoutModalOverlay.classList.add('hidden'), 300);
            };

            nextToPaymentBtn.addEventListener('click', () => {
                const shippingForm = document.getElementById('checkout-step-1');
                const requiredFields = shippingForm.querySelectorAll('[required]');
                let isValid = true;
                requiredFields.forEach(field => {
                    if (!field.value || !String(field.value).trim()) {
                        isValid = false;
                        field.classList.add('border-red-500');
                    } else field.classList.remove('border-red-500');
                });
                if (isValid) showCheckoutStep(2);
                else alert('Please fill in all required shipping details.');
            });

            backToShippingBtn.addEventListener('click', () => showCheckoutStep(1));

            nextToConfirmationBtn.addEventListener('click', () => {
                const paymentForm = document.getElementById('checkout-step-2');
                const requiredFields = paymentForm.querySelectorAll('[required]');
                let isValid = true;
                requiredFields.forEach(field => {
                    if (field.type === 'file') return; // file validated separately
                    if (!field.value || !String(field.value).trim()) {
                        isValid = false;
                        field.classList.add('border-red-500');
                    } else field.classList.remove('border-red-500');
                });

                const paymentSlip = document.getElementById('payment_slip');
                if (!paymentSlip.files.length) {
                    isValid = false;
                    paymentSlip.classList.add('border-red-500');
                } else paymentSlip.classList.remove('border-red-500');

                const referralSource = document.querySelector('input[name="How do you know about us?"]:checked');
                if (!referralSource) {
                    isValid = false;
                    document.querySelectorAll('input[name="How do you know about us?"]').forEach(radio => radio.parentNode.classList.add('text-red-500'));
                } else document.querySelectorAll('input[name="How do you know about us?"]').forEach(radio => radio.parentNode.classList.remove('text-red-500'));

                if (isValid) showCheckoutStep(3);
                else alert('Please fill in all required payment details.');
            });

            backToPaymentBtn.addEventListener('click', () => showCheckoutStep(2));
            cancelCheckoutBtn.addEventListener('click', closeCheckoutModal);
            proceedToCheckoutBtn.addEventListener('click', showCheckoutModal);
            closeCheckoutButton.addEventListener('click', closeCheckoutModal);
            checkoutModalOverlay.addEventListener('click', (e) => { if (e.target === checkoutModalOverlay) closeCheckoutModal(); });

            // PREBOOK modal handlers
            window.showPrebookModal = () => {
                prebookPageContent.classList.remove('hidden');
                prebookSuccessPage.classList.add('hidden');
                prebookPageOverlay.classList.remove('hidden');
                document.body.classList.add('overflow-hidden');
                void prebookPageModal.offsetWidth;
                prebookPageModal.classList.remove('scale-95', 'opacity-0');
                prebookPageModal.classList.add('scale-100', 'opacity-100');
                bottomNotificationBar.classList.add('hidden-down');
            };

            window.closePrebookModal = (refresh = false) => {
                prebookPageModal.classList.remove('scale-100', 'opacity-100');
                prebookPageModal.classList.add('scale-95', 'opacity-0');
                document.body.classList.remove('overflow-hidden');
                bottomNotificationBar.classList.remove('hidden-down');
                setTimeout(() => {
                    prebookPageOverlay.classList.add('hidden');
                    if (refresh) location.reload();
                }, 300);
            };

            closePrebookPageButton.addEventListener('click', () => closePrebookModal());
            prebookPageOverlay.addEventListener('click', (e) => { if (e.target === prebookPageOverlay) closePrebookModal(); });

            informViaRadios.forEach(radio => {
                radio.addEventListener('change', (e) => {
                    emailEntry.classList.add('hidden');
                    whatsappEntry.classList.add('hidden');
                    prebookEmailInput.required = false;
                    prebookWhatsappInput.required = false;
                    const target = e.target.getAttribute('data-target');
                    if (target === 'email-entry') {
                        emailEntry.classList.remove('hidden');
                        prebookEmailInput.required = true;
                    } else if (target === 'whatsapp-entry') {
                        whatsappEntry.classList.remove('hidden');
                        prebookWhatsappInput.required = true;
                    }
                });
            });

            // PRODUCT POPUP
            const renderProductImages = (product) => {
                popupMainImage.src = product.images[0];
                popupThumbnails.innerHTML = '';
                product.images.forEach((url, index) => {
                    const thumbnail = document.createElement('img');
                    thumbnail.src = url;
                    thumbnail.alt = `${product.name} thumbnail ${index+1}`;
                    thumbnail.className = 'w-12 h-12 sm:w-16 sm:h-16 rounded-lg object-cover cursor-pointer border-2 transition duration-150 hover:border-[#1A5693]';
                    if (index === 0) thumbnail.classList.add('border-[#1A5693]');
                    thumbnail.addEventListener('click', () => {
                        popupMainImage.src = url;
                        popupThumbnails.querySelectorAll('img').forEach(img => img.classList.remove('border-[#1A5693]'));
                        thumbnail.classList.add('border-[#1A5693]');
                    });
                    popupThumbnails.appendChild(thumbnail);
                });
            };

            const showProductPopup = (productId) => {
                const product = findProductById(Number(productId));
                if (!product) return;
                popupProductName.textContent = product.name;
                popupProductPrice.textContent = product.isPrebook ? "Rs. ??" : `Rs. ${product.price.toLocaleString('en-PK')}`;
                popupProductOldPrice.textContent = product.oldPrice ? `Rs. ${product.oldPrice.toLocaleString('en-PK')}` : '';
                popupProductDescription.textContent = product.description;
                popupAddToCartBtn.setAttribute('data-product-id', product.id);
                if (product.isPrebook) {
                    popupAddToCartBtn.textContent = 'CLICK FOR FREE PREVIEW';
                    popupAddToCartBtn.disabled = false;
                    popupAddToCartBtn.classList.remove('bg-gray-400','hover:bg-gray-400');
                    popupAddToCartBtn.classList.add('bg-[#1A5693]','hover:bg-blue-700');
                    popupAddToCartBtn.onclick = () => window.open(product.previewLink,'_blank');
                    popupFreePreviewBtn.textContent = 'Pre-book Now';
                    popupFreePreviewBtn.onclick = showPrebookModal;
                } else {
                    popupAddToCartBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.38a2 2 0 0 0 1.84-1.11L22 7H4"/></svg><span>Add to cart</span>';
                    popupAddToCartBtn.disabled = false;
                    popupAddToCartBtn.classList.remove('bg-gray-400','hover:bg-gray-400');
                    popupAddToCartBtn.classList.add('bg-[#1A5693]','hover:bg-blue-700');
                    popupAddToCartBtn.onclick = (e) => { addToCart(e.currentTarget.getAttribute('data-product-id')); closeProductPopup(); };
                    popupFreePreviewBtn.textContent = 'Click for free preview';
                    popupFreePreviewBtn.onclick = () => { if (product.previewLink) window.open(product.previewLink,'_blank'); else alert('Free preview not available for this product.'); };
                }
                renderProductImages(product);
                productPopupOverlay.classList.remove('hidden');
                void productPopup.offsetWidth;
                productPopup.classList.remove('scale-95','opacity-0');
                productPopup.classList.add('scale-100','opacity-100');
            };

            const closeProductPopup = () => {
                productPopup.classList.remove('scale-100','opacity-100');
                productPopup.classList.add('scale-95','opacity-0');
                setTimeout(() => productPopupOverlay.classList.add('hidden'), 300);
            };

            productTriggers.forEach(trigger => trigger.addEventListener('click', (e) => showProductPopup(e.currentTarget.getAttribute('data-product-id'))));
            closeProductPopupButton.addEventListener('click', closeProductPopup);
            productPopupOverlay.addEventListener('click', (e) => { if (e.target === productPopupOverlay) closeProductPopup(); });

            // Image comparison slider (kept)
            const comparisonWrapper = document.getElementById('image-comparison-wrapper');
            const imageAfter = document.getElementById('image-after');
            const comparisonLine = document.getElementById('comparison-line');
            const sliderHandle = document.getElementById('slider-handle');

            let isDragging = false;
            const updateSlider = (e) => {
                if (!comparisonWrapper) return;
                const rect = comparisonWrapper.getBoundingClientRect();
                let clientX;
                if (e.touches) clientX = e.touches[0].clientX;
                else clientX = e.clientX;
                let x = clientX - rect.left;
                if (x < 0) x = 0;
                if (x > rect.width) x = rect.width;
                const percent = (x / rect.width) * 100;
                imageAfter.style.clipPath = `inset(0 0 0 ${percent}%)`;
                imageAfter.style.webkitClipPath = `inset(0 0 0 ${percent}%)`;
                comparisonLine.style.left = `${percent}%`;
                sliderHandle.style.left = `${percent}%`;
            };
            const startDrag = (e) => {
                if (e.type === 'mousedown') e.preventDefault();
                isDragging = true;
                comparisonWrapper && comparisonWrapper.classList.add('dragging');
                updateSlider(e);
                document.addEventListener('mousemove', drag);
                document.addEventListener('mouseup', stopDrag);
                document.addEventListener('touchmove', drag, { passive: false });
                document.addEventListener('touchend', stopDrag);
            };
            const drag = (e) => { if (isDragging) updateSlider(e); };
            const stopDrag = () => {
                isDragging = false;
                comparisonWrapper && comparisonWrapper.classList.remove('dragging');
                document.removeEventListener('mousemove', drag);
                document.removeEventListener('mouseup', stopDrag);
                document.removeEventListener('touchmove', drag);
                document.removeEventListener('touchend', stopDrag);
            };
            if (comparisonWrapper) {
                comparisonWrapper.addEventListener('mousedown', startDrag);
                comparisonWrapper.addEventListener('touchstart', startDrag, { passive: false });
                const imgs = [document.getElementById('image-before'), document.getElementById('image-after')];
                let loaded = 0;
                imgs.forEach(img => {
                    if (!img) return;
                    if (img.complete) loaded++;
                    else img.onload = () => { loaded++; if (loaded === imgs.length) updateSlider({ clientX: comparisonWrapper.getBoundingClientRect().left + comparisonWrapper.offsetWidth/2 }); };
                });
                if (loaded === imgs.length) updateSlider({ clientX: comparisonWrapper.getBoundingClientRect().left + comparisonWrapper.offsetWidth/2 });
            }

            mobileMenuButton.addEventListener('click', () => mobileMenu.classList.toggle('hidden'));

            // filters
            const setFilter = (targetYear) => {
                filterButtons.forEach(btn => {
                    const year = btn.getAttribute('data-year');
                    if (year === targetYear) {
                        btn.classList.add('active');
                        btn.classList.remove('text-gray-300');
                        btn.classList.add('text-white');
                        btn.style.color = 'white';
                    } else {
                        btn.classList.remove('active');
                        btn.classList.remove('text-white');
                        btn.classList.add('text-gray-300');
                        btn.style.color = '#d1d5db';
                    }
                });

                let firstVisibleProduct = null;
                const productContainer = document.getElementById('product-container');
                productCards.forEach(card => {
                    const cardYear = card.getAttribute('data-year');
                    if (targetYear === 'all' || cardYear === targetYear) {
                        card.classList.remove('product-slide-up');
                        card.classList.remove('hidden');
                        void card.offsetWidth;
                        card.classList.add('product-slide-up');
                        if (!firstVisibleProduct) firstVisibleProduct = card;
                    } else {
                        card.classList.add('hidden');
                        card.classList.remove('product-slide-up');
                    }
                });

                if (firstVisibleProduct) productContainer.scrollTo({ left: firstVisibleProduct.offsetLeft - 16, behavior: 'smooth' });
                else productContainer.scrollTo({ left: 0, behavior: 'smooth' });
            };
            filterButtons.forEach(button => button.addEventListener('click', (e) => setFilter(e.currentTarget.getAttribute('data-year'))));

            // cart initial
            setFilter('all');
            calculateTotals();

            // ---------- FORM SUBMISSION INTEGRATION ----------
            // We'll submit both forms (prebook and checkout) natively to FormSubmit (non-AJAX) and target hidden iframe.
            // This reliably sends fields and files and avoids CORS/fetch errors.

            let submissionInProgressFor = null; // 'prebook'|'checkout'|null

            // PREBOOK: let native submit occur; mark flag so iframe onload knows what to show.
            prebookForm.addEventListener('submit', (e) => {
                submissionInProgressFor = 'prebook';
                // allow native submission to proceed (do not preventDefault)
            });

            // CHECKOUT: when confirm pressed, validate then native submit to include file upload
            confirmOrderBtn.addEventListener('click', () => {
                // validate required in checkout-step-2
                const paymentForm = document.getElementById('checkout-step-2');
                const requiredFields = paymentForm.querySelectorAll('[required]');
                let isValid = true;

                requiredFields.forEach(field => {
                    if (field.type === 'file') {
                        if (!field.files.length) {
                            isValid = false;
                            field.classList.add('border-red-500');
                        } else field.classList.remove('border-red-500');
                        return;
                    }
                    if (!field.value || !String(field.value).trim()) {
                        isValid = false;
                        field.classList.add('border-red-500');
                    } else field.classList.remove('border-red-500');
                });

                const referralSource = document.querySelector('input[name="How do you know about us?"]:checked');
                if (!referralSource) {
                    isValid = false;
                    document.querySelectorAll('input[name="How do you know about us?"]').forEach(radio => radio.parentNode.classList.add('text-red-500'));
                } else document.querySelectorAll('input[name="How do you know about us?"]').forEach(radio => radio.parentNode.classList.remove('text-red-500'));

                if (!isValid) {
                    alert('Please fill in all required payment details.');
                    return;
                }

                // ensure hidden inputs already filled
                // set flag and submit
                submissionInProgressFor = 'checkout';
                confirmOrderBtn.disabled = true;
                const prevText = confirmOrderBtn.textContent;
                confirmOrderBtn.textContent = 'Submitting...';

                // native submit
                if (typeof checkoutForm.requestSubmit === 'function') checkoutForm.requestSubmit();
                else checkoutForm.submit();

                // The hidden iframe load handler below will react and show confirmation UI.
            });

            // IFRAME load handler
            hiddenIframe.addEventListener('load', () => {
                // If no tracked submission, ignore (iframe may load blank initial)
                if (!submissionInProgressFor) return;

                if (submissionInProgressFor === 'prebook') {
                    // Show success UI for prebook
                    const method = document.querySelector('input[name="Inform Via"]:checked')?.value || '';
                    const contact = method === 'Email' ? (prebookEmailInput.value || '') : (prebookWhatsappInput.value || '');
                    document.getElementById('success-message-info').innerHTML = `
                        Wohoo you got 15% off! You will be informed at <span class="font-extrabold text-[#1A5693]">${contact || 'the contact you provided'}</span> when the book is launched.
                    `;

                    prebookPageContent.classList.add('hidden');
                    prebookSuccessPage.classList.remove('hidden');

                    // popper animation
                    popper.style.display = 'block';
                    popper.textContent = `WOHOO! YOU GOT 15% OFF! We'll contact you at ${contact || 'the contact you provided'}.`;
                    popper.classList.add('show');
                    setTimeout(() => { popper.classList.remove('show'); setTimeout(()=>popper.style.display='none',350); }, 4300);

                    // confetti
                    startConfetti(prebookPageModal);

                    submissionInProgressFor = null;
                    return;
                }

                if (submissionInProgressFor === 'checkout') {
                    // show order confirmation with unique number
                    const orderNumber = 'MM-' + Date.now();
                    const orderInfo = document.getElementById('form-cart-details').value || 'Order details';
                    const total = document.getElementById('form-final-bill').value || 'Rs. 0';

                    const confirmationMessage = `
                        <div class="p-4 bg-green-100 rounded-lg border border-green-200 text-center text-gray-800">
                          <h3 class="text-2xl font-extrabold text-[#1A5693]">Thank you for placing your order!</h3>
                          <p class="mt-2">Order Number: <strong>${orderNumber}</strong></p>
                          <p class="mt-2">${orderInfo}</p>
                          <p class="mt-3 font-semibold">Total Paid: <span class="text-red-600">${total}</span></p>
                          <p class="mt-3">Your order will be delivered in 4-5 working days.</p>
                          <p class="mt-2 text-sm">Kindly keep a screenshot of your payment slip for reference.</p>
                        </div>
                        <div class="mt-4">
                          <button onclick="closeCheckoutModal(); location.reload();" class="w-full bg-green-500 text-white py-2 rounded-lg font-bold">Close</button>
                        </div>
                    `;
                    const step3 = document.getElementById('checkout-step-3');
                    step3.innerHTML = `<h4 class="text-lg font-bold text-gray-700">Order Submitted!</h4><hr class="border-gray-100">${confirmationMessage}`;

                    // clear cart state & UI
                    cart = [];
                    renderCart();
                    calculateTotals();

                    submissionInProgressFor = null;
                    confirmOrderBtn.disabled = false;
                    confirmOrderBtn.textContent = 'Confirm Order & Upload Slip';
                }
            });

            // confetti helper
            function startConfetti(container) {
                const confettiColors = ['#ef4444', '#3b82f6', '#facc15', '#10b981', '#ffffff'];
                const count = 40;
                const fragment = document.createDocumentFragment();
                for (let i = 0; i < count; i++) {
                    const c = document.createElement('div');
                    c.className = 'confetti';
                    c.style.left = (Math.random()*100)+'%';
                    c.style.top = (Math.random()*20)+'%';
                    c.style.setProperty('--color', confettiColors[Math.floor(Math.random()*confettiColors.length)]);
                    c.style.setProperty('--duration', `${Math.random()*3+2}s`);
                    fragment.appendChild(c);
                }
                container.appendChild(fragment);
                setTimeout(()=>container.querySelectorAll('.confetti').forEach(n=>n.remove()), 5000);
            }

            // Sticky prebook popups
            const stickyPrebookPopupOverlay = document.getElementById('prebook-notification-popup-overlay');
            function showPopup(){ stickyPrebookPopupOverlay.classList.add('active'); }
            function hidePopup(){ stickyPrebookPopupOverlay.classList.remove('active'); }
            window.showPopup = showPopup; window.hidePopup = hidePopup;

            // show prebook popup automatically after load
            window.addEventListener('load', () => setTimeout(showPopup, 2000));
            stickyPrebookPopupOverlay.addEventListener('click', (e) => { if (e.target === stickyPrebookPopupOverlay) hidePopup(); });
        }); // DOMContentLoaded end
    </script>
</body>
</html>
