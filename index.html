<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MODMEDICALIS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Long+Reach&family=Oswald:wght@400;700&family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <style>
        /* Apply Inter font family, with Oswald as an option for headings */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #ffffff;
        }

        /* Applying Oswald Bold (700) to headings and button */
        h1, h2, .oswald-text, .oswald-font {
            font-family: 'Oswald', sans-serif;
            font-weight: 700;
            color: #4A5568;
        }

        /* Specific h1 styling for the hero section */
        .hero-heading {
            color: #F7FAFC;
            font-size: 3rem;
        }

        .hero-heading .text-brand-blue {
            color: #38B6FF;
        }

        /* Custom color definitions for branding */
        .custom-red-bg {
            background-color: #E63D3D;
        }
        .custom-red-text {
            color: #E63D3D;
        }
        .custom-orange-btn {
            background-color: #FF773D;
            transition: transform 0.2s;
        }
        .custom-peach-bg {
            background-color: #FFF2E6;
        }
        .custom-blue-bg {
            background-color: #F0F8FF;
        }

        .bg-brand-blue {
            background-color: #38B6FF;
        }

        .text-brand-blue {
            color: #38B6FF;
        }

        .oswald-btn {
            font-family: 'Oswald', sans-serif;
            font-weight: 700;
        }

        /* Placeholder image styles */
        .placeholder-img {
            object-fit: cover;
            width: 100%;
            height: 100%;
        }

        /* Custom CSS for the hero image */
        .hero-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: 50% 20%;
        }

        /* Adjust object-position for smaller screens (portrait aspect) to prioritize the subjects */
        @media (max-width: 639px) {
            .hero-image {
                object-position: 70% 50%;
            }
            .hero-buttons {
                flex-direction: column;
                width: 100%;
            }
            .hero-buttons button {
                width: 100%;
            }
        }

        .category-box-shadow {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -4px rgba(0, 0, 0, 0.05);
        }

        /* Custom class for cart sidebar transition */
        .translate-x-full {
            transform: translateX(100%);
        }

        /* CSS for the carousel images (now unused, but kept for future reference if needed) */
        .carousel-slide {
            transition: opacity 0.5s ease-in-out;
        }
        .carousel-slide.hidden {
            display: none;
        }

        /* Mobile menu transition classes */
        .mobile-menu {
            transition: transform 0.3s ease-out;
            transform: translateY(-100%);
        }
        .mobile-menu.active {
            transform: translateY(0);
        }

        /* Animation classes for scrolling */
        .animate-on-scroll {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        }

        .show-section {
            opacity: 1;
            transform: translateY(0);
        }

        /* New styles for carousel */
        .carousel-container {
            display: flex;
            transition: transform 0.5s ease-in-out;
        }
        .carousel-item {
            flex: 0 0 100%;
            max-width: 100%;
        }
        @media (min-width: 768px) {
            .carousel-item {
                flex: 0 0 33.333333%;
                max-width: 33.333333%;
            }
        }

        /* Styles for the new checkout form */
        .checkout-modal-open {
            overflow: hidden;
        }

        .checkout-modal-enter-active, .checkout-modal-leave-active {
            transition: opacity 0.3s ease;
        }
        .checkout-modal-enter, .checkout-modal-leave-to {
            opacity: 0;
        }
        .checkout-modal-content-enter-active, .checkout-modal-content-leave-active {
            transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }
        .checkout-modal-content-enter, .checkout-modal-content-leave-to {
            transform: translateY(20px);
        }

        .form-input {
            width: 100%;
            padding: 0.75rem;
            border-radius: 0.5rem;
            border: 1px solid #d1d5db;
            transition: border-color 0.2s;
            font-family: 'Inter', sans-serif;
        }
        .form-input:focus {
            outline: none;
            border-color: #38B6FF;
            box-shadow: 0 0 0 2px rgba(56, 182, 255, 0.2);
        }

        .payment-box {
            background-color: #F9FAFB;
            border: 1px solid #E5E7EB;
            border-radius: 0.75rem;
            padding: 1rem;
        }

        .confirm-btn {
            background-color: #38B6FF;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 700;
            transition: background-color 0.2s;
        }

        .confirm-btn:hover {
            background-color: #2a8fd6;
        }

        /* --- FIXES FOR MOBILE VIEW --- */

        /* Fixes the Proceed to Checkout button visibility on iOS Safari */
        @supports (padding-bottom: env(safe-area-inset-bottom)) {
            .cart-fixed-bottom {
                padding-bottom: calc(1rem + env(safe-area-inset-bottom));
            }
        }
        /* Fallback for older browsers */
        .cart-fixed-bottom {
            padding-bottom: 2rem;
        }

        /* Makes the checkout form scrollable on mobile */
        .checkout-scrollable-content {
            flex-grow: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch; /* For smooth scrolling on iOS */
        }
        /* Ensures the container has a defined height */
        .checkout-modal-content-wrapper {
            display: flex;
            flex-direction: column;
            height: 90vh; /* Adjust as needed */
            max-height: 90vh; /* Prevents it from going off screen */
        }

        /* New styles for the product modal */
        .product-modal-container {
            position: fixed;
            top: 0;
            right: 0;
            height: 100%;
            width: 100%;
            max-width: 100%;
            background-color: white;
            z-index: 40;
            transform: translateX(100%);
            transition: transform 0.3s ease-out;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        @media (min-width: 640px) {
            .product-modal-container {
                max-width: 60%;
            }
        }
        @media (min-width: 768px) {
            .product-modal-container {
                max-width: 50%;
            }
        }
        @media (min-width: 1024px) {
            .product-modal-container {
                max-width: 40%;
            }
        }
        .product-modal-container.is-visible {
            transform: translateX(0);
        }
        .product-modal-container.is-hidden {
            display: none;
        }
        .product-modal-close-btn {
            position: absolute;
            top: 1rem;
            left: 1rem;
            z-index: 50;
        }

        /* New styles for the features section */
        .feature-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .feature-item {
            display: flex;
            align-items: center;
            padding: 0.5rem 0;
            transition: color 0.2s ease;
        }
        .feature-item:hover {
            color: #38B6FF;
        }
        .feature-bullet {
            width: 0.5rem;
            height: 0.5rem;
            background-color: #38B6FF;
            border-radius: 50%;
            margin-right: 0.75rem;
            flex-shrink: 0;
        }
        .feature-text {
            font-size: 1rem;
            font-weight: 500;
            color: #4B5563;
        }
        .feature-item:hover .feature-text {
            color: #38B6FF;
        }
    </style>
</head>
<body>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'brand-red': '#E63D3D',
                        'brand-orange': '#FF773D',
                        'brand-peach': '#FFF2E6',
                        'brand-lightblue': '#F0F8FF',
                        'brand-blue': '#38B6FF',
                    },
                }
            }
        }
    </script>

    <header class="sticky top-0 bg-white shadow-sm z-30">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 flex justify-between items-center py-4 relative lg:grid lg:grid-cols-3 lg:gap-4">
            <div class="flex items-center space-x-2 lg:space-x-4">
                <button id="mobile-menu-toggle" class="text-gray-800 hover:text-brand-red transition p-2 rounded-full lg:hidden">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
                <nav class="hidden lg:flex lg:space-x-8 text-sm font-semibold text-gray-700">
                    <a href="#" class="hover:text-brand-red transition" onclick="scrollToProducts(event)">PRODUCTS</a>
                    <a href="#" class="hover:text-brand-red transition">BLOG</a>
                    <a href="#" class="hover:text-brand-red transition">ABOUT</a>
                </nav>
            </div>

            <div class="flex-grow flex justify-center lg:justify-center">
                <a href="#" onclick="renderHomePage()">
                    <img src="https://i.imgur.com/DqHrTRQ.png" alt="MedSchoolBro Logo" class="h-10 sm:h-12 lg:h-14">
                </a>
            </div>

            <div class="flex items-center space-x-4 ml-auto lg:justify-end">
                <nav class="hidden lg:flex lg:space-x-8 text-sm font-semibold text-gray-700">
                    <a href="#" class="hover:text-brand-red transition">ModQUIZ</a>
                    <a href="#" class="hover:text-brand-red transition">OUR TEAM</a>
                    <a href="#" class="hover:text-brand-red transition">CONTACT US</a>
                </nav>
                <button id="search-toggle" class="text-gray-800 hover:text-brand-red transition p-2 rounded-full">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                </button>
                <button id="cart-toggle" class="text-gray-800 hover:text-brand-red transition relative p-2 rounded-full">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path></svg>
                    <span id="cart-count" class="absolute top-0 right-0 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-white transform translate-x-1/2 -translate-y-1/2 bg-brand-red rounded-full">0</span>
                </button>
            </div>
        </div>
        <nav id="mobile-menu" class="mobile-menu absolute w-full top-full left-0 bg-white shadow-md z-20 flex flex-col py-4 px-4 hidden">
            <a href="#" class="block px-4 py-2 text-gray-800 hover:bg-gray-100 transition" onclick="scrollToProducts(event)">PRODUCTS</a>
            <a href="#" class="block px-4 py-2 text-gray-800 hover:bg-gray-100 transition">BLOG</a>
            <a href="#" class="block px-4 py-2 text-gray-800 hover:bg-gray-100 transition">ABOUT</a>
            <a href="#" class="block px-4 py-2 text-gray-800 hover:bg-gray-100 transition">ModQUIZ</a>
            <a href="#" class="block px-4 py-2 text-gray-800 hover:bg-gray-100 transition">OUR TEAM</a>
            <a href="#" class="block px-4 py-2 text-gray-800 hover:bg-gray-100 transition">CONTACT US</a>
        </nav>
    </header>

    <div id="main-content">
    </div>

    <div id="product-modal" class="product-modal-container is-hidden">
        <div id="product-modal-content">
            </div>
    </div>

    <div id="search-modal" class="fixed inset-0 bg-white bg-opacity-95 z-40 hidden p-4 sm:p-10 transition-opacity duration-300 opacity-0" aria-modal="true" role="dialog">
        <div class="max-w-4xl mx-auto transform translate-y-4 opacity-0 transition-all duration-300">
            <div class="flex justify-end">
                <button id="search-close" class="text-gray-500 hover:text-brand-red text-3xl font-light">&times;</button>
            </div>
            <div class="mt-4">
                <div class="relative flex items-center border-b-2 border-gray-300 focus-within:border-brand-red transition-colors duration-200">
                    <input type="text" id="search-input" placeholder="Search..." class="w-full text-2xl p-2 focus:outline-none placeholder-gray-400">
                    <button class="p-2 text-gray-800 hover:text-brand-red transition">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                    </button>
                </div>
                <div class="flex flex-col sm:flex-row mt-8 space-y-8 sm:space-y-0 sm:space-x-12">
                    <div class="w-full sm:w-1/2">
                        <h3 class="text-xs font-bold text-gray-500 mb-4">SUGGESTIONS</h3>
                        <ul id="search-suggestions" class="space-y-4 text-gray-800 font-semibold">
                            </ul>
                    </div>
                    <div class="w-full sm:w-1/2">
                        <h3 class="text-xs font-bold text-gray-500 mb-4">PRODUCTS</h3>
                        <div id="search-products-list" class="space-y-4">
                            </div>
                    </div>
                </div>
                <div class="mt-8 pt-4 border-t border-gray-200 flex justify-between items-center text-gray-600 font-semibold hidden" id="search-result-info">
                    <span></span>
                    <svg class="w-5 h-5 ml-2 text-brand-red" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
                </div>
            </div>
        </div>
    </div>

    <div id="cart-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden" role="dialog" aria-modal="true">
        <div class="fixed top-0 right-0 h-full w-full sm:w-[400px] bg-white shadow-2xl flex flex-col transform translate-x-full transition-transform duration-300" id="cart-sidebar">
            <div class="p-4 border-b flex justify-between items-center sticky top-0 bg-white z-10">
                <h2 class="text-xl font-bold text-gray-900">YOUR CART</h2>
                <button id="cart-close" class="text-gray-500 hover:text-brand-red text-2xl font-light">&times;</button>
            </div>

            <div id="cart-items-container" class="flex-grow overflow-y-auto p-4 space-y-4">
            </div>

            <div class="p-4 border-t sticky bottom-0 bg-white shadow-lg cart-fixed-bottom z-10">
                <div class="flex justify-between items-center mb-4 text-lg font-bold">
                    <span>Subtotal:</span>
                    <span id="cart-subtotal" class="text-brand-red">Rs.0</span>
                </div>
                <button id="checkout-button" class="w-full custom-red-bg text-white font-bold py-3 px-4 rounded-xl shadow-lg transition transform hover:opacity-90 disabled:opacity-50" disabled>
                    PROCEED TO CHECKOUT
                </button>
            </div>
        </div>
    </div>

    <div id="checkout-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden" role="dialog" aria-modal="true">
        <div class="fixed inset-0 flex items-center justify-center p-4">
            <div class="bg-white rounded-2xl shadow-xl w-full max-w-lg p-6 sm:p-8 transform transition-all checkout-modal-content-wrapper" id="checkout-form-container">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold oswald-font text-gray-900">CHECKOUT DETAILS</h2>
                    <button id="checkout-form-close" class="text-gray-500 hover:text-brand-red text-2xl font-light">&times;</button>
                </div>

                <form id="checkout-form" action="https://formsubmit.co/hasnainmughal4200@gmail.com" method="POST" enctype="multipart/form-data" class="space-y-6 checkout-scrollable-content">
                    <input type="hidden" name="_subject" id="order-subject-input" value="New Order from Website!">
                    <input type="hidden" name="_template" value="box">
                    <input type="hidden" name="_captcha" value="false">
                    <input type="hidden" name="_redirect" value="https://thedrg.com/thank-you-page">
                    <input type="hidden" name="_order_number" id="order-number-input">
                    <input type="hidden" name="cart_summary" id="cart-summary-input">
                    <input type="hidden" name="total_price" id="total-price-input">

                    <div>
                        <label for="full_name" class="block text-sm font-semibold text-gray-700 mb-2 oswald-font">FULL NAME</label>
                        <input type="text" id="full_name" name="Full Name" required class="form-input oswald-font" placeholder="Muhammad Hasnain">
                    </div>

                    <div>
                        <label for="contact_number" class="block text-sm font-semibold text-gray-700 mb-2 oswald-font">CONTACT NUMBER</label>
                        <input type="tel" id="contact_number" name="Contact Number" required class="form-input oswald-font" placeholder="e.g. 03096554421">
                    </div>

                    <div id="college-section">
                        <label for="college_select" class="block text-sm font-semibold text-gray-700 mb-2 oswald-font">SELECT YOUR COLLEGE</label>
                        <select id="college_select" name="College" required class="form-input oswald-font">
                            <option value="">- Select a College -</option>
                        </select>
                    </div>

                    <div id="promo-code-container" class="hidden">
                        <label for="promo_code" class="block text-sm font-semibold text-gray-700 mb-2 oswald-font">PROMO CODE</label>
                        <div class="relative flex items-center">
                            <input type="text" id="promo_code" name="Promo Code" class="form-input pr-12 oswald-font" placeholder="Enter code">
                            <button type="button" id="apply-promo-btn" class="absolute right-0 top-0 mt-3 mr-3 text-brand-blue font-semibold text-sm">Apply</button>
                            <span id="promo-status" class="hidden absolute right-3 text-green-500">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                            </span>
                        </div>
                        <p id="promo-message" class="text-sm mt-2 font-medium text-red-500"></p>
                    </div>

                    <div>
                        <label for="shipping_address" class="block text-sm font-semibold text-gray-700 mb-2 oswald-font">SHIPPING ADDRESS</label>
                        <textarea id="shipping_address" name="Shipping Address" required rows="3" class="form-input oswald-font" placeholder="Enter full address with city and landmark"></textarea>
                        <p class="text-sm text-gray-500 mt-2">
                            Shipping charges: **Rs. 100 in Lahore, Rs. 200 out of Lahore.** To be paid at the time of delivery, not online.
                        </p>
                    </div>

                    <div class="payment-box">
                        <h3 class="text-lg font-bold oswald-font text-gray-800 mb-2">PAYMENT</h3>
                        <p class="text-sm font-medium text-gray-700 mb-1">Total to Pay: <span id="final-total" class="font-bold text-lg text-brand-red"></span></p>
                        <p class="text-sm text-gray-600 mb-2">Please pay the amount via EasyPaisa or JazzCash to:</p>
                        <p class="font-bold text-md mb-2">03096554421 - MUHAMMAD HASNAIN</p>

                        <div class="mt-4">
                            <label for="payment_slip" class="block text-sm font-semibold text-gray-700 mb-2 oswald-font">UPLOAD PAYMENT SLIP</label>
                            <input type="file" id="payment_slip" name="Payment Slip" accept="image/*" required class="form-input">
                        </div>
                    </div>

                    <div id="final-order-summary" class="hidden">
                        <h3 class="text-lg font-bold oswald-font text-gray-800 mb-4">ORDER SUMMARY</h3>
                        <div class="space-y-2 text-gray-700">
                            <p class="flex justify-between">
                                <span class="font-semibold oswald-font">Product(s) Price:</span>
                                <span id="summary-product-price"></span>
                            </p>
                            <p class="flex justify-between">
                                <span class="font-semibold oswald-font">Discount:</span>
                                <span id="summary-discount">Rs.0</span>
                            </p>
                            <div class="border-t border-gray-200 mt-2 pt-2 flex justify-between font-bold text-gray-900">
                                <span class="oswald-font">Final Total:</span>
                                <span id="summary-final-total"></span>
                            </div>
                            <p class="text-sm text-gray-500 mt-1">Shipping charges of **Rs. 100 / Rs. 200** will be collected on delivery.</p>
                        </div>
                    </div>

                    <div class="text-center">
                        <button type="submit" id="confirm-order-btn" class="confirm-btn w-full oswald-btn" disabled>CONFIRM ORDER</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="thankyou-modal" class="fixed inset-0 bg-black bg-opacity-70 z-50 hidden flex items-center justify-center p-4 text-center">
        <div class="bg-white rounded-2xl shadow-xl p-8 sm:p-10 max-w-sm mx-auto transform transition-all scale-95 opacity-0" id="thankyou-content">
            <svg class="w-16 h-16 mx-auto mb-4 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            <h3 class="text-2xl font-bold oswald-font mb-2">THANK YOU!</h3>
            <p class="text-gray-600 mb-4">Your order has been placed successfully.</p>
            <div class="bg-gray-100 p-4 rounded-xl text-left mb-4">
                <p class="text-sm text-gray-500">Order Number:</p>
                <p id="thankyou-order-number" class="text-md font-bold text-gray-800 oswald-font mb-2"></p>
                <p class="text-sm text-gray-500">Order Details:</p>
                <p id="thankyou-order-details" class="text-sm text-gray-700 font-medium oswald-font"></p>
            </div>
            <p class="text-sm font-semibold text-brand-red mb-4">Please keep a screenshot of this receipt.</p>
            <p class="text-sm text-gray-500">
                Your order will be delivered within **3-4 working days**.
                <br>
                <span class="text-xs italic text-gray-400">1-2 day delays can be expected for unforeseen circumstances.</span>
            </p>
        </div>
    </div>

    <script>
        // --- Medical Colleges Data ---
        const medicalColleges = [
            "Aga Khan University Medical College, Karachi",
            "Akhtar Saeed Medical & Dental College, Lahore",
            "Al-Aleem Medical College, Lahore",
            "Allama Iqbal Medical College, Lahore",
            "Ameer-ud-Din Medical College (PGMI), Lahore",
            "Army Medical College, Rawalpindi",
            "Avicenna Medical College, Lahore",
            "Aziz Fatima Medical & Dental College, Faisalabad",
            "Baqai Medical College, Karachi",
            "Bolan Medical College, Quetta",
            "Central Park Medical College, Lahore",
            "CMH Lahore Medical College, Lahore",
            "Dow Medical College, Karachi",
            "Faisalabad Medical University, Faisalabad",
            "Fatima Jinnah Medical University, Lahore",
            "FMH College of Medicine & Dentistry, Lahore",
            "Federal Medical & Dental College, Islamabad",
            "Ghulam Mohammad Maher Medical College, Sukkur",
            "Gujranwala Medical College, Gujranwala",
            "Hamdard College of Medicine & Dentistry, Karachi",
            "Islam Medical College, Sialkot",
            "Islamic International Medical College, Rawalpindi",
            "Jinnah Medical & Dental College, Karachi",
            "Karachi Medical & Dental College, Karachi",
            "Khawaja Muhammad Safdar Medical College, Sialkot",
            "King Edward Medical University, Lahore",
            "Lahore Medical & Dental College, Lahore",
            "Liaquat University of Medical & Health Sciences, Jamshoro",
            "Multan Medical & Dental College, Multan",
            "Nawaz Sharif Medical College, Gujrat",
            "Nishtar Medical University, Multan",
            "Northwest School of Medicine, Peshawar",
            "Peoples University of Medical & Health Sciences for Women, Nawabshah",
            "Punjab Medical College, Faisalabad",
            "Quaid-e-Azam Medical College, Bahawalpur",
            "Rashid Latif Medical College, Lahore",
            "Rawalpindi Medical University, Rawalpindi",
            "Sahiwal Medical College, Sahiwal",
            "Services Institute of Medical Sciences, Lahore",
            "Shalamar Medical & Dental College, Lahore",
            "Shaikh Khalifa Bin Zayed Al-Nahyan Medical and Dental College, Lahore",
            "Sheikh Zayed Medical College, Rahim Yar Khan",
            "Sialkot Medical College, Sialkot",
            "Wah Medical College, Wah Cantt",
            "Ziauddin Medical College, Karachi"
        ];

        // --- Product and Cart State ---
        const products = [
            {
                id: 'p1',
                name: "MINOR SUBJECTS FLASHCARDS BLOCK 2",
                price: 900,
                originalPrice: 1200,
                category: 'mbbs1',
                status: 'sale',
                img: "https://i.imgur.com/I2S59DU.png",
                carouselImages: [
                    "https://i.imgur.com/I2S59DU.png",
                    "https://i.imgur.com/6P3L5cE.png",
                    "https://i.imgur.com/V7RjYhE.png",
                    "https://i.imgur.com/5J3b36F.png",
                    "https://i.imgur.com/m293J6o.png"
                ],
                description: "Master your MBBS-I minor subjects with our high-yield Flashcards for Block 2. This set is meticulously designed to simplify complex topics in a concise, easy-to-digest format. Each card includes a key concept on the front and a detailed, high-yield explanation on the back, complete with mnemonics, diagrams, and clinical correlations. Our flashcards are perfect for quick revision, spaced repetition, and solidifying your understanding of crucial information. Say goodbye to bulky textbooks and hello to smarter studying."
            },
            {
                id: 'p2',
                name: "MINOR SUBJECTS FLASHCARDS BLOCK 3",
                price: 0,
                category: 'mbbs1',
                status: 'coming-soon',
                img: "",
                carouselImages: [],
                description: "Get ready to ace your MBBS-I Block 3 exams with our upcoming Minor Subjects Flashcards. This comprehensive set will cover all the essential topics, breaking down complex material into bite-sized, high-yield facts. Perfect for last-minute revision and building a strong foundation for your medical career."
            },
            {
                id: 'p3',
                name: "MIND YOUR MINORS BLOCK 5",
                price: 500,
                category: 'mbbs2',
                status: 'available',
                img: "https://i.imgur.com/M1TedjB.png",
                carouselImages: [
                    "https://i.imgur.com/M1TedjB.png",
                    "https://i.imgur.com/6P3L5cE.png",
                    "https://i.imgur.com/V7RjYhE.png",
                    "https://i.imgur.com/5J3b36F.png",
                    "https://i.imgur.com/m293J6o.png"
                ],
                description: "The 'Mind Your Minors Block 5' guide is your ultimate companion for mastering the minor subjects of MBBS-II. This book is a curated collection of high-yield notes, clinical vignettes, and practice questions, all designed to help you prepare efficiently and effectively. We focus on integrating concepts from various disciplines, so you can see the bigger picture and remember complex topics with ease. Stop drowning in endless pages and start studying smarter with this essential guide."
            },
            {
                id: 'p4',
                name: "MIND YOUR MINORS BLOCK 6",
                price: 0,
                category: 'mbbs2',
                status: 'coming-soon',
                img: "https://i.imgur.com/on3KOKq.png",
                carouselImages: [],
                description: "Our 'Mind Your Minors Block 6' guide is coming soon! This next-level resource is being developed with the same high-yield, integrative approach you love, focusing on the key concepts needed to excel in your MBBS-II exams. Stay tuned for the most efficient and effective study tool you'll ever need."
            },
        ];

        let cart = [];
        let currentFilter = 'all';
        let discountApplied = false;
        let finalTotal = 0;

        const getProductById = (id) => products.find(p => p.id === id);

        const formatPrice = (price) => {
            if (price === 0) return '';
            const parts = price.toString().split('.');
            parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            return `Rs.${parts.join('.')}`;
        };

        // --- Main Content Rendering ---
        function renderHomePage() {
            const mainContent = document.getElementById('main-content');
            mainContent.innerHTML = `
                <main class="relative h-[500px] sm:h-[600px] lg:h-[650px] overflow-hidden animate-on-scroll">
                    <div class="absolute inset-0 custom-peach-bg">
                        <img src="https://i.imgur.com/lum96dJ.png" alt="A doctor reviewing notes with a student" class="hero-image">
                    </div>

                    <div class="relative container mx-auto h-full px-4 sm:px-6 lg:px-8 flex flex-col justify-center text-left">
                        <p class="inline-block bg-brand-blue text-white rounded-full px-3 py-1 text-sm font-bold tracking-wider mb-4 oswald-text" style="width: fit-content;">TRUSTED BY MED STUDENTS</p>

                        <h1 class="text-4xl sm:text-6xl lg:text-7xl font-extrabold leading-tight mb-8 hero-heading">
                            <span class="text-black">STUDY SMARTER</span> <br class="hidden sm:block">
                            <span class="text-brand-blue">FOR YOUR EXAMS</span>
                        </h1>

                        <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4 hero-buttons">
                            <button class="bg-brand-blue text-white font-bold py-3 px-6 rounded-xl hover:shadow-lg transition transform hover:scale-105 shadow-lg whitespace-nowrap oswald-btn">
                                SHOP ALL GUIDES
                            </button>
                            <button class="bg-white text-gray-900 font-bold py-3 px-6 rounded-xl border-2 border-brand-blue hover:bg-gray-50 transition transform hover:scale-105 shadow-md whitespace-nowrap mt-4 sm:mt-0 oswald-btn">
                                FREE RESOURCES
                            </button>
                        </div>
                    </div>
                </main>

                <section class="container mx-auto px-4 sm:px-6 lg:px-8 py-12 animate-on-scroll" id="top-resources-section">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-10">
                        <h2 class="text-3xl sm:text-4xl font-extrabold text-gray-900 mb-4 sm:mb-0">TOP RESOURCES</h2>
                        <div class="flex space-x-4 text-sm font-semibold text-gray-600" id="product-filters">
                            <a href="#" data-filter="all" class="filter-link text-brand-red font-bold border-b-2 border-brand-red pb-1" onclick="setFilter('all', event)">ALL</a>
                            <a href="#" data-filter="mbbs1" class="filter-link hover:text-brand-red pb-1" onclick="setFilter('mbbs1', event)">MBBS-I</a>
                            <a href="#" data-filter="mbbs2" class="filter-link hover:text-brand-red pb-1" onclick="setFilter('mbbs2', event)">MBBS-II</a>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 md:grid-cols-4 gap-6 lg:gap-8" id="product-grid">
                    </div>
                </section>
                
                <section class="container mx-auto px-4 sm:px-6 lg:px-8 py-12 animate-on-scroll">
                    <h2 class="text-3xl sm:text-4xl font-extrabold text-center text-gray-900 mb-8 oswald-font">FEATURES</h2>
                    <div class="max-w-4xl mx-auto">
                        <ul class="feature-list grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-x-8 gap-y-2 text-center sm:text-left">
                            <li class="feature-item"><span class="feature-bullet"></span><span class="feature-text">UHS LO-Oriented</span></li>
                            <li class="feature-item"><span class="feature-bullet"></span><span class="feature-text">Based on UHS Books</span></li>
                            <li class="feature-item"><span class="feature-bullet"></span><span class="feature-text">Clear Flowcharts</span></li>
                            <li class="feature-item"><span class="feature-bullet"></span><span class="feature-text">Detailed Illustrations</span></li>
                            <li class="feature-item"><span class="feature-bullet"></span><span class="feature-text">Easy Mnemonics</span></li>
                            <li class="feature-item"><span class="feature-bullet"></span><span class="feature-text">UHS Past Papers</span></li>
                            <li class="feature-item"><span class="feature-bullet"></span><span class="feature-text">QR Code Quizzes</span></li>
                            <li class="feature-item"><span class="feature-bullet"></span><span class="feature-text">OSPE-focused Material</span></li>
                        </ul>
                    </div>
                </section>
                <section class="custom-blue-bg py-12 animate-on-scroll">
                    <div class="container mx-auto px-4 sm:px-6 lg:px-8 relative">
                        <h2 class="text-4xl sm:text-5xl font-extrabold text-center text-gray-900 mb-12">
                            SEE WHAT STUDENTS SAY
                        </h2>

                        <div class="relative overflow-hidden">
                            <div id="testimonial-carousel" class="flex transition-transform duration-500 ease-in-out">
                                <div class="carousel-item p-4 flex-shrink-0 w-full md:w-1/3">
                                    <div class="bg-white p-6 rounded-3xl shadow-lg hover:shadow-xl transition flex flex-col h-full">
                                        <div class="flex items-center mb-4">
                                            <div class="w-12 h-12 rounded-full bg-gray-300 mr-4 overflow-hidden">
                                                <img src="https://placehold.co/48x48/666666/FFFFFF?text=AS" alt="Student 1" class="placeholder-img">
                                            </div>
                                            <div>
                                                <p class="font-bold text-gray-900">STUDENT</p>
                                                <p class="text-xs text-gray-500">Allama Iqbal Medical College, MS-I</p>
                                            </div>
                                        </div>
                                        <p class="text-gray-700 leading-relaxed text-sm">
                                            "A wholesome experience with these flashcards. Received the order on time, and today read the first flashcard of pathology, and I didn't even need to cram it. It just has imprinted in my mind with mnemonics and the pictorial presentation. Totally worth it. I hope you guys launch it for block 3 as well."
                                        </p>
                                    </div>
                                </div>

                                <div class="carousel-item p-4 flex-shrink-0 w-full md:w-1/3">
                                    <div class="bg-white p-6 rounded-3xl shadow-lg hover:shadow-xl transition flex flex-col h-full">
                                        <div class="flex items-center mb-4">
                                            <div class="w-12 h-12 rounded-full bg-gray-300 mr-4 overflow-hidden">
                                                <img src="https://placehold.co/48x48/666666/FFFFFF?text=AA" alt="Student 2" class="placeholder-img">
                                            </div>
                                            <div>
                                                <p class="font-bold text-gray-900">STUDENT</p>
                                                <p class="text-xs text-gray-500">Allama Iqbal Medical College, MS-II</p>
                                            </div>
                                        </div>
                                        <p class="text-gray-700 leading-relaxed text-sm">
                                            "Thank you so much for creating such an amazing study resource for our minor subjects! I'd love it if you could make books for other blocks too, they'd be super helpful!"
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="absolute inset-y-0 left-0 flex items-center">
                            <button id="prev-btn" class="bg-white p-2 rounded-full shadow-md text-gray-800 hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                                </svg>
                            </button>
                        </div>
                        <div class="absolute inset-y-0 right-0 flex items-center">
                            <button id="next-btn" class="bg-white p-2 rounded-full shadow-md text-gray-800 hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                </section>

                <footer class="bg-gray-800 text-white py-6 mt-8">
                    <div class="container mx-auto px-4 text-center text-sm">
                        <p class="mb-1">&copy; 2025 MODMEDICALIS All rights reserved</p>
                        <p>Developed by Muhammad Hasnain MS-II — AIMC</p>
                    </div>
                </footer>
            `;
            // Re-bind event listeners for the newly created elements
            const productCards = document.querySelectorAll('#product-grid .product-card');
            productCards.forEach(card => {
                card.addEventListener('click', (e) => {
                    const productId = e.currentTarget.dataset.productId;
                    openProductPage(productId);
                });
            });
            // Re-apply the filter
            setFilter(currentFilter, { preventDefault: () => {} });
        }

        // --- Product Page Rendering ---
        function openProductPage(productId) {
            const product = getProductById(productId);
            if (!product) {
                return;
            }

            const productModal = document.getElementById('product-modal');
            const modalContent = document.getElementById('product-modal-content');

            modalContent.innerHTML = `
                <div class="flex flex-col h-full relative">
                    <button onclick="closeProductPage()" class="product-modal-close-btn text-gray-500 hover:text-brand-red transition p-2 rounded-full z-20">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                        </svg>
                    </button>
                    <div class="flex-grow overflow-y-auto pb-12">
                        <div class="w-full relative">
                            <div class="w-full h-72 sm:h-96 overflow-hidden bg-gray-100 relative">
                                <div id="product-carousel" class="flex transition-transform duration-500 ease-in-out h-full w-full">
                                    ${product.carouselImages.map(imgSrc => `
                                        <div class="flex-shrink-0 w-full h-full">
                                            <img src="${imgSrc}" alt="${product.name}" class="w-full h-full object-contain">
                                        </div>
                                    `).join('')}
                                </div>
                                <div class="absolute inset-x-0 bottom-4 flex justify-center space-x-2">
                                    ${product.carouselImages.map((_, index) => `
                                        <button class="carousel-dot w-3 h-3 rounded-full bg-gray-300 hover:bg-gray-500 transition-colors duration-200" data-index="${index}"></button>
                                    `).join('')}
                                </div>
                            </div>
                        </div>

                        <div class="p-6">
                            <h1 class="text-3xl font-extrabold text-gray-900 mb-4 oswald-font">${product.name}</h1>
                            <p class="text-lg font-bold text-brand-red mb-4">${formatPrice(product.price)}
                                ${product.originalPrice ? `<span class="text-gray-400 line-through text-sm font-normal ml-2">${formatPrice(product.originalPrice)}</span>` : ''}
                            </p>
                            <p class="text-gray-700 leading-relaxed mb-6">
                                ${product.description}
                            </p>
                            <div class="grid grid-cols-2 gap-4">
                                <button onclick="addToCartAndShowCart('${product.id}')" class="bg-brand-red text-white font-bold py-3 px-4 rounded-xl oswald-btn transition transform hover:scale-105 shadow-lg whitespace-nowrap">
                                    ADD TO CART
                                </button>
                                <button class="bg-white text-gray-900 font-bold py-3 px-4 rounded-xl border-2 border-brand-red oswald-btn transition transform hover:bg-gray-50 hover:scale-105 whitespace-nowrap">
                                    FREE PREVIEW
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            productModal.classList.remove('is-hidden');
            document.body.style.overflow = 'hidden';

            // Use rAF for immediate transition start
            requestAnimationFrame(() => {
                productModal.classList.add('is-visible');
            });
            
            initCarousel();
        }

        function closeProductPage() {
            const productModal = document.getElementById('product-modal');
            productModal.classList.remove('is-visible');
            document.body.style.overflow = '';
            setTimeout(() => {
                productModal.classList.add('is-hidden');
            }, 300);
        }

        function initCarousel() {
            const carousel = document.getElementById('product-carousel');
            const dotsContainer = document.querySelector('.absolute.bottom-4');
            if (!carousel || !dotsContainer) return;

            const totalImages = carousel.children.length;
            let currentImageIndex = 0;
            let intervalId;

            const updateCarousel = () => {
                const translateXValue = -currentImageIndex * 100;
                carousel.style.transform = `translateX(${translateXValue}%)`;

                document.querySelectorAll('.carousel-dot').forEach((dot, index) => {
                    if (index === currentImageIndex) {
                        dot.classList.add('bg-gray-800');
                        dot.classList.remove('bg-gray-300');
                    } else {
                        dot.classList.add('bg-gray-300');
                        dot.classList.remove('bg-gray-800');
                    }
                });
            };

            const startAutoScroll = () => {
                clearInterval(intervalId); // Clear any existing interval
                intervalId = setInterval(() => {
                    currentImageIndex = (currentImageIndex + 1) % totalImages;
                    updateCarousel();
                }, 3000); // Change image every 3 seconds
            };

            // Event listener for dot navigation
            dotsContainer.addEventListener('click', (e) => {
                if (e.target.classList.contains('carousel-dot')) {
                    const index = parseInt(e.target.dataset.index, 10);
                    currentImageIndex = index;
                    updateCarousel();
                    startAutoScroll(); // Restart the timer
                }
            });

            // Handle touch/mouse events for manual swipe (optional, but good for UX)
            let startX = 0;
            let endX = 0;
            carousel.addEventListener('mousedown', (e) => {
                startX = e.pageX;
            });
            carousel.addEventListener('mouseup', (e) => {
                endX = e.pageX;
                if (startX - endX > 50) {
                    // Swiped left
                    currentImageIndex = (currentImageIndex + 1) % totalImages;
                } else if (endX - startX > 50) {
                    // Swiped right
                    currentImageIndex = (currentImageIndex - 1 + totalImages) % totalImages;
                }
                updateCarousel();
                startAutoScroll();
            });

            updateCarousel(); // Initial call
            startAutoScroll(); // Start the auto-scroll
        }

        // Renamed and updated function to add to cart and show cart
        function addToCartAndShowCart(productId) {
            addToCart(productId);
            document.getElementById('cart-modal').classList.remove('hidden');
            document.getElementById('cart-sidebar').classList.remove('translate-x-full');
        }

        // --- Product Filtering Functions ---

        /**
         * Renders a single product card HTML string.
         * @param {object} product - The product object.
         * @returns {string} The HTML string for the product card.
         */
        function renderProductCard(product) {
            let color = '909090'; // Default placeholder color
            if (product.category === 'mbbs1') color = '70A0F0';
            else if (product.category === 'mbbs2') color = 'FFAA44';

            const priceDisplay = product.status === 'sale'
                ? `<p class="oswald-font text-lg font-bold text-brand-red">${formatPrice(product.price)} <span class="text-gray-400 line-through text-sm font-normal ml-2">${formatPrice(product.originalPrice)}</span></p>`
                : product.status === 'available'
                ? `<p class="oswald-font text-lg font-bold text-brand-red">${formatPrice(product.price)}</p>`
                : `<p class="oswald-font text-lg font-bold text-gray-500">COMING SOON</p>`;

            const buttonHtml = product.status === 'available' || product.status === 'sale'
                ? `<button onclick="addToCartAndShowCart('${product.id}')" class="mt-2 w-full bg-brand-blue oswald-btn text-white font-semibold py-2 rounded-lg text-sm hover:scale-[1.02] transition shadow-md">Add to Cart</button>`
                : `<button disabled class="mt-2 w-full bg-gray-300 oswald-btn text-gray-600 font-semibold py-2 rounded-lg text-sm cursor-not-allowed">Coming Soon</button>`;

            const tagHtml = product.status === 'coming-soon' ? '<span class="absolute top-0 left-0 bg-brand-blue text-white text-xs font-bold px-3 py-1 rounded-br-lg z-10">NEW</span>'
                : product.status === 'sale' ? '<span class="absolute top-0 left-0 bg-brand-red text-white text-xs font-bold px-3 py-1 rounded-br-lg z-10">SALE</span>'
                : '';

            const imageSrc = product.img || `https://placehold.co/300x400/${color}/FFFFFF?text=${product.name.replace(/ /g, '+')}`;

            return `
                <div class="group relative bg-white rounded-xl overflow-hidden p-3 transition hover:shadow-lg cursor-pointer product-card" data-product-id="${product.id}">
                    ${tagHtml}
                    <div class="block">
                        <div class="h-48 sm:h-64 bg-gray-100 rounded-xl overflow-hidden mb-4 relative">
                            <img src="${imageSrc}" alt="${product.name}" class="placeholder-img">
                        </div>
                    </div>
                    <div class="block">
                         <p class="text-sm font-semibold text-gray-900 mb-1 leading-snug oswald-font hover:underline">${product.name}</p>
                    </div>
                    <p class="text-xs font-bold text-brand-red uppercase mb-1 oswald-font">${product.category.toUpperCase()}</p>
                    <div class="flex text-yellow-500 mb-2 text-xs">
                        <span>&#9733;</span><span>&#9733;</span><span>&#9733;</span><span>&#9733;</span><span>&#9733;</span>
                    </div>
                    ${priceDisplay}
                    ${buttonHtml}
                </div>
            `;
        }

        /**
         * Filters products and updates the display grid.
         * @param {string} filter - The active filter slug ('all', 'mbbs1', 'mbbs2').
         */
        function renderProducts(filter) {
            const grid = document.getElementById('product-grid');
            grid.innerHTML = '';
            currentFilter = filter;

            const filteredProducts = products.filter(product => {
                if (filter === 'all') {
                    return true;
                }
                return product.category === filter;
            });

            if (filteredProducts.length === 0) {
                 grid.innerHTML = `<div class="col-span-4 text-center py-12 text-gray-500 text-lg">No products found in the selected category.</div>`;
            } else {
                filteredProducts.forEach(product => {
                    grid.insertAdjacentHTML('beforeend', renderProductCard(product));
                });
            }

            // FIX: Re-bind event listeners for the newly created elements after the grid is populated
            const productCards = document.querySelectorAll('#product-grid .product-card');
            productCards.forEach(card => {
                card.addEventListener('click', (e) => {
                    const productId = e.currentTarget.dataset.productId;
                    openProductPage(productId);
                });
            });
        }

        /**
         * Sets the active filter and updates the UI.
         * @param {string} filter - The category slug.
         * @param {Event} event - The click event to prevent default link behavior.
         */
        function setFilter(filter, event) {
            event.preventDefault();
            const filterLinks = document.querySelectorAll('#product-filters .filter-link');
            filterLinks.forEach(link => {
                link.classList.remove('text-brand-red', 'font-bold', 'border-b-2', 'border-brand-red');
                link.classList.add('text-gray-600', 'hover:text-brand-red');
            });

            const activeFilterLink = document.querySelector(`#product-filters .filter-link[data-filter="${filter}"]`);
            if (activeFilterLink) {
                activeFilterLink.classList.add('text-brand-red', 'font-bold', 'border-b-2', 'border-brand-red');
                activeFilterLink.classList.remove('text-gray-600', 'hover:text-brand-red');
            }
            renderProducts(filter);
        }

        // --- Cart Operations ---
        function updateCartUI() {
            const container = document.getElementById('cart-items-container');
            const subtotalEl = document.getElementById('cart-subtotal');
            const countEl = document.getElementById('cart-count');
            const checkoutBtn = document.getElementById('checkout-button');
            let subtotal = 0;
            let totalItems = 0;
            container.innerHTML = '';

            if (cart.length === 0) {
                container.innerHTML = `<p class="text-center text-gray-500 mt-8">Your cart is empty.</p>`;
                subtotalEl.textContent = formatPrice(0);
                countEl.textContent = '0';
                checkoutBtn.disabled = true;
            } else {
                cart.forEach(item => {
                    const product = getProductById(item.id);
                    if (!product) return;
                    const itemTotal = product.price * item.quantity;
                    totalItems += item.quantity;
                    subtotal += itemTotal;

                    const imageSrc = product.img || `https://placehold.co/64x64/CCCCCC/333333?text=${product.name.replace(/ /g, '+')}`;

                    const cartItemHTML = `
                        <div class="flex items-start justify-between border-b border-gray-100 pb-4 pt-4">
                            <div class="flex space-x-3">
                                <div class="w-16 h-16 bg-gray-200 rounded-lg flex-shrink-0 overflow-hidden">
                                    <img src="${imageSrc}" alt="${product.name}" class="placeholder-img">
                                </div>
                                <div class="flex flex-col">
                                    <p class="font-semibold text-sm line-clamp-2 text-gray-800">${product.name}</p>
                                    <p class="text-xs text-gray-500">${formatPrice(product.price)} each</p>
                                    <button onclick="removeFromCart('${product.id}')" class="text-xs text-brand-red text-left mt-1 hover:opacity-70 transition">Remove</button>
                                </div>
                            </div>
                            <div class="flex flex-col items-end space-y-1">
                                <span class="font-bold text-sm text-gray-900">${formatPrice(itemTotal)}</span>
                                <div class="flex items-center border border-gray-300 rounded-lg">
                                    <button onclick="decreaseQuantity('${product.id}')" class="w-7 h-7 flex items-center justify-center text-gray-700 hover:bg-gray-100 rounded-l-lg disabled:opacity-30 transition" ${item.quantity <= 1 ? 'disabled' : ''}>&minus;</button>
                                    <span class="w-6 text-center text-sm font-medium text-gray-800">${item.quantity}</span>
                                    <button onclick="increaseQuantity('${product.id}')" class="w-7 h-7 flex items-center justify-center text-gray-700 hover:bg-gray-100 rounded-r-lg transition">+</button>
                                </div>
                            </div>
                        </div>
                    `;
                    container.insertAdjacentHTML('beforeend', cartItemHTML);
                });

                subtotalEl.textContent = formatPrice(subtotal);
                countEl.textContent = totalItems.toString();
                checkoutBtn.disabled = false;
            }
        }

        function addToCart(productId) {
            const product = getProductById(productId);
            if (product.status === 'coming-soon') {
                alert('This product is not yet available for purchase.');
                return;
            }

            const existingItem = cart.find(item => item.id === productId);
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({ id: productId, quantity: 1 });
            }
            updateCartUI();
        }

        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            updateCartUI();
        }

        function increaseQuantity(productId) {
            const item = cart.find(i => i.id === productId);
            if (item) {
                item.quantity += 1;
                updateCartUI();
            }
        }

        function decreaseQuantity(productId) {
            const item = cart.find(i => i.id === productId);
            if (item && item.quantity > 1) {
                item.quantity -= 1;
            } else if (item && item.quantity === 1) {
                removeFromCart(productId);
            }
            updateCartUI();
        }

        // --- Checkout Form Logic ---
        function populateColleges() {
            const collegeSelect = document.getElementById('college_select');
            collegeSelect.innerHTML = `<option value="">- Select a College -</option>`;
            medicalColleges.forEach(college => {
                const option = document.createElement('option');
                option.value = college;
                option.textContent = college;
                collegeSelect.appendChild(option);
            });
        }

        function openCheckoutForm() {
            if (cart.length === 0) {
                alert('Your cart is empty. Please add a product to proceed.');
                return;
            }

            // Hide the cart modal
            document.getElementById('cart-modal').classList.add('hidden');
            document.getElementById('cart-sidebar').classList.add('translate-x-full');

            // Show the checkout modal
            const checkoutModal = document.getElementById('checkout-modal');
            const checkoutFormContainer = document.getElementById('checkout-form-container');
            checkoutModal.classList.remove('hidden');
            document.body.classList.add('checkout-modal-open');

            requestAnimationFrame(() => {
                checkoutModal.classList.add('checkout-modal-enter-active');
                checkoutModal.classList.remove('checkout-modal-enter');
                checkoutFormContainer.classList.add('checkout-modal-content-enter-active');
                checkoutFormContainer.classList.remove('checkout-modal-content-enter');
            });

            // Calculate and display total
            let subtotal = cart.reduce((sum, item) => sum + getProductById(item.id).price * item.quantity, 0);
            finalTotal = subtotal;

            document.getElementById('final-total').textContent = formatPrice(finalTotal);
            document.getElementById('summary-product-price').textContent = formatPrice(subtotal);
            document.getElementById('summary-final-total').textContent = formatPrice(finalTotal);

            // Generate and set order number
            const orderNumber = `DRG-${Math.floor(Math.random() * 1000000)}`;
            document.getElementById('order-number-input').value = orderNumber;

            // Update cart summary for form submission
            const cartSummary = cart.map(item => {
                const product = getProductById(item.id);
                return `${product.name} (x${item.quantity}) - ${formatPrice(product.price * item.quantity)}`;
            }).join(', ');
            document.getElementById('cart-summary-input').value = cartSummary;

            document.getElementById('total-price-input').value = finalTotal;
        }

        function closeCheckoutForm() {
            const checkoutModal = document.getElementById('checkout-modal');
            const checkoutFormContainer = document.getElementById('checkout-form-container');

            checkoutModal.classList.add('checkout-modal-leave-to');
            checkoutFormContainer.classList.add('checkout-modal-content-leave-to');

            setTimeout(() => {
                checkoutModal.classList.add('hidden');
                checkoutModal.classList.remove('checkout-modal-leave-to', 'checkout-modal-enter-active');
                checkoutFormContainer.classList.remove('checkout-modal-content-leave-to', 'checkout-modal-content-enter-active');
                document.body.classList.remove('checkout-modal-open');

                // Reset form and UI states
                document.getElementById('checkout-form').reset();
                discountApplied = false;
                document.getElementById('promo-code-container').classList.add('hidden');
                document.getElementById('promo-status').classList.add('hidden');
                document.getElementById('promo-message').textContent = '';
                document.getElementById('confirm-order-btn').disabled = true;
                document.getElementById('final-order-summary').classList.add('hidden');
            }, 300);
        }

        function applyPromoCode() {
            const promoCodeInput = document.getElementById('promo_code');
            const promoStatus = document.getElementById('promo-status');
            const promoMessage = document.getElementById('promo-message');
            const promoCode = promoCodeInput.value.trim().toUpperCase();

            if (promoCode === 'AIMC28' && !discountApplied) {
                const discount = 100;
                finalTotal = finalTotal - discount;
                discountApplied = true;

                document.getElementById('final-total').textContent = formatPrice(finalTotal);
                document.getElementById('summary-discount').textContent = `-${formatPrice(discount)}`;
                document.getElementById('summary-final-total').textContent = formatPrice(finalTotal);

                promoStatus.classList.remove('hidden');
                promoMessage.textContent = 'Promo code applied successfully!';
                promoMessage.classList.remove('text-red-500');
                promoMessage.classList.add('text-green-500');
            } else if (discountApplied) {
                promoMessage.textContent = 'Promo code is already applied.';
                promoMessage.classList.remove('text-green-500');
                promoMessage.classList.add('text-red-500');
            } else {
                promoStatus.classList.add('hidden');
                promoMessage.textContent = 'Invalid promo code.';
                promoMessage.classList.remove('text-green-500');
                promoMessage.classList.add('text-red-500');
            }
        }

        function showThankYouModal(orderNumber) {
            const thankyouModal = document.getElementById('thankyou-modal');
            const thankyouContent = document.getElementById('thankyou-content');

            document.body.classList.add('checkout-modal-open');
            thankyouModal.classList.remove('hidden');

            document.getElementById('thankyou-order-number').textContent = orderNumber;

            const productNames = cart.map(item => {
                const product = getProductById(item.id);
                return `${product.name} (x${item.quantity})`;
            }).join(', ');

            document.getElementById('thankyou-order-details').textContent = productNames;

            // Start the transition
            setTimeout(() => {
                thankyouContent.classList.remove('scale-95', 'opacity-0');
            }, 10);
        }

        // --- Search Modal Logic ---
        function updateSearchUI(query) {
            const suggestionsList = document.getElementById('search-suggestions');
            const productsList = document.getElementById('search-products-list');
            const searchResultInfo = document.getElementById('search-result-info');
            const searchResultText = searchResultInfo.querySelector('span');

            suggestionsList.innerHTML = '';
            productsList.innerHTML = '';

            const lowerCaseQuery = query.toLowerCase();

            const filteredProducts = products.filter(product =>
                product.name.toLowerCase().includes(lowerCaseQuery)
            );

            // Display suggestions
            filteredProducts.forEach(product => {
                const suggestionItem = document.createElement('li');
                suggestionItem.innerHTML = `<a href="#" class="hover:text-brand-red block transition" data-product-id="${product.id}">${product.name}</a>`;
                suggestionsList.appendChild(suggestionItem);
            });

            // Display products
            filteredProducts.forEach(product => {
                const productDiv = document.createElement('div');
                productDiv.classList.add('flex', 'items-center', 'space-x-3', 'cursor-pointer');
                productDiv.setAttribute('data-product-id', product.id);
                const imageSrc = product.img || `https://placehold.co/48x48/CCCCCC/333333?text=${product.name.replace(/ /g, '+')}`;
                productDiv.innerHTML = `
                    <div class="w-12 h-12 bg-gray-200 rounded-lg flex-shrink-0">
                        <img src="${imageSrc}" alt="${product.name}" class="placeholder-img rounded-lg">
                    </div>
                    <span class="font-semibold text-sm">${product.name}</span>
                `;
                productsList.appendChild(productDiv);
            });

            if (lowerCaseQuery.length > 0) {
                 if (filteredProducts.length > 0) {
                    searchResultText.textContent = `Found ${filteredProducts.length} result(s) for "${query}"`;
                    searchResultInfo.classList.remove('hidden');
                } else {
                    searchResultText.textContent = `No results found for "${query}"`;
                    searchResultInfo.classList.remove('hidden');
                    suggestionsList.innerHTML = `<li class="text-gray-500">No suggestions</li>`;
                    productsList.innerHTML = `<div class="text-gray-500 text-sm">No products found.</div>`;
                }
            } else {
                searchResultInfo.classList.add('hidden');
            }
        }

        // --- Smooth Scrolling Function ---
        function scrollToProducts(event) {
            if (event) event.preventDefault();
            const productSection = document.getElementById('top-resources-section');
            if (productSection) {
                productSection.scrollIntoView({ behavior: 'smooth' });
            } else {
                renderHomePage();
            }
        }

        // --- Initialization and Event Listeners ---
        document.addEventListener('DOMContentLoaded', () => {
            renderHomePage();
            updateCartUI();
            populateColleges();

            // --- Mobile Menu Toggles ---
            const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
            const mobileMenu = document.getElementById('mobile-menu');

            mobileMenuToggle.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
                mobileMenu.classList.toggle('active');
            });
            window.addEventListener('resize', () => {
                if (window.innerWidth >= 1024) {
                    mobileMenu.classList.add('hidden');
                    mobileMenu.classList.remove('active');
                }
            });

            // --- Search Modal Toggles ---
            const searchModal = document.getElementById('search-modal');
            const searchModalContent = searchModal.querySelector('div');
            const searchInput = document.getElementById('search-input');
            const searchSuggestions = document.getElementById('search-suggestions');
            const searchProductsList = document.getElementById('search-products-list');

            document.getElementById('search-toggle').addEventListener('click', () => {
                searchModal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
                requestAnimationFrame(() => {
                    searchModal.classList.add('opacity-100');
                    searchModal.classList.remove('opacity-0');
                    searchModalContent.classList.add('translate-y-0', 'opacity-100');
                    searchModalContent.classList.remove('translate-y-4', 'opacity-0');
                    searchInput.focus();
                    updateSearchUI(''); // Initial state when modal opens
                });
            });

            document.getElementById('search-close').addEventListener('click', () => {
                searchModal.classList.add('opacity-0');
                searchModalContent.classList.add('translate-y-4', 'opacity-0');
                searchModalContent.classList.remove('translate-y-0', 'opacity-100');
                document.body.style.overflow = '';
                setTimeout(() => {
                    searchModal.classList.add('hidden');
                    searchInput.value = ''; // Clear search input
                }, 300);
            });

            searchInput.addEventListener('input', (e) => {
                updateSearchUI(e.target.value);
            });

            // Event listener for search suggestions
            searchSuggestions.addEventListener('click', (e) => {
                e.preventDefault();
                const productId = e.target.dataset.productId;
                const productElement = document.querySelector(`[data-product-id="${productId}"]`);
                if (productElement) {
                     productElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                     document.getElementById('search-close').click(); // Close search modal
                }
            });

            // Event listener for product clicks in search results
            searchProductsList.addEventListener('click', (e) => {
                e.preventDefault();
                const productDiv = e.target.closest('[data-product-id]');
                if (productDiv) {
                    const productId = productDiv.dataset.productId;
                    document.getElementById('search-close').click(); // Close search modal
                    setTimeout(() => {
                        openProductPage(productId); // Open product modal
                    }, 300);
                }
            });


            // --- Cart Modal Toggles with Transitions ---
            const cartToggle = document.getElementById('cart-toggle');
            const cartModal = document.getElementById('cart-modal');
            const cartSidebar = document.getElementById('cart-sidebar');
            const cartClose = document.getElementById('cart-close');
            const checkoutBtn = document.getElementById('checkout-button');

            cartToggle.addEventListener('click', () => {
                cartModal.classList.remove('hidden');
                requestAnimationFrame(() => cartSidebar.classList.remove('translate-x-full'));
            });

            cartClose.addEventListener('click', () => {
                cartSidebar.classList.add('translate-x-full');
                setTimeout(() => cartModal.classList.add('hidden'), 300);
            });

            cartModal.addEventListener('click', (e) => {
                if (e.target === cartModal) {
                    cartSidebar.classList.add('translate-x-full');
                    setTimeout(() => cartModal.classList.add('hidden'), 300);
                }
            });

            // --- Checkout Form UI & Logic ---
            checkoutBtn.addEventListener('click', openCheckoutForm);
            document.getElementById('checkout-form-close').addEventListener('click', closeCheckoutForm);

            const collegeSelect = document.getElementById('college_select');
            const promoCodeContainer = document.getElementById('promo-code-container');
            const confirmOrderBtn = document.getElementById('confirm-order-btn');
            const finalOrderSummary = document.getElementById('final-order-summary');
            const paymentSlipInput = document.getElementById('payment_slip');

            collegeSelect.addEventListener('change', (e) => {
                if (e.target.value === 'Allama Iqbal Medical College, Lahore') {
                    promoCodeContainer.classList.remove('hidden');
                } else {
                    promoCodeContainer.classList.add('hidden');
                    // Reset promo state
                    discountApplied = false;
                    let subtotal = cart.reduce((sum, item) => sum + getProductById(item.id).price * item.quantity, 0);
                    finalTotal = subtotal;
                    document.getElementById('final-total').textContent = formatPrice(finalTotal);
                    document.getElementById('summary-discount').textContent = formatPrice(0);
                    document.getElementById('summary-final-total').textContent = formatPrice(finalTotal);
                    document.getElementById('promo-status').classList.add('hidden');
                    document.getElementById('promo-message').textContent = '';
                }
            });

            document.getElementById('apply-promo-btn').addEventListener('click', applyPromoCode);

            paymentSlipInput.addEventListener('change', () => {
                if (paymentSlipInput.files.length > 0) {
                    confirmOrderBtn.disabled = false;
                    finalOrderSummary.classList.remove('hidden');
                } else {
                    confirmOrderBtn.disabled = true;
                    finalOrderSummary.classList.add('hidden');
                }
            });

            // --- Form Submission Logic with FormSubmit ---
            document.getElementById('checkout-form').addEventListener('submit', function(e) {
                e.preventDefault();

                const form = e.target;
                const formData = new FormData(form);

                // Add calculated fields to form data
                formData.append('Subtotal', formatPrice(cart.reduce((sum, item) => sum + getProductById(item.id).price * item.quantity, 0)));
                formData.append('Discount', discountApplied ? formatPrice(100) : formatPrice(0));
                formData.append('Final Total', formatPrice(finalTotal));
                formData.append('Total to Pay', formatPrice(finalTotal));
                formData.append('Shipping Charges', 'To be paid on delivery');
                formData.append('Payment Method', 'EasyPaisa/JazzCash');

                const orderNumber = document.getElementById('order-number-input').value;
                const subject = `New Order #${orderNumber} from Website!`;
                formData.set('_subject', subject);

                // FormSubmit submission
                fetch(form.action, {
                    method: 'POST',
                    body: formData,
                }).then(response => {
                    if (response.ok) {
                         closeCheckoutForm();
                         showThankYouModal(orderNumber);
                         cart = [];
                         updateCartUI();
                    } else {
                        alert('There was an issue submitting your order. Please try again.');
                    }
                }).catch(error => {
                    console.error('Submission error:', error);
                    alert('There was an issue submitting your order. Please try again.');
                });
            });

            // --- Intersection Observer for Scroll Animations ---
            const observerOptions = {
                root: null,
                rootMargin: '0px',
                threshold: 0.1
            };

            const observer = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('show-section');
                        observer.unobserve(entry.target);
                    }
                });
            }, observerOptions);

            document.querySelectorAll('.animate-on-scroll').forEach(section => {
                observer.observe(section);
            });

            // --- Carousel Logic ---
            const carousel = document.getElementById('testimonial-carousel');
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const items = document.querySelectorAll('.carousel-item');
            const totalItems = items.length;
            let currentIndex = 0;

            function updateCarousel() {
                const isMobile = window.innerWidth < 768;
                const itemsToShow = isMobile ? 1 : 3;
                const maxIndex = totalItems - itemsToShow;

                carousel.style.transform = `translateX(-${currentIndex * 100 / itemsToShow}%)`;

                prevBtn.disabled = currentIndex === 0;
                nextBtn.disabled = currentIndex >= maxIndex;
            }

            nextBtn.addEventListener('click', () => {
                const isMobile = window.innerWidth < 768;
                const itemsToShow = isMobile ? 1 : 3;
                const maxIndex = totalItems - itemsToShow;
                if (currentIndex < maxIndex) {
                    currentIndex++;
                    updateCarousel();
                }
            });

            prevBtn.addEventListener('click', () => {
                if (currentIndex > 0) {
                    currentIndex--;
                    updateCarousel();
                }
            });

            window.addEventListener('resize', () => {
                currentIndex = 0; // Reset index on resize to prevent weird positioning
                updateCarousel();
            });

            updateCarousel(); // Initial call to set the correct state
        });
    </script>

</body>
</html>
