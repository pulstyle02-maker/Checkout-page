<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ModMedicalis | Let the visuals speak</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLMDJd/r7oQ9tTdsLqB81lE1K8j/bNq0lR7a/m4N1zJ3I7Z5n7W2vP0yQ5G7gNl1g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        /* Import Fonts */
        @import url('https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;700&display=swap'); /* New Body Font */
        @import url('https://fonts.googleapis.com/css2?family=Chau+Philomene+One&display=swap'); /* New Heading Font */
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Parisienne&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Lilita+One&display=swap');
        
        /* Custom font definitions for strong visual style */
        .algerya-sans-sc-font {
            font-family: 'Chau Philomene One', sans-serif; /* Updated font */
            font-weight: 700; 
            letter-spacing: 0.1em;
            text-transform: uppercase; /* Added for all caps */
        }

        @keyframes gradient-shift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .londrina-solid-font {
            font-family: 'Chau Philomene One', sans-serif; /* Updated font to match main heading */
            font-weight: 700; 
            text-transform: uppercase; /* Added for all caps */
        }

        /* Change main font to Glacial Indifference (using Lexend as a similar alternative) */
        body {
            font-family: 'Lexend', sans-serif;
            background-color: #f8fafc;
            color: #1e293b;
            transition: background-color 0.3s, color 0.3s;
        }
        
        .grid-pattern-bg {
             position: absolute;
             top: 0;
             left: 0;
             width: 100%;
             height: 100%;
             z-index: 1;
             background-image: linear-gradient(to right, rgba(255, 255, 255, 0.2) 2px, transparent 2px),
                               linear-gradient(to bottom, rgba(255, 255, 255, 0.2) 2px, transparent 2px);
             background-size: 40px 40px;
        }
        
        .red-curved-section {
            background-color: #ef4444;
            border-bottom-left-radius: 50px;
            border-bottom-right-radius: 50px;
            position: relative;
            overflow: hidden;
            z-index: 1;
        }
        
        .red-curved-section .content-z {
            position: relative;
            z-index: 10;
        }

        .medical-pattern-svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            opacity: 0.05;
        }
        
        .avail-btn {
            background-color: #1e293b;
            color: white;
            padding: 1rem 2.5rem;
            font-weight: 700;
            border-radius: 1.5rem;
            transition: background-color 0.3s, transform 0.2s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .avail-btn:hover {
            background-color: #334155;
            transform: translateY(-2px);
        }
        
        .top-resources-gradient {
            background: linear-gradient(90deg, #1A5693, #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            color: transparent;
            font-weight: 800;
        }
        
        .filter-text-button {
            position: relative;
            cursor: pointer;
            padding: 0.5rem 1rem;
            font-weight: 700;
            transition: color 0.3s ease;
            padding-bottom: 0.75rem; 
        }
        
        .filter-text-button::after {
            content: '';
            position: absolute;
            left: 50%; 
            bottom: 0;
            height: 3px;
            width: 0;
            background-color: #3b82f6; 
            transition: width 0.3s ease, transform 0.3s ease;
            transform: translateX(-50%);
        }

        .filter-text-button.active {
            color: #3b82f6; 
        }
        
        #filter-buttons-container .filter-text-button.active::after {
             background-color: white !important;
        }

        .filter-text-button.active::after {
            width: 100%;
        }
        
        .review-box-design {
            background-color: white;
            border: 1px solid #e5e7eb;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            border-radius: 1rem; 
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            height: 100%;
        }
        
        .review-box-design:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }
        
        .review-box-design::before {
             content: '';
             position: absolute;
             top: 0;
             left: 0;
             width: 100%;
             height: 4px;
             background-color: #1A5693;
             transform: scaleX(0);
             transform-origin: left;
             transition: transform 0.3s ease;
        }
        
        .review-box-design:hover::before {
            transform: scaleX(1);
        }

        .product-popup-image-container {
            width: 100%;
            padding-top: 125%; 
            position: relative;
            overflow: hidden;
            background-color: #f3f4f6;
        }
        
        .product-popup-image-container img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain; 
        }
        
        .glass-card {
            background-color: #ffffff;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            position: relative;
        }

        .horizontal-scroll-container {
            display: flex;
            overflow-x: scroll;
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch;
            padding-bottom: 1rem;
        }

        .horizontal-scroll-container::-webkit-scrollbar {
            display: none; 
        }
        .horizontal-scroll-container {
            -ms-overflow-style: none;  
            scrollbar-width: none;  
        }

        .product-image-box {
            background-color: #e5e7eb; 
            position: relative;
            height: 9rem; 
            margin-bottom: 0.5rem; 
            cursor: pointer; 
        }
        .product-image-box img {
            object-fit: contain;
            width: 100%;
            height: 100%;
        }
        .product-card-title {
            font-size: 1rem; 
            line-height: 1.2;
            font-weight: 900; 
            text-transform: uppercase;
            cursor: pointer; 
            font-family: 'Chau Philomene One', sans-serif; /* Changed to Chau Philomene One */
            letter-spacing: 0.05em;
        }
        .product-price-main {
            color: #ef4444; 
            font-size: 1.25rem; 
            font-weight: 900;
        }
        .product-price-cut {
            color: #9ca3af; 
            text-decoration: line-through;
            font-size: 0.875rem; 
        }
        .add-to-cart-btn {
            width: 2rem; 
            height: 2rem; 
            font-size: 1.25rem; 
            background-color: #1e293b; 
            color: white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            position: absolute; 
            bottom: 0.75rem; 
            right: 0.75rem; 
        }
        
        .cart-item-card {
            background-color: #fff;
            border: 1px solid #e5e7eb;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        
        @keyframes slideUp {
          from {
            opacity: 0;
            transform: translateY(20px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
        .product-slide-up {
          animation: slideUp 0.4s ease-out forwards;
        }

        .parisienne-font { font-family: 'Parisienne', cursive; font-weight: 400; }
        .playfair-font { font-family: 'Playfair Display', serif; font-weight: 800; }
        .insight-banner-bg { background-image: linear-gradient(to right, #1A5693, #3b82f6); color: #ffffff; }
        .insight-text-yellow { color: #facc15; font-weight: 700; }
        @keyframes floatAndRotate { 0% { transform: translate(0, 0) rotate(0deg); } 33% { transform: translate(10px, -10px) rotate(3deg); } 66% { transform: translate(-8px, 8px) rotate(-2deg); } 100% { transform: translate(0, 0) rotate(0deg); } }
        .dynamic-bg-img { position: absolute; opacity: 0.12; background-size: contain; background-repeat: no-repeat; pointer-events: none; animation: floatAndRotate 20s ease-in-out infinite alternate; }
        .dynamic-bg-img:nth-child(1) { top: 5%; left: 5%; width: 80px; height: 80px; animation-duration: 22s; animation-delay: 0s; } .dynamic-bg-img:nth-child(2) { top: 40%; left: 15%; width: 70px; height: 70px; animation-duration: 25s; animation-delay: 2s; animation-direction: alternate-reverse; } .dynamic-bg-img:nth-child(3) { top: 10%; right: 10%; width: 90px; height: 90px; animation-duration: 18s; animation-delay: 4s; } .dynamic-bg-img:nth-child(4) { bottom: 10%; right: 5%; width: 60px; height: 60px; animation-duration: 20s; animation-delay: 6s; animation-direction: alternate-reverse; } .dynamic-bg-img:nth-child(5) { bottom: 25%; left: 8%; width: 50px; height: 50px; animation-duration: 28s; animation-delay: 8s; } .dynamic-bg-img:nth-child(6) { top: 55%; right: 20%; width: 85px; height: 85px; animation-duration: 23s; animation-delay: 10s; animation-direction: alternate-reverse; } .dynamic-bg-img:nth-child(7) { top: 30%; left: 25%; width: 65px; height: 65px; animation-duration: 24s; animation-delay: 1s; } .dynamic-bg-img:nth-child(8) { top: 70%; left: 5%; width: 75px; height: 75px; animation-duration: 26s; animation-delay: 3s; animation-direction: alternate; } .dynamic-bg-img:nth-child(9) { top: 45%; right: 5%; width: 80px; height: 80px; animation-duration: 19s; animation-delay: 5s; animation-direction: alternate-reverse; } .dynamic-bg-img:nth-child(10) { bottom: 20%; right: 25%; width: 55px; height: 55px; animation-duration: 21s; animation-delay: 7s; } .dynamic-bg-img:nth-child(11) { top: 15%; left: 40%; width: 60px; height: 60px; animation-duration: 29s; animation-delay: 9s; animation-direction: alternate; } .dynamic-bg-img:nth-child(12) { bottom: 5%; left: 35%; width: 70px; height: 70px; animation-duration: 17s; animation-delay: 11s; animation-direction: alternate-reverse; }

        .comparison-container {
            position: relative;
            overflow: hidden;
            padding-top: 75%;
            max-width: 42rem; 
            margin: 0 auto;
            user-select: none;
            cursor: ew-resize;
            border-radius: 1rem; 
        }

        .comparison-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain; 
            transition: clip-path 0.3s ease-out; 
            -webkit-transition: clip-path 0.3s ease-out;
            pointer-events: none; 
        }
        
        .comparison-image.after {
            clip-path: inset(0 0 0 50%); 
            -webkit-clip-path: inset(0 0 0 50%);
        }

        .comparison-line {
            position: absolute;
            top: 0;
            left: 50%; 
            width: 6px; 
            height: 100%;
            background-color: #1A5693;
            transform: translateX(-50%);
            z-index: 20;
            transition: left 0.3s ease-out;
            pointer-events: none;
            border-radius: 9999px;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
        }

        .slider-handle {
            position: absolute;
            top: 50%;
            left: 50%; 
            width: 40px;
            height: 40px;
            background-color: white;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            z-index: 30;
            transition: left 0.3s ease-out;
            pointer-events: none; 
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }
        
        .tilted-overlap-image {
            position: absolute;
            top: -2.5rem;
            right: 0.5rem;
            width: 120px; 
            height: 120px; 
            z-index: 20;
            transform: rotate(10deg);
            object-fit: contain;
            pointer-events: none;
        }
        
        .logo-font {
            font-family: 'Lilita One', cursive;
            background: linear-gradient(90deg, #1A5693, #ef4444);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            color: transparent;
        }
        
        .progress-bar-container {
            width: 100%;
            height: 8px;
            background-color: #e5e7eb;
            border-radius: 4px;
            margin-bottom: 1.5rem;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(to right, #1A5693, #3b82f6);
            border-radius: 4px;
            transition: width 0.5s ease-in-out;
        }
        
        .checkout-step {
            display: none;
        }
        
        .checkout-step.active {
            display: block;
        }
        
        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1.5rem;
            position: relative;
        }
        
        .step-indicator::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            background-color: #e5e7eb;
            transform: translateY(-50%);
            z-index: 1;
        }
        
        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 2;
            position: relative;
            flex: 1;
        }
        
        .step-circle {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #6b7280;
            margin-bottom: 0.5rem;
            transition: all 0.3s ease;
        }
        
        .step.active .step-circle {
            background-color: #1A5693;
            color: white;
        }
        
        .step.completed .step-circle {
            background-color: #10b981;
            color: white;
        }
        
        .step-label {
            font-size: 0.75rem;
            color: #6b7280;
            text-align: center;
        }
        
        .step.active .step-label {
            color: #1A5693;
            font-weight: 600;
        }
        
        .step.completed .step-label {
            color: #10b981;
        }
        
        .checkout-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 1.5rem;
        }
        
        .search-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            max-height: 200px;
            overflow-y: auto;
            z-index: 50;
        }
        
        .search-dropdown-item {
            padding: 0.75rem 1rem;
            cursor: pointer;
            border-bottom: 1px solid #f3f4f6;
            transition: background-color 0.2s;
        }
        
        .search-dropdown-item:hover {
            background-color: #f9fafb;
        }
        
        .search-dropdown-item:last-child {
            border-bottom: none;
        }

        .modern-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 0.75rem;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        .modern-input:focus {
            border-color: #1A5693;
            outline: none;
            box-shadow: 0 0 0 3px rgba(26, 86, 147, 0.2);
        }
        
        @media (prefers-color-scheme: dark) {
            body {
                background-color: #f8fafc !important;
                color: #1e293b !important;
            }
        }
        
        .hero-bg-image {
             background-image: url('https://i.imgur.com/Tnsqxey.jpeg');
             background-size: cover;
             background-position: center;
             opacity: 0.4; 
        }
    </style>
</head>
<body class="min-h-screen antialiased">

    <div class="bg-red-600 text-white text-center py-2 text-xs font-semibold sticky top-0 z-50 algerya-sans-sc-font text-base tracking-widest">
        MIND YOUR MINORS BLOCK 6 HAS BEEN LAUNCHED
    </div>

    <header class="bg-white shadow-lg sticky top-8 md:top-0 z-40">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-14 sm:h-16">
                <a href="#" id="home-logo-link" class="flex-shrink-0 flex items-center">
                    <img src="https://i.imgur.com/R8x4icz.png" alt="ModMedicalis Logo" class="h-10 sm:h-12 w-auto rounded-lg">
                </a>
                
                <nav class="hidden md:flex items-center space-x-6">
                    <div class="relative">
                        <input type="text" id="search-input" placeholder="Search products..." class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-[#1A5693] focus:border-[#1A5693] w-64">
                        <button id="search-button" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-600 hover:text-[#1A5693]">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
                        </button>
                        <div id="search-dropdown" class="search-dropdown hidden"></div>
                    </div>
                    <button id="desktop-cart-button" class="relative text-gray-600 hover:text-[#1A5693] transition duration-150">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-shopping-cart"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.38a2 2 0 0 0 1.84-1.11L22 7H4"/></svg>
                        <span id="desktop-cart-count" class="absolute -top-1 -right-1 inline-flex items-center justify-center px-2 py-0.5 text-xs font-bold leading-none text-white transform translate-x-1/2 -translate-y-1/2 bg-[#1A5693] rounded-full">0</span>
                    </button>
                </nav>

                <div class="flex items-center md:hidden space-x-4">
                    <button id="mobile-cart-button" class="relative text-gray-600 hover:text-[#1A5693] transition duration-150">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-shopping-cart"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.38a2 2 0 0 0 1.84-1.11L22 7H4"/></svg>
                        <span id="mobile-cart-count" class="absolute -top-1 -right-1 inline-flex items-center justify-center px-2 py-0.5 text-xs font-bold leading-none text-white transform translate-x-1/2 -translate-y-1/2 bg-[#1A5693] rounded-full">0</span>
                    </button>
                    <button id="mobile-menu-button" class="text-gray-600 hover:text-[#1A5693]">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-menu"><line x1="4" x2="20" y1="12"y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>
                    </button>
                </div>
            </div>
        </div>
        <div id="mobile-menu" class="hidden md:hidden bg-white border-t border-gray-100">
            <div class="px-4 py-3 space-y-2">
                <div class="relative w-full">
                    <input type="text" id="mobile-search-input" placeholder="Search products..." class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-[#1A5693] focus:border-[#1A5693]">
                    <button id="mobile-search-button" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-600 hover:text-[#1A5693]">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
                    </button>
                    <div id="mobile-search-dropdown" class="search-dropdown hidden"></div>
                </div>
            </div>
        </div>
    </header>

    <main>
        <section class="pt-6 pb-12 sm:pt-6 sm:pb-16 bg-[#E0F4FF] relative overflow-hidden">
            <div class="absolute inset-0 z-0 hero-bg-image"></div>
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center relative z-10">
                <h1 class="text-3xl sm:text-6xl font-extrabold tracking-tight mb-4 algerya-sans-sc-font">
                    <span class="text-3xl sm:text-6xl text-gray-700 font-normal">WHEN THE WORDS GET DULL</span>
                    <div class="text-[#1A5693] text-5xl sm:text-7xl mt-1 mb-3 londrina-solid-font">
                        LET THE <span class="text-red-600">VISUALS</span> SPEAK!
                    </div>
                </h1>
                <div class="flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-4"></div>
            </div>
        </section>

        <section id="notes" class="py-12 sm:py-20 mx-0 mt-8 mb-4 shadow-2xl bg-red-600 relative overflow-hidden">
            <div class="grid-pattern-bg"></div>
            <img src="https://i.imgur.com/QRYh6HS.png" alt="Medical Diagram" class="tilted-overlap-image">
             <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center relative z-30">
                 <h2 class="text-2xl sm:text-4xl font-bold mb-4 text-white algerya-sans-sc-font">TOP RESOURCES</h2>
                 <div id="filter-buttons-container" class="flex justify-center space-x-6 mb-8">
                    <span id="filter-all" data-year="all" class="filter-text-button active text-base text-white" style="color: white;">ALL</span> 
                    <span id="filter-1st" data-year="1" class="filter-text-button text-base text-gray-300">1st Year</span>
                    <span id="filter-2nd" data-year="2" class="filter-text-button text-base text-gray-300">2nd Year</span>
                 </div>
                 <div id="product-container" class="horizontal-scroll-container">
                    <div class="glass-card snap-center flex-shrink-0 w-48 p-3 rounded-xl text-center product-card mr-3" data-year="1" data-product-id="1">
                        <div class="product-image-box rounded-lg flex items-center justify-center product-trigger" data-product-id="1">
                            <img src="https://i.imgur.com/c4XSHmA.jpeg" alt="Block 2 Flashcards" class="rounded-lg">
                        </div>
                        <h3 class="product-card-title text-gray-900 mb-0.5 product-trigger" data-product-id="1">BLOCK 2 FLASHCARDS</h3>
                        <div class="flex flex-col items-center justify-center space-y-0.5">
                            <span class="product-price-cut text-xs">Rs. 1100 (pkr)</span>
                            <span class="product-price-main">Rs. 900</span>
                        </div>
                        <button class="add-to-cart-btn rounded-full flex items-center justify-center" data-product-id="1">
                            <span class="text-xl font-light leading-none">+</span>
                        </button>
                    </div>
                    <div class="glass-card snap-center flex-shrink-0 w-48 p-3 rounded-xl text-center product-card mr-3" data-year="2" data-product-id="2">
                        <div class="product-image-box rounded-lg flex items-center justify-center product-trigger" data-product-id="2">
                            <img src="https://i.imgur.com/mTnWoeB.png" alt="Mind Your Minors Block 5" class="rounded-lg">
                            <span class="absolute top-1 left-1 text-xs font-bold text-white bg-blue-500 px-2 py-0.5 rounded-full shadow-md">BEST VALUE</span>
                        </div>
                        <h3 class="product-card-title text-gray-900 mb-0.5 product-trigger" data-product-id="2">MIND YOUR MINORS - BLOCK 5</h3>
                        <div class="flex flex-col items-center justify-center space-y-0.5">
                            <span class="product-price-main">Rs. 500</span>
                        </div>
                        <button class="add-to-cart-btn rounded-full flex items-center justify-center" data-product-id="2">
                            <span class="text-xl font-light leading-none">+</span>
                        </button>
                    </div>
                    <div class="glass-card snap-center flex-shrink-0 w-48 p-3 rounded-xl text-center product-card mr-3" data-year="2" data-product-id="3">
                        <div class="product-image-box rounded-lg flex items-center justify-center product-trigger" data-product-id="3">
                             <img src="https://i.imgur.com/wLiYfOr.jpeg" alt="Mind Your Minors Block 6" class="rounded-lg">
                             <span class="absolute top-1 left-1 text-xs font-bold text-white bg-red-600 px-2 py-0.5 rounded-full shadow-md">NEW!</span>
                        </div>
                        <h3 class="product-card-title text-gray-900 mb-0.5 product-trigger" data-product-id="3">MIND YOUR MINORS - BLOCK 6</h3>
                        <div class="flex flex-col items-center justify-center space-y-0.5 mt-2">
                             <span class="product-price-main">Rs. 700</span>
                        </div>
                        <button class="add-to-cart-btn rounded-full flex items-center justify-center" data-product-id="3">
                            <span class="text-xl font-light leading-none">+</span>
                        </button>
                    </div>
                 </div>
             </div>
        </section>
        
        <section class="pt-6 pb-0 sm:pt-8 sm:pb-0" style="background-color: #E0F4FF;">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <h2 class="text-2xl sm:text-4xl font-extrabold text-center mb-8 text-gray-900 algerya-sans-sc-font">
                    <span class="text-black">TRUSTED BY THE </span><span style="color: #00A5E3;">STUDENTS FROM 10+</span><span class="text-black"> MEDSCHOOLS</span>
                </h2>
                <div class="horizontal-scroll-container pb-0 space-x-4">
                    <div class="snap-center flex-shrink-0 w-72 sm:w-80 p-5 review-box-design">
                        <div class="flex items-center space-x-1 text-yellow-500 text-base mb-2">
                            <span>⭐️</span><span>⭐️</span><span>⭐️</span><span>⭐️</span><span>⭐️</span>
                        </div>
                        <p class="italic text-gray-700 mb-3 text-sm leading-relaxed">"your FLASHCARDS are super effective and a lifesaver indeed...really admire your efforts behind these &lt;3 BIG thanks for the mnemonics !!"</p>
                        <div class="font-bold text-gray-900 text-sm">MBBS Student</div>
                        <div class="text-xs text-gray-500">1st year MBBS student AIMC</div>
                    </div>
                    <div class="snap-center flex-shrink-0 w-72 sm:w-80 p-5 review-box-design">
                        <div class="flex items-center space-x-1 text-yellow-500 text-base mb-2">
                            <span>⭐️</span><span>⭐️</span><span>⭐️</span><span>⭐️</span><span>⭐️</span>
                        </div>
                        <p class="italic text-gray-700 mb-3 text-sm leading-relaxed">"Mind your minors is literally a v good initiative. The illustrations are quite appealing and all the minors being covered in a book with past ppr questions is cherry on top.... The quality of book is great. Thank yuh so much for your kind efforts"</p>
                        <div class="font-bold text-gray-900 text-sm">MBBS Student</div>
                        <div class="text-xs text-gray-500">2nd year MBBS student AIMC</div>
                    </div>
                    <div class="snap-center flex-shrink-0 w-72 sm:w-80 p-5 review-box-design">
                        <div class="flex items-center space-x-1 text-yellow-500 text-base mb-2">
                            <span>⭐️</span><span>⭐️</span><span>⭐️</span><span>⭐️</span>
                        </div>
                        <p class="italic text-gray-700 mb-3 text-sm leading-relaxed">"9.5/10. The idea, the design, the packaging and a good initiative for helping students achieve marks in minor subjects. Near to perfect. May ALLAH grant you with great success and fulfil your desires. Ameen"</p>
                        <div class="font-bold text-gray-900 text-sm">Hamza</div>
                        <div class="text-xs text-gray-500">1st year central park medical college</div>
                    </div>
                    <div class="snap-center flex-shrink-0 w-72 sm:w-80 p-5 review-box-design">
                        <div class="flex items-center space-x-1 text-yellow-500 text-base mb-2">
                            <span>⭐️</span><span>⭐️</span><span>⭐️</span><span>⭐️</span><span>⭐️</span>
                        </div>
                        <p class="italic text-gray-700 mb-3 text-sm leading-relaxed">"AJ ke assessment mein pharmacology ke all 3 LOS THAY and 9 MCQS THAY ALL COVERED FROM FLASHCARDS"</p>
                        <div class="font-bold text-gray-900 text-sm">Abd-ur-Rehman</div>
                        <div class="text-xs text-gray-500">1st year MBBS Sialkot medical college</div>
                    </div>
                    <div class="snap-center flex-shrink-0 w-72 sm:w-80 p-5 review-box-design">
                        <div class="flex items-center space-x-1 text-yellow-500 text-base mb-2">
                            <span>⭐️</span><span>⭐️</span><span>⭐️</span><span>⭐️</span><span>⭐️</span>
                        </div>
                        <p class="italic text-gray-700 mb-3 text-sm leading-relaxed">"For the first time in my life i have recieved a book in this packaging ... and everything is on top notch ... quality over everything More powers to you guys"</p>
                        <div class="font-bold text-gray-900 text-sm">Meerab Murtaza</div>
                        <div class="text-xs text-gray-500">2nd year MBBS AIMC</div>
                    </div>
                </div>
            </div>
        </section>
        
        <section id="new-comparison-image" class="pt-0 pb-6 sm:pb-8 bg-[#E0F4FF]">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
                <div class="max-w-4xl mx-auto rounded-xl shadow-none overflow-hidden"> 
                    <img src="https://i.imgur.com/HFxNvsE.png" alt="Mind Your Minors Book Example" class="w-full h-auto object-cover">
                </div>
            </div>
        </section>

        <section class="py-12 sm:py-20 red-curved-section mb-4">
            <svg class="medical-pattern-svg" viewBox="0 0 100 100" preserveAspectRatio="none" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <pattern id="medicalPattern" patternUnits="userSpaceOnUse" width="20" height="20">
                        <path d="M 10 0 L 10 20 M 0 10 L 20 10" stroke="#fef2f2" stroke-width="1.5" />
                        <path d="M 5 5 Q 10 0 15 5 Q 20 10 15 15 Q 10 20 5 15" fill="none" stroke="#fef2f2" stroke-width="0.5" />
                        <path d="M 0 12 L 5 12 L 7 8 L 9 16 L 11 8 L 13 12 L 20 12" fill="none" stroke="#fef2f2" stroke-width="0.25" />
                    </pattern>
                </defs>
                <rect width="100%" height="100%" fill="url(#medicalPattern)" />
            </svg>
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center content-z">
                <h2 class="text-4xl sm:text-6xl font-extrabold text-white algerya-sans-sc-font">FREE RESOURCES</h2>
                <a href="https://modmedicalis.online/FREE-RESOURCES" class="avail-btn">CLICK TO AVAIL</a>
                <p class="text-white text-opacity-80 mt-4 text-sm font-medium">Flashcards, Quizzes, Past Papers and UHS Notes</p>
            </div>
        </section>
        
        <section class="py-12 sm:py-20 bg-[#E0F4FF] border-t border-gray-200">
            <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
                <h2 class="text-2xl sm:text-4xl font-extrabold text-center mb-10 text-gray-900 algerya-sans-sc-font">
                    <span style="color: black;">MESSAGE FROM THE </span> <span style="color: #00A5E3;">FOUNDER</span>
                </h2>
                <div class="p-6 sm:p-8 bg-white rounded-xl shadow-2xl border-t-0">
                    <p class="italic text-gray-700 mb-6 text-base leading-relaxed">Mind Your Minors was born from the real struggles of every medical student; endless notes, massive books, and not enough time. We wanted to change the way students learn, making it smarter, simpler, and more visual. Each page blends clarity with creativity, turning complex topics into quick, memorable insights. Designed by students who've been in your shoes, this book makes learning the minor subjects not a burden, but a breakthrough in your MBBS journey.</p>
                    <div class="flex items-center justify-end space-x-4 pt-4 border-t border-gray-100">
                        <div class="text-right">
                            <p class="font-bold text-lg text-gray-900">Muhammad Hasnain</p>
                            <p class="text-sm text-[#1A5693] font-semibold">Founder, ModMedicalis</p>
                        </div>
                        <img src="https://i.imgur.com/2y4pFZW.jpeg" alt="Founder's Photo" class="h-16 w-16 rounded-full object-cover ring-2 ring-[#1A5693] p-0.5">
                    </div>
                </div>
            </div>
        </section>
        
        <section class="py-12 sm:py-20 bg-white border-t border-gray-100">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <h2 class="text-2xl sm:text-4xl font-extrabold text-center mb-12 text-gray-900 algerya-sans-sc-font">
                    <span class="text-[#1A5693]">OUR</span> TEAM
                </h2>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-6 sm:gap-8">
                    <div class="flex flex-col items-center text-center p-0 bg-white rounded-none shadow-none border-none transition duration-300">
                        <img src="https://i.imgur.com/2y4pFZW.jpeg" alt="Muhammad Hasnain Photo" class="h-28 w-28 rounded-full object-cover mb-4 border-none shadow-none">
                        <p class="font-bold text-lg text-gray-900">Muhammad Hasnain</p>
                        <p class="text-sm text-red-600 font-semibold">Founder | Developer</p>
                        <p class="text-xs text-gray-500 mt-1">MS-II (AIMC)</p>
                    </div>
                    <div class="flex flex-col items-center text-center p-0 bg-white rounded-none shadow-none border-none transition duration-300">
                        <img src="https://i.imgur.com/RbGRiTF.jpeg" alt="Hamza Masood Gondal Photo" class="h-28 w-28 rounded-full object-cover mb-4 border-none shadow-none">
                        <p class="font-bold text-lg text-gray-900">Hamza Masood Gondal</p>
                        <p class="text-sm text-red-600 font-semibold">Co-Founder | Top Position Holder</p>
                        <p class="text-xs text-gray-500 mt-1">MS-II (AIMC)</p>
                    </div>
                    <div class="flex flex-col items-center text-center p-0 bg-white rounded-none shadow-none border-none transition duration-300">
                        <img src="https://i.imgur.com/A3rIAiM.jpeg" alt="Mahrukh Nadeem Photo" class="h-28 w-28 rounded-full object-cover mb-4 border-none shadow-none">
                        <p class="font-bold text-lg text-gray-900">Mahrukh Nadeem</p>
                        <p class="text-sm text-red-600 font-semibold">Admin | Designer</p>
                        <p class="text-xs text-gray-500 mt-1">MS-II (AIMC)</p>
                    </div>
                    <div class="flex flex-col items-center text-center p-0 bg-white rounded-none shadow-none border-none transition duration-300">
                        <img src="https://i.imgur.com/VQH3Rqp.png" alt="Hadia Gulshan Photo" class="h-28 w-28 rounded-full object-cover mb-4 border-none shadow-none">
                        <p class="font-bold text-lg text-gray-900">Hadia Gulshan</p>
                        <p class="text-sm text-red-600 font-semibold">Graphic designer</p>
                        <p class="text-xs text-gray-500 mt-1">MS-II (AIMC)</p>
                    </div>
                </div>
            </div>
        </section>
        
        </main>
    
    <footer id="contact" class="bg-[#FFEFF2] text-gray-900 py-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <div class="flex flex-col items-center mb-8">
                <a href="#" class="home-logo-link flex-shrink-0 flex items-center mb-4">
                     <img src="https://i.imgur.com/R8x4icz.png" alt="ModMedicalis Logo" class="h-12 w-auto rounded-lg">
                </a>
                <h3 class="text-xl font-bold text-red-600 mb-2 algerya-sans-sc-font">MODMEDICALIS</h3>
                <p class="text-sm text-gray-600 max-w-sm">Your trusted partner for medical education excellence.</p>
            </div>
            <div class="max-w-xs mx-auto mb-8 border-t border-b border-gray-300 py-6">
                <h4 class="text-base font-bold mb-4 text-red-600 algerya-sans-sc-font">MENU</h4>
                <ul class="space-y-2 text-base font-medium">
                    <li><a href="#" class="home-logo-link text-gray-700 hover:text-red-600 transition">Home</a></li>
                    <li><a href="#notes" class="text-gray-700 hover:text-red-600 transition">Shop</a></li>
                    <li><a href="https://modmedicalis.online/FREE-RESOURCES" class="text-gray-700 hover:text-red-600 transition">Free Resources</a></li>
                    <li><a href="#contact" class="text-gray-700 hover:text-red-600 transition">Contact / FAQs</a></li>
                </ul>
            </div>
            <div class="flex justify-center space-x-6 mb-8 text-2xl">
                 <a href="https://www.facebook.com/" target="_blank" class="text-gray-700 hover:text-red-600 transition"><i class="fab fa-facebook-f"></i></a>
                 <a href="https://www.instagram.com/modmedicalis?igsh=MTZtcGl6N3cwazRlcg==" target="_blank" class="text-gray-700 hover:text-red-600 transition"><i class="fab fa-instagram"></i></a>
                 <a href="https://www.youtube.com/" target="_blank" class="text-gray-700 hover:text-red-600 transition"><i class="fab fa-youtube"></i></a>
                 <a href="https://www.tiktok.com/" target="_blank" class="text-gray-700 hover:text-red-600 transition"><i class="fab fa-tiktok"></i></a>
            </div>
            <div class="text-xs text-gray-500 space-x-4 pt-4 mt-4 border-t border-gray-300">
                <p class="mb-2">&copy; 2025 ModMedicalis</p>
                <div class="flex flex-wrap justify-center space-x-3 sm:space-x-4">
                    <a href="#" class="hover:text-red-600">Refund Policy</a>
                    <a href="#" class="hover:text-red-600">Privacy Policy</a>
                    <a href="#" class="hover:text-red-600">Terms of Service</a>
                    <a href="#" class="hover:text-red-600">Shipping Policy</a>
                </div>
            </div>
        </div>
    </footer>
    
    <div id="cart-modal-overlay" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div id="cart-modal" class="bg-white rounded-xl shadow-2xl w-full max-w-sm sm:max-w-md transform transition-all duration-300 scale-95 opacity-0">
            <div class="p-4 border-b flex justify-between items-center bg-[#00A5E3] rounded-t-xl">
                <h3 class="text-xl font-bold text-white algerya-sans-sc-font">Your Cart</h3>
                <button id="close-cart-button" class="text-white hover:text-gray-100 transition p-1">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                </button>
            </div>
            <div id="cart-items-container" class="p-4 max-h-72 overflow-y-auto space-y-3">
                <p id="empty-cart-message" class="text-gray-500 text-center italic text-sm">Your cart is empty.</p>
            </div>
            <div id="cart-footer" class="p-4 border-t space-y-2 rounded-b-xl bg-gray-50">
                <div class="flex justify-between font-semibold text-gray-700 text-sm">
                    <span>Subtotal:</span>
                    <span id="cart-subtotal">Rs. 0</span>
                </div>
                <div class="flex justify-between text-lg font-extrabold text-[#1A5693]">
                    <span>Total:</span>
                    <span id="cart-total">Rs. 0</span>
                </div>
                <button id="proceed-to-checkout-btn" class="w-full bg-[#00A5E3] text-white py-2 rounded-lg font-bold text-sm hover:bg-cyan-600 transition duration-200 shadow-lg algerya-sans-sc-font">
                    Proceed to Checkout
                </button>
            </div>
        </div>
    </div>
    
    <div id="checkout-page" class="hidden bg-slate-50 min-h-screen py-12">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
            <div id="checkout-page-content" class="bg-white rounded-xl shadow-2xl w-full overflow-hidden">
                <div class="p-4 border-b flex justify-between items-center bg-[#00A5E3] rounded-t-xl">
                    <h3 class="text-xl font-bold text-white algerya-sans-sc-font">Checkout</h3>
                    <button id="close-checkout-button" class="text-white hover:text-gray-100 transition p-1">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                    </button>
                </div>
                <div id="checkout-steps-container">
                    <div class="p-4 border-b">
                        <div class="step-indicator">
                            <div class="step active" data-step="1">
                                <div class="step-circle">1</div>
                                <div class="step-label">Shipping</div>
                            </div>
                            <div class="step" data-step="2">
                                <div class="step-circle">2</div>
                                <div class="step-label">Payment</div>
                            </div>
                            <div class="step" data-step="3">
                                <div class="step-circle">3</div>
                                <div class="step-label">Confirmation</div>
                            </div>
                        </div>
                        <div class="progress-bar-container">
                            <div id="checkout-progress-bar" class="progress-bar" style="width: 0%;"></div>
                        </div>
                    </div>
                    <form id="checkout-form" method="POST" enctype="multipart/form-data">
                        <input type="hidden" name="_subject" value="New ModMedicalis Order!">
                        <input type="hidden" name="_template" value="table">
                        <input type="hidden" name="_captcha" value="false">
                        <input type="hidden" name="Cart Details" id="form-cart-details">
                        <input type="hidden" name="Final Bill" id="form-final-bill">
                        <input type="hidden" name="Order ID" id="form-order-id">
                        <input type="hidden" name="Roll Number" id="form-roll-number" value=""> 

                        <div id="checkout-step-1" class="checkout-step active p-6 space-y-5">
                            <h4 class="text-lg font-bold text-gray-700 algerya-sans-sc-font">Shipping Details</h4>
                            <hr class="border-gray-100">
                            <div>
                                <label for="full_name" class="block text-sm font-medium text-gray-700 mb-2">FULL NAME</label>
                                <input type="text" id="full_name" name="Full Name" required class="modern-input">
                            </div>
                            <div>
                                <label for="college" class="block text-sm font-medium text-gray-700 mb-2">SELECT COLLEGE</label>
                                <select id="college" name="College" required class="modern-input">
                                    <option value="" disabled selected>Select your medical college</option>
                                </select>
                            </div>
                            <div id="aimc-promo-section" class="hidden p-5 bg-blue-50 rounded-xl border-4 border-blue-100 space-y-4 shadow-inner">
                                <h5 class="text-base font-extrabold text-[#1A5693] algerya-sans-sc-font">AIMC SPECIAL OFFER (Block 6 only)</h5>
                                <div>
                                    <label for="promo_code" class="block text-sm font-medium text-gray-700 mb-2">PROMO CODE (AIMC students only)</label>
                                    <input type="text" id="promo_code" name="Promo Code Entered" class="modern-input uppercase" placeholder="">
                                </div>
                                <div id="roll-number-entry" class="hidden">
                                    <label for="roll_number" class="block text-sm font-medium text-gray-700 mb-2">ROLL NUMBER (For verification)</label>
                                    <input type="number" id="roll_number" name="AIMC Roll Number" class="modern-input" placeholder="">
                                    <p id="roll-number-feedback" class="text-xs mt-2 font-semibold"></p>
                                </div>
                            </div>
                            <div>
                                <label for="contact_number" class="block text-sm font-medium text-gray-700 mb-2">CONTACT NUMBER</label>
                                <input type="tel" id="contact_number" name="Contact Number" required class="modern-input">
                            </div>
                            <div>
                                <label for="shipping_address" class="block text-sm font-medium text-gray-700 mb-2">SHIPPING ADDRESS (Full Details for Courier)</label>
                                <textarea id="shipping_address" name="Shipping Address" rows="3" required class="modern-input"></textarea>
                            </div>
                            <div class="checkout-navigation">
                                <button type="button" id="cancel-checkout-btn" class="px-6 py-2 bg-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-400 transition duration-200">Cancel</button>
                                <button type="button" id="next-to-payment-btn" class="px-6 py-2 bg-[#00A5E3] text-white rounded-lg font-medium hover:bg-cyan-600 transition duration-200 algerya-sans-sc-font">Next: Payment Details</button>
                            </div>
                        </div>

                        <div id="checkout-step-2" class="checkout-step p-6 space-y-5">
                            <h4 class="text-lg font-bold text-gray-700 algerya-sans-sc-font">Payment Details</h4>
                            <hr class="border-gray-100">
                            <div class="bg-gray-100 p-5 rounded-xl border border-gray-200 text-center shadow-inner">
                                <p class="text-sm font-semibold text-gray-800 mb-3">PAYMENT TO:</p>
                                <p class="text-xl font-bold text-gray-900 algerya-sans-sc-font">MUHAMMAD HASNAIN</p>
                                <div class="flex items-center justify-center space-x-2 mt-2">
                                    <span id="payment-number" class="text-xl font-mono text-blue-600 font-extrabold">03096554421</span>
                                    <button type="button" onclick="copyPaymentNumber()" class="bg-blue-600 text-white px-3 py-1 rounded-lg text-xs font-semibold hover:bg-blue-700 transition">Copy</button>
                                </div>
                                <p class="text-xs text-gray-500 mt-2">Jazzcash and Easypaisa</p>
                                <p class="text-lg font-extrabold text-red-600 mt-4 border-t border-gray-300 pt-3">Product Total: <span id="payment-amount">Rs. 0</span></p>
                                <p class="text-xs text-gray-500 mt-1 italic font-semibold">*Delivery charges are paid in cash to the rider upon delivery.*</p>
                            </div>
                            <div>
                                <label for="payment_slip" class="block text-sm font-medium text-gray-700 mb-2">Upload Payment Slip (Required for confirmation)</label>
                                <input type="file" id="payment_slip" name="Payment Slip" accept="image/*,.pdf" required class="w-full p-2 border border-gray-300 rounded-lg focus:ring-[#1A5693] focus:border-[#1A5693] text-sm">
                            </div>
                            <h4 class="text-lg font-bold text-gray-700 pt-3 algerya-sans-sc-font">How did you hear about us?</h4>
                            <hr class="border-gray-100">
                            <div class="space-y-2">
                                <div class="flex items-center">
                                    <input id="source-ambassador" name="Referral Source" type="radio" value="Ambassador" required class="h-4 w-4 text-[#1A5693] border-gray-300 focus:ring-[#1A5693]">
                                    <label for="source-ambassador" class="ml-3 block text-sm font-medium text-gray-700">Ambassador</label>
                                </div>
                                <div class="flex items-center">
                                    <input id="source-social" name="Referral Source" type="radio" value="Social Media" class="h-4 w-4 text-[#1A5693] border-gray-300 focus:ring-[#1A5693]">
                                    <label for="source-social" class="ml-3 block text-sm font-medium text-gray-700">Social Media</label>
                                </div>
                                <div class="flex items-center">
                                    <input id="source-colleagues" name="Referral Source" type="radio" value="Colleagues" class="h-4 w-4 text-[#1A5693] border-gray-300 focus:ring-[#1A5693]">
                                    <label for="source-colleagues" class="ml-3 block text-sm font-medium text-gray-700">Colleagues</label>
                                </div>
                                <div class="flex items-center">
                                    <input id="source-other" name="Referral Source" type="radio" value="Other" class="h-4 w-4 text-[#1A5693] border-gray-300 focus:ring-[#1A5693]">
                                    <label for="source-other" class="ml-3 block text-sm font-medium text-gray-700">Other</label>
                                </div>
                            </div>
                            <div class="checkout-navigation">
                                <button type="button" id="back-to-shipping-btn" class="px-6 py-2 bg-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-400 transition duration-200">Back</button>
                                <button type="button" id="next-to-confirmation-btn" class="px-6 py-2 bg-[#00A5E3] text-white rounded-lg font-medium hover:bg-cyan-600 transition duration-200 algerya-sans-sc-font">Next: Confirmation</button>
                            </div>
                        </div>

                        <div id="checkout-step-3" class="checkout-step p-6 space-y-5">
                            <h4 class="text-lg font-bold text-gray-700 algerya-sans-sc-font">Order Confirmation</h4>
                            <hr class="border-gray-100">
                            <div id="checkout-delivery-note" class="p-3 bg-red-100 rounded-xl border border-red-300 text-sm font-semibold text-gray-800"></div>
                            <div class="p-4 bg-red-50 rounded-xl border border-red-200 shadow-md">
                                <h5 class="text-lg font-extrabold text-red-600 algerya-sans-sc-font">Final Bill and Order Summary</h5>
                                <ul id="checkout-summary-list" class="text-sm text-gray-700 mt-3 space-y-1"></ul>
                                <div class="flex justify-between font-extrabold text-[#1A5693] mt-3 pt-3 border-t border-red-200 text-xl">
                                    <span>TOTAL (Products and Delivery):</span>
                                    <span id="checkout-final-total">Rs. 0</span>
                                </div>
                            </div>
                            <div class="checkout-navigation">
                                <button type="button" id="back-to-payment-btn" class="px-6 py-2 bg-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-400 transition duration-200">Back</button>
                                <button type="submit" id="confirm-order-btn" class="px-6 py-2 bg-red-600 text-white rounded-lg font-medium hover:bg-red-700 transition duration-200 algerya-sans-sc-font">Confirm Order and Place</button>
                            </div>
                        </div>
                    </form>
                </div>
                <div id="checkout-success-page" class="hidden p-8 text-center">
                    <svg class="w-16 h-16 mx-auto text-green-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <h3 class="text-2xl font-bold mt-4 text-gray-800 algerya-sans-sc-font">ORDER CONFIRMED!</h3>
                    <div id="checkout-success-message" class="mt-2 text-gray-600 leading-relaxed"></div>
                    <p class="mt-4 text-xs text-gray-500 bg-gray-100 p-2 rounded-lg">Kindly keep a screenshot of this receipt if required in any case of order confirmation. <br> Contact: <strong>03096554421</strong></p>
                    <button id="close-success-btn" class="mt-6 px-6 py-2 bg-[#1A5693] text-white rounded-lg font-medium hover:bg-blue-700 transition duration-200 algerya-sans-sc-font">CLOSE</button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="product-page" class="hidden min-h-screen bg-white">
        <div id="product-page-content" class="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
            <div class="p-3 flex justify-end">
                <button id="close-product-page-button" class="text-gray-500 hover:text-gray-900 transition p-1">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                </button>
            </div>
            <div class="grid md:grid-cols-2 gap-8 lg:gap-12"> 
                <div class="space-y-3"> 
                    <div id="popup-image-carousel" class="w-full relative">
                        <div class="product-popup-image-container rounded-xl shadow-lg"> 
                            <img id="popup-main-image" src="" alt="Product Main Image">
                        </div>
                        <div id="popup-thumbnails" class="flex space-x-2 mt-3 overflow-x-auto justify-center"></div>
                    </div>
                </div>
                <div class="space-y-4"> 
                    <h2 id="popup-product-name" class="text-2xl font-extrabold text-[#1A5693] algerya-sans-sc-font"></h2>
                    <div class="flex items-center space-x-2">
                         <span id="popup-product-price" class="font-extrabold text-red-600 flex items-end space-x-1"></span>
                         <span id="popup-product-old-price" class="text-base text-gray-400 line-through"></span>
                    </div>
                    <p id="popup-product-description" class="text-gray-700 leading-relaxed text-sm"></p>
                    <div class="flex flex-col space-y-3 pt-2">
                        <button id="popup-add-to-cart-btn" class="w-full bg-[#1A5693] text-white py-2.5 rounded-lg font-bold text-base hover:bg-blue-700 transition duration-200 shadow-lg flex items-center justify-center space-x-2 disabled:opacity-50" data-product-id="">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-shopping-cart"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.38a2 2 0 0 0 1.84-1.11L22 7H4"/></svg>
                            <span class="algerya-sans-sc-font">Add to cart</span>
                        </button>
                        <button id="popup-prebook-btn" class="hidden w-full bg-[#1A5693] text-white py-2.5 rounded-lg font-bold text-base hover:bg-blue-700 transition duration-200 shadow-lg flex items-center justify-center space-x-2">
                            <span class="algerya-sans-sc-font">Pre-book Now</span>
                        </button>
                        <button id="popup-free-preview-btn" class="w-full bg-gray-200 text-gray-800 py-2.5 rounded-lg font-bold text-base hover:bg-gray-300 transition duration-200 shadow-md flex items-center justify-center space-x-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-eye"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>
                            <span class="algerya-sans-sc-font">Click for free preview</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Custom alert/popup replacement function
        function displayCustomAlert(message) {
            const popup = document.createElement('div');
            popup.className = 'fixed inset-0 bg-black bg-opacity-70 z-[1000] flex items-center justify-center p-4';
            popup.innerHTML = `
                <div class="bg-white rounded-xl shadow-2xl p-6 max-w-sm w-full text-center">
                    <h5 class="text-xl font-bold text-red-600 mb-4 algerya-sans-sc-font">Notification</h5>
                    <p class="text-gray-700 mb-6">${message}</p>
                    <button onclick="this.closest('.fixed').remove()" class="px-6 py-2 bg-[#1A5693] text-white rounded-lg font-bold hover:bg-blue-700 algerya-sans-sc-font">OK</button>
                </div>
            `;
            document.body.appendChild(popup);
        }

        function copyPaymentNumber() {
            const number = '03096554421';
            const tempInput = document.createElement('input');
            tempInput.value = number;
            document.body.appendChild(tempInput);
            tempInput.select();
            try {
                document.execCommand('copy');
                displayCustomAlert('Number copied to clipboard!');
            } catch (err) {
                displayCustomAlert('Failed to copy number. Please manually copy: 03096554421');
            }
            document.body.removeChild(tempInput);
        }

        const DELIVERY_CHARGE_LAHORE = 100;
        const DELIVERY_CHARGE_OLL = 200;
        
        const LAHORE_COLLEGE_KEYWORDS = [
            'King Edward Medical University (KEMU), Lahore', 'Allama Iqbal Medical College (AIMC), Lahore', 'Fatima Jinnah Medical University (FJMU), Lahore', 'Services Institute of Medical Sciences (SIMS), Lahore', 'Shalamar Medical and Dental College (SMDC), Lahore', 'CMH Lahore Medical College (CMH LMC)', 'FMH College of Medicine and Dentistry (FMHCM&D), Lahore', 'University College of Medicine and Dentistry (UCMD), Lahore', 'Azra Naheed Medical College (ANMC), Lahore', 'Central Park Medical College (CPMC), Lahore', 'Lahore Medical and Dental College (LMDC), Lahore', 'Continental Medical College (CMC), Lahore', 'Akhtar Saeed Medical and Dental College (ASMDC), Lahore', 'Pak Red Crescent Medical and Dental College, Lahore', 'Green International University (GIU), Lahore'
        ];
        
        const isLahoreCollege = (collegeName) => {
            if (!collegeName) return false;
            return LAHORE_COLLEGE_KEYWORDS.some(keyword => collegeName.includes(keyword));
        };

        const calculateDeliveryCharge = (collegeName) => {
            return isLahoreCollege(collegeName) ? DELIVERY_CHARGE_LAHORE : DELIVERY_CHARGE_OLL;
        };

        const PAKISTAN_MEDICAL_COLLEGES = [
            'King Edward Medical University (KEMU), Lahore', 'Allama Iqbal Medical College (AIMC), Lahore', 'Fatima Jinnah Medical University (FJMU), Lahore', 'Services Institute of Medical Sciences (SIMS), Lahore', 'Nishtar Medical University (NMU), Multan', 'Rawalpindi Medical University (RMU), Rawalpindi', 'Quaid-e-Azam Medical College (QAMC), Bahawalpur', 'Faisalabad Medical University (FMU), Faisalabad', 'Sargodha Medical College (SMC), Sargodha', 'Gujranwala Medical College (GMC), Gujranwala', 'Sialkot Medical College (SMC), Sialkot', 'Dera Ghazi Khan Medical College (DGKMC), D.G Khan', 'Dow Medical College (DMC), Karachi', 'Sindh Medical College (SMC), Karachi', 'Jinnah Sindh Medical University (JSMU), Karachi', 'Liaquat University of Medical and Health Sciences (LUMHS), Jamshoro', 'Khyber Medical College (KMC), Peshawar', 'Ayub Medical College (AMC), Abbottabad', 'Bolan Medical College (BMC), Quetta', 'Shaikh Zayed Medical College (SZMC), Rahim Yar Khan', 'Azad Jammu and Kashmir Medical College (AJKMC), Muzaffarabad', 'PIMS Medical College, Islamabad', 'Saidu Medical College, Swat', 'Gajju Khan Medical College (GKMC), Swabi', 'Bannu Medical College (BMC), Bannu', 'Aga Khan University Hospital (AKUH), Karachi', 'Shalamar Medical and Dental College (SMDC), Lahore', 'CMH Lahore Medical College (CMH LMC)', 'FMH College of Medicine and Dentistry (FMHCM&D), Lahore', 'University College of Medicine and Dentistry (UCMD), Lahore', 'Azra Naheed Medical College (ANMC), Lahore', 'Central Park Medical College (CPMC), Lahore', 'Lahore Medical and Dental College (LMDC), Lahore', 'Continental Medical College (CMC), Lahore', 'Amna Inayat Medical College (AIMC), Sheikhupura', 'Islamabad Medical and Dental College (IMDC), Islamabad', 'Foundation University Medical College (FUMC), Rawalpindi', 'Riphah International University (RIU), Islamabad', 'Rawal Institute of Health Sciences, Islamabad', 'Karachi Medical and Dental College (KMDC), Karachi', 'Liaquat College of Medicine and Dentistry (LCMD), Karachi', 'Ziauddin Medical University, Karachi', 'Indus Medical College, Tando Muhammad Khan', 'Wah Medical College, Wah Cantt', 'Hashmat Medical College, Gujrat', 'Akhtar Saeed Medical and Dental College (ASMDC), Lahore', 'Pak Red Crescent Medical and Dental College, Lahore', 'HBS Medical and Dental College, Islamabad', 'Sarhad University of Science and IT, Peshawar', 'Bacha Khan Medical College, Mardan', 'Women Medical and Dental College, Abbottabad', 'Bakhtawar Amin Medical and Dental College, Multan', 'Bilal Medical College, Rawalpindi', 'Fazaia Medical College, Islamabad', 'Green International University (GIU), Lahore',
        ].sort();
        
        // --- BACKEND ROLL NUMBER MANAGEMENT ---
        const JSONBIN_URL = 'https://api.jsonbin.io/v3/b/69169c6dae596e708f58089e';
        const JSONBIN_API_KEY = '$2a$10$lNnY7Irt8/dx/9/aYstApuBdcwDWQQMdQxVPIRd6aLvb4dTc8IFXi';
        let availableRollsFromBackend = [];
        let isBackendReady = false;

        async function fetchAvailableRollNumbers() {
            try {
                const response = await fetch(`${JSONBIN_URL}/latest`);
                if (!response.ok) throw new Error(`Backend responded with status: ${response.status}`);
                const data = await response.json();
                if (data.record && data.record.available_roll_nos && Array.isArray(data.record.available_roll_nos)) {
                    availableRollsFromBackend = data.record.available_roll_nos;
                    isBackendReady = true;
                    console.log('Successfully fetched available roll numbers from backend.');
                } else {
                    throw new Error('Unexpected data structure from backend.');
                }
            } catch (error) {
                console.error('CRITICAL ERROR fetching roll numbers:', error);
                isBackendReady = false;
            }
        }

        function isRollNumberAvailable(rollNumber) {
            const num = parseInt(rollNumber);
            if (isNaN(num)) return false;
            return availableRollsFromBackend.includes(num);
        }

        async function updateBackendWithUsedRollNumber(usedRollNumber) {
            const numToRemove = parseInt(usedRollNumber);
            if (isNaN(numToRemove)) return;

            const updatedRolls = availableRollsFromBackend.filter(roll => roll !== numToRemove);
            const payload = { available_roll_nos: updatedRolls };

            try {
                const response = await fetch(JSONBIN_URL, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': JSONBIN_API_KEY,
                        'X-Bin-Versioning': 'false'
                    },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) throw new Error(`Backend update failed with status: ${response.status}`);
                console.log(`Successfully removed roll number ${usedRollNumber} from backend.`);
                availableRollsFromBackend = updatedRolls;
            } catch (error) {
                console.error('CRITICAL ERROR updating backend with used roll number:', error);
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            fetchAvailableRollNumbers();

            const mainContent = document.querySelector('main');
            const header = document.querySelector('header');
            const footer = document.querySelector('footer');
            const productPage = document.getElementById('product-page');
            const checkoutPage = document.getElementById('checkout-page');
            
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            const filterButtons = document.querySelectorAll('.filter-text-button');
            const productCards = document.querySelectorAll('.product-card');
            const productTriggers = document.querySelectorAll('.product-trigger'); 
            
            const searchInput = document.getElementById('search-input');
            const searchDropdown = document.getElementById('search-dropdown');
            const mobileSearchInput = document.getElementById('mobile-search-input');
            const mobileSearchDropdown = document.getElementById('mobile-search-dropdown');
            
            const cartModalOverlay = document.getElementById('cart-modal-overlay');
            const cartModal = document.getElementById('cart-modal');
            const cartItemsContainer = document.getElementById('cart-items-container');
            const emptyCartMessage = document.getElementById('empty-cart-message');
            const cartSubtotalElement = document.getElementById('cart-subtotal');
            const cartTotalElement = document.getElementById('cart-total');
            const cartCountElements = document.querySelectorAll('[id$="-cart-count"]');
            const proceedToCheckoutBtn = document.getElementById('proceed-to-checkout-btn');
            
            const closeCheckoutButton = document.getElementById('close-checkout-button');
            const paymentAmount = document.getElementById('payment-amount');
            const checkoutSummaryList = document.getElementById('checkout-summary-list');
            const checkoutFinalTotal = document.getElementById('checkout-final-total');
            const checkoutCollegeSelect = document.getElementById('college');
            const checkoutDeliveryNote = document.getElementById('checkout-delivery-note');
            
            const checkoutForm = document.getElementById('checkout-form');
            const checkoutStepsContainer = document.getElementById('checkout-steps-container');
            const checkoutSuccessPage = document.getElementById('checkout-success-page');
            const checkoutSteps = document.querySelectorAll('.checkout-step');
            const stepIndicators = document.querySelectorAll('.step');
            const progressBar = document.getElementById('checkout-progress-bar');
            const nextToPaymentBtn = document.getElementById('next-to-payment-btn');
            const backToShippingBtn = document.getElementById('back-to-shipping-btn');
            const nextToConfirmationBtn = document.getElementById('next-to-confirmation-btn');
            const backToPaymentBtn = document.getElementById('back-to-payment-btn');
            const cancelCheckoutBtn = document.getElementById('cancel-checkout-btn');
            const closeSuccessBtn = document.getElementById('close-success-btn');
            
            const closeProductPageButton = document.getElementById('close-product-page-button');
            const popupMainImage = document.getElementById('popup-main-image');
            const popupThumbnails = document.getElementById('popup-thumbnails');
            const popupProductName = document.getElementById('popup-product-name');
            const popupProductPrice = document.getElementById('popup-product-price');
            const popupProductOldPrice = document.getElementById('popup-product-old-price');
            const popupProductDescription = document.getElementById('popup-product-description');
            const popupAddToCartBtn = document.getElementById('popup-add-to-cart-btn');
            const popupFreePreviewBtn = document.getElementById('popup-free-preview-btn');

            const aimcPromoSection = document.getElementById('aimc-promo-section');
            const promoCodeInput = document.getElementById('promo_code');
            const rollNumberEntry = document.getElementById('roll-number-entry');
            const rollNumberInput = document.getElementById('roll_number');
            const rollNumberFeedback = document.getElementById('roll-number-feedback');
            const formRollNumber = document.getElementById('form-roll-number');
            
            const PRODUCTS_FORM_URL = "https://formbold.com/s/oP5Jb";
            const BLOCK6_FORM_URL = "https://formbold.com/s/3Z4Np";
            
            const products = [
                { id: 1, name: "BLOCK 2 FLASHCARDS", price: 900, oldPrice: 1100, year: 1, isPrebook: false, images: ["https://i.imgur.com/c4XSHmA.jpeg"], description: "High-yield flashcards for Block 2, aligned with UHS LOs. Perfect for quick revision and concept consolidation.", previewLink: "https://drive.google.com/file/d/1QFJiBzPELwVWcaVi7VWnDrIr-bwm5qBy/view?usp=drivesdk" },
                { id: 2, name: "MIND YOUR MINORS - BLOCK 5", price: 500, oldPrice: null, year: 2, isPrebook: false, images: ["https://i.imgur.com/mTnWoeB.png"], description: "Get ready to ace your minor subjects with our illustrative notes and say good bye to boring books. Completely alligned with UHS LOs and recommended books.", previewLink: "https://drive.google.com/file/d/1LDBgWhSP6xeWDqxyKyutZ7tOijrx_uuS/view?usp=drivesdk" },
                { id: 3, name: "MIND YOUR MINORS - BLOCK 6", price: 700, oldPrice: 1500, year: 2, isPrebook: false, images: ["https://i.imgur.com/wLiYfOr.jpeg", "https://placehold.co/400x500/00A5E3/ffffff?text=SYSTEMATIC\nFLOWCHARTS", "https://placehold.co/400x500/1A5693/ffffff?text=HIGH+YIELD\nILLUSTRATIONS", "https://placehold.co/400x500/EF4444/ffffff?text=PAST\nPAPER+TIPS" ], description: "The newly launched minor subjects block notes. Completely aligned with UHS LOs and recommended books, featuring enhanced illustrations and high-yield mnemonics.", previewLink: "https://drive.google.com/file/d/1yhewdyE8Xc4ALB3Eo7CDzAFTsr_PHbK-/view?usp=drivesdk" }
            ];
            
            let cart = [];
            let currentCheckoutStep = 1;
            const findProductById = (id) => products.find(p => p.id === id);

            function switchView(view) {
                mainContent.classList.add('hidden');
                header.classList.add('hidden');
                footer.classList.add('hidden');
                productPage.classList.add('hidden');
                checkoutPage.classList.add('hidden');
                document.querySelector('.sticky.top-0.z-50')?.classList.add('hidden');

                if (view === 'main') {
                    mainContent.classList.remove('hidden');
                    header.classList.remove('hidden');
                    footer.classList.remove('hidden');
                    document.querySelector('.sticky.top-0.z-50')?.classList.remove('hidden');
                } else if (view === 'product') {
                    productPage.classList.remove('hidden');
                } else if (view === 'checkout') {
                    checkoutPage.classList.remove('hidden');
                }
                window.scrollTo(0, 0);
            }
            
            const performSearch = (searchTerm, dropdownElement) => {
                if (!searchTerm.trim()) {
                    dropdownElement.classList.add('hidden');
                    return;
                }
                
                const searchLower = searchTerm.toLowerCase();
                const matchingProducts = products.filter(p => p.name.toLowerCase().includes(searchLower) || (p.description && p.description.toLowerCase().includes(searchLower)));
                
                dropdownElement.innerHTML = matchingProducts.length > 0 ? '' : '<div class="search-dropdown-item text-gray-500">No products found</div>';

                matchingProducts.forEach(product => {
                    const item = document.createElement('div');
                    item.className = 'search-dropdown-item';
                    item.textContent = product.name;
                    item.addEventListener('click', () => {
                        openProductPage(product.id);
                        dropdownElement.classList.add('hidden');
                        if (searchInput) searchInput.value = '';
                        if (mobileSearchInput) mobileSearchInput.value = '';
                    });
                    dropdownElement.appendChild(item);
                });
                dropdownElement.classList.remove('hidden');
            };
            
            if (searchInput && searchDropdown) {
                searchInput.addEventListener('input', () => performSearch(searchInput.value, searchDropdown));
                searchInput.addEventListener('focus', () => { if (searchInput.value.trim()) performSearch(searchInput.value, searchDropdown); });
                document.addEventListener('click', (e) => { if (!searchInput.contains(e.target) && !searchDropdown.contains(e.target)) searchDropdown.classList.add('hidden'); });
            }
            
            if (mobileSearchInput && mobileSearchDropdown) {
                mobileSearchInput.addEventListener('input', () => performSearch(mobileSearchInput.value, mobileSearchDropdown));
                mobileSearchInput.addEventListener('focus', () => { if (mobileSearchInput.value.trim()) performSearch(mobileSearchInput.value, mobileSearchDropdown); });
                document.addEventListener('click', (e) => { if (!mobileSearchInput.contains(e.target) && !mobileSearchDropdown.contains(e.target)) mobileSearchDropdown.classList.add('hidden'); });
            }
            
            const updateCheckoutProgress = (step) => {
                stepIndicators.forEach((indicator) => {
                    const stepNumber = parseInt(indicator.dataset.step);
                    indicator.classList.toggle('active', stepNumber === step);
                    indicator.classList.toggle('completed', stepNumber < step);
                });
                progressBar.style.width = `${((step - 1) / (stepIndicators.length - 1)) * 100}%`;
                currentCheckoutStep = step;
            };
            
            const showCheckoutStep = (step) => {
                checkoutSteps.forEach(s => s.classList.remove('active'));
                document.getElementById(`checkout-step-${step}`)?.classList.add('active');
                updateCheckoutProgress(step);
            };
            
            const isBlock6InCart = () => cart.some(item => item.productId === 3);

            const toggleAimcPromo = () => {
                const isAimcSelected = checkoutCollegeSelect.value.includes('Allama Iqbal Medical College (AIMC), Lahore');
                const showPromo = isAimcSelected && isBlock6InCart();
                aimcPromoSection.classList.toggle('hidden', !showPromo);
                
                if (!showPromo) {
                    promoCodeInput.value = '';
                    rollNumberEntry.classList.add('hidden');
                    rollNumberInput.value = '';
                    rollNumberInput.removeAttribute('required');
                    rollNumberFeedback.textContent = '';
                    formRollNumber.value = '';
                }
            };
            
            checkoutCollegeSelect.addEventListener('change', () => {
                toggleAimcPromo();
                updateCheckoutTotals();
            });
            
            promoCodeInput.addEventListener('input', () => {
                const code = promoCodeInput.value.toUpperCase();
                if (code === 'AIMC28') {
                    rollNumberEntry.classList.remove('hidden');
                    rollNumberInput.setAttribute('required', 'required');
                    rollNumberFeedback.textContent = 'Promo code accepted. Please enter your Roll Number.';
                    rollNumberFeedback.className = 'text-xs mt-2 font-semibold text-green-600';
                } else {
                    rollNumberEntry.classList.add('hidden');
                    rollNumberInput.removeAttribute('required');
                    rollNumberInput.value = '';
                    rollNumberFeedback.textContent = 'Enter the correct code to proceed with the discount.';
                    rollNumberFeedback.className = 'text-xs mt-2 font-semibold text-gray-500';
                }
                formRollNumber.value = '';
                updateCheckoutTotals();
            });

            rollNumberInput.addEventListener('input', () => {
                const roll = rollNumberInput.value.trim();

                if (!isBackendReady) {
                    rollNumberFeedback.textContent = 'Could not connect to the promo verification server. The AIMC promo is temporarily unavailable.';
                    rollNumberFeedback.className = 'text-xs mt-2 font-semibold text-red-600';
                    updateCheckoutTotals();
                    return;
                }

                if (roll.length > 0) {
                    if (isRollNumberAvailable(roll)) {
                        rollNumberFeedback.textContent = 'Roll Number is valid and available for promo discount.';
                        rollNumberFeedback.className = 'text-xs mt-2 font-semibold text-green-600';
                    } else {
                        rollNumberFeedback.textContent = 'Sorry, it looks like you have already pre-ordered the book.';
                        rollNumberFeedback.className = 'text-xs mt-2 font-semibold text-red-600';
                    }
                } else {
                     rollNumberFeedback.textContent = 'Please enter your Roll Number for verification.';
                     rollNumberFeedback.className = 'text-xs mt-2 font-semibold text-gray-500';
                }
                formRollNumber.value = '';
                updateCheckoutTotals();
            });
            
            const calculateDiscount = () => {
                const isBlock6Present = isBlock6InCart();
                const isAimcSelected = checkoutCollegeSelect.value.includes('Allama Iqbal Medical College (AIMC), Lahore');
                const isPromoCodeCorrect = promoCodeInput.value.toUpperCase() === 'AIMC28';
                
                if (isBlock6Present && isAimcSelected && isPromoCodeCorrect) {
                    const roll = rollNumberInput.value.trim();
                    if (roll.length > 0 && isRollNumberAvailable(roll)) {
                        const block6Item = cart.find(item => item.productId === 3);
                        if(block6Item) {
                            const fixedDiscountPerItem = 100;
                            return fixedDiscountPerItem * block6Item.quantity;
                        }
                    }
                }
                return 0;
            };
            
            const updateCheckoutTotals = () => {
                let itemsTotal = cart.reduce((acc, item) => acc + item.price * item.quantity, 0);
                const discount = calculateDiscount();
                const college = checkoutCollegeSelect.value;
                const deliveryCharge = cart.length > 0 && college ? calculateDeliveryCharge(college) : 0;
                const cityStatus = college && isLahoreCollege(college) ? 'Lahore' : 'Out of Lahore (OLL)';
                const productSubtotalAfterDiscount = itemsTotal - discount;
                const finalTotal = productSubtotalAfterDiscount + deliveryCharge;
                
                paymentAmount.textContent = `Rs. ${Math.max(0, productSubtotalAfterDiscount).toLocaleString('en-PK')}`;
                checkoutFinalTotal.textContent = `Rs. ${Math.max(0, finalTotal).toLocaleString('en-PK')}`; 
                
                checkoutDeliveryNote.innerHTML = `
                     <h5 class="text-lg font-extrabold text-red-700 algerya-sans-sc-font mb-2">Delivery Payment Note</h5>
                     <p class="text-sm">
                         Delivery charges of <strong>Rs. ${deliveryCharge.toLocaleString('en-PK')}</strong> (${cityStatus}) 
                         <span class="font-extrabold underline">MUST BE PAID IN CASH TO THE RIDER</span> upon delivery. 
                         The total amount you pay online (Rs. ${Math.max(0, productSubtotalAfterDiscount).toLocaleString('en-PK')}) is for products only.
                     </p>
                 `;
                
                let cartSummary = [];
                checkoutSummaryList.innerHTML = '';
                cart.forEach(item => {
                    const itemTotal = item.price * item.quantity;
                    checkoutSummaryList.insertAdjacentHTML('beforeend', `<li>${item.name} x ${item.quantity} - Rs. ${itemTotal.toLocaleString('en-PK')}</li>`);
                    cartSummary.push(`${item.name} x ${item.quantity} (Rs. ${itemTotal.toLocaleString('en-PK')})`);
                });
                
                if (discount > 0) {
                    checkoutSummaryList.insertAdjacentHTML('beforeend', `<li class="text-green-600 font-semibold">AIMC Promo Discount (15% on Block 6) - Rs. ${discount.toLocaleString('en-PK')}</li>`);
                    cartSummary.push(`Discount (15% on Block 6): -Rs. ${discount.toLocaleString('en-PK')}`);
                }
                
                if (deliveryCharge > 0) {
                     checkoutSummaryList.insertAdjacentHTML('beforeend', `<li class="font-bold text-red-600 pt-2 border-t border-gray-100 mt-2">Delivery Charges (${cityStatus}, Cash Payment) - Rs. ${deliveryCharge.toLocaleString('en-PK')}</li>`);
                     cartSummary.push(`Delivery Charge (${cityStatus}): +Rs. ${deliveryCharge.toLocaleString('en-PK')} (Cash to Rider)`);
                }
                
                document.getElementById('form-cart-details').value = cartSummary.join('; ');
                document.getElementById('form-final-bill').value = `Rs. ${Math.max(0, productSubtotalAfterDiscount).toLocaleString('en-PK')}`;
            };

            const validateStep = (stepNumber) => {
                const stepDiv = document.getElementById(`checkout-step-${stepNumber}`);
                const inputs = stepDiv.querySelectorAll('[required]');
                let isValid = true;
                
                Array.from(inputs).forEach(input => {
                    if (!input.checkValidity()) {
                        isValid = false;
                        input.reportValidity();
                    }
                    if (input.type === 'radio' && !stepDiv.querySelector(`input[name="${input.name}"]:checked`)) {
                        isValid = false;
                    }
                });
                
                if (stepNumber === 1) {
                    const isAimcSelected = checkoutCollegeSelect.value.includes('Allama Iqbal Medical College (AIMC), Lahore');
                    if (!aimcPromoSection.classList.contains('hidden') && isAimcSelected && promoCodeInput.value.toUpperCase() === 'AIMC28') {
                        if (!isBackendReady) {
                            displayCustomAlert('Cannot verify your roll number at this time. Please check your internet connection or try again later.');
                            isValid = false;
                        } else {
                            const roll = rollNumberInput.value.trim();
                            if (!roll || !isRollNumberAvailable(roll)) {
                                displayCustomAlert('Please enter a valid, unused AIMC roll number to claim the promo code.');
                                isValid = false;
                            }
                        }
                    }
                }
                
                if (stepNumber === 2) {
                    const paymentSlip = document.getElementById('payment_slip');
                    if (paymentSlip && !paymentSlip.files.length) {
                        displayCustomAlert('Please upload the payment slip to proceed.');
                        isValid = false;
                    }
                }
                
                return isValid;
            };

            const openCheckoutPage = () => {
                if (cart.length === 0) return displayCustomAlert('Your cart is empty. Please add a product before proceeding to checkout.');
                
                if (checkoutCollegeSelect.options.length <= 1) { 
                    const fragment = document.createDocumentFragment();
                    PAKISTAN_MEDICAL_COLLEGES.forEach(college => {
                        const option = document.createElement('option');
                        option.value = college;
                        option.textContent = college;
                        fragment.appendChild(option);
                    });
                    const otherOption = document.createElement('option');
                    otherOption.value = 'Other';
                    otherOption.textContent = 'Other (Please specify in Address)';
                    fragment.appendChild(otherOption);
                    checkoutCollegeSelect.appendChild(fragment);
                }
                
                showCartModal(false); 
                toggleAimcPromo();
                updateCheckoutTotals();
                showCheckoutStep(1);
                checkoutStepsContainer.classList.remove('hidden');
                checkoutSuccessPage.classList.add('hidden');
                checkoutForm.reset();
                switchView('checkout');
            };

            nextToPaymentBtn.addEventListener('click', () => {
                if (validateStep(1)) {
                    if (promoCodeInput.value.toUpperCase() === 'AIMC28' && rollNumberInput.value.trim() && isRollNumberAvailable(rollNumberInput.value.trim())) {
                        formRollNumber.value = rollNumberInput.value.trim();
                    } else {
                        formRollNumber.value = '';
                    }
                    updateCheckoutTotals();
                    showCheckoutStep(2);
                }
            });
            backToShippingBtn.addEventListener('click', () => showCheckoutStep(1));
            nextToConfirmationBtn.addEventListener('click', () => {
                if (validateStep(2)) {
                    updateCheckoutTotals();
                    showCheckoutStep(3);
                } 
            });
            backToPaymentBtn.addEventListener('click', () => showCheckoutStep(2));
            
            checkoutForm.addEventListener('submit', function(e) {
                e.preventDefault();
                if (!validateStep(1) || !validateStep(2) || !validateStep(3)) {
                    displayCustomAlert('Please complete all previous steps correctly before confirming the order.');
                    return;
                }

                const submitButton = document.getElementById('confirm-order-btn');
                submitButton.disabled = true;
                submitButton.textContent = 'Placing Order...';

                const isBlock6Checkout = isBlock6InCart();
                const formActionUrl = isBlock6Checkout ? BLOCK6_FORM_URL : PRODUCTS_FORM_URL;
                const orderId = `MOD-${Date.now()}-${Math.floor(Math.random() * 90000) + 10000}`;
                document.getElementById('form-order-id').value = orderId;
                const formData = new FormData(checkoutForm);
                const userName = formData.get('Full Name');
                const usedRollNumber = formRollNumber.value.trim();

                if (usedRollNumber) {
                    formData.set('Roll Number Used', usedRollNumber);
                } else {
                    formData.set('Roll Number Used', 'N/A (No Promo/Other College)');
                }
                
                const discountValue = calculateDiscount();
                if (discountValue > 0) {
                    formData.set('Discount Applied', `Rs. ${discountValue.toLocaleString('en-PK')} (Fixed 100/item, displayed as 15% off)`);
                }

                const college = checkoutCollegeSelect.value;
                const deliveryCharge = cart.length > 0 && college ? calculateDeliveryCharge(college) : 0;
                formData.set('Delivery Charge (Cash to Rider)', `Rs. ${deliveryCharge.toLocaleString('en-PK')}`);

                fetch(formActionUrl, { method: 'POST', body: formData })
                .then(response => {
                    if (response.ok) {
                        if (usedRollNumber) {
                            updateBackendWithUsedRollNumber(usedRollNumber);
                        }
                        checkoutStepsContainer.classList.add('hidden');
                        checkoutSuccessPage.classList.remove('hidden');
                        document.getElementById('checkout-success-message').innerHTML = `Thank you, <strong>${userName}</strong>! <br> Your order number <strong>${orderId}</strong> has been received and will be delivered within 3-4 working days.`;
                        cart = [];
                        renderCart();
                    } else { throw new Error('Form submission failed.'); }
                })
                .catch(error => {
                    console.error('Error submitting checkout form:', error);
                    displayCustomAlert('There was an error placing your order. Please check your network connection and try again.');
                }).finally(() => {
                    submitButton.disabled = false;
                    submitButton.textContent = 'Confirm Order and Place';
                });
            });

            proceedToCheckoutBtn.addEventListener('click', openCheckoutPage);
            
            const renderProductImages = (product) => {
                popupMainImage.src = product.images[0];
                popupThumbnails.innerHTML = '';
                product.images.forEach((url, index) => {
                    const thumbnail = document.createElement('img');
                    thumbnail.src = url;
                    thumbnail.alt = `${product.name} thumbnail ${index + 1}`;
                    thumbnail.className = `w-12 h-12 sm:w-16 sm:h-16 rounded-lg object-cover cursor-pointer border-2 transition duration-150 hover:border-[#1A5693] ${index === 0 ? 'border-[#1A5693]' : 'border-transparent'}`;
                    thumbnail.addEventListener('click', () => {
                        popupMainImage.src = url;
                        document.querySelectorAll('#popup-thumbnails img').forEach(img => img.classList.replace('border-[#1A5693]', 'border-transparent'));
                        thumbnail.classList.replace('border-transparent', 'border-[#1A5693]');
                    });
                    popupThumbnails.appendChild(thumbnail);
                });
            };

            const openProductPage = (productId) => {
                const id = parseInt(productId);
                const product = findProductById(id);
                if (!product) return;

                popupProductName.textContent = product.name;
                const numericalPrice = product.price.toLocaleString('en-PK').replace('Rs.', '').trim(); 
                popupProductPrice.innerHTML = `<span class="algerya-sans-sc-font text-4xl sm:text-5xl leading-none">Rs.</span><span class="text-3xl leading-none">${numericalPrice}</span>`; 
                popupProductOldPrice.textContent = product.oldPrice ? `Rs. ${product.oldPrice.toLocaleString('en-PK')}` : '';
                popupProductDescription.textContent = product.description;
                
                popupAddToCartBtn.onclick = () => { addToCart(id); switchView('main'); };
                popupFreePreviewBtn.onclick = () => window.open(product.previewLink, '_blank');
                
                renderProductImages(product);
                switchView('product');
            };

            const calculateTotals = () => {
                let subtotal = cart.reduce((acc, item) => acc + item.price * item.quantity, 0);
                let totalItems = cart.reduce((acc, item) => acc + item.quantity, 0);
                cartSubtotalElement.textContent = `Rs. ${subtotal.toLocaleString('en-PK')}`;
                cartTotalElement.textContent = `Rs. ${subtotal.toLocaleString('en-PK')}`;
                cartCountElements.forEach(el => el.textContent = totalItems);
            };

            const renderCart = () => {
                cartItemsContainer.innerHTML = '';
                emptyCartMessage.classList.toggle('hidden', cart.length > 0);
                proceedToCheckoutBtn.disabled = cart.length === 0;

                cart.forEach(item => {
                    const itemHtml = `
                        <div class="flex items-center space-x-3 p-2 cart-item-card rounded-xl">
                            <div class="flex-shrink-0 w-10 h-10 bg-gray-200 rounded-lg overflow-hidden"><img src="${item.image}" alt="${item.name}" class="w-full h-full object-contain"></div>
                            <div class="flex-grow">
                                <p class="text-xs font-semibold text-gray-800">${item.name}</p>
                                <p class="text-[0.65rem] text-red-500 font-bold">Rs. ${item.price.toLocaleString('en-PK')}</p>
                            </div>
                            <div class="flex items-center space-x-1">
                                <button data-id="${item.productId}" data-delta="-1" class="quantity-btn w-5 h-5 bg-gray-200 rounded-full text-xs font-bold text-gray-700 hover:bg-gray-300 transition touch-manipulation">-</button>
                                <span class="w-3 text-center text-xs font-semibold">${item.quantity}</span>
                                <button data-id="${item.productId}" data-delta="1" class="quantity-btn w-5 h-5 bg-[#E0F4FF] rounded-full text-xs font-bold text-[#1A5693] hover:bg-[#c9e8f9] transition touch-manipulation">+</button>
                            </div>
                            <div class="text-right w-12"><p class="text-xs font-bold text-[#1A5693]">Rs. ${(item.price * item.quantity).toLocaleString('en-PK')}</p></div>
                        </div>`;
                    cartItemsContainer.insertAdjacentHTML('beforeend', itemHtml);
                });
                
                document.querySelectorAll('.quantity-btn').forEach(button => button.addEventListener('click', handleQuantityChange));
                calculateTotals();
            };
            
            const showCartModal = (show = true) => {
                if (show) {
                    renderCart();
                    cartModalOverlay.classList.remove('hidden');
                    void cartModal.offsetWidth; 
                    cartModal.classList.remove('scale-95', 'opacity-0');
                    cartModal.classList.add('scale-100', 'opacity-100');
                } else {
                    cartModal.classList.remove('scale-100', 'opacity-100');
                    cartModal.classList.add('scale-95', 'opacity-0');
                    setTimeout(() => cartModalOverlay.classList.add('hidden'), 300); 
                }
            };
            
            const addToCart = (productId) => {
                const id = parseInt(productId);
                const product = findProductById(id);
                if (!product) return;
                const cartItem = cart.find(item => item.productId === id);
                if (cartItem) cartItem.quantity++;
                else cart.push({ productId: id, name: product.name, price: product.price, quantity: 1, image: product.images[0] });
                showCartModal(true);
            };

            const handleQuantityChange = (e) => {
                e.preventDefault();
                const productId = parseInt(e.currentTarget.dataset.id);
                const delta = parseInt(e.currentTarget.dataset.delta);
                const itemIndex = cart.findIndex(item => item.productId === productId);
                if (itemIndex > -1) {
                    cart[itemIndex].quantity += delta;
                    if (cart[itemIndex].quantity <= 0) cart.splice(itemIndex, 1);
                }
                renderCart();
                if (currentCheckoutStep === 1) toggleAimcPromo(); 
            };

            mobileMenuButton.addEventListener('click', () => mobileMenu.classList.toggle('hidden'));
            productTriggers.forEach(trigger => trigger.addEventListener('click', (e) => openProductPage(e.currentTarget.dataset.productId)));
            
            closeProductPageButton.addEventListener('click', () => switchView('main'));
            closeCheckoutButton.addEventListener('click', () => switchView('main'));
            cancelCheckoutBtn.addEventListener('click', () => switchView('main'));
            closeSuccessBtn.addEventListener('click', () => switchView('main'));
            document.querySelectorAll('.home-logo-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    switchView('main');
                });
            });

            const setFilter = (targetYear) => {
                filterButtons.forEach(btn => {
                    const isActive = btn.dataset.year === targetYear;
                    btn.classList.toggle('active', isActive);
                    btn.classList.toggle('text-white', isActive);
                    btn.classList.toggle('text-gray-300', !isActive);
                    btn.style.color = isActive ? 'white' : '#d1d5db';
                });
                productCards.forEach(card => {
                    const isVisible = targetYear === 'all' || card.dataset.year === targetYear;
                    card.classList.toggle('hidden', !isVisible);
                    if (isVisible) {
                        card.classList.remove('product-slide-up');
                        void card.offsetWidth;
                        card.classList.add('product-slide-up');
                    }
                });
            };

            filterButtons.forEach(button => button.addEventListener('click', (e) => setFilter(e.currentTarget.dataset.year)));
            document.querySelectorAll('.add-to-cart-btn').forEach(button => button.addEventListener('click', (e) => addToCart(e.currentTarget.dataset.productId)));
            document.getElementById('desktop-cart-button').addEventListener('click', () => showCartModal(true));
            document.getElementById('mobile-cart-button').addEventListener('click', () => showCartModal(true));
            document.getElementById('close-cart-button').addEventListener('click', () => showCartModal(false));
            cartModalOverlay.addEventListener('click', (e) => { if (e.target === cartModalOverlay) showCartModal(false); });

            setFilter('all');
            calculateTotals();
        });
    </script>
</body>
</html>
