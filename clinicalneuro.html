<!DOCTYPE html>
<html lang="en" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clinical Neuroanatomy - MEDIQUIZ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        
        /* Default (Light) Theme Colors */
        :root {
            --primary-text: #111827; /* Dark Grey */
            --secondary-text: #374151;
            --bg-color: #f9fafb; /* Light Grey BG */
            --card-bg: #ffffff;
            --accent-color: #0d9488; /* Teal 600 (Blend color) */
            --header-bg: #0d9488; /* Header background */
            --header-border: #0f766e;
            --dark-blue-bg: #111827; /* Fallback for card if not pure white */
        }
        
        /* Dark Theme Colors: Red/Blue Blend with Dark Background and White Grid */
        .dark {
            --primary-text: #f3f4f6; /* White text */
            --secondary-text: #9ca3af;
            --bg-color: #030712; /* Very Dark Blue/Black Background (Deep base color) */
            --card-bg: #111827; /* Dark Navy Card Background */
            --accent-color: #3b82f6; /* Blue 500 (Primary blend color - Blue) */
            --accent-light: #60a5fa; /* Lighter Blue */
            --secondary-accent: #ef4444; /* Red 500 (Secondary blend color - Red) */
            --header-bg: #1f2937; /* Darker header for contrast */
            --header-border: #3b82f6;
            --grid-line: #4b5563; /* Light Grey/White lines for "grid" effect */
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--primary-text);
            transition: background-color 0.3s, color 0.3s;
        }

        /* Custom Styles for Red/Blue Blend */
        .dark .tab-button.active {
            color: var(--accent-light);
            border-bottom-color: var(--secondary-accent); /* Red bottom border for blend */
            font-weight: 600;
        }

        .dark .accordion-header.active {
            border-left-color: var(--accent-light); /* Blue border for visual structure */
        }

        /* White/Light Grid Lines on Dark Background */
        .dark .table-responsive table {
            border: 1px solid var(--grid-line);
        }
        .dark .divide-gray-700 {
            border-color: var(--grid-line); /* White grid line effect */
        }
        .dark .border-gray-700 {
            border-color: var(--grid-line);
        }
        
        /* Quiz Option Styling */
        .quiz-option {
            background-color: var(--card-bg);
            border: 2px solid #e5e7eb;
        }
        .dark .quiz-option {
            border: 2px solid var(--grid-line); /* White grid line on options */
        }
        .quiz-option:hover {
            background-color: #f3f4f6; /* Light hover */
        }
        .dark .quiz-option:hover {
            background-color: #1f2937; /* Dark hover */
        }
        .quiz-option.selected {
            border-color: var(--accent-color);
            background-color: var(--bg-color);
        }
        .dark .quiz-option.selected {
            border-color: var(--accent-light); /* Blue selection border */
        }
        
        /* Correct Answer Styling */
        .quiz-option.correct {
            background-color: #d1fae5 !important; /* Green 100 */
            border-color: #10b981 !important; /* Green 500 */
            color: #065f46;
        }
        .dark .quiz-option.correct {
            background-color: #064e3b !important; /* Dark Green */
            border-color: #047857 !important;
            color: #d1fae5;
        }
        
        /* Feedback Area (Green for Correct) */
        .dark #feedback-area {
            background-color: #064e3b; /* Dark Green */
            border-color: #047857;
        }
        .dark #feedback-area p, .dark #feedback-area span {
            color: #d1fae5;
        }

        /* Structured notes styling for clean text formatting */
        .structured-notes {
            font-size: 0.9rem;
            line-height: 1.5;
        }
    </style>
</head>
<body>

<div id="app" class="max-w-4xl mx-auto min-h-screen shadow-2xl bg-white dark:bg-gray-900 transition duration-300">
    <header class="p-4 bg-teal-600 dark:bg-gray-800 text-white dark:text-teal-400 shadow-xl sticky top-0 z-20 transition duration-300 border-b-4 border-teal-700 dark:border-blue-500" style="background-color: var(--header-bg); border-bottom-color: var(--header-border);">
        <div class="flex justify-between items-center">
            <p class="text-xs font-semibold uppercase tracking-wider mb-1 text-teal-200 dark:text-blue-300">
                MEDIQUIZ | CLINICAL NOTES
            </p>
            <button id="theme-toggle" onclick="toggleTheme()" class="text-white dark:text-blue-400 p-2 rounded-full hover:bg-teal-700 dark:hover:bg-gray-700 transition duration-150 focus:outline-none focus:ring-2 focus:ring-teal-300 dark:focus:ring-blue-500">
                <span id="theme-toggle-icon">
                    </span>
            </button>
        </div>

        <h1 class="text-4xl font-extrabold mt-1 tracking-tight text-white dark:text-blue-300">
            Clinical Neuroanatomy
        </h1>
    </header>

    <div id="tabs-container" class="sticky top-[100px] bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 flex justify-start flex-wrap shadow-lg z-10 p-2 transition duration-300" style="background-color: var(--card-bg); border-bottom-color: var(--grid-line);">
        </div>

    <main id="content-container" class="p-4">
        <div class="text-center p-8 text-gray-500 dark:text-gray-400" id="loading-message">
            Loading high-yield clinical data...
        </div>
    </main>

    <footer class="p-4 text-center text-xs text-gray-500 dark:text-gray-600 border-t border-gray-200 dark:border-gray-700 mt-8" style="border-top-color: var(--grid-line);">
        Developed for MBBS-level understanding.
    </footer>
</div>

<script>
    // --- Dark/Light Theme Logic ---
    const html = document.documentElement;

    const userPrefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    const initialTheme = localStorage.getItem('theme') || (userPrefersDark ? 'dark' : 'light');

    if (initialTheme === 'dark') {
        html.classList.add('dark');
    } else {
        html.classList.remove('dark');
    }

    function updateThemeIcon() {
        const icon = document.getElementById('theme-toggle-icon');
        if (icon) {
            // Sun for dark theme (to switch to light), Moon for light theme (to switch to dark)
            if (html.classList.contains('dark')) {
                // Currently dark, show Sun icon (switch to light)
                icon.innerHTML = `<svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 7a.75.75 0 01.75.75v.5a.75.75 0 01-1.5 0v-.5A.75.75 0 0110 7zM10 16.75a.75.75 0 01.75-.75h.5a.75.75 0 010 1.5h-.5a.75.75 0 01-.75-.75zM15.54 8.46a.75.75 0 01.057-1.05l.344-.345a.75.75 0 011.06 0 .75.75 0 010 1.06l-.345.344a.75.75 0 01-1.05.057zM5.385 15.54a.75.75 0 011.05-.057l.345.344a.75.75 0 010 1.06.75.75 0 01-1.06 0l-.344-.345a.75.75 0 01.057-1.05zM17 10a.75.75 0 01.75-.75h.5a.75.75 0 010 1.5h-.5A.75.75 0 0117 10zM7 10a.75.75 0 01.75-.75h.5a.75.75 0 010 1.5h-.5A.75.75 0 017 10zM17.657 5.343a.75.75 0 01-.057 1.05l-.344.345a.75.75 0 01-1.06 0 .75.75 0 010-1.06l.345-.344a.75.75 0 011.05-.057zM6.343 17.657a.75.75 0 011.06 0l.344.345a.75.75 0 010 1.06.75.75 0 01-1.06 0l-.344-.345a.75.75 0 010-1.06zM12 15a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"></path></svg>`;
            } else {
                // Currently light, show Moon icon (switch to dark)
                icon.innerHTML = `<svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12.75 20.25c-4.418 0-8.125-3.5-8.125-7.812 0-3.562 2.375-6.687 5.75-7.75A9.014 9.014 0 0012 3c-4.962 0-9 4.038-9 9s4.038 9 9 9 9-4.038 9-9c0-1.012-.175-1.987-.5-2.906-1.062 1.344-2.625 2.156-4.375 2.156-3.812 0-6.875-3.063-6.875-6.875 0-1.75.813-3.313 2.157-4.375C14.438 3.312 15.412 3 16.5 3c.531 0 1.031.062 1.5.187 1.062.25 1.937.75 2.562 1.437.625.688 1.031 1.531 1.125 2.438.094.906.031 1.844-.188 2.719C21.781 10.938 22 11.95 22 13.125c0 4.75-3.844 8.625-8.625 8.625-1.175 0-2.187-.219-3.125-.625z"></path></svg>`;
            }
        }
    }

    window.toggleTheme = function() {
        if (html.classList.contains('dark')) {
            html.classList.remove('dark');
            localStorage.setItem('theme', 'light');
        } else {
            html.classList.add('dark');
            localStorage.setItem('theme', 'dark');
        }
        updateThemeIcon();
    }
    
    // --- 1. Data Structure with Updated Content (The data structure from the prompt is used and is correct) ---

    // Refactored Medulla Content
    const medulla_1_content = [
        { type: "text", text: "The **Medulla Oblongata** is critical as it contains many cranial nerve nuclei concerned with **vital functions** (e.g., regulation of heart rate & respiration)." },
        { type: "text", text: "It serves as a **conduit** for ascending & descending tracts connecting the spinal cord to higher centers. These tracts may be involved in **Demyelinating diseases, Neoplasms, or Vascular disorders**." },
        { type: "text", text: "⚠️ **Caution:** Sudden withdrawal of cerebrospinal fluid may cause herniation through the foramen magnum → sudden failure of vital functions due to pressure & ischemia of cranial nerve nuclei." }
    ];

    const medulla_2_content = [
        { type: "text", text: "A congenital anomaly characterized by **herniation of cerebellar tonsils & medulla oblongata** through the **foramen magnum** into the vertebral canal." },
        { type: "text", text: "This blocks CSF exits in the roof of the fourth ventricle, leading to **internal hydrocephalus**." },
        { type: "text", text: "Associated with: Craniovertebral anomalies and **Spina bifida**." },
        { type: "text", text: "Signs & symptoms are due to pressure on the cerebellum and medulla, often involving the last 4 cranial nerves (IX, X, XI, XII)." }
    ];

    const medulla_3_content = [
        { type: "text", text: "The medulla's location (beneath the tentorium cerebelli, above the foramen magnum) makes it vulnerable to pressure changes." },
        { type: "text", text: "Tumors in the posterior fossa → **increased intracranial pressure** → brain (cerebellum & medulla) pushed downward." },
        { type: "text", text: "Downward herniation blocks CSF exits, leading to hydrocephalus. ⚠️ It is **dangerous to perform a lumbar puncture** in this scenario as it can precipitate herniation." }
    ];

    const medulla_4_content = [
        { type: "text", text: "<h4 class='font-semibold text-base mt-2 mb-1 text-teal-600 dark:text-blue-400' style='color: var(--accent-light);'>Lateral Medullary Syndrome (Wallenberg)</h4>" },
        { type: "text", text: "Supply: **Posterior Inferior Cerebellar Artery (PICA)**. Thrombosis leads to a highly characteristic set of symptoms:" },
        {
            type: "table",
            headers: ["Structure/Tract", "Ipsilateral (Same Side)", "Contralateral (Opposite Side)"],
            rows: [
                ["CN Nuclei (IX, X, V)", "Dysphagia, Dysarthria, Facial Pain/Temp loss", "None"],
                ["Vestibular Nuclei", "Vertigo, Nystagmus, Nausea/Vomiting", "None"],
                ["Descending Sympathetic Fibers", "Horner Syndrome (Ptosis, Miosis, Anhidrosis)", "None"],
                ["Spinothalamic Tract", "None", "Loss of Pain & Temperature on body"]
            ]
        },
        { type: "text", text: "<h4 class='font-semibold text-base mt-4 mb-1 text-teal-600 dark:text-blue-400' style='color: var(--accent-light);'>Medial Medullary Syndrome</h4>" },
        { type: "text", text: "Supply: **Vertebral Artery** (or its branches). Thrombosis affects:" },
        {
            type: "table",
            headers: ["Involved Structure", "Symptom"],
            rows: [
                ["Pyramidal Tract", "Contralateral Hemiparesis"],
                ["Medial Lemniscus", "Contralateral Loss of Proprioception/Fine Touch"],
                ["Hypoglossal Nerve (XII)", "Ipsilateral tongue paralysis → deviation to paralyzed side"]
            ]
        }
    ];

    // Refactored Pons Content
    const pons_1_content = [
        { type: "text", text: "Location: Posterior cranial fossa. Forms the upper half of the floor of the fourth ventricle." },
        { type: "text", text: "Contains nuclei for **CN V, VI, VII, VIII**. Serves as a major conduit for **Corticospinal** tracts, the **Medial Longitudinal Fasciculus (MLF)**, and the lemnisci." },
        { type: "text", text: "Lesions (tumors, hemorrhage, infarcts) often result in a wide variety of symptoms, including classic crossed palsies." }
    ];

    const pons_2_content = [
        { type: "text", text: "The **Astrocytoma** is the most common brainstem tumor in childhood." },
        { type: "text", text: "<h4 class='font-semibold text-base mt-2 mb-1 text-teal-600 dark:text-blue-400' style='color: var(--accent-light);'>Common Presentation (Crossed Signs)</h4>" },
        {
            type: "text",
            text: `
            <ul class='list-disc pl-5 text-sm space-y-1'>
                <li>**Ipsilateral Cranial Nerve Paralysis:** Weakness of facial muscles (VII), lateral rectus (VI), jaw muscles (V).</li>
                <li>**Contralateral Hemiparesis** (Corticospinal tracts).</li>
                <li>**Contralateral Sensory Defects** (Medial & Spinal Lemnisci).</li>
                <li>**Impaired Conjugate Eye Movements** (MLF involvement).</li>
                <li>**Ipsilateral Cerebellar Signs** (Corticopontocerebellar tracts).</li>
            </ul>
            `
        }
    ];

    const pons_3_content = [
        { type: "text", text: "Blood supply comes from the **basilar artery** and its branches. Hemorrhage is often life-threatening." },
        { type: "text", text: "<h4 class='font-semibold text-base mt-2 mb-1 text-teal-600 dark:text-blue-400' style='color: var(--accent-light);'>Clinical Presentation</h4>" },
        {
            type: "text",
            text: `
            <ul class='list-disc pl-5 text-sm space-y-1'>
                <li>**Unilateral:** Ipsilateral facial paralysis, contralateral limb paralysis, ocular deviation.</li>
                <li>**Bilateral (Massive):** Often results in **“pinpoint” pupils**, **bilateral paralysis (quadriplegia)**, and **poikilothermia**.</li>
            </ul>
            `
        }
    ];

    const pons_4_content = [
        { type: "text", text: "Caused by thrombosis or embolism of the **basilar artery** or its branches." },
        {
            type: "table",
            headers: ["Type of Infarct", "Damaged Structures", "Key Symptoms"],
            rows: [
                ["Paramedian", "Corticospinal tracts, Pontine Nuclei", "Contralateral hemiparesis, Ipsilateral ataxia"],
                ["Lateral", "Trigeminal nerve, CN VII/VIII pathways, Spinothalamic", "Ipsilateral facial weakness, Contralateral sensory loss (AICA Syndrome)"]
            ]
        }
    ];

    // Refactored Midbrain Content
    const midbrain_1_content = [
        { type: "text", text: "The **upper end of the brainstem**, vulnerable to trauma. Contains nuclei for **CN III (Oculomotor)** and **CN IV (Trochlear)**." },
        { type: "text", text: "Important motor control centers: **Red Nucleus** and **Substantia Nigra**. The **Colliculi** serve as visual and auditory reflex centers." },
        { type: "text", text: "Acts as a major conduit for ascending and descending tracts (Corticospinal fibers run through the Crus Cerebri)." }
    ];

    const midbrain_2_content = [
        { type: "text", text: "Sudden lateral head movement can cause the cerebral peduncles to **impinge against the tentorium edge**." },
        { type: "text", text: "<h4 class='font-semibold text-base mt-2 mb-1 text-teal-600 dark:text-blue-400' style='color: var(--accent-light);'>Cranial Nerve Palsies</h4>" },
        {
            type: "text",
            text: `
            <ul class='list-disc pl-5 text-sm space-y-1'>
                <li>**Oculomotor (CN III) Palsy:** **Ipsilateral** paralysis of most extrinsic eye muscles, **Ptosis**, **Dilated pupil** (parasympathetic fibers affected).</li>
                <li>**Trochlear (CN IV) Palsy:** **Contralateral** paralysis of the superior oblique muscle (difficulty looking down and in).</li>
            </ul>
            `
        }
    ];

    const midbrain_3_content = [
        { type: "text", text: "Blockage (e.g., congenital hydrocephalus, pineal gland tumor) of the **Cerebral Aqueduct** prevents CSF flow from the third to the fourth ventricle." },
        { type: "text", text: "The resulting pressure often causes lesions in the surrounding midbrain (Periaqueductal Gray Matter)." },
        { type: "text", text: "Symptoms involve the adjacent structures: **CN III/IV nuclei** and the major tracts like the **corticospinal tracts** and associated eye movement centers (e.g., **Parinaud Syndrome**)." }
    ];

    const midbrain_4_content = [
        { type: "text", text: "Caused by occlusion of branches of the **Posterior Cerebral Artery**." },
        {
            type: "table",
            headers: ["Syndrome", "Affected Structures", "Key Signs (Classic Crossed Palsy)"],
            rows: [
                ["**Weber Syndrome**", "CN III nerve and Crus Cerebri", "Ipsilateral CN III Palsy; Contralateral Hemiplegia"],
                ["**Benedikt Syndrome**", "CN III nerve, Medial Lemniscus, Red Nucleus", "Ipsilateral CN III Palsy; Contralateral Hemianesthesia & Tremor/Ataxia (from red nucleus)"]
            ]
        }
    ];

    // Refactored Meninges Content
    const meninges_1_content = [
        { type: "text", text: "The three layers provide protection, buoyancy (CSF), and structural support." },
        { type: "text", text: "<h4 class='font-semibold text-base mt-2 mb-1 text-teal-600 dark:text-blue-400' style='color: var(--accent-light);'>Functional Layers</h4>" },
        {
            type: "text",
            text: `
            <ul class='list-disc pl-5 text-sm space-y-1'>
                <li>**Dura Mater:** Tough, protective layer. Forms dural folds (**Falx Cerebri, Tentorium Cerebelli**) to limit brain movement.</li>
                <li>**Arachnoid Mater:** Thin, impermeable. Forms the **Subarachnoid space** which contains CSF.</li>
                <li>**Pia Mater:** Vascular membrane that closely invests the brain and spinal cord.</li>
            </ul>
            `
        }
    ];

    const meninges_2_content = [
        { type: "text", text: "Excessive brain movement in trauma can cause the brain to impact the skull or dural folds." },
        { type: "text", text: "This movement can injure **tethered cranial nerves** or cause the tearing of **cortical veins** at their entry point into the dural sinuses." },
        { type: "text", text: "The tearing of veins is the common cause of **Subdural Hemorrhage**." }
    ];

    const meninges_3_content = [
        { type: "text", text: "Headaches arise from pain-sensitive structures **outside the brain** (meninges, blood vessels). The dura is highly innervated." },
        { type: "text", text: "<h4 class='font-semibold text-base mt-2 mb-1 text-teal-600 dark:text-blue-400' style='color: var(--accent-light);'>Meningeal Headaches (e.g., Meningitis)</h4>" },
        { type: "text", text: "Dural sensory supply is from the Trigeminal nerve (above Tentorium) and Cervical nerves (below Tentorium). Irritation (e.g., infection) causes severe headache, often referred to the corresponding regions." },
        { type: "text", text: "<h4 class='font-semibold text-base mt-4 mb-1 text-teal-600 dark:text-blue-400' style='color: var(--accent-light);'>Clinical Hemorrhages</h4>" },
        {
            type: "table",
            headers: ["Hemorrhage", "Vessel Injured", "CT Shape"],
            rows: [
                ["**Epidural Hematoma**", "Middle Meningeal Artery", "**Lens-shaped** (biconvex), does not cross sutures."],
                ["**Subdural Hematoma**", "Bridging Veins (Superior Cerebral Veins)", "**Crescent-shaped**, crosses suture lines."],
                ["**Subarachnoid Hemorrhage**", "Berry Aneurysm (Circle of Willis)", "Blood in sulci and basal cisterns ('Thunderclap' headache)."]
            ]
        }
    ];

    // --- The Main Data Object ---
    const clinicalData = {
        "Spinal Cord": [
            {
                id: 'paralysis', title: "1. Types of Paralysis", source: "Snell’s Neuroanatomy",
                content: [
                    { type: "text", text: "<strong>Definition:</strong> Paralysis means loss of voluntary motor control due to interruption of motor pathways." },
                    { type: "text", text: "<h4 class='font-semibold text-base mt-2 mb-1 text-teal-600 dark:text-blue-400' style='color: var(--accent-light);'>Types</h4>" },
                    {
                        type: "table",
                        headers: ["Type", "Description", "Common Cause"],
                        rows: [
                            ["Monoplegia", "Paralysis of one limb", "Local cortical or peripheral lesion"],
                            ["Hemiplegia", "Paralysis of one side of body (arm + leg)", "Lesion above decussation (internal capsule, brainstem, cortex)"],
                            ["Paraplegia", "Paralysis of both lower limbs", "Spinal cord lesion below cervical level"],
                            ["Diplegia", "Paralysis of both corresponding limbs (arms or legs)", "Bilateral cerebral lesion (e.g., cerebral palsy)"],
                            ["Quadriplegia (Tetraplegia)", "Paralysis of all four limbs", "Cervical cord injury"]
                        ]
                    },
                    { type: "text", text: "<h4 class='font-semibold text-base mt-4 mb-1 text-teal-600 dark:text-blue-400' style='color: var(--accent-light);'>Explanation</h4><ul class='list-disc pl-5 text-sm space-y-1'><li>Each type reflects which part of descending motor pathway (corticospinal tract) is damaged.</li><li>Unilateral cortical lesion → Hemiplegia</li><li>Bilateral cord lesion → Paraplegia</li><li>Cervical cord lesion → Quadriplegia</li></ul>" },
                ]
            },
            {
                id: 'umnlmn', title: "2. Upper Motor Neuron (UMN) vs Lower Motor Neuron (LMN) Lesion", source: "Snell’s Neuroanatomy",
                content: [
                    { type: "text", text: "<strong>Definition:</strong> <ul><li>UMN lesion: Damage to corticospinal or corticobulbar tracts above anterior horn cell.</li><li>LMN lesion: Damage to anterior horn cells or their axons in peripheral nerves.</li></ul>" },
                    { type: "text", text: "<h4 class='font-semibold text-base mt-2 mb-1 text-teal-600 dark:text-blue-400' style='color: var(--accent-light);'>Site of Lesion</h4><ul class='list-disc pl-5 text-sm space-y-1'><li><strong>UMN:</strong> Brain, internal capsule, brainstem, spinal cord (above anterior horn)</li><li><strong>LMN:</strong> Anterior horn cell, ventral root, spinal nerve, peripheral nerve</li></ul>" },
                    { type: "text", text: "<h4 class='font-semibold text-base mt-4 mb-1 text-teal-600 dark:text-blue-400' style='color: var(--accent-light);'>Clinical Features and Reasons</h4>" },
                    {
                        type: "table",
                        headers: ["Feature", "UMN Lesion", "LMN Lesion", "Reason / Explanation"],
                        rows: [
                            ["Muscle Power", "Decreased (not lost initially)", "Severely decreased", "UMN provides inhibitory and facilitatory control; loss causes imbalance"],
                            ["Muscle Tone", "Increased (Spasticity, Rigidity, Clonus)", "Decreased (Flaccid)", "In UMN lesion, gamma loop hyperactive → hypertonia"],
                            ["Reflexes", "Exaggerated (Hyperreflexia)", "Absent / Decreased", "UMN normally inhibits spinal reflex arcs"],
                            ["Babinski Sign", "Present (dorsiflexion of big toe)", "Absent (normal plantar flexion)", "Due to loss of corticospinal inhibition"],
                            ["Fasciculations", "Absent", "Present", "LMN degeneration causes spontaneous firing of motor units"],
                            ["Atrophy", "Mild (disuse)", "Severe (denervation)", "Muscle loses direct nerve supply in LMN lesion"]
                        ]
                    }
                ]
            },
            {
                id: 'tabes', title: "3. Tabes Dorsalis", source: "Snell’s Neuroanatomy",
                content: [
                    { type: "text", text: "<strong>Definition:</strong> A chronic neurosyphilis infection affecting the posterior (dorsal) roots and columns of the spinal cord." },
                    { type: "text", text: "<strong>Lesion Site:</strong> <ul><li>Posterior columns (Gracile and Cuneate fasciculi)</li><li>Dorsal roots (especially in lumbosacral region)</li></ul>" },
                    { type: "text", text: "<strong>Cause:</strong> Late-stage <em>Treponema pallidum</em> infection → degeneration of sensory neurons" },
                    { type: "text", text: "<strong>Tracts Involved:</strong> Dorsal column (fine touch, vibration, proprioception), Spinocerebellar tracts (coordination), Dorsal roots (reflex arcs)" },
                    { type: "text", text: "<h4 class='font-semibold text-base mt-4 mb-1 text-teal-600 dark:text-blue-400' style='color: var(--accent-light);'>Clinical Features (with reason)</h4>" },
                    {
                        type: "table",
                        headers: ["Symptom", "Explanation"],
                        rows: [
                            ["Stabbing pain in lower limbs", "Irritation of dorsal roots by inflammatory process"],
                            ["Loss of proprioception and vibration sense", "Dorsal column degeneration"],
                            ["Sensory ataxia (unsteady gait)", "Brain doesn’t receive position sense input → stamping gait"],
                            ["Hypotonia", "Muscle spindle feedback lost"],
                            ["Loss of tendon reflexes", "Reflex arcs destroyed due to dorsal root lesion"],
                            ["Positive Romberg’s sign", "Patient sways with eyes closed due to loss of position sense"]
                        ]
                    }
                ]
            },
            {
                id: 'transection', title: "4. Complete Cord Transection Syndrome", source: "Snell’s Neuroanatomy",
                content: [
                    { type: "text", text: "<strong>Definition:</strong> Complete severing of the spinal cord at any level → loss of all motor and sensory functions below lesion." },
                    { type: "text", text: "<strong>Common Causes:</strong> Vertebral fracture or dislocation, Penetrating trauma, Tumor or severe disc prolapse." },
                    { type: "text", text: "<strong>Tracts Affected:</strong> Corticospinal (motor), Spinothalamic (pain/temp), Dorsal column (fine touch/proprioception), Autonomic tracts (bladder, bowel, vasomotor loss)." },
                    { type: "text", text: "<h4 class='font-semibold text-base mt-4 mb-1 text-teal-600 dark:text-blue-400' style='color: var(--accent-light);'>Clinical Features</h4>" },
                    {
                        type: "table",
                        headers: ["Phase", "Manifestation", "Explanation"],
                        rows: [
                            ["Spinal Shock (immediate)", "Flaccid paralysis, areflexia, no tone, urinary retention", "Temporary suppression of all reflexes"],
                            ["After few weeks", "Spastic paralysis, hyperreflexia, Babinski positive", "Reflex circuits recover but under no cortical control"],
                            ["Sensory loss", "All modalities lost below lesion", "Complete interruption of ascending tracts"],
                            ["Autonomic loss", "Bladder/bowel incontinence", "Descending autonomic fibers disrupted"]
                        ]
                    }
                ]
            },
            {
                id: 'anterior', title: "5. Anterior Cord Syndrome", source: "Snell’s Neuroanatomy",
                content: [
                    { type: "text", text: "<strong>Definition:</strong> Infarction or damage to the anterior two-thirds of the spinal cord due to anterior spinal artery occlusion." },
                    { type: "text", text: "<strong>Lesion Site:</strong> Corticospinal tracts (motor), Spinothalamic tracts (pain and temperature), <strong>Sparing of dorsal columns</strong> (posterior one-third intact)." },
                    { type: "text", text: "<strong>Causes:</strong> Atherosclerosis, Trauma, Aortic surgery complication." },
                    { type: "text", text: "<h4 class='font-semibold text-base mt-4 mb-1 text-teal-600 dark:text-blue-400' style='color: var(--accent-light);'>Clinical Features (with reasoning)</h4>" },
                    {
                        type: "table",
                        headers: ["Feature", "Explanation"],
                        rows: [
                            ["Bilateral motor paralysis below lesion", "Corticospinal tract destruction"],
                            ["Loss of pain & temperature below lesion", "Spinothalamic tract damage"],
                            ["Preserved fine touch, vibration, proprioception", "Dorsal column spared (posterior blood supply intact)"],
                            ["LMN signs at level of lesion", "Anterior horn cells directly damaged"]
                        ]
                    }
                ]
            },
            {
                id: 'central', title: "6. Central Cord Syndrome", source: "Snell’s Neuroanatomy",
                content: [
                    { type: "text", text: "<strong>Definition:</strong> Damage to central gray matter and adjacent white matter, usually in cervical spinal cord." },
                    { type: "text", text: "<strong>Common Cause:</strong> Hyperextension injury (especially in elderly), Syringomyelia (fluid-filled cavity expansion)." },
                    { type: "text", text: "<strong>Lesion Site:</strong> Crossing fibers of spinothalamic tract (pain/temp), Cervical corticospinal fibers (upper limbs more affected)." },
                    { type: "text", text: "<h4 class='font-semibold text-base mt-4 mb-1 text-teal-600 dark:text-blue-400' style='color: var(--accent-light);'>Clinical Features (and reasoning)</h4>" },
                    {
                        type: "table",
                        headers: ["Feature", "Explanation"],
                        rows: [
                            ["Bilateral loss of pain and temperature (cape-like pattern)", "Crossing spinothalamic fibers damaged at anterior commissure"],
                            ["Motor weakness (upper limb > lower limb)", "Cervical corticospinal fibers compressed centrally"],
                            ["Sacral sparing", "Sacral fibers located laterally, spared in central lesion"],
                            ["Variable LMN weakness at level of lesion", "Anterior horn involvement possible"]
                        ]
                    }
                ]
            },
            {
                id: 'brown-sequard', title: "7. Brown-Séquard Syndrome (Cord Hemisection)", source: "Snell’s Neuroanatomy",
                content: [
                    { type: "text", text: "<strong>Definition:</strong> Hemisection of spinal cord (damage to one-half)." },
                    { type: "text", text: "<strong>Common Cause:</strong> Penetrating injury (knife, bullet), Vertebral fracture, Tumor." },
                    { type: "text", text: "<strong>Lesion Site:</strong> One half of cord → affects both ascending and descending tracts." },
                    { type: "text", text: "<h4 class='font-semibold text-base mt-4 mb-1 text-teal-600 dark:text-blue-400' style='color: var(--accent-light);'>Clinical Features (and reasoning)</h4>" },
                    {
                        type: "table",
                        headers: ["Side", "Tract", "Symptom", "Reason"],
                        rows: [
                            ["Ipsilateral (same side)", "Corticospinal tract", "Spastic paralysis below lesion", "Motor tract crosses in medulla, so fibers have already crossed"],
                            ["Ipsilateral (same side)", "Dorsal column", "Loss of fine touch, vibration, proprioception below lesion", "Fibers ascend uncrossed till medulla"],
                            ["Contralateral (opposite side)", "Spinothalamic tract", "Loss of pain and temperature 2 segments below lesion", "Fibers cross in spinal cord after entering 1–2 levels above"]
                        ]
                    },
                    { type: "text", text: "<p class='mt-2 text-sm text-red-700 dark:text-red-400' style='color: var(--secondary-accent);'><strong>At level of lesion:</strong> LMN paralysis and loss of all sensations on the ipsilateral side.</p>" }
                ]
            },
            {
                id: 'syringomyelia', title: "8. Syringomyelia", source: "Snell’s Neuroanatomy",
                content: [
                    { type: "text", text: "<strong>Definition:</strong> Cavitation (fluid-filled cavity) of central canal of spinal cord, usually in cervical region." },
                    { type: "text", text: "<strong>Cause:</strong> Congenital (Arnold–Chiari malformation), Trauma, tumor, or infection." },
                    { type: "text", text: "<strong>Lesion Site:</strong> Anterior white commissure (crossing spinothalamic fibers), Sometimes anterior horn cells." },
                    { type: "text", text: "<h4 class='font-semibold text-base mt-4 mb-1 text-teal-600 dark:text-blue-400' style='color: var(--accent-light);'>Clinical Features (and reasoning)</h4>" },
                    {
                        type: "table",
                        headers: ["Feature", "Explanation"],
                        rows: [
                            ["Bilateral loss of pain & temperature (cape-like)", "Crossing spinothalamic fibers interrupted"],
                            ["Preserved fine touch, vibration", "Dorsal columns intact"],
                            ["Muscle wasting, weakness of hands", "LMN damage (anterior horn)"],
                            ["Spasticity in lower limbs", "Corticospinal tract involvement laterally"],
                            ["Scoliosis", "Unequal paraspinal weakness"]
                        ]
                    }
                ]
            },
            {
                id: 'arnold-chiari-sc', title: "9. Arnold–Chiari Malformation (Spinal Cord Focus)", source: "Snell’s Neuroanatomy",
                content: [
                    { type: "text", text: "<strong>Definition:</strong> Congenital herniation of cerebellar tonsils and medulla through the foramen magnum into the vertebral canal." },
                    { type: "text", text: "<strong>Types:</strong> Type I: Mild tonsillar herniation. Type II: With spinal meningomyelocele (severe)." },
                    { type: "text", text: "<strong>Pathophysiology:</strong> Herniation → compression of medulla and upper spinal cord, CSF flow obstruction → internal hydrocephalus." },
                    { type: "text", text: "<h4 class='font-semibold text-base mt-4 mb-1 text-teal-600 dark:text-blue-400' style='color: var(--accent-light);'>Clinical Features (and reasoning)</h4>" },
                    {
                        type: "table",
                        headers: ["Feature", "Explanation"],
                        rows: [
                            ["Headache, neck pain", "Increased intracranial pressure"],
                            ["Dysphagia, dysarthria", "Compression of nucleus ambiguus (CN IX, X)"],
                            ["Vertigo, nystagmus", "Involvement of vestibular nuclei"],
                            ["Ataxia", "Cerebellar compression"],
                            ["Paralysis of laryngeal muscles", "CN X affected"],
                            ["Hydrocephalus", "CSF circulation blocked"]
                        ]
                    }
                ]
            }
        ],
        
        // RESTRUCTURED MEDULLA CONTENT
        "Medulla": [
            {
                id: 'medulla-sig', 
                title: "1. Clinical Significance & Vulnerability", 
                source: "High-Yield Notes",
                content: medulla_1_content
            },
            {
                id: 'medulla-chiari', 
                title: "2. Arnold-Chiari Phenomenon", 
                source: "High-Yield Notes",
                content: medulla_2_content
            },
            {
                id: 'medulla-pressure', 
                title: "3. Raised Posterior Cranial Fossa Pressure", 
                source: "High-Yield Notes",
                content: medulla_3_content
            },
            {
                id: 'medulla-vascular', 
                title: "4. Vascular Disorders of the Medulla", 
                source: "High-Yield Notes",
                content: medulla_4_content
            }
        ],

        // RESTRUCTURED PONS CONTENT
        "Pons": [
            {
                id: 'pons-sig', 
                title: "1. Clinical Significance & Nuclei", 
                source: "High-Yield Notes",
                content: pons_1_content
            },
            {
                id: 'pons-tumors', 
                title: "2. Tumors of the Pons (Astrocytoma)", 
                source: "High-Yield Notes",
                content: pons_2_content
            },
            {
                id: 'pons-hemorrhage', 
                title: "3. Pontine Hemorrhage", 
                source: "High-Yield Notes",
                content: pons_3_content
            },
            {
                id: 'pons-infarcts', 
                title: "4. Infarctions and Syndromes", 
                source: "High-Yield Notes",
                content: pons_4_content
            }
        ],

        // RESTRUCTURED MIDBRAIN CONTENT
        "Midbrain": [
            {
                id: 'midbrain-sig', 
                title: "1. Clinical Significance & Key Structures", 
                source: "High-Yield Notes",
                content: midbrain_1_content
            },
            {
                id: 'midbrain-trauma', 
                title: "2. Trauma and Oculomotor Palsy", 
                source: "High-Yield Notes",
                content: midbrain_2_content
            },
            {
                id: 'midbrain-aqueduct', 
                title: "3. Blockage of Cerebral Aqueduct", 
                source: "High-Yield Notes",
                content: midbrain_3_content
            },
            {
                id: 'midbrain-vascular', 
                title: "4. Vascular Lesions (Weber & Benedikt)", 
                source: "High-Yield Notes",
                content: midbrain_4_content
            }
        ],

        // RESTRUCTURED MENINGES CONTENT
        "Meninges & Pressure": [
            {
                id: 'meninges-sig', 
                title: "1. Functional Significance of the Layers", 
                source: "High-Yield Notes",
                content: meninges_1_content
            },
            {
                id: 'meninges-trauma', 
                title: "2. Excessive Brain Movements in Injury", 
                source: "High-Yield Notes",
                content: meninges_2_content
            },
            {
                id: 'meninges-headaches', 
                title: "3. Headaches and Intracranial Hemorrhage", 
                source: "High-Yield Notes",
                content: meninges_3_content
            }
        ],
        "MCQ Quiz": [] // Placeholder for the quiz tab
    };

    // --- 2. Dynamic Rendering Functions (Modified for Teal/Dark Mode) ---

    // Function to generate the HTML for a table
    function createTable(headers, rows) {
        let tableHtml = `
            <div class="table-responsive">
                <table class="min-w-full divide-y divide-gray-300 dark:divide-gray-600 rounded-lg overflow-hidden shadow-md border border-gray-200 dark:border-gray-700">
                    <thead class="bg-teal-50 dark:bg-gray-700">
                        <tr>
                            ${headers.map(h => `<th scope="col" class="p-3 text-left text-xs font-medium text-teal-800 dark:text-blue-300 uppercase tracking-wider" style="color: var(--accent-light);">${h}</th>`).join('')}
                        </tr>
                    </thead>
                    <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-100 dark:divide-gray-700">
                        ${rows.map(row => `
                            <tr class="hover:bg-gray-50 dark:hover:bg-gray-700">
                                ${row.map(cell => `<td class="p-3 whitespace-normal text-sm text-gray-700 dark:text-gray-300">${cell}</td>`).join('')}
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>`;
        return tableHtml;
    }

    // Function to render content for a single note item
    function renderContent(contentArray) {
        let html = '';
        contentArray.forEach(item => {
            if (item.type === 'text') {
                html += `<div class="text-gray-700 dark:text-gray-300 mb-3 text-sm leading-relaxed structured-notes">${item.text}</div>`;
            } else if (item.type === 'table') {
                html += `<div class="mt-4 mb-4">${createTable(item.headers, item.rows)}</div>`;
            }
        });
        return html;
    }

    // Function to render the accordion for a single clinical note
    function createAccordion(note) {
        return `
            <div class="mb-4 rounded-xl shadow-lg border border-gray-100 dark:border-gray-700 overflow-hidden bg-white dark:bg-gray-800 transition duration-300" data-note-id="${note.id}">
                <button class="accordion-header flex justify-between items-center w-full p-4 bg-white dark:bg-gray-800 text-left text-lg font-semibold text-teal-700 dark:text-blue-300 focus:outline-none hover:bg-teal-50 dark:hover:bg-gray-700" onclick="toggleAccordion('${note.id}')" style="color: var(--primary-text); background-color: var(--card-bg); border-left-color: var(--accent-light);">
                    <span class="flex-1" style="color: var(--accent-light);">${note.title}</span>
                    <span class="text-sm font-normal text-gray-500 dark:text-gray-400 italic hidden sm:block ml-4 mr-2">${note.source}</span>
                    <svg class="w-5 h-5 transition-transform duration-300 transform text-teal-500 dark:text-blue-400" data-icon-id="${note.id}" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" style="color: var(--accent-light);"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </button>
                <div id="content-${note.id}" class="accordion-content p-4 bg-gray-50 dark:bg-gray-900 hidden border-t border-gray-100 dark:border-gray-700" style="background-color: var(--bg-color); border-top-color: var(--grid-line);">
                    ${renderContent(note.content)}
                </div>
            </div>
        `;
    }

    // Function to render all tabs and set up the click handler
    function setupTabs() {
        const tabsContainer = document.getElementById('tabs-container');
        tabsContainer.innerHTML = ''; // Clear previous tabs

        const tabKeys = Object.keys(clinicalData);

        // Define the default tab to load
        let defaultTab = "MCQ Quiz"; // Set quiz as default

        tabKeys.forEach((key) => {
            const button = document.createElement('button');
            // Custom styles applied here for the red/blue blend
            button.className = `tab-button px-3 py-2 text-sm font-medium border-b-2 border-transparent text-gray-600 dark:text-gray-400 hover:text-teal-600 dark:hover:text-blue-400 hover:border-teal-300 dark:hover:border-red-500 transition duration-150 rounded-t-lg mx-1`;
            button.textContent = key;
            button.onclick = () => switchTab(key);
            tabsContainer.appendChild(button);

            // Set the initial active tab and content
            if (key === defaultTab) {
                button.classList.add('active');
                switchTab(key); // Call switchTab to render the content immediately
            }
        });
    }

    // Function to handle tab switching
    function switchTab(categoryKey) {
        document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
        const targetButton = Array.from(document.querySelectorAll('.tab-button')).find(btn => btn.textContent === categoryKey);
        if (targetButton) {
            targetButton.classList.add('active');
        }

        if (categoryKey === "MCQ Quiz") {
            renderQuiz();
        } else {
            displayCategory(categoryKey);
        }
    }

    // Main function to display notes for the active category
    function displayCategory(categoryKey) {
        const container = document.getElementById('content-container');
        container.innerHTML = '';
        
        const notes = clinicalData[categoryKey];
        if (notes && notes.length > 0) {
            notes.forEach(note => {
                container.innerHTML += createAccordion(note);
            });
        } else {
            // Only show a message if the category is truly empty (e.g., if we kept the original Brainstem/Meninges as empty)
             container.innerHTML = `<div class="text-center p-12 text-teal-700 dark:text-blue-300 bg-teal-50 dark:bg-gray-800 m-4 rounded-xl border border-teal-200 dark:border-gray-700 shadow-inner" style="border-color: var(--grid-line); background-color: var(--card-bg);">
                <p class="text-3xl mb-3" style="color: var(--accent-light);">🧠 Notes Coming Soon!</p>
                <p class="text-lg">Detailed clinical summaries for <strong>${categoryKey}</strong> will be added shortly. In the meantime, test your knowledge in the <strong>MCQ Quiz</strong> tab!</p>
            </div>`;
        }
    }

    // Function to toggle the accordion content
    function toggleAccordion(id) {
        const content = document.getElementById(`content-${id}`);
        const header = document.querySelector(`[data-note-id="${id}"] .accordion-header`);
        const icon = document.querySelector(`[data-icon-id="${id}"]`);

        const isVisible = !content.classList.contains('hidden');

        if (isVisible) {
            content.classList.add('hidden');
            header.classList.remove('active');
            icon.classList.remove('rotate-180');
        } else {
            // Hide all other open accordions
            document.querySelectorAll('.accordion-content').forEach(c => {
                c.classList.add('hidden');
                c.previousElementSibling.classList.remove('active');
                c.previousElementSibling.querySelector('svg').classList.remove('rotate-180');
            });
            // Show current one
            content.classList.remove('hidden');
            header.classList.add('active');
            icon.classList.add('rotate-180');
        }
    }

    // --- 3. MCQ Quiz Data and Logic (UPDATED) ---

    // The new 50-question data array (extracted from your prompt)
    const newMcqData = [
        { q: "A 65-year-old man suddenly develops dysphagia, hoarseness, ipsilateral facial analgesia, vertigo, nystagmus, ipsilateral Horner syndrome, and contralateral loss of pain and temperature in the body after an episode of hypertension. Which artery is most likely occluded?", opts: ["Anterior spinal artery", "Posterior inferior cerebellar artery", "Basilar artery", "Superior cerebellar artery"], ans: "Posterior inferior cerebellar artery", exp: "Lateral medullary (Wallenberg) syndrome → PICA involvement → nucleus ambiguus (IX, X), vestibular nuclei, spinothalamic tract, descending sympathetic fibers." },
        { q: "A 50-year-old patient presents with sudden onset right-sided weakness, loss of vibration and proprioception on the right side, and deviation of the tongue to the left on protrusion. Mild dysarthria is also noted. Where is the lesion?", opts: ["Right lateral medulla", "Left medial medulla", "Right anterior cord", "Left posterior cord"], ans: "Left medial medulla", exp: "Medial medullary syndrome (Left side) → medial lemniscus (contralateral sensory loss on right side), pyramidal tract (contralateral weakness on right side), hypoglossal nerve (ipsilateral tongue deviation to left side)." },
        { q: "After a minor fall, a 45-year-old man presents with bilateral facial weakness, quadriplegia, pinpoint pupils, and inability to regulate body temperature. MRI shows hemorrhage in the brainstem. Which structure is most extensively damaged?", opts: ["Midbrain", "Pons", "Medulla oblongata", "Cerebellum"], ans: "Pons", exp: "Bilateral pontine hemorrhage → facial nerve nuclei (bilateral LMN facial paralysis), corticospinal fibers (quadriplegia), hypothalamic connections (poikilothermia), ocular sympathetic fibers (pinpoint pupils)." },
        { q: "A 7-year-old child presents with ipsilateral facial weakness, lateral rectus palsy, nystagmus, contralateral hemiparesis, and ataxia. Imaging reveals a mass in the brainstem. Which tract explains the ipsilateral ataxia?", opts: ["Corticospinal", "Corticopontocerebellar", "Spinothalamic", "Medial lemniscus"], ans: "Corticopontocerebellar", exp: "Corticopontocerebellar tract lesion → ipsilateral cerebellar signs (intention tremor & ataxia)." },
        { q: "A 60-year-old man with hypertension develops drooping eyelid, dilated pupil, lateral deviation of the eyeball, and contralateral hemiplegia. Which syndrome is most consistent?", opts: ["Weber syndrome", "Benedikt syndrome", "Lateral medullary syndrome", "Medial medullary syndrome"], ans: "Weber syndrome", exp: "Weber syndrome → oculomotor nerve palsy + contralateral corticospinal tract involvement (Crus Cerebri)." },
        { q: "A patient presents with dysarthria, dysphagia, ipsilateral tongue deviation, contralateral hemiparesis, and contralateral loss of vibration/proprioception. MRI shows a ventromedial medullary infarct. Which structure is affected?", opts: ["Lateral medulla", "Medial medulla", "Pons", "Midbrain"], ans: "Medial medulla", exp: "Medial medullary syndrome → pyramid (corticospinal), medial lemniscus, hypoglossal nucleus." },
        { q: "After sudden hypertension, a 58-year-old man develops vertigo, nausea, vomiting, ipsilateral limb ataxia, and loss of pain and temperature in contralateral limbs, with dysphagia and hoarseness. Cranial nerve exam shows IX, X, XI involvement. What artery is involved?", opts: ["PICA", "Anterior spinal artery", "Superior cerebellar artery", "Basilar artery"], ans: "PICA", exp: "Lateral medullary syndrome (Wallenberg) is caused by PICA occlusion." },
        { q: "A child presents with weakness of facial muscles on the same side, weakness of lateral rectus, contralateral hemiparesis, sensory defects in face/trunk/limbs, and ipsilateral cerebellar signs. The lesion is most likely located in:", opts: ["Medulla", "Pons", "Midbrain", "Cerebellum"], ans: "Pons", exp: "A lesion in the pons often causes crossed signs (ipsilateral CNs VI/VII, contralateral long tracts) with ipsilateral cerebellar signs (Corticopontocerebellar fibers)." },
        { q: "A patient develops ipsilateral ophthalmoplegia, ptosis, lateral deviation of eyeball, contralateral hemiplegia, and mild tremor of contralateral limbs. MRI shows midbrain infarct. Which artery is likely involved?", opts: ["Posterior cerebral artery", "PICA", "Basilar artery", "Anterior spinal artery"], ans: "Posterior cerebral artery", exp: "Weber + Benedikt features → PCA branch → oculomotor nucleus + crus cerebri + red nucleus." },
        { q: "Trauma causes a patient to have ipsilateral levator palpebrae, superior, inferior, medial rectus, inferior oblique paralysis, dilated pupil, and contralateral trochlear palsy. The most likely site of injury is:", opts: ["Midbrain", "Pons", "Medulla", "Cervical cord"], ans: "Midbrain", exp: "Oculomotor (III) and Trochlear (IV) nuclei are in the midbrain. Ipsilateral CN III palsy and contralateral CN IV palsy (as the CN IV nerve crosses before exit) is midbrain injury." },
        { q: "A 55-year-old man presents with bilateral upper limb weakness > lower limbs, impaired pain and temperature in hands, vibration & proprioception intact, after a fall. MRI shows central cord hyperintensity at C5-C6. Most likely lesion?", opts: ["Central cord syndrome", "Anterior cord syndrome", "Brown-Séquard syndrome", "Complete cord transection"], ans: "Central cord syndrome", exp: "Hyperextension injury in the elderly often causes central cord edema/damage → central motor/pain-temp tracts affected, with cervical (upper limb) fibers most central." },
        { q: "A patient with history of syphilis complains of loss of proprioception and vibration in lower limbs, ataxic gait, positive Romberg sign, lightning pains in legs, motor function intact. Which tract is affected?", opts: ["Dorsal columns", "Spinothalamic tract", "Corticospinal tract", "Anterior horn"], ans: "Dorsal columns", exp: "Tabes Dorsalis → syphilis affects dorsal roots and columns → loss of proprioception/vibration and sensory ataxia." },
        { q: "A 30-year-old male presents with ipsilateral spastic hemiparesis of lower limb, loss of proprioception on same side, and loss of pain/temp on opposite side, after penetrating injury at T10. Pattern?", opts: ["Brown-Séquard syndrome", "Central cord syndrome", "Anterior cord syndrome", "Complete cord transection"], ans: "Brown-Séquard syndrome", exp: "Spinal cord hemisection (Brown-Séquard) → ipsilateral UMN (corticospinal) and dorsal column loss, contralateral spinothalamic loss." },
        { q: "A 25-year-old man has loss of pain and temperature in a cape-like distribution over shoulders & arms, with preserved vibration & proprioception. MRI shows central cervical cord cyst. Likely diagnosis?", opts: ["Syringomyelia", "Central cord syndrome", "Anterior cord syndrome", "Brown-Séquard syndrome"], ans: "Syringomyelia", exp: "Central cavitation/cyst formation typically damages the crossing spinothalamic fibers at the anterior white commissure → bilateral, segmental loss of pain/temperature." },
        { q: "A 20-year-old newborn presents with herniation of cerebellar tonsils, hydrocephalus, apnea, and stridor. MRI shows tonsillar herniation through foramen magnum. Diagnosis?", opts: ["Arnold-Chiari malformation", "Dandy-Walker malformation", "Syringomyelia", "Holoprosencephaly"], ans: "Arnold-Chiari malformation", exp: "Type II Chiari malformation involves tonsillar and brainstem herniation, causing hydrocephalus and lower cranial nerve signs (apnea, stridor)." },
        { q: "A patient presents with flaccid paralysis of all limbs initially, later spasticity develops, loss of all sensation below lesion, and autonomic dysfunction, following a traumatic fall. Most likely syndrome?", opts: ["Complete cord transection", "Anterior cord syndrome", "Central cord syndrome", "Brown-Séquard syndrome"], ans: "Complete cord transection", exp: "Complete cord transection initially presents with spinal shock (flaccid paralysis) followed by hyperreflexia/spasticity." },
        { q: "A patient presents with bilateral motor loss below the lesion, impaired pain and temperature, preserved vibration/proprioception, following ischemia of the anterior spinal artery. Diagnosis?", opts: ["Anterior cord syndrome", "Central cord syndrome", "Brown-Séquard syndrome", "Complete cord transection"], ans: "Anterior cord syndrome", exp: "Anterior spinal artery supplies the anterior 2/3 of the cord (motor + spinothalamic) but spares the posterior 1/3 (dorsal columns)." },
        { q: "Following a flexion injury of the neck, an elderly patient presents with upper limb weakness > lower limb, impaired pain & temperature in hands, with intact vibration/proprioception. Likely mechanism?", opts: ["Hyperextension → central cord edema", "Anterior cord ischemia", "Brown-Séquard hemisection", "Dorsal column lesion"], ans: "Hyperextension → central cord edema", exp: "Central Cord Syndrome (CCS) is often caused by hyperextension trauma and results in a classic upper limb > lower limb motor weakness." },
        { q: "A patient presents with ipsilateral LMN facial weakness, contralateral hemiparesis, contralateral loss of touch and vibration, after brainstem trauma. Which tracts & nuclei explain findings?", opts: ["Corticospinal + facial nucleus + medial lemniscus", "Spinothalamic + vestibular nuclei", "Medial longitudinal fasciculus", "Corticospinal + red nucleus only"], ans: "Corticospinal + facial nucleus + medial lemniscus", exp: "A pontine lesion can involve the ipsilateral facial nucleus/nerve (LMN face), the pyramidal tract (contralateral hemiparesis), and the medial lemniscus (contralateral proprioception/vibration loss)." },
        { q: "A 65-year-old patient develops vertigo, vomiting, ipsilateral ataxia, ipsilateral Horner syndrome, ipsilateral facial analgesia, and contralateral pain/temp loss in limbs. Most likely site of infarct?", opts: ["Lateral medulla", "Medial medulla", "Pons", "Midbrain"], ans: "Lateral medulla", exp: "Classic Wallenberg/Lateral Medullary Syndrome due to PICA occlusion." },
        { q: "After a traumatic fall, a 55-year-old man develops complete loss of motor and sensory function below the lesion, flaccid initially then spastic, with loss of bladder and bowel control. Which syndrome best describes his condition?", opts: ["Central cord syndrome", "Complete cord transection syndrome", "Brown-Séquard syndrome", "Anterior cord syndrome"], ans: "Complete cord transection syndrome", exp: "Complete loss of all functions below the lesion, with the two-stage (flaccid → spastic) motor presentation." },
        { q: "A 35-year-old presents with loss of bilateral pain and temperature in hands and shoulders, but motor function and vibration/proprioception remain intact. Which condition is most likely?", opts: ["Central cord syndrome", "Syringomyelia", "Anterior cord syndrome", "Brown-Séquard syndrome"], ans: "Syringomyelia", exp: "Cape-like distribution of pain/temp loss with preservation of dorsal column senses is the classic presentation of syringomyelia." },
        { q: "A 40-year-old man with a history of syphilis complains of ataxia, loss of vibration and proprioception in lower limbs, with a positive Romberg sign, but motor function is intact. Which tract is affected?", opts: ["Spinothalamic tract", "Corticospinal tract", "Dorsal column (fasciculus gracilis & cuneatus)", "Anterior horn cells"], ans: "Dorsal column (fasciculus gracilis & cuneatus)", exp: "Tabes dorsalis affects the dorsal columns leading to sensory ataxia and proprioception loss." },
        { q: "Following an ischemic spinal event, a patient shows loss of motor function below lesion, impaired pain and temperature, but preserved vibration and proprioception. Which syndrome is most likely?", opts: ["Anterior cord syndrome", "Central cord syndrome", "Brown-Séquard syndrome", "Complete cord transection"], ans: "Anterior cord syndrome", exp: "Loss of anterior spinal artery territory (motor and spinothalamic) with sparing of posterior columns." },
        { q: "A hyperextension injury in an elderly patient results in upper limb weakness greater than lower limb weakness, impaired pain and temperature in the hands, but intact vibration and proprioception. Which syndrome is most likely?", opts: ["Central cord syndrome", "Anterior cord syndrome", "Brown-Séquard syndrome", "Complete cord transection"], ans: "Central cord syndrome", exp: "The classic presentation of Central Cord Syndrome: upper limb predominance due to central location of cervical tracts." },
        { q: "A patient suffers a penetrating hemisection of the spinal cord. He presents with ipsilateral loss of motor function and dorsal column sensations, but contralateral loss of pain and temperature. Which syndrome is this?", opts: ["Central cord syndrome", "Brown-Séquard syndrome", "Anterior cord syndrome", "Complete cord transection"], ans: "Brown-Séquard syndrome", exp: "Ipsilateral motor/proprioception (uncrossed) and contralateral pain/temp (crossed)." },
        { q: "A patient develops hoarseness, dysphagia, ipsilateral limb ataxia, contralateral loss of pain and temperature following a stroke. Which lesion best explains these findings?", opts: ["Medial medullary syndrome", "Lateral medullary (Wallenberg) syndrome", "Central cord syndrome", "Brown-Séquard syndrome"], ans: "Lateral medullary (Wallenberg) syndrome", exp: "Involvement of nucleus ambiguus (hoarseness/dysphagia), inferior cerebellar peduncle (ataxia), and spinothalamic tract (contralateral pain/temp loss)." },
        { q: "A patient has contralateral hemiparesis, ipsilateral tongue deviation, and contralateral loss of vibration and proprioception after a stroke. Which syndrome does this describe?", opts: ["Lateral medullary syndrome", "Medial medullary syndrome", "Central cord syndrome", "Complete cord transection"], ans: "Medial medullary syndrome", exp: "Involvement of pyramidal tract (contralateral hemiparesis), medial lemniscus (contralateral proprioception loss), and hypoglossal nerve (ipsilateral tongue deviation)." },
        { q: "A child with a brainstem mass presents with ipsilateral facial weakness, lateral rectus palsy, contralateral hemiparesis, and ipsilateral ataxia. Which tract is responsible for the ipsilateral ataxia?", opts: ["Corticospinal tract", "Spinothalamic tract", "Corticopontocerebellar tract", "Medial lemniscus"], ans: "Corticopontocerebellar tract", exp: "Pontine lesions can involve the descending corticopontocerebellar fibers before they cross, leading to ipsilateral ataxia." },
        { q: "A patient develops ipsilateral ptosis, lateral deviation of the eyeball, dilated pupil, and contralateral hemiplegia after an infarct. Which syndrome is most consistent?", opts: ["Benedikt syndrome", "Weber syndrome", "Lateral medullary syndrome", "Medial medullary syndrome"], ans: "Weber syndrome", exp: "Ipsilateral CN III palsy (ptosis, dilation, deviation) and contralateral motor weakness (hemiplegia) is the classic Weber syndrome." },
        { q: "A patient presents with vertigo, nausea, ipsilateral limb ataxia, ipsilateral Horner syndrome, dysphagia, and contralateral loss of pain and temperature. MRI reveals infarct in the brainstem. Which structures are involved?", opts: ["Medial lemniscus and pyramids", "Nucleus ambiguus, vestibular nuclei, spinothalamic tract, descending sympathetic fibers", "Corticospinal tract and red nucleus", "Hypoglossal nucleus only"], ans: "Nucleus ambiguus, vestibular nuclei, spinothalamic tract, descending sympathetic fibers", exp: "These structures are all located in the lateral medulla, classic for Wallenberg syndrome." },
        { q: "After a brainstem trauma, a 58-year-old patient develops bilateral LMN facial weakness, quadriplegia, poikilothermia, and pinpoint pupils. Which structure is most extensively damaged?", opts: ["Midbrain", "Medulla", "Pons (bilateral)", "Cerebellum"], ans: "Pons (bilateral)", exp: "This massive damage (quadriplegia, CN palsies, sympathetic loss/pinpoint pupils) points to a bilateral lesion in the Pons." },
        { q: "Trauma causes a patient to have ipsilateral paralysis of levator palpebrae, superior, inferior, and medial rectus, inferior oblique, dilated pupil, and contralateral superior oblique paralysis. Lesion is most likely at:", opts: ["Midbrain", "Pons", "Medulla", "Cervical cord"], ans: "Midbrain", exp: "Involvement of CN III and contralateral CN IV (trochlear) in the midbrain." },
        { q: "A patient presents with cape-like loss of pain and temperature in upper limbs, with motor function intact and dorsal columns spared. Mechanism of lesion?", opts: ["Central cord cavity → syringomyelia", "Anterior cord ischemia", "Brown-Séquard hemisection", "Complete cord transection"], ans: "Central cord cavity → syringomyelia", exp: "Syringomyelia causes a cavity that enlarges centrally, damaging crossing pain/temp fibers." },
        { q: "A 60-year-old patient with cervical hyperextension injury develops upper limb weakness > lower limb weakness, impaired pain and temperature in hands, intact vibration and proprioception. Syndrome?", opts: ["Central cord syndrome", "Anterior cord syndrome", "Brown-Séquard syndrome", "Complete cord transection"], ans: "Central cord syndrome", exp: "Classic Central Cord Syndrome presentation due to hyperextension injury." },
        { q: "A penetrating hemisection of the spinal cord at T10 results in ipsilateral motor and dorsal column loss, contralateral loss of pain and temperature. Which syndrome?", opts: ["Central cord syndrome", "Brown-Séquard syndrome", "Anterior cord syndrome", "Complete cord transection"], ans: "Brown-Séquard syndrome", exp: "Ipsilateral motor and proprioception (dorsal column) loss, contralateral pain/temp loss." },
        { q: "Following medial medullary infarct, a patient develops contralateral hemiparesis, contralateral loss of vibration and proprioception, and ipsilateral tongue deviation. Which structures are involved?", opts: ["Pyramid, medial lemniscus, hypoglossal nucleus", "Spinothalamic tract and dorsal nucleus of vagus", "Corticopontocerebellar fibers", "Vestibular nuclei and trigeminal nucleus"], ans: "Pyramid, medial lemniscus, hypoglossal nucleus", exp: "These three structures run contiguously in the medial medulla." },
        { q: "A newborn presents with herniation of cerebellar tonsils, hydrocephalus, apnea, and stridor. Most likely congenital anomaly?", opts: ["Dandy-Walker malformation", "Arnold-Chiari malformation", "Syringomyelia", "Holoprosencephaly"], ans: "Arnold-Chiari malformation", exp: "Type II Chiari malformation is characterized by tonsillar/medulla herniation, hydrocephalus, and brainstem signs (apnea, stridor)." },
        { q: "A patient develops loss of motor function and pain/temperature below lesion with preserved vibration and proprioception, after anterior spinal artery thrombosis. Syndrome?", opts: ["Anterior cord syndrome", "Central cord syndrome", "Brown-Séquard syndrome", "Complete cord transection"], ans: "Anterior cord syndrome", exp: "Ischemia of the anterior spinal artery (Anterior Cord Syndrome) spares the dorsal columns." },
        { q: "Elderly patient with cervical hyperextension injury shows upper limb weakness > lower limb, impaired pain and temperature in hands, vibration intact. Most likely mechanism?", opts: ["Anterior cord ischemia", "Central cord syndrome", "Brown-Séquard hemisection", "Syringomyelia"], ans: "Central cord syndrome", exp: "Hyperextension injury leading to CCS is the most likely mechanism." },
        { q: "Patient presents with vertigo, nausea, ipsilateral limb ataxia, ipsilateral Horner syndrome, dysphagia, and contralateral pain/temperature loss. MRI shows infarct in:", opts: ["Medial medulla", "Lateral medulla", "Pons", "Midbrain"], ans: "Lateral medulla", exp: "Wallenberg syndrome (Lateral Medulla)." },
        { q: "Stroke patient develops ipsilateral tongue deviation, contralateral hemiparesis, and contralateral loss of vibration/proprioception. Which site is most likely affected?", opts: ["Lateral medulla", "Medial medulla", "Pons", "Midbrain"], ans: "Medial medulla", exp: "Medial Medullary Syndrome." },
        { q: "Brainstem tumor causes ipsilateral facial weakness, lateral rectus palsy, contralateral hemiparesis, and ipsilateral ataxia. Which tract explains ipsilateral ataxia?", opts: ["Spinothalamic tract", "Corticospinal tract", "Corticopontocerebellar tract", "Medial lemniscus"], ans: "Corticopontocerebellar tract", exp: "Pontine/Brainstem lesion affecting the uncrossed corticopontocerebellar fibers." },
        { q: "Patient develops ipsilateral ptosis, lateral deviation of eyeball, dilated pupil, and contralateral hemiplegia due to midbrain infarct. Syndrome?", opts: ["Benedikt syndrome", "Weber syndrome", "Lateral medullary syndrome", "Medial medullary syndrome"], ans: "Weber syndrome", exp: "Midbrain lesion involving CN III and Crus Cerebri." },
        { q: "Patient presents with hoarseness, dysphagia, vertigo, nystagmus, ipsilateral Horner syndrome, and contralateral pain/temperature loss. Which artery is involved?", opts: ["Basilar artery", "PICA", "Anterior spinal artery", "Posterior cerebral artery"], ans: "PICA", exp: "Posterior Inferior Cerebellar Artery occlusion (Wallenberg)." },
        { q: "Cervical hyperextension injury in an elderly patient leads to upper limb weakness > lower limb, impaired pain/temp in hands, dorsal columns spared. Syndrome?", opts: ["Central cord syndrome", "Brown-Séquard syndrome", "Anterior cord syndrome", "Complete cord transection"], ans: "Central cord syndrome", exp: "Classic CCS." },
        { q: "Penetrating spinal cord hemisection produces ipsilateral motor & dorsal column loss, contralateral pain/temp loss. Syndrome?", opts: ["Central cord syndrome", "Brown-Séquard syndrome", "Anterior cord syndrome", "Complete cord transection"], ans: "Brown-Séquard syndrome", exp: "Spinal cord hemisection." },
        { q: "Post-trauma patient develops flaccid paralysis → spasticity below lesion, loss of all sensation, and autonomic dysfunction. Syndrome?", opts: ["Complete cord transection", "Central cord syndrome", "Brown-Séquard syndrome", "Anterior cord syndrome"], ans: "Complete cord transection", exp: "Initial flaccid (shock) followed by spasticity (release from cortical inhibition)." },
        { q: "Central cervical cord cavity presents with cape-like loss of pain and temperature in upper limbs, motor intact, dorsal columns spared. Diagnosis?", opts: ["Syringomyelia", "Central cord syndrome", "Anterior cord syndrome", "Brown-Séquard syndrome"], ans: "Syringomyelia", exp: "Central cavitation/syrinx affecting crossing spinothalamic fibers." },
        { q: "Newborn with herniated cerebellar tonsils and hydrocephalus presents with apnea. Most likely diagnosis?", opts: ["Arnold-Chiari malformation", "Syringomyelia", "Dandy-Walker malformation", "Holoprosencephaly"], ans: "Arnold-Chiari malformation", exp: "Chiari malformation (Type II) causes tonsillar herniation and brainstem compression (apnea)." }
    ];

    let currentQuestionIndex = 0;
    let shuffledQuestions = [];

    // Fisher-Yates (Knuth) Shuffle for randomizing the quiz
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function startQuiz() {
        // Shuffle the questions when the quiz starts
        shuffledQuestions = shuffleArray([...newMcqData]);
        currentQuestionIndex = 0;
        renderQuestion();
    }

    function renderQuestion() {
        const container = document.getElementById('content-container');
        if (shuffledQuestions.length === 0) {
            container.innerHTML = `<div class="text-center p-12 text-teal-700 dark:text-blue-300 bg-teal-50 dark:bg-gray-800 m-4 rounded-xl border border-teal-200 dark:border-gray-700 shadow-inner" style="border-color: var(--grid-line); background-color: var(--card-bg);">
                <p class="text-3xl mb-3 font-bold" style="color: var(--accent-light);">Quiz Ready!</p>
                <button onclick="startQuiz()" class="bg-teal-600 hover:bg-teal-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white dark:text-gray-900 font-bold py-3 px-6 rounded-full transition duration-150 shadow-lg hover:shadow-xl transform hover:scale-105" style="background-color: var(--accent-color);">Start ${newMcqData.length}-Question Quiz</button>
            </div>`;
            return;
        }

        const q = shuffledQuestions[currentQuestionIndex];
        const questionNumber = currentQuestionIndex + 1;
        
        let optionsHtml = q.opts.map((option, index) => {
            const letter = String.fromCharCode(65 + index);
            return `
                <button class="quiz-option w-full text-left p-4 my-3 rounded-xl border transition duration-200 text-gray-800 dark:text-gray-200 shadow-sm hover:shadow-md focus:outline-none" 
                        data-option="${option}" 
                        onclick="selectOption(this, '${q.ans}', '${q.exp.replace(/'/g, "\\'")}')"
                        style="background-color: var(--card-bg); border-color: var(--grid-line);">
                    <span class="font-bold text-teal-600 dark:text-blue-400 mr-2" style="color: var(--accent-light);">${letter}.</span> ${option}
                </button>
            `;
        }).join('');

        const skipOptions = shuffledQuestions.map((_, index) => `
            <option value="${index}" ${index === currentQuestionIndex ? 'selected' : ''}>Q${index + 1}</option>
        `).join('');


        container.innerHTML = `
            <div class="max-w-xl mx-auto p-6 bg-white dark:bg-gray-800 rounded-2xl shadow-2xl border border-gray-100 dark:border-gray-700 transition duration-300" style="background-color: var(--card-bg); border-color: var(--grid-line);">
                <div class="flex justify-between items-center mb-4 border-b pb-3 border-gray-200 dark:border-gray-700" style="border-bottom-color: var(--grid-line);">
                    <h2 class="text-xl font-bold text-teal-700 dark:text-blue-300" style="color: var(--accent-light);">Question ${questionNumber} / ${shuffledQuestions.length}</h2>
                    <select onchange="skipToQuestion(this.value)" class="p-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm bg-gray-50 dark:bg-gray-700 text-gray-800 dark:text-gray-200" style="border-color: var(--grid-line); background-color: var(--bg-color);">
                        ${skipOptions}
                    </select>
                </div>
                
                <p class="text-xl font-medium mb-6 text-gray-900 dark:text-gray-100 leading-relaxed">${q.q}</p>
                
                <div id="options-container">
                    ${optionsHtml}
                </div>

                <div id="feedback-area" class="mt-6 p-4 bg-green-100 dark:bg-green-900 rounded-xl border border-green-300 dark:border-green-600 hidden transition duration-300">
                    <p class="font-bold text-green-800 dark:text-green-300 mb-2 flex items-center">
                        <svg class="w-5 h-5 mr-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                        Correct Answer: <span id="correct-answer" class="ml-1 font-semibold"></span>
                    </p>
                    <p class="text-sm text-gray-700 dark:text-gray-200"><strong>Explanation:</strong> <span id="explanation-text"></span></p>
                </div>

                <div class="flex justify-between mt-6 pt-4 border-t border-gray-200 dark:border-gray-700" style="border-top-color: var(--grid-line);">
                    <button onclick="navigateQuestion(-1)" class="flex items-center text-teal-600 dark:text-blue-400 disabled:opacity-30 disabled:cursor-not-allowed font-medium p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-150" style="color: var(--accent-light);">
                        <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                        Previous
                    </button>
                    <button id="check-answer-btn" onclick="showAnswer()" class="bg-teal-500 hover:bg-teal-600 dark:bg-blue-500 dark:hover:bg-blue-400 text-white font-bold py-2 px-6 rounded-full transition duration-150 shadow-lg hover:shadow-xl transform hover:scale-105" style="background-color: var(--accent-color);">
                        Check Answer
                    </button>
                    <button onclick="navigateQuestion(1)" class="flex items-center text-teal-600 dark:text-blue-400 disabled:opacity-30 disabled:cursor-not-allowed font-medium p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-150" style="color: var(--accent-light);">
                        Next
                        <svg class="w-5 h-5 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                    </button>
                </div>
            </div>
        `;
        updateNavigationButtons();
    }

    function updateNavigationButtons() {
        const prevBtn = document.querySelector('button[onclick="navigateQuestion(-1)"]');
        const nextBtn = document.querySelector('button[onclick="navigateQuestion(1)"]');

        if (prevBtn) prevBtn.disabled = currentQuestionIndex === 0;
        if (nextBtn) nextBtn.disabled = currentQuestionIndex === shuffledQuestions.length - 1;
    }

    window.selectOption = function(selectedElement) {
        // Clear previous selection states
        document.querySelectorAll('.quiz-option').forEach(btn => {
            btn.classList.remove('selected');
            btn.classList.remove('correct');
            btn.disabled = false;
        });

        // Mark current selection
        selectedElement.classList.add('selected');

        // Hide feedback area and show check button
        document.getElementById('feedback-area').classList.add('hidden');
        document.getElementById('check-answer-btn').classList.remove('hidden');
    }

    window.showAnswer = function() {
        const q = shuffledQuestions[currentQuestionIndex];

        // Find and highlight the correct answer
        document.querySelectorAll('.quiz-option').forEach(btn => {
            const buttonText = btn.textContent.slice(3).trim(); // Remove A., B., C., D. prefix
            if (buttonText === q.ans) {
                btn.classList.add('correct');
            }
            btn.disabled = true; // Disable all options after checking
        });

        // Show feedback area
        document.getElementById('correct-answer').textContent = q.ans;
        document.getElementById('explanation-text').textContent = q.exp;
        document.getElementById('feedback-area').classList.remove('hidden');
        document.getElementById('check-answer-btn').classList.add('hidden');
    }

    window.navigateQuestion = function(direction) {
        currentQuestionIndex += direction;
        if (currentQuestionIndex < 0) currentQuestionIndex = 0;
        if (currentQuestionIndex >= shuffledQuestions.length) currentQuestionIndex = shuffledQuestions.length - 1;
        renderQuestion();
    }

    window.skipToQuestion = function(index) {
        currentQuestionIndex = parseInt(index);
        renderQuestion();
    }

    window.renderQuiz = function() {
        // Ensure quiz is initialized on first click
        if (shuffledQuestions.length === 0) {
            startQuiz();
        } else {
            renderQuestion();
        }
    }

    // Wait for the DOM to be fully loaded before initializing
    document.addEventListener('DOMContentLoaded', () => {
        setupTabs();
        updateThemeIcon(); // Set initial icon
        // Expose the toggle function globally so the inline onclick works
        window.toggleAccordion = toggleAccordion;
    });

</script>

</body>
</html>
